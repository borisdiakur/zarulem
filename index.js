var dc=Object.defineProperty;var jg=(n,e,t)=>e in n?dc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var fc=n=>dc(n,"__esModule",{value:!0});var pc=(n,e)=>()=>(e||(e={exports:{}},n(e.exports,e)),e.exports),mc=(n,e)=>{for(var t in e)dc(n,t,{get:e[t],enumerable:!0})};var ld=(n,e,t)=>(jg(n,typeof e!="symbol"?e+"":e,t),t);var xg=pc(k1=>{fc(k1);mc(k1,{default:()=>H1});function z1(n,e,{color:t=65280,scale:i=1,onInit:r,onUpdate:s,autoUpdate:o}={}){let a=[],c=new At({color:t!=null?t:65280,wireframe:!0}),u=new R,d=new R,f=new R,l=new ct,h=new Tl(1),p=new br(1,1,1),m=new _n(10,10,10,10);function v(P){let T=new We,I=[];for(let W=0;W<P.vertices.length;W++){let D=P.vertices[W];I.push(D.x,D.y,D.z)}T.setAttribute("position",new je(I,3));let U=[];for(let W=0;W<P.faces.length;W++){let D=P.faces[W],L=D[0];for(let O=1;O<D.length-1;O++){let F=D[O],Z=D[O+1];U.push(L,F,Z)}}return T.setIndex(U),T.computeBoundingSphere(),T.computeVertexNormals(),T}function _(P){let T=new We,I=[],U=u,W=d,D=f;for(let L=0;L<P.indices.length/3;L++)P.getTriangleVertices(L,U,W,D),I.push(U.x,U.y,U.z),I.push(W.x,W.y,W.z),I.push(D.x,D.y,D.z);return T.setAttribute("position",new je(I,3)),T.computeBoundingSphere(),T.computeVertexNormals(),T}function g(P){let T=new We,I=P.elementSize||1,U=P.data.flatMap((D,L)=>D.flatMap((O,F)=>[L*I,F*I,O])),W=[];for(let D=0;D<P.data.length-1;D++)for(let L=0;L<P.data[D].length-1;L++){let O=P.data[D].length,F=D*O+L;W.push(F+1,F+O,F+O+1),W.push(F+O,F+1,F)}return T.setIndex(W),T.setAttribute("position",new je(U,3)),T.computeBoundingSphere(),T.computeVertexNormals(),T}function y(P){let T=new ke,{SPHERE:I,BOX:U,PLANE:W,CYLINDER:D,CONVEXPOLYHEDRON:L,TRIMESH:O,HEIGHTFIELD:F}=ve.types;switch(P.type){case I:{T=new ke(h,c);break}case U:{T=new ke(p,c);break}case W:{T=new ke(m,c);break}case D:{let Z=new wu(P.radiusTop,P.radiusBottom,P.height,P.numSegments);T=new ke(Z,c),P.geometryId=Z.id;break}case L:{let Z=v(P);T=new ke(Z,c),P.geometryId=Z.id;break}case O:{let Z=_(P);T=new ke(Z,c),P.geometryId=Z.id;break}case F:{let Z=g(P);T=new ke(Z,c),P.geometryId=Z.id;break}}return n.add(T),T}function b(P,T){let{SPHERE:I,BOX:U,PLANE:W,CYLINDER:D,CONVEXPOLYHEDRON:L,TRIMESH:O,HEIGHTFIELD:F}=ve.types;switch(T.type){case I:{let{radius:Z}=T;P.scale.set(Z*i,Z*i,Z*i);break}case U:{P.scale.copy(T.halfExtents),P.scale.multiplyScalar(2*i);break}case W:break;case D:{P.scale.set(1*i,1*i,1*i);break}case L:{P.scale.set(1*i,1*i,1*i);break}case O:{P.scale.copy(T.scale).multiplyScalar(i);break}case F:{P.scale.set(1*i,1*i,1*i);break}}}function w(P,T){if(!P)return!1;let{geometry:I}=P;return I instanceof Tl&&T.type===ve.types.SPHERE||I instanceof br&&T.type===ve.types.BOX||I instanceof _n&&T.type===ve.types.PLANE||I.id===T.geometryId&&T.type===ve.types.CYLINDER||I.id===T.geometryId&&T.type===ve.types.CONVEXPOLYHEDRON||I.id===T.geometryId&&T.type===ve.types.TRIMESH||I.id===T.geometryId&&T.type===ve.types.HEIGHTFIELD}function x(P,T){let I=a[P],U=!1;return w(I,T)||(I&&n.remove(I),a[P]=I=y(T),U=!0),b(I,T),U}function S(){let P=a,T=u,I=l,U=0;for(let W of e)for(let D=0;D!==W.shapes.length;D++){let L=W.shapes[D],O=x(U,L),F=P[U];F&&(W.quaternion.vmult(W.shapeOffsets[D],T),W.position.vadd(T,T),W.quaternion.mult(W.shapeOrientations[D],I),F.position.copy(T),F.quaternion.copy(I),O&&r instanceof Function&&r(W,F,L),!O&&s instanceof Function&&s(W,F,L)),U++}for(let W=U;W<P.length;W++){let D=P[W];D&&n.remove(D)}P.length=U,o!==!1&&requestAnimationFrame(S)}return o!==!1&&requestAnimationFrame(S),{update:S}}var H1=z1});var bg=pc(U1=>{fc(U1);mc(U1,{Panel:()=>G1,__moduleExports:()=>Kh,default:()=>V1});var Kh=$l(function(n,e){(function(t,i){n.exports=i()})(mn,function(){var t=function(){function i(h){return o.appendChild(h.dom),h}function r(h){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===h?"block":"none";s=h}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(h){h.preventDefault(),r(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,u=0,d=i(new t.Panel("FPS","#0ff","#002")),f=i(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=i(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:o,addPanel:i,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){u++;var h=(performance||Date).now();if(f.update(h-a,200),h>c+1e3&&(d.update(1e3*u/(h-c),100),c=h,u=0,l)){var p=performance.memory;l.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return h},update:function(){a=this.end()},domElement:o,setMode:r}};return t.Panel=function(i,r,s){var o=Infinity,a=0,c=Math.round,u=c(window.devicePixelRatio||1),d=80*u,f=48*u,l=3*u,h=2*u,p=3*u,m=15*u,v=74*u,_=30*u,g=document.createElement("canvas");g.width=d,g.height=f,g.style.cssText="width:80px;height:48px";var y=g.getContext("2d");return y.font="bold "+9*u+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=s,y.fillRect(0,0,d,f),y.fillStyle=r,y.fillText(i,l,h),y.fillRect(p,m,v,_),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(p,m,v,_),{dom:g,update:function(b,w){o=Math.min(o,b),a=Math.max(a,b),y.fillStyle=s,y.globalAlpha=1,y.fillRect(0,0,d,m),y.fillStyle=r,y.fillText(c(b)+" "+i+" ("+c(o)+"-"+c(a)+")",l,h),y.drawImage(g,p+u,m,v-u,_,p,m,v-u,_),y.fillRect(p+v-u,m,u,_),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(p+v-u,m,u,c((1-b/w)*_))}}},t})}),G1=Kh.Panel,V1=Kh});var Wg=pc(W1=>{fc(W1);mc(W1,{GUI:()=>Vg,color:()=>zg,controllers:()=>Hg,default:()=>hE,dom:()=>Ug,gui:()=>Gg});function j1(n){if(!!n&&typeof window!="undefined"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=n,document.head.appendChild(e),n}}function Ks(n,e){var t=n.__state.conversionName.toString(),i=Math.round(n.r),r=Math.round(n.g),s=Math.round(n.b),o=n.a,a=Math.round(n.h),c=n.s.toFixed(1),u=n.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var d=n.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}else{if(t==="CSS_RGB")return"rgb("+i+","+r+","+s+")";if(t==="CSS_RGBA")return"rgba("+i+","+r+","+s+","+o+")";if(t==="HEX")return"0x"+n.hex.toString(16);if(t==="RGB_ARRAY")return"["+i+","+r+","+s+"]";if(t==="RGBA_ARRAY")return"["+i+","+r+","+s+","+o+"]";if(t==="RGB_OBJ")return"{r:"+i+",g:"+r+",b:"+s+"}";if(t==="RGBA_OBJ")return"{r:"+i+",g:"+r+",b:"+s+",a:"+o+"}";if(t==="HSV_OBJ")return"{h:"+a+",s:"+c+",v:"+u+"}";if(t==="HSVA_OBJ")return"{h:"+a+",s:"+c+",v:"+u+",a:"+o+"}"}return"unknown format"}var wg=Array.prototype.forEach,fa=Array.prototype.slice,ue={BREAK:{},extend:function(e){return this.each(fa.call(arguments,1),function(t){var i=this.isObject(t)?Object.keys(t):[];i.forEach(function(r){this.isUndefined(t[r])||(e[r]=t[r])}.bind(this))},this),e},defaults:function(e){return this.each(fa.call(arguments,1),function(t){var i=this.isObject(t)?Object.keys(t):[];i.forEach(function(r){this.isUndefined(e[r])&&(e[r]=t[r])}.bind(this))},this),e},compose:function(){var e=fa.call(arguments);return function(){for(var t=fa.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,t,i){if(!!e){if(wg&&e.forEach&&e.forEach===wg)e.forEach(t,i);else if(e.length===e.length+0){var r=void 0,s=void 0;for(r=0,s=e.length;r<s;r++)if(r in e&&t.call(i,e[r],r)===this.BREAK)return}else for(var o in e)if(t.call(i,e[o],o)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var r=void 0;return function(){var s=this,o=arguments;function a(){r=null,i||e.apply(s,o)}var c=i||!r;clearTimeout(r),r=setTimeout(a,t),c&&e.apply(s,o)}},toArray:function(e){return e.toArray?e.toArray():fa.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(n){function e(t){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},q1=[{litmus:ue.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Ks},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Ks},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Ks},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Ks}}},{litmus:ue.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:ue.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:ue.isObject,conversions:{RGBA_OBJ:{read:function(e){return ue.isNumber(e.r)&&ue.isNumber(e.g)&&ue.isNumber(e.b)&&ue.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return ue.isNumber(e.r)&&ue.isNumber(e.g)&&ue.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return ue.isNumber(e.h)&&ue.isNumber(e.s)&&ue.isNumber(e.v)&&ue.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return ue.isNumber(e.h)&&ue.isNumber(e.s)&&ue.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],pa=void 0,rc=void 0,sc=function(){rc=!1;var e=arguments.length>1?ue.toArray(arguments):arguments[0];return ue.each(q1,function(t){if(t.litmus(e))return ue.each(t.conversions,function(i,r){if(pa=i.read(e),rc===!1&&pa!==!1)return rc=pa,pa.conversionName=r,pa.conversion=i,ue.BREAK}),ue.BREAK}),rc},Mg=void 0,ma={hsv_to_rgb:function(e,t,i){var r=Math.floor(e/60)%6,s=e/60-Math.floor(e/60),o=i*(1-t),a=i*(1-s*t),c=i*(1-(1-s)*t),u=[[i,c,o],[a,i,o],[o,i,c],[o,a,i],[c,o,i],[i,o,a]][r];return{r:u[0]*255,g:u[1]*255,b:u[2]*255}},rgb_to_hsv:function(e,t,i){var r=Math.min(e,t,i),s=Math.max(e,t,i),o=s-r,a=void 0,c=void 0;if(s!==0)c=o/s;else return{h:NaN,s:0,v:0};return e===s?a=(t-i)/o:t===s?a=2+(i-e)/o:a=4+(e-t)/o,a/=6,a<0&&(a+=1),{h:a*360,s:c,v:s/255}},rgb_to_hex:function(e,t,i){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,i),r},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,i){return i<<(Mg=t*8)|e&~(255<<Mg)}},X1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zn=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},Hn=function(){function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),ar=function n(e,t,i){e===null&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(r===void 0){var s=Object.getPrototypeOf(e);return s===null?void 0:n(s,t,i)}else{if("value"in r)return r.value;var o=r.get;return o===void 0?void 0:o.call(i)}},lr=function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},cr=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n},bt=function(){function n(){if(zn(this,n),this.__state=sc.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Hn(n,[{key:"toString",value:function(){return Ks(this)}},{key:"toHexString",value:function(){return Ks(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function $h(n,e,t){Object.defineProperty(n,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(bt.recalculateRGB(this,e,t),this.__state[e])},set:function(r){this.__state.space!=="RGB"&&(bt.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=r}})}function Qh(n,e){Object.defineProperty(n,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(bt.recalculateHSV(this),this.__state[e])},set:function(i){this.__state.space!=="HSV"&&(bt.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=i}})}bt.recalculateRGB=function(n,e,t){if(n.__state.space==="HEX")n.__state[e]=ma.component_from_hex(n.__state.hex,t);else if(n.__state.space==="HSV")ue.extend(n.__state,ma.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")};bt.recalculateHSV=function(n){var e=ma.rgb_to_hsv(n.r,n.g,n.b);ue.extend(n.__state,{s:e.s,v:e.v}),ue.isNaN(e.h)?ue.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=e.h};bt.COMPONENTS=["r","g","b","h","s","v","hex","a"];$h(bt.prototype,"r",2);$h(bt.prototype,"g",1);$h(bt.prototype,"b",0);Qh(bt.prototype,"h");Qh(bt.prototype,"s");Qh(bt.prototype,"v");Object.defineProperty(bt.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(bt.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ma.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var ur=function(){function n(e,t){zn(this,n),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return Hn(n,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),Y1={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Sg={};ue.each(Y1,function(n,e){ue.each(n,function(t){Sg[t]=e})});var Z1=/(\d+(\.\d+)?)px/;function li(n){if(n==="0"||ue.isUndefined(n))return 0;var e=n.match(Z1);return ue.isNull(e)?0:parseFloat(e[1])}var Q={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var r=i,s=t;ue.isUndefined(s)&&(s=!0),ue.isUndefined(r)&&(r=!0),e.style.position="absolute",s&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,r){var s=i||{},o=Sg[t];if(!o)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":{var c=s.x||s.clientX||0,u=s.y||s.clientY||0;a.initMouseEvent(t,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,c,u,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var d=a.initKeyboardEvent||a.initKeyEvent;ue.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(t,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break}default:{a.initEvent(t,s.bubbles||!1,s.cancelable||!0);break}}ue.defaults(a,r),e.dispatchEvent(a)},bind:function(e,t,i,r){var s=r||!1;return e.addEventListener?e.addEventListener(t,i,s):e.attachEvent&&e.attachEvent("on"+t,i),Q},unbind:function(e,t,i,r){var s=r||!1;return e.removeEventListener?e.removeEventListener(t,i,s):e.detachEvent&&e.detachEvent("on"+t,i),Q},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);i.indexOf(t)===-1&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Q},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),r=i.indexOf(t);r!==-1&&(i.splice(r,1),e.className=i.join(" "))}else e.className=void 0;return Q},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return li(t["border-left-width"])+li(t["border-right-width"])+li(t["padding-left"])+li(t["padding-right"])+li(t.width)},getHeight:function(e){var t=getComputedStyle(e);return li(t["border-top-width"])+li(t["border-bottom-width"])+li(t["padding-top"])+li(t["padding-bottom"])+li(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent;while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ed=function(n){lr(e,n);function e(t,i){zn(this,e);var r=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=r;r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox");function o(){s.setValue(!s.__prev)}return Q.bind(r.__checkbox,"change",o,!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return Hn(e,[{key:"setValue",value:function(i){var r=ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ur),Tg=function(n){lr(e,n);function e(t,i,r){zn(this,e);var s=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r,a=s;if(s.__select=document.createElement("select"),ue.isArray(o)){var c={};ue.each(o,function(u){c[u]=u}),o=c}return ue.each(o,function(u,d){var f=document.createElement("option");f.innerHTML=d,f.setAttribute("value",u),a.__select.appendChild(f)}),s.updateDisplay(),Q.bind(s.__select,"change",function(){var u=this.options[this.selectedIndex].value;a.setValue(u)}),s.domElement.appendChild(s.__select),s}return Hn(e,[{key:"setValue",value:function(i){var r=ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return Q.isActive(this.__select)?this:(this.__select.value=this.getValue(),ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(ur),Eg=function(n){lr(e,n);function e(t,i){zn(this,e);var r=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=r;function o(){s.setValue(s.__input.value)}function a(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),Q.bind(r.__input,"keyup",o),Q.bind(r.__input,"change",o),Q.bind(r.__input,"blur",a),Q.bind(r.__input,"keydown",function(c){c.keyCode===13&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Hn(e,[{key:"updateDisplay",value:function(){return Q.isActive(this.__input)||(this.__input.value=this.getValue()),ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ur);function Ag(n){var e=n.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var td=function(n){lr(e,n);function e(t,i,r){zn(this,e);var s=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r||{};return s.__min=o.min,s.__max=o.max,s.__step=o.step,ue.isUndefined(s.__step)?s.initialValue===0?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=Ag(s.__impliedStep),s}return Hn(e,[{key:"setValue",value:function(i){var r=i;return this.__min!==void 0&&r<this.__min?r=this.__min:this.__max!==void 0&&r>this.__max&&(r=this.__max),this.__step!==void 0&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(i){return this.__min=i,this}},{key:"max",value:function(i){return this.__max=i,this}},{key:"step",value:function(i){return this.__step=i,this.__impliedStep=i,this.__precision=Ag(i),this}}]),e}(ur);function J1(n,e){var t=Math.pow(10,e);return Math.round(n*t)/t}var ga=function(n){lr(e,n);function e(t,i,r){zn(this,e);var s=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r));s.__truncationSuspended=!1;var o=s,a=void 0;function c(){var p=parseFloat(o.__input.value);ue.isNaN(p)||o.setValue(p)}function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function d(){u()}function f(p){var m=a-p.clientY;o.setValue(o.getValue()+m*o.__impliedStep),a=p.clientY}function l(){Q.unbind(window,"mousemove",f),Q.unbind(window,"mouseup",l),u()}function h(p){Q.bind(window,"mousemove",f),Q.bind(window,"mouseup",l),a=p.clientY}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),Q.bind(s.__input,"change",c),Q.bind(s.__input,"blur",d),Q.bind(s.__input,"mousedown",h),Q.bind(s.__input,"keydown",function(p){p.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,u())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return Hn(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():J1(this.getValue(),this.__precision),ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(td);function Cg(n,e,t,i,r){return i+(r-i)*((n-e)/(t-e))}var oc=function(n){lr(e,n);function e(t,i,r,s,o){zn(this,e);var a=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:r,max:s,step:o})),c=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),Q.bind(a.__background,"mousedown",u),Q.bind(a.__background,"touchstart",l),Q.addClass(a.__background,"slider"),Q.addClass(a.__foreground,"slider-fg");function u(m){document.activeElement.blur(),Q.bind(window,"mousemove",d),Q.bind(window,"mouseup",f),d(m)}function d(m){m.preventDefault();var v=c.__background.getBoundingClientRect();return c.setValue(Cg(m.clientX,v.left,v.right,c.__min,c.__max)),!1}function f(){Q.unbind(window,"mousemove",d),Q.unbind(window,"mouseup",f),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function l(m){m.touches.length===1&&(Q.bind(window,"touchmove",h),Q.bind(window,"touchend",p),h(m))}function h(m){var v=m.touches[0].clientX,_=c.__background.getBoundingClientRect();c.setValue(Cg(v,_.left,_.right,c.__min,c.__max))}function p(){Q.unbind(window,"touchmove",h),Q.unbind(window,"touchend",p),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return Hn(e,[{key:"updateDisplay",value:function(){var i=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=i*100+"%",ar(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(td),nd=function(n){lr(e,n);function e(t,i,r){zn(this,e);var s=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=s;return s.__button=document.createElement("div"),s.__button.innerHTML=r===void 0?"Fire":r,Q.bind(s.__button,"click",function(a){return a.preventDefault(),o.fire(),!1}),Q.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return Hn(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(ur),ac=function(n){lr(e,n);function e(t,i){zn(this,e);var r=cr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));r.__color=new bt(r.getValue()),r.__temp=new bt(0);var s=r;r.domElement=document.createElement("div"),Q.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",Q.bind(r.__input,"keydown",function(m){m.keyCode===13&&f.call(this)}),Q.bind(r.__input,"blur",f),Q.bind(r.__selector,"mousedown",function(){Q.addClass(this,"drag").bind(window,"mouseup",function(){Q.removeClass(s.__selector,"drag")})}),Q.bind(r.__selector,"touchstart",function(){Q.addClass(this,"drag").bind(window,"touchend",function(){Q.removeClass(s.__selector,"drag")})});var o=document.createElement("div");ue.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),ue.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),ue.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),ue.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),ue.extend(o.style,{width:"100%",height:"100%",background:"none"}),Lg(o,"top","rgba(0,0,0,0)","#000"),ue.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),K1(r.__hue_field),ue.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),Q.bind(r.__saturation_field,"mousedown",a),Q.bind(r.__saturation_field,"touchstart",a),Q.bind(r.__field_knob,"mousedown",a),Q.bind(r.__field_knob,"touchstart",a),Q.bind(r.__hue_field,"mousedown",c),Q.bind(r.__hue_field,"touchstart",c);function a(m){h(m),Q.bind(window,"mousemove",h),Q.bind(window,"touchmove",h),Q.bind(window,"mouseup",u),Q.bind(window,"touchend",u)}function c(m){p(m),Q.bind(window,"mousemove",p),Q.bind(window,"touchmove",p),Q.bind(window,"mouseup",d),Q.bind(window,"touchend",d)}function u(){Q.unbind(window,"mousemove",h),Q.unbind(window,"touchmove",h),Q.unbind(window,"mouseup",u),Q.unbind(window,"touchend",u),l()}function d(){Q.unbind(window,"mousemove",p),Q.unbind(window,"touchmove",p),Q.unbind(window,"mouseup",d),Q.unbind(window,"touchend",d),l()}function f(){var m=sc(this.value);m!==!1?(s.__color.__state=m,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function l(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}r.__saturation_field.appendChild(o),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay();function h(m){m.type.indexOf("touch")===-1&&m.preventDefault();var v=s.__saturation_field.getBoundingClientRect(),_=m.touches&&m.touches[0]||m,g=_.clientX,y=_.clientY,b=(g-v.left)/(v.right-v.left),w=1-(y-v.top)/(v.bottom-v.top);return w>1?w=1:w<0&&(w=0),b>1?b=1:b<0&&(b=0),s.__color.v=w,s.__color.s=b,s.setValue(s.__color.toOriginal()),!1}function p(m){m.type.indexOf("touch")===-1&&m.preventDefault();var v=s.__hue_field.getBoundingClientRect(),_=m.touches&&m.touches[0]||m,g=_.clientY,y=1-(g-v.top)/(v.bottom-v.top);return y>1?y=1:y<0&&(y=0),s.__color.h=y*360,s.setValue(s.__color.toOriginal()),!1}return r}return Hn(e,[{key:"updateDisplay",value:function(){var i=sc(this.getValue());if(i!==!1){var r=!1;ue.each(bt.COMPONENTS,function(a){if(!ue.isUndefined(i[a])&&!ue.isUndefined(this.__color.__state[a])&&i[a]!==this.__color.__state[a])return r=!0,{}},this),r&&ue.extend(this.__color.__state,i)}ue.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,o=255-s;ue.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Lg(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),ue.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),e}(ur),$1=["-moz-","-o-","-webkit-","-ms-",""];function Lg(n,e,t,i){n.style.background="",ue.each($1,function(r){n.style.cssText+="background: "+r+"linear-gradient("+e+", "+t+" 0%, "+i+" 100%); "})}function K1(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var Q1={load:function(e,t){var i=t||document,r=i.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,i.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){var i=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var s=i.getElementsByTagName("head")[0];try{s.appendChild(r)}catch(o){}}},eE=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,tE=function(e,t){var i=e[t];return ue.isArray(arguments[2])||ue.isObject(arguments[2])?new Tg(e,t,arguments[2]):ue.isNumber(i)?ue.isNumber(arguments[2])&&ue.isNumber(arguments[3])?ue.isNumber(arguments[4])?new oc(e,t,arguments[2],arguments[3],arguments[4]):new oc(e,t,arguments[2],arguments[3]):ue.isNumber(arguments[4])?new ga(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ga(e,t,{min:arguments[2],max:arguments[3]}):ue.isString(i)?new Eg(e,t):ue.isFunction(i)?new nd(e,t,""):ue.isBoolean(i)?new ed(e,t):null};function nE(n){setTimeout(n,1e3/60)}var iE=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||nE,rE=function(){function n(){zn(this,n),this.backgroundElement=document.createElement("div"),ue.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Q.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),ue.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;Q.bind(this.backgroundElement,"click",function(){e.hide()})}return Hn(n,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),ue.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,i=function r(){t.domElement.style.display="none",t.backgroundElement.style.display="none",Q.unbind(t.domElement,"webkitTransitionEnd",r),Q.unbind(t.domElement,"transitionend",r),Q.unbind(t.domElement,"oTransitionEnd",r)};Q.bind(this.domElement,"webkitTransitionEnd",i),Q.bind(this.domElement,"transitionend",i),Q.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Q.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Q.getHeight(this.domElement)/2+"px"}}]),n}(),sE=j1(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);Q1.inject(sE);var Rg="dg",Pg=72,Ig=20,_a="Default",va=function(){try{return!!window.localStorage}catch(n){return!1}}(),ya=void 0,Og=!0,$s=void 0,id=!1,Dg=[],$e=function n(e){var t=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Q.addClass(this.domElement,Rg),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=ue.defaults(i,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),i=ue.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),ue.isUndefined(i.load)?i.load={preset:_a}:i.preset&&(i.load.preset=i.preset),ue.isUndefined(i.parent)&&i.hideable&&Dg.push(this),i.resizable=ue.isUndefined(i.parent)&&i.resizable,i.autoPlace&&ue.isUndefined(i.scrollable)&&(i.scrollable=!0);var r=va&&localStorage.getItem(Qs(this,"isLocal"))==="true",s=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:i.load.preset},set:function(l){t.parent?t.getRoot().preset=l:i.load.preset=l,aE(this),t.revert()}},width:{get:function(){return i.width},set:function(l){i.width=l,sd(t,l)}},name:{get:function(){return i.name},set:function(l){i.name=l,o&&(o.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(l){i.closed=l,i.closed?Q.addClass(t.__ul,n.CLASS_CLOSED):Q.removeClass(t.__ul,n.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=l?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return r},set:function(l){va&&(r=l,l?Q.bind(window,"unload",s):Q.unbind(window,"unload",s),localStorage.setItem(Qs(t,"isLocal"),l))}}}),ue.isUndefined(i.parent)){if(this.closed=i.closed||!1,Q.addClass(this.domElement,n.CLASS_MAIN),Q.makeSelectable(this.domElement,!1),va&&r){t.useLocalStorage=!0;var a=localStorage.getItem(Qs(this,"gui"));a&&(i.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,Q.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),i.closeOnTop?(Q.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Q.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Q.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{i.closed===void 0&&(i.closed=!0);var c=document.createTextNode(i.name);Q.addClass(c,"controller-name"),o=rd(t,c);var u=function(l){return l.preventDefault(),t.closed=!t.closed,!1};Q.addClass(this.__ul,n.CLASS_CLOSED),Q.addClass(o,"title"),Q.bind(o,"click",u),i.closed||(this.closed=!1)}i.autoPlace&&(ue.isUndefined(i.parent)&&(Og&&($s=document.createElement("div"),Q.addClass($s,Rg),Q.addClass($s,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild($s),Og=!1),$s.appendChild(this.domElement),Q.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||sd(t,i.width)),this.__resizeHandler=function(){t.onResizeDebounced()},Q.bind(window,"resize",this.__resizeHandler),Q.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Q.bind(this.__ul,"transitionend",this.__resizeHandler),Q.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&oE(this),s=function(){va&&localStorage.getItem(Qs(t,"isLocal"))==="true"&&localStorage.setItem(Qs(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=s;function d(){var f=t.getRoot();f.width+=1,ue.defer(function(){f.width-=1})}i.parent||d()};$e.toggleHide=function(){id=!id,ue.each(Dg,function(n){n.domElement.style.display=id?"none":""})};$e.CLASS_AUTO_PLACE="a";$e.CLASS_AUTO_PLACE_CONTAINER="ac";$e.CLASS_MAIN="main";$e.CLASS_CONTROLLER_ROW="cr";$e.CLASS_TOO_TALL="taller-than-window";$e.CLASS_CLOSED="closed";$e.CLASS_CLOSE_BUTTON="close-button";$e.CLASS_CLOSE_TOP="close-top";$e.CLASS_CLOSE_BOTTOM="close-bottom";$e.CLASS_DRAG="drag";$e.DEFAULT_WIDTH=245;$e.TEXT_CLOSED="Close Controls";$e.TEXT_OPEN="Open Controls";$e._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===Pg||n.keyCode===Pg)&&$e.toggleHide()};Q.bind(window,"keydown",$e._keydownHandler,!1);ue.extend($e.prototype,{add:function(e,t){return xa(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return xa(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;ue.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&$s.removeChild(this.domElement);var e=this;ue.each(this.__folders,function(t){e.removeFolder(t)}),Q.unbind(window,"keydown",$e._keydownHandler,!1),Fg(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new $e(t);this.__folders[e]=i;var r=rd(this,i.domElement);return Q.addClass(r,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Fg(e);var t=this;ue.each(e.__folders,function(i){e.removeFolder(i)}),ue.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Q.getOffset(e.__ul).top,i=0;ue.each(e.__ul.childNodes,function(r){e.autoPlace&&r===e.__save_row||(i+=Q.getHeight(r))}),window.innerHeight-t-Ig<i?(Q.addClass(e.domElement,$e.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-Ig+"px"):(Q.removeClass(e.domElement,$e.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&ue.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:ue.debounce(function(){this.onResize()},50),remember:function(){if(ue.isUndefined(ya)&&(ya=new rE,ya.domElement.innerHTML=eE),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;ue.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&lE(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&sd(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=lc(this)),e.folders={},ue.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=lc(this),od(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[_a]=lc(this,!0)),this.load.remembered[e]=lc(this),this.preset=e,ad(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){ue.each(this.__controllers,function(t){this.getRoot().load.remembered?Bg(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),ue.each(this.__folders,function(t){t.revert(t)}),e||od(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&Ng(this.__listening)},updateDisplay:function(){ue.each(this.__controllers,function(e){e.updateDisplay()}),ue.each(this.__folders,function(e){e.updateDisplay()})}});function rd(n,e,t){var i=document.createElement("li");return e&&i.appendChild(e),t?n.__ul.insertBefore(i,t):n.__ul.appendChild(i),n.onResize(),i}function Fg(n){Q.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&Q.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function od(n,e){var t=n.__preset_select[n.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function cE(n,e,t){if(t.__li=e,t.__gui=n,ue.extend(t,{options:function(o){if(arguments.length>1){var a=t.__li.nextElementSibling;return t.remove(),xa(n,t.object,t.property,{before:a,factoryArgs:[ue.toArray(arguments)]})}if(ue.isArray(o)||ue.isObject(o)){var c=t.__li.nextElementSibling;return t.remove(),xa(n,t.object,t.property,{before:c,factoryArgs:[o]})}},name:function(o){return t.__li.firstElementChild.firstElementChild.innerHTML=o,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof oc){var i=new ga(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});ue.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(s){var o=t[s],a=i[s];t[s]=i[s]=function(){var c=Array.prototype.slice.call(arguments);return a.apply(i,c),o.apply(t,c)}}),Q.addClass(e,"has-slider"),t.domElement.insertBefore(i.domElement,t.domElement.firstElementChild)}else if(t instanceof ga){var r=function(o){if(ue.isNumber(t.__min)&&ue.isNumber(t.__max)){var a=t.__li.firstElementChild.firstElementChild.innerHTML,c=t.__gui.__listening.indexOf(t)>-1;t.remove();var u=xa(n,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return u.name(a),c&&u.listen(),u}return o};t.min=ue.compose(r,t.min),t.max=ue.compose(r,t.max)}else t instanceof ed?(Q.bind(e,"click",function(){Q.fakeEvent(t.__checkbox,"click")}),Q.bind(t.__checkbox,"click",function(s){s.stopPropagation()})):t instanceof nd?(Q.bind(e,"click",function(){Q.fakeEvent(t.__button,"click")}),Q.bind(e,"mouseover",function(){Q.addClass(t.__button,"hover")}),Q.bind(e,"mouseout",function(){Q.removeClass(t.__button,"hover")})):t instanceof ac&&(Q.addClass(e,"color"),t.updateDisplay=ue.compose(function(s){return e.style.borderLeftColor=t.__color.toString(),s},t.updateDisplay),t.updateDisplay());t.setValue=ue.compose(function(s){return n.getRoot().__preset_select&&t.isModified()&&od(n.getRoot(),!0),s},t.setValue)}function Bg(n,e){var t=n.getRoot(),i=t.__rememberedObjects.indexOf(e.object);if(i!==-1){var r=t.__rememberedObjectIndecesToControllers[i];if(r===void 0&&(r={},t.__rememberedObjectIndecesToControllers[i]=r),r[e.property]=e,t.load&&t.load.remembered){var s=t.load.remembered,o=void 0;if(s[n.preset])o=s[n.preset];else if(s[_a])o=s[_a];else return;if(o[i]&&o[i][e.property]!==void 0){var a=o[i][e.property];e.initialValue=a,e.setValue(a)}}}}function xa(n,e,t,i){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var r=void 0;if(i.color)r=new ac(e,t);else{var s=[e,t].concat(i.factoryArgs);r=tE.apply(n,s)}i.before instanceof ur&&(i.before=i.before.__li),Bg(n,r),Q.addClass(r.domElement,"c");var o=document.createElement("span");Q.addClass(o,"property-name"),o.innerHTML=r.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(r.domElement);var c=rd(n,a,i.before);return Q.addClass(c,$e.CLASS_CONTROLLER_ROW),r instanceof ac?Q.addClass(c,"color"):Q.addClass(c,X1(r.getValue())),cE(n,c,r),n.__controllers.push(r),r}function Qs(n,e){return document.location.href+"."+e}function ad(n,e,t){var i=document.createElement("option");i.innerHTML=e,i.value=e,n.__preset_select.appendChild(i),t&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function kg(n,e){e.style.display=n.useLocalStorage?"block":"none"}function lE(n){var e=n.__save_row=document.createElement("li");Q.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),Q.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",Q.addClass(t,"button gears");var i=document.createElement("span");i.innerHTML="Save",Q.addClass(i,"button"),Q.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New",Q.addClass(r,"button"),Q.addClass(r,"save-as");var s=document.createElement("span");s.innerHTML="Revert",Q.addClass(s,"button"),Q.addClass(s,"revert");var o=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?ue.each(n.load.remembered,function(f,l){ad(n,l,l===n.preset)}):ad(n,_a,!1),Q.bind(o,"change",function(){for(var f=0;f<n.__preset_select.length;f++)n.__preset_select[f].innerHTML=n.__preset_select[f].value;n.preset=this.value}),e.appendChild(o),e.appendChild(t),e.appendChild(i),e.appendChild(r),e.appendChild(s),va){var a=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block",localStorage.getItem(Qs(n,"isLocal"))==="true"&&c.setAttribute("checked","checked"),kg(n,a),Q.bind(c,"change",function(){n.useLocalStorage=!n.useLocalStorage,kg(n,a)})}var d=document.getElementById("dg-new-constructor");Q.bind(d,"keydown",function(f){f.metaKey&&(f.which===67||f.keyCode===67)&&ya.hide()}),Q.bind(t,"click",function(){d.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),ya.show(),d.focus(),d.select()}),Q.bind(i,"click",function(){n.save()}),Q.bind(r,"click",function(){var f=prompt("Enter a new preset name.");f&&n.saveAs(f)}),Q.bind(s,"click",function(){n.revert()})}function oE(n){var e=void 0;n.__resize_handle=document.createElement("div"),ue.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(s){return s.preventDefault(),n.width+=e-s.clientX,n.onResize(),e=s.clientX,!1}function i(){Q.removeClass(n.__closeButton,$e.CLASS_DRAG),Q.unbind(window,"mousemove",t),Q.unbind(window,"mouseup",i)}function r(s){return s.preventDefault(),e=s.clientX,Q.addClass(n.__closeButton,$e.CLASS_DRAG),Q.bind(window,"mousemove",t),Q.bind(window,"mouseup",i),!1}Q.bind(n.__resize_handle,"mousedown",r),Q.bind(n.__closeButton,"mousedown",r),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function sd(n,e){n.domElement.style.width=e+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=e+"px"),n.__closeButton&&(n.__closeButton.style.width=e+"px")}function lc(n,e){var t={};return ue.each(n.__rememberedObjects,function(i,r){var s={},o=n.__rememberedObjectIndecesToControllers[r];ue.each(o,function(a,c){s[c]=e?a.initialValue:a.getValue()}),t[r]=s}),t}function aE(n){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].value===n.preset&&(n.__preset_select.selectedIndex=e)}function Ng(n){n.length!==0&&iE.call(window,function(){Ng(n)}),ue.each(n,function(e){e.updateDisplay()})}var zg={Color:bt,math:ma,interpret:sc},Hg={Controller:ur,BooleanController:ed,OptionController:Tg,StringController:Eg,NumberController:td,NumberControllerBox:ga,NumberControllerSlider:oc,FunctionController:nd,ColorController:ac},Ug={dom:Q},Gg={GUI:$e},Vg=$e,uE={color:zg,controllers:Hg,dom:Ug,gui:Gg,GUI:Vg},hE=uE});var Cn=class{constructor(e=[0,0,0,0,0,0,0,0,0]){this.elements=e}identity(){let e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){let e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){let t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e=new R){let t=this.elements;e.x=t[0],e.y=t[4],e.z=t[8]}vmult(e,t=new R){let i=this.elements,r=e.x,s=e.y,o=e.z;return t.x=i[0]*r+i[1]*s+i[2]*o,t.y=i[3]*r+i[4]*s+i[5]*o,t.z=i[6]*r+i[7]*s+i[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t=new Cn){let{elements:i}=e;for(let r=0;r<3;r++)for(let s=0;s<3;s++){let o=0;for(let a=0;a<3;a++)o+=i[r+a*3]*this.elements[a+s*3];t.elements[r+s*3]=o}return t}scale(e,t=new Cn){let i=this.elements,r=t.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*i[3*s+0],r[3*s+1]=e.y*i[3*s+1],r[3*s+2]=e.z*i[3*s+2];return t}solve(e,t=new R){let i=3,r=4,s=[],o,a;for(o=0;o<i*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let c=3,u=c,d,f=4,l;do{if(o=u-c,s[o+r*o]===0){for(a=o+1;a<u;a++)if(s[o+r*a]!==0){d=f;do l=f-d,s[l+r*o]+=s[l+r*a];while(--d);break}}if(s[o+r*o]!==0)for(a=o+1;a<u;a++){let h=s[o+r*a]/s[o+r*o];d=f;do l=f-d,s[l+r*a]=l<=o?0:s[l+r*a]-s[l+r*o]*h;while(--d)}}while(--c);if(t.z=s[2*r+3]/s[2*r+2],t.y=(s[1*r+3]-s[1*r+2]*t.z)/s[1*r+1],t.x=(s[0*r+3]-s[0*r+2]*t.z-s[0*r+1]*t.y)/s[0*r+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===Infinity||t.y===Infinity||t.z===Infinity)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="",t=",";for(let i=0;i<9;i++)e+=this.elements[i]+t;return e}reverse(e=new Cn){let t=3,i=6,r=[],s,o;for(s=0;s<t*i;s++)r.push(0);for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+i*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3,c=a,u,d=i,f;do{if(s=c-a,r[s+i*s]===0){for(o=s+1;o<c;o++)if(r[s+i*o]!==0){u=d;do f=d-u,r[f+i*s]+=r[f+i*o];while(--u);break}}if(r[s+i*s]!==0)for(o=s+1;o<c;o++){let l=r[s+i*o]/r[s+i*s];u=d;do f=d-u,r[f+i*o]=f<=s?0:r[f+i*o]-r[f+i*s]*l;while(--u)}}while(--a);s=2;do{o=s-1;do{let l=r[s+i*o]/r[s+i*s];u=i;do f=i-u,r[f+i*o]=r[f+i*o]-r[f+i*s]*l;while(--u)}while(o--)}while(--s);s=2;do{let l=1/r[s+i*s];u=i;do f=i-u,r[f+i*s]=r[f+i*s]*l;while(--u)}while(s--);s=2;do{o=2;do{if(f=r[t+o+i*s],isNaN(f)||f===Infinity)throw"Could not reverse! A=["+this.toString()+"]";e.e(s,o,f)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){let t=e.x,i=e.y,r=e.z,s=e.w,o=t+t,a=i+i,c=r+r,u=t*o,d=t*a,f=t*c,l=i*a,h=i*c,p=r*c,m=s*o,v=s*a,_=s*c,g=this.elements;return g[3*0+0]=1-(l+p),g[3*0+1]=d-_,g[3*0+2]=f+v,g[3*1+0]=d+_,g[3*1+1]=1-(u+p),g[3*1+2]=h-m,g[3*2+0]=f-v,g[3*2+1]=h+m,g[3*2+2]=1-(u+l),this}transpose(e=new Cn){let t=e.elements,i=this.elements;for(let r=0;r!==3;r++)for(let s=0;s!==3;s++)t[3*r+s]=i[3*s+r];return e}},R=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}cross(e,t=new R){let i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,c=this.z;return t.x=a*s-c*r,t.y=c*i-o*s,t.z=o*r-a*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new R(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new R(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Cn([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){let e=this.x,t=this.y,i=this.z,r=Math.sqrt(e*e+t*t+i*i);if(r>0){let s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e=new R){let t=this.x,i=this.y,r=this.z,s=Math.sqrt(t*t+i*i+r*r);return s>0?(s=1/s,e.x=t*s,e.y=i*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){let e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){let t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r))}distanceSquared(e){let t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r)}scale(e,t=new R){let i=this.x,r=this.y,s=this.z;return t.x=e*i,t.y=e*r,t.z=e*s,t}vmul(e,t=new R){return t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i=new R){return i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e=new R){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){let i=this.length();if(i>0){let r=qg,s=1/i;r.set(this.x*s,this.y*s,this.z*s);let o=Xg;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){let r=this.x,s=this.y,o=this.z;i.x=r+(e.x-r)*t,i.y=s+(e.y-s)*t,i.z=o+(e.z-o)*t}almostEquals(e,t=1e-6){return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e=1e-6){return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(cd),cd.almostEquals(e,t)}clone(){return new R(this.x,this.y,this.z)}};R.ZERO=new R(0,0,0);R.UNIT_X=new R(1,0,0);R.UNIT_Y=new R(0,1,0);R.UNIT_Z=new R(0,0,1);var qg=new R,Xg=new R,cd=new R,Xt=class{constructor(e={}){this.lowerBound=new R,this.upperBound=new R,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,r){let s=this.lowerBound,o=this.upperBound,a=i;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let c=1;c<e.length;c++){let u=e[c];a&&(a.vmult(u,ud),u=ud),u.x>o.x&&(o.x=u.x),u.x<s.x&&(s.x=u.x),u.y>o.y&&(o.y=u.y),u.y<s.y&&(s.y=u.y),u.z>o.z&&(o.z=u.z),u.z<s.z&&(s.z=u.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Xt().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){let t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=i.x&&i.x<=s.x||t.x<=s.x&&s.x<=i.x,a=r.y<=i.y&&i.y<=s.y||t.y<=s.y&&s.y<=i.y,c=r.z<=i.z&&i.z<=s.z||t.z<=s.z&&s.z<=i.z;return o&&a&&c}volume(){let e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){let t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound;return t.x<=r.x&&i.x>=s.x&&t.y<=r.y&&i.y>=s.y&&t.z<=r.z&&i.z>=s.z}getCorners(e,t,i,r,s,o,a,c){let u=this.lowerBound,d=this.upperBound;e.copy(u),t.set(d.x,u.y,u.z),i.set(d.x,d.y,u.z),r.set(u.x,d.y,d.z),s.set(d.x,u.y,d.z),o.set(u.x,d.y,u.z),a.set(u.x,u.y,d.z),c.copy(d)}toLocalFrame(e,t){let i=hd,r=i[0],s=i[1],o=i[2],a=i[3],c=i[4],u=i[5],d=i[6],f=i[7];this.getCorners(r,s,o,a,c,u,d,f);for(let l=0;l!==8;l++){let h=i[l];e.pointToLocal(h,h)}return t.setFromPoints(i)}toWorldFrame(e,t){let i=hd,r=i[0],s=i[1],o=i[2],a=i[3],c=i[4],u=i[5],d=i[6],f=i[7];this.getCorners(r,s,o,a,c,u,d,f);for(let l=0;l!==8;l++){let h=i[l];e.pointToWorld(h,h)}return t.setFromPoints(i)}overlapsRay(e){let{direction:t,from:i}=e,r=1/t.x,s=1/t.y,o=1/t.z,a=(this.lowerBound.x-i.x)*r,c=(this.upperBound.x-i.x)*r,u=(this.lowerBound.y-i.y)*s,d=(this.upperBound.y-i.y)*s,f=(this.lowerBound.z-i.z)*o,l=(this.upperBound.z-i.z)*o,h=Math.max(Math.max(Math.min(a,c),Math.min(u,d)),Math.min(f,l)),p=Math.min(Math.min(Math.max(a,c),Math.max(u,d)),Math.max(f,l));return!(p<0||h>p)}},ud=new R,hd=[new R,new R,new R,new R,new R,new R,new R,new R],gc=class{constructor(){this.matrix=[]}get(e,t){let{index:i}=e,{index:r}=t;if(r>i){let s=r;r=i,i=s}return this.matrix[(i*(i+1)>>1)+r-1]}set(e,t,i){let{index:r}=e,{index:s}=t;if(s>r){let o=s;s=r,r=o}this.matrix[(r*(r+1)>>1)+s-1]=i?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}},_c=class{constructor(){}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;return i[e]===void 0&&(i[e]=[]),i[e].includes(t)||i[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return!!(i[e]!==void 0&&i[e].includes(t))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;let i=this._listeners;if(i[e]===void 0)return this;let r=i[e].indexOf(t);return r!==-1&&i[e].splice(r,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;let i=this._listeners[e.type];if(i!==void 0){e.target=this;for(let r=0,s=i.length;r<s;r++)i[r].call(this,e)}return this}},ct=class{constructor(e=0,t=0,i=0,r=1){this.x=e,this.y=t,this.z=i,this.w=r}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){let i=Math.sin(t*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(t*.5),this}toAxisAngle(e=new R){this.normalize();let t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){let i=Yg,r=Zg;e.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{let i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t=new ct){let i=this.x,r=this.y,s=this.z,o=this.w,a=e.x,c=e.y,u=e.z,d=e.w;return t.x=i*d+o*a+r*u-s*c,t.y=r*d+o*c+s*a-i*u,t.z=s*d+o*u+i*c-r*a,t.w=o*d-i*a-r*c-s*u,t}inverse(e=new ct){let t=this.x,i=this.y,r=this.z,s=this.w;this.conjugate(e);let o=1/(t*t+i*i+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e=new ct){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){let e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t=new R){let i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,c=this.z,u=this.w,d=u*i+a*s-c*r,f=u*r+c*i-o*s,l=u*s+o*r-a*i,h=-o*i-a*r-c*s;return t.x=d*u+h*-o+f*-c-l*-a,t.y=f*u+h*-a+l*-o-d*-c,t.z=l*u+h*-c+d*-a-f*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t="YZX"){let i,r,s,o=this.x,a=this.y,c=this.z,u=this.w;switch(t){case"YZX":let d=o*a+c*u;if(d>.499&&(i=2*Math.atan2(o,u),r=Math.PI/2,s=0),d<-.499&&(i=-2*Math.atan2(o,u),r=-Math.PI/2,s=0),i===void 0){let f=o*o,l=a*a,h=c*c;i=Math.atan2(2*a*u-2*o*c,1-2*l-2*h),r=Math.asin(2*d),s=Math.atan2(2*o*u-2*a*c,1-2*f-2*h)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=i,e.z=r,e.x=s}setFromEuler(e,t,i,r="XYZ"){let s=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(i/2),c=Math.sin(e/2),u=Math.sin(t/2),d=Math.sin(i/2);return r==="XYZ"?(this.x=c*o*a+s*u*d,this.y=s*u*a-c*o*d,this.z=s*o*d+c*u*a,this.w=s*o*a-c*u*d):r==="YXZ"?(this.x=c*o*a+s*u*d,this.y=s*u*a-c*o*d,this.z=s*o*d-c*u*a,this.w=s*o*a+c*u*d):r==="ZXY"?(this.x=c*o*a-s*u*d,this.y=s*u*a+c*o*d,this.z=s*o*d+c*u*a,this.w=s*o*a-c*u*d):r==="ZYX"?(this.x=c*o*a-s*u*d,this.y=s*u*a+c*o*d,this.z=s*o*d-c*u*a,this.w=s*o*a+c*u*d):r==="YZX"?(this.x=c*o*a+s*u*d,this.y=s*u*a+c*o*d,this.z=s*o*d-c*u*a,this.w=s*o*a-c*u*d):r==="XZY"&&(this.x=c*o*a-s*u*d,this.y=s*u*a-c*o*d,this.z=s*o*d+c*u*a,this.w=s*o*a+c*u*d),this}clone(){return new ct(this.x,this.y,this.z,this.w)}slerp(e,t,i=new ct){let r=this.x,s=this.y,o=this.z,a=this.w,c=e.x,u=e.y,d=e.z,f=e.w,l,h,p,m,v;return h=r*c+s*u+o*d+a*f,h<0&&(h=-h,c=-c,u=-u,d=-d,f=-f),1-h>1e-6?(l=Math.acos(h),p=Math.sin(l),m=Math.sin((1-t)*l)/p,v=Math.sin(t*l)/p):(m=1-t,v=t),i.x=m*r+v*c,i.y=m*s+v*u,i.z=m*o+v*d,i.w=m*a+v*f,i}integrate(e,t,i,r=new ct){let s=e.x*i.x,o=e.y*i.y,a=e.z*i.z,c=this.x,u=this.y,d=this.z,f=this.w,l=t*.5;return r.x+=l*(s*f+o*d-a*u),r.y+=l*(o*f+a*c-s*d),r.z+=l*(a*f+s*u-o*c),r.w+=l*(-s*c-o*u-a*d),r}},Yg=new R,Zg=new R,Jg={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256},ve=class{constructor(e={}){this.id=ve.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,i,r){throw"calculateWorldAABB() not implemented for shape type "+this.type}};ve.idCounter=0;ve.types=Jg;var Ge=class{constructor(e={}){this.position=new R,this.quaternion=new ct,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Ge.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Ge.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t=new R){return this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,r=new R){return i.vsub(e,r),t.conjugate(dd),dd.vmult(r,r),r}static pointToWorldFrame(e,t,i,r=new R){return t.vmult(i,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,i=new R){return e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,r=new R){return t.w*=-1,t.vmult(i,r),t.w*=-1,r}},dd=new ct,dr=class extends ve{constructor(e={}){let{vertices:t=[],faces:i=[],normals:r=[],axes:s,boundingSphereRadius:o}=e;super({type:ve.types.CONVEXPOLYHEDRON});this.vertices=t,this.faces=i,this.faceNormals=r,this.faceNormals.length===0&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){let e=this.faces,t=this.vertices,i=this.uniqueEdges;i.length=0;let r=new R;for(let s=0;s!==e.length;s++){let o=e[s],a=o.length;for(let c=0;c!==a;c++){let u=(c+1)%a;t[o[c]].vsub(t[o[u]],r),r.normalize();let d=!1;for(let f=0;f!==i.length;f++)if(i[f].almostEquals(r)||i[f].almostEquals(r)){d=!0;break}d||i.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let r=0;r<this.faces[e].length;r++)if(!this.vertices[this.faces[e][r]])throw new Error("Vertex "+this.faces[e][r]+" not found!");let t=this.faceNormals[e]||new R;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;let i=this.vertices[this.faces[e][0]];if(t.dot(i)<0){console.error(".faceNormals["+e+"] = Vec3("+t.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let r=0;r<this.faces[e].length;r++)console.warn(".vertices["+this.faces[e][r]+"] = Vec3("+this.vertices[this.faces[e][r]].toString()+")")}}}getFaceNormal(e,t){let i=this.faces[e],r=this.vertices[i[0]],s=this.vertices[i[1]],o=this.vertices[i[2]];dr.computeNormal(r,s,o,t)}static computeNormal(e,t,i,r){let s=new R,o=new R;t.vsub(e,o),i.vsub(t,s),s.cross(o,r),r.isZero()||r.normalize()}clipAgainstHull(e,t,i,r,s,o,a,c,u){let d=new R,f=-1,l=-Number.MAX_VALUE;for(let p=0;p<i.faces.length;p++){d.copy(i.faceNormals[p]),s.vmult(d,d);let m=d.dot(o);m>l&&(l=m,f=p)}let h=[];for(let p=0;p<i.faces[f].length;p++){let m=i.vertices[i.faces[f][p]],v=new R;v.copy(m),s.vmult(v,v),r.vadd(v,v),h.push(v)}f>=0&&this.clipFaceAgainstHull(o,e,t,h,a,c,u)}findSeparatingAxis(e,t,i,r,s,o,a,c){let u=new R,d=new R,f=new R,l=new R,h=new R,p=new R,m=Number.MAX_VALUE,v=this;if(v.uniqueAxes)for(let _=0;_!==v.uniqueAxes.length;_++){i.vmult(v.uniqueAxes[_],u);let g=v.testSepAxis(u,e,t,i,r,s);if(g===!1)return!1;g<m&&(m=g,o.copy(u))}else{let _=a?a.length:v.faces.length;for(let g=0;g<_;g++){let y=a?a[g]:g;u.copy(v.faceNormals[y]),i.vmult(u,u);let b=v.testSepAxis(u,e,t,i,r,s);if(b===!1)return!1;b<m&&(m=b,o.copy(u))}}if(e.uniqueAxes)for(let _=0;_!==e.uniqueAxes.length;_++){s.vmult(e.uniqueAxes[_],d);let g=v.testSepAxis(d,e,t,i,r,s);if(g===!1)return!1;g<m&&(m=g,o.copy(d))}else{let _=c?c.length:e.faces.length;for(let g=0;g<_;g++){let y=c?c[g]:g;d.copy(e.faceNormals[y]),s.vmult(d,d);let b=v.testSepAxis(d,e,t,i,r,s);if(b===!1)return!1;b<m&&(m=b,o.copy(d))}}for(let _=0;_!==v.uniqueEdges.length;_++){i.vmult(v.uniqueEdges[_],l);for(let g=0;g!==e.uniqueEdges.length;g++)if(s.vmult(e.uniqueEdges[g],h),l.cross(h,p),!p.almostZero()){p.normalize();let y=v.testSepAxis(p,e,t,i,r,s);if(y===!1)return!1;y<m&&(m=y,o.copy(p))}}return r.vsub(t,f),f.dot(o)>0&&o.negate(o),!0}testSepAxis(e,t,i,r,s,o){let a=this;dr.project(a,e,i,r,vc),dr.project(t,e,s,o,yc);let c=vc[0],u=vc[1],d=yc[0],f=yc[1];if(c<f||d<u)return!1;let l=c-f,h=d-u;return l<h?l:h}calculateLocalInertia(e,t){let i=new R,r=new R;this.computeLocalAABB(r,i);let s=i.x-r.x,o=i.y-r.y,a=i.z-r.z;t.x=1/12*e*(2*o*2*o+2*a*2*a),t.y=1/12*e*(2*s*2*s+2*a*2*a),t.z=1/12*e*(2*o*2*o+2*s*2*s)}getPlaneConstantOfFace(e){let t=this.faces[e],i=this.faceNormals[e],r=this.vertices[t[0]];return-i.dot(r)}clipFaceAgainstHull(e,t,i,r,s,o,a){let c=new R,u=new R,d=new R,f=new R,l=new R,h=new R,p=new R,m=new R,v=this,_=[],g=r,y=_,b=-1,w=Number.MAX_VALUE;for(let I=0;I<v.faces.length;I++){c.copy(v.faceNormals[I]),i.vmult(c,c);let U=c.dot(e);U<w&&(w=U,b=I)}if(b<0)return;let x=v.faces[b];x.connectedFaces=[];for(let I=0;I<v.faces.length;I++)for(let U=0;U<v.faces[I].length;U++)x.indexOf(v.faces[I][U])!==-1&&I!==b&&x.connectedFaces.indexOf(I)===-1&&x.connectedFaces.push(I);let S=x.length;for(let I=0;I<S;I++){let U=v.vertices[x[I]],W=v.vertices[x[(I+1)%S]];U.vsub(W,u),d.copy(u),i.vmult(d,d),t.vadd(d,d),f.copy(this.faceNormals[b]),i.vmult(f,f),t.vadd(f,f),d.cross(f,l),l.negate(l),h.copy(U),i.vmult(h,h),t.vadd(h,h);let D=x.connectedFaces[I];p.copy(this.faceNormals[D]);let L=this.getPlaneConstantOfFace(D);m.copy(p),i.vmult(m,m);let O=L-m.dot(t);for(this.clipFaceAgainstPlane(g,y,m,O);g.length;)g.shift();for(;y.length;)g.push(y.shift())}p.copy(this.faceNormals[b]);let P=this.getPlaneConstantOfFace(b);m.copy(p),i.vmult(m,m);let T=P-m.dot(t);for(let I=0;I<g.length;I++){let U=m.dot(g[I])+T;if(U<=s&&(console.log("clamped: depth="+U+" to minDist="+s),U=s),U<=o){let W=g[I];if(U<=1e-6){let D={point:W,normal:m,depth:U};a.push(D)}}}}clipFaceAgainstPlane(e,t,i,r){let s,o,a=e.length;if(a<2)return t;let c=e[e.length-1],u=e[0];s=i.dot(c)+r;for(let d=0;d<a;d++){if(u=e[d],o=i.dot(u)+r,s<0)if(o<0){let f=new R;f.copy(u),t.push(f)}else{let f=new R;c.lerp(u,s/(s-o),f),t.push(f)}else if(o<0){let f=new R;c.lerp(u,s/(s-o),f),t.push(f),t.push(u)}c=u,s=o}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new R);let i=this.vertices,r=this.worldVertices;for(let s=0;s!==this.vertices.length;s++)t.vmult(i[s],r[s]),e.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){let i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){let s=i[r];s.x<e.x?e.x=s.x:s.x>t.x&&(t.x=s.x),s.y<e.y?e.y=s.y:s.y>t.y&&(t.y=s.y),s.z<e.z?e.z=s.z:s.z>t.z&&(t.z=s.z)}}computeWorldFaceNormals(e){let t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new R);let i=this.faceNormals,r=this.worldFaceNormals;for(let s=0;s!==t;s++)e.vmult(i[s],r[s]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0,t=this.vertices;for(let i=0;i!==t.length;i++){let r=t[i].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,i,r){let s=this.vertices,o,a,c,u,d,f,l=new R;for(let h=0;h<s.length;h++){l.copy(s[h]),t.vmult(l,l),e.vadd(l,l);let p=l;(o===void 0||p.x<o)&&(o=p.x),(u===void 0||p.x>u)&&(u=p.x),(a===void 0||p.y<a)&&(a=p.y),(d===void 0||p.y>d)&&(d=p.y),(c===void 0||p.z<c)&&(c=p.z),(f===void 0||p.z>f)&&(f=p.z)}i.set(o,a,c),r.set(u,d,f)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e=new R){let t=this.vertices;for(let i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){let i=this.vertices.length,r=this.vertices;if(t){for(let s=0;s<i;s++){let o=r[s];t.vmult(o,o)}for(let s=0;s<this.faceNormals.length;s++){let o=this.faceNormals[s];t.vmult(o,o)}}if(e)for(let s=0;s<i;s++){let o=r[s];o.vadd(e,o)}}pointIsInside(e){let t=this.vertices,i=this.faces,r=this.faceNormals,s=new R;this.getAveragePointLocal(s);for(let o=0;o<this.faces.length;o++){let a=r[o],c=t[i[o][0]],u=new R;e.vsub(c,u);let d=a.dot(u),f=new R;s.vsub(c,f);let l=a.dot(f);if(d<0&&l>0||d>0&&l<0)return!1}return-1}static project(e,t,i,r,s){let o=e.vertices.length,a=Kg,c=0,u=0,d=$g,f=e.vertices;d.setZero(),Ge.vectorToLocalFrame(i,r,t,a),Ge.pointToLocalFrame(i,r,d,d);let l=d.dot(a);u=c=f[0].dot(a);for(let h=1;h<o;h++){let p=f[h].dot(a);p>c&&(c=p),p<u&&(u=p)}if(u-=l,c-=l,u>c){let h=u;u=c,c=h}s[0]=c,s[1]=u}},vc=[],yc=[],Kg=new R,$g=new R,Ln=class extends ve{constructor(e){super({type:ve.types.BOX});this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){let e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,r=R,s=[new r(-e,-t,-i),new r(e,-t,-i),new r(e,t,-i),new r(-e,t,-i),new r(-e,-t,i),new r(e,-t,i),new r(e,t,i),new r(-e,t,i)],o=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],a=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],c=new dr({vertices:s,faces:o,axes:a});this.convexPolyhedronRepresentation=c,c.material=this.material}calculateLocalInertia(e,t=new R){return Ln.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,i){let r=e;i.x=1/12*t*(2*r.y*2*r.y+2*r.z*2*r.z),i.y=1/12*t*(2*r.x*2*r.x+2*r.z*2*r.z),i.z=1/12*t*(2*r.y*2*r.y+2*r.x*2*r.x)}getSideNormals(e,t){let i=e,r=this.halfExtents;if(i[0].set(r.x,0,0),i[1].set(0,r.y,0),i[2].set(0,0,r.z),i[3].set(-r.x,0,0),i[4].set(0,-r.y,0),i[5].set(0,0,-r.z),t!==void 0)for(let s=0;s!==i.length;s++)t.vmult(i[s],i[s]);return i}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,i){let r=this.halfExtents,s=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let o=0;o<s.length;o++)Oi.set(s[o][0],s[o][1],s[o][2]),t.vmult(Oi,Oi),e.vadd(Oi,Oi),i(Oi.x,Oi.y,Oi.z)}calculateWorldAABB(e,t,i,r){let s=this.halfExtents;Gn[0].set(s.x,s.y,s.z),Gn[1].set(-s.x,s.y,s.z),Gn[2].set(-s.x,-s.y,s.z),Gn[3].set(-s.x,-s.y,-s.z),Gn[4].set(s.x,-s.y,-s.z),Gn[5].set(s.x,s.y,-s.z),Gn[6].set(-s.x,s.y,-s.z),Gn[7].set(s.x,-s.y,s.z);let o=Gn[0];t.vmult(o,o),e.vadd(o,o),r.copy(o),i.copy(o);for(let a=1;a<8;a++){let c=Gn[a];t.vmult(c,c),e.vadd(c,c);let u=c.x,d=c.y,f=c.z;u>r.x&&(r.x=u),d>r.y&&(r.y=d),f>r.z&&(r.z=f),u<i.x&&(i.x=u),d<i.y&&(i.y=d),f<i.z&&(i.z=f)}}},Oi=new R,Gn=[new R,new R,new R,new R,new R,new R,new R,new R],xc={AWAKE:0,SLEEPY:1,SLEEPING:2},xe=class extends _c{constructor(e={}){super();this.id=xe.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new R,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new R,this.previousPosition=new R,this.interpolatedPosition=new R,this.initPosition=new R,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new R,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new R,this.force=new R;let t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?xe.STATIC:xe.DYNAMIC,typeof e.type==typeof xe.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep!="undefined"?e.allowSleep:!0,this.sleepState=xe.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit!="undefined"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit!="undefined"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new R,this.quaternion=new ct,this.initQuaternion=new ct,this.previousQuaternion=new ct,this.interpolatedQuaternion=new ct,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new R,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new R,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new R,this.invInertia=new R,this.invInertiaWorld=new Cn,this.invMassSolve=0,this.invInertiaSolve=new R,this.invInertiaWorldSolve=new Cn,this.fixedRotation=typeof e.fixedRotation!="undefined"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping!="undefined"?e.angularDamping:.01,this.linearFactor=new R(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new R(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new Xt,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new R,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){let e=this.sleepState;this.sleepState=xe.AWAKE,this.wakeUpAfterNarrowphase=!1,e===xe.SLEEPING&&this.dispatchEvent(xe.wakeupEvent)}sleep(){this.sleepState=xe.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){let t=this.sleepState,i=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;t===xe.AWAKE&&i<r?(this.sleepState=xe.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(xe.sleepyEvent)):t===xe.SLEEPY&&i>r?this.wakeUp():t===xe.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(xe.sleepEvent))}}updateSolveMassProperties(){this.sleepState===xe.SLEEPING||this.type===xe.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t=new R){return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t=new R){return this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t=new R){return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t=new R){return this.quaternion.vmult(e,t),t}addShape(e,t,i){let r=new R,s=new ct;return t&&r.copy(t),i&&s.copy(i),this.shapes.push(e),this.shapeOffsets.push(r),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}updateBoundingRadius(){let e=this.shapes,t=this.shapeOffsets,i=e.length,r=0;for(let s=0;s!==i;s++){let o=e[s];o.updateBoundingSphereRadius();let a=t[s].length(),c=o.boundingSphereRadius;a+c>r&&(r=a+c)}this.boundingRadius=r}computeAABB(){let e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,r=e.length,s=Qg,o=e_,a=this.quaternion,c=this.aabb,u=t_;for(let d=0;d!==r;d++){let f=e[d];a.vmult(t[d],s),s.vadd(this.position,s),a.mult(i[d],o),f.calculateWorldAABB(s,o,u.lowerBound,u.upperBound),d===0?c.copy(u):c.extend(u)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){let t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!e)){let i=n_,r=i_;i.setRotationFromQuaternion(this.quaternion),i.transpose(r),i.scale(t,i),i.mmult(r,this.invInertiaWorld)}}applyForce(e,t=new R){if(this.type!==xe.DYNAMIC)return;this.sleepState===xe.SLEEPING&&this.wakeUp();let i=r_;t.cross(e,i),this.force.vadd(e,this.force),this.torque.vadd(i,this.torque)}applyLocalForce(e,t=new R){if(this.type!==xe.DYNAMIC)return;let i=s_,r=o_;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyForce(i,r)}applyImpulse(e,t=new R){if(this.type!==xe.DYNAMIC)return;this.sleepState===xe.SLEEPING&&this.wakeUp();let i=t,r=a_;r.copy(e),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);let s=l_;i.cross(e,s),this.invInertiaWorld.vmult(s,s),this.angularVelocity.vadd(s,this.angularVelocity)}applyLocalImpulse(e,t=new R){if(this.type!==xe.DYNAMIC)return;let i=c_,r=u_;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyImpulse(i,r)}updateMassProperties(){let e=h_;this.invMass=this.mass>0?1/this.mass:0;let t=this.inertia,i=this.fixedRotation;this.computeAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Ln.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!i?1/t.x:0,t.y>0&&!i?1/t.y:0,t.z>0&&!i?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){let i=new R;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}integrate(e,t,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===xe.DYNAMIC||this.type===xe.KINEMATIC)||this.sleepState===xe.SLEEPING)return;let r=this.velocity,s=this.angularVelocity,o=this.position,a=this.force,c=this.torque,u=this.quaternion,d=this.invMass,f=this.invInertiaWorld,l=this.linearFactor,h=d*e;r.x+=a.x*h*l.x,r.y+=a.y*h*l.y,r.z+=a.z*h*l.z;let p=f.elements,m=this.angularFactor,v=c.x*m.x,_=c.y*m.y,g=c.z*m.z;s.x+=e*(p[0]*v+p[1]*_+p[2]*g),s.y+=e*(p[3]*v+p[4]*_+p[5]*g),s.z+=e*(p[6]*v+p[7]*_+p[8]*g),o.x+=r.x*e,o.y+=r.y*e,o.z+=r.z*e,u.integrate(this.angularVelocity,e,this.angularFactor,u),t&&(i?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}};xe.COLLIDE_EVENT_NAME="collide";xe.DYNAMIC=1;xe.STATIC=2;xe.KINEMATIC=4;xe.AWAKE=xc.AWAKE;xe.SLEEPY=xc.SLEEPY;xe.SLEEPING=xc.SLEEPING;xe.idCounter=0;xe.wakeupEvent={type:"wakeup"};xe.sleepyEvent={type:"sleepy"};xe.sleepEvent={type:"sleep"};var Qg=new R,e_=new ct,t_=new Xt,n_=new Cn,i_=new Cn,r_=new R,s_=new R,o_=new R,a_=new R,l_=new R,c_=new R,u_=new R,h_=new R,bc=class{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return!((e.collisionFilterGroup&t.collisionFilterMask)==0||(t.collisionFilterGroup&e.collisionFilterMask)==0||((e.type&xe.STATIC)!=0||e.sleepState===xe.SLEEPING)&&((t.type&xe.STATIC)!=0||t.sleepState===xe.SLEEPING))}intersectionTest(e,t,i,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,r):this.doBoundingSphereBroadphase(e,t,i,r)}doBoundingSphereBroadphase(e,t,i,r){let s=d_;t.position.vsub(e.position,s);let o=(e.boundingRadius+t.boundingRadius)**2;s.lengthSquared()<o&&(i.push(e),r.push(t))}doBoundingBoxBroadphase(e,t,i,r){e.aabbNeedsUpdate&&e.computeAABB(),t.aabbNeedsUpdate&&t.computeAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),r.push(t))}makePairsUnique(e,t){let i=f_,r=p_,s=m_,o=e.length;for(let a=0;a!==o;a++)r[a]=e[a],s[a]=t[a];e.length=0,t.length=0;for(let a=0;a!==o;a++){let c=r[a].id,u=s[a].id,d=c<u?c+","+u:u+","+c;i[d]=a,i.keys.push(d)}for(let a=0;a!==i.keys.length;a++){let c=i.keys.pop(),u=i[c];e.push(r[u]),t.push(s[u]),delete i[c]}}setWorld(e){}static boundingSphereCheck(e,t){let i=new R;e.position.vsub(t.position,i);let r=e.shapes[0],s=t.shapes[0];return Math.pow(r.boundingSphereRadius+s.boundingSphereRadius,2)>i.lengthSquared()}aabbQuery(e,t,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},d_=new R,f_={keys:[]},p_=[],m_=[],fd=class extends bc{constructor(){super()}collisionPairs(e,t,i){let r=e.bodies,s=r.length,o,a;for(let c=0;c!==s;c++)for(let u=0;u!==c;u++)o=r[c],a=r[u],!!this.needBroadphaseCollision(o,a)&&this.intersectionTest(o,a,t,i)}aabbQuery(e,t,i=[]){for(let r=0;r<e.bodies.length;r++){let s=e.bodies[r];s.aabbNeedsUpdate&&s.computeAABB(),s.aabb.overlaps(t)&&i.push(s)}return i}},ba=class{constructor(){this.rayFromWorld=new R,this.rayToWorld=new R,this.hitNormalWorld=new R,this.hitPointWorld=new R,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}},Ve=class{constructor(e=new R,t=new R){this.from=e.clone(),this.to=t.clone(),this.direction=new R,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ve.ANY,this.result=new ba,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||Ve.ANY,this.result=t.result||new ba,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask!="undefined"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup!="undefined"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse!="undefined"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(pd),wc.length=0,e.broadphase.aabbQuery(e,pd,wc),this.intersectBodies(wc),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());let i=this.checkCollisionResponse;if(i&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)==0||(e.collisionFilterGroup&this.collisionFilterMask)==0)return;let r=g_,s=__;for(let o=0,a=e.shapes.length;o<a;o++){let c=e.shapes[o];if(!(i&&!c.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(c,s,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,r=e.length;!this.result.shouldStop&&i<r;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,r){let s=this.from;if(P_(s,this.direction,i)>e.boundingSphereRadius)return;let a=this[e.type];a&&a.call(this,e,t,i,r,e)}_intersectBox(e,t,i,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,r,s)}_intersectPlane(e,t,i,r,s){let o=this.from,a=this.to,c=this.direction,u=new R(0,0,1);t.vmult(u,u);let d=new R;o.vsub(i,d);let f=d.dot(u);a.vsub(i,d);let l=d.dot(u);if(f*l>0||o.distanceTo(a)<f)return;let h=u.dot(c);if(Math.abs(h)<this.precision)return;let p=new R,m=new R,v=new R;o.vsub(i,p);let _=-u.dot(p)/h;c.scale(_,m),o.vadd(m,v),this.reportIntersection(u,v,s,r,-1)}getAABB(e){let{lowerBound:t,upperBound:i}=e,r=this.to,s=this.from;t.x=Math.min(r.x,s.x),t.y=Math.min(r.y,s.y),t.z=Math.min(r.z,s.z),i.x=Math.max(r.x,s.x),i.y=Math.max(r.y,s.y),i.z=Math.max(r.z,s.z)}_intersectHeightfield(e,t,i,r,s){let o=e.data,a=e.elementSize,c=v_;c.from.copy(this.from),c.to.copy(this.to),Ge.pointToLocalFrame(i,t,c.from,c.from),Ge.pointToLocalFrame(i,t,c.to,c.to),c.updateDirection();let u=y_,d,f,l,h;d=f=0,l=h=e.data.length-1;let p=new Xt;c.getAABB(p),e.getIndexOfPosition(p.lowerBound.x,p.lowerBound.y,u,!0),d=Math.max(d,u[0]),f=Math.max(f,u[1]),e.getIndexOfPosition(p.upperBound.x,p.upperBound.y,u,!0),l=Math.min(l,u[0]+1),h=Math.min(h,u[1]+1);for(let m=d;m<l;m++)for(let v=f;v<h;v++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(m,v,p),!!p.overlapsRay(c)){if(e.getConvexTrianglePillar(m,v,!1),Ge.pointToWorldFrame(i,t,e.pillarOffset,wa),this._intersectConvex(e.pillarConvex,t,wa,r,s,md),this.result.shouldStop)return;e.getConvexTrianglePillar(m,v,!0),Ge.pointToWorldFrame(i,t,e.pillarOffset,wa),this._intersectConvex(e.pillarConvex,t,wa,r,s,md)}}}_intersectSphere(e,t,i,r,s){let o=this.from,a=this.to,c=e.radius,u=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,d=2*((a.x-o.x)*(o.x-i.x)+(a.y-o.y)*(o.y-i.y)+(a.z-o.z)*(o.z-i.z)),f=(o.x-i.x)**2+(o.y-i.y)**2+(o.z-i.z)**2-c**2,l=d**2-4*u*f,h=x_,p=b_;if(!(l<0))if(l===0)o.lerp(a,l,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,s,r,-1);else{let m=(-d-Math.sqrt(l))/(2*u),v=(-d+Math.sqrt(l))/(2*u);if(m>=0&&m<=1&&(o.lerp(a,m,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,s,r,-1)),this.result.shouldStop)return;v>=0&&v<=1&&(o.lerp(a,v,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,s,r,-1))}}_intersectConvex(e,t,i,r,s,o){let a=w_,c=gd,u=o&&o.faceList||null,d=e.faces,f=e.vertices,l=e.faceNormals,h=this.direction,p=this.from,m=this.to,v=p.distanceTo(m),_=u?u.length:d.length,g=this.result;for(let y=0;!g.shouldStop&&y<_;y++){let b=u?u[y]:y,w=d[b],x=l[b],S=t,P=i;c.copy(f[w[0]]),S.vmult(c,c),c.vadd(P,c),c.vsub(p,c),S.vmult(x,a);let T=h.dot(a);if(Math.abs(T)<this.precision)continue;let I=a.dot(c)/T;if(!(I<0)){h.scale(I,Yt),Yt.vadd(p,Yt),Rn.copy(f[w[0]]),S.vmult(Rn,Rn),P.vadd(Rn,Rn);for(let U=1;!g.shouldStop&&U<w.length-1;U++){Vn.copy(f[w[U]]),Wn.copy(f[w[U+1]]),S.vmult(Vn,Vn),S.vmult(Wn,Wn),P.vadd(Vn,Vn),P.vadd(Wn,Wn);let W=Yt.distanceTo(p);!(so(Yt,Rn,Vn,Wn)||so(Yt,Vn,Rn,Wn))||W>v||this.reportIntersection(a,Yt,s,r,b)}}}}_intersectTrimesh(e,t,i,r,s,o){let a=M_,c=L_,u=R_,d=gd,f=S_,l=T_,h=E_,p=C_,m=A_,v=o&&o.faceList||null,_=e.indices,g=e.vertices,y=this.from,b=this.to,w=this.direction;u.position.copy(i),u.quaternion.copy(t),Ge.vectorToLocalFrame(i,t,w,f),Ge.pointToLocalFrame(i,t,y,l),Ge.pointToLocalFrame(i,t,b,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,l.x*=e.scale.x,l.y*=e.scale.y,l.z*=e.scale.z,h.vsub(l,f),f.normalize();let x=l.distanceSquared(h);e.tree.rayQuery(this,u,c);for(let S=0,P=c.length;!this.result.shouldStop&&S!==P;S++){let T=c[S];e.getNormal(T,a),e.getVertex(_[T*3],Rn),Rn.vsub(l,d);let I=f.dot(a),U=a.dot(d)/I;if(U<0)continue;f.scale(U,Yt),Yt.vadd(l,Yt),e.getVertex(_[T*3+1],Vn),e.getVertex(_[T*3+2],Wn);let W=Yt.distanceSquared(l);!(so(Yt,Vn,Rn,Wn)||so(Yt,Rn,Vn,Wn))||W>x||(Ge.vectorToWorldFrame(t,a,m),Ge.pointToWorldFrame(i,t,Yt,p),this.reportIntersection(m,p,s,r,T))}c.length=0}reportIntersection(e,t,i,r,s){let o=this.from,a=this.to,c=o.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=typeof s!="undefined"?s:-1,this.mode){case Ve.ALL:this.hasHit=!0,u.set(o,a,e,t,i,r,c),u.hasHit=!0,this.callback(u);break;case Ve.CLOSEST:(c<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(o,a,e,t,i,r,c));break;case Ve.ANY:this.hasHit=!0,u.hasHit=!0,u.set(o,a,e,t,i,r,c),u.shouldStop=!0;break}}};Ve.CLOSEST=1;Ve.ANY=2;Ve.ALL=4;var pd=new Xt,wc=[],oo=new R,Mc=new R;Ve.pointInTriangle=so;function so(n,e,t,i){i.vsub(e,fr),t.vsub(e,oo),n.vsub(e,Mc);let r=fr.dot(fr),s=fr.dot(oo),o=fr.dot(Mc),a=oo.dot(oo),c=oo.dot(Mc),u,d;return(u=a*o-s*c)>=0&&(d=r*c-s*o)>=0&&u+d<r*a-s*s}var g_=new R,__=new ct,Yt=new R,Rn=new R,Vn=new R,Wn=new R;Ve.prototype[ve.types.BOX]=Ve.prototype._intersectBox;Ve.prototype[ve.types.PLANE]=Ve.prototype._intersectPlane;var md={faceList:[0]},wa=new R,v_=new Ve,y_=[];Ve.prototype[ve.types.HEIGHTFIELD]=Ve.prototype._intersectHeightfield;var x_=new R,b_=new R;Ve.prototype[ve.types.SPHERE]=Ve.prototype._intersectSphere;var w_=new R,gd=new R;Ve.prototype[ve.types.CYLINDER]=Ve.prototype._intersectConvex;Ve.prototype[ve.types.CONVEXPOLYHEDRON]=Ve.prototype._intersectConvex;var M_=new R,S_=new R,T_=new R,E_=new R,A_=new R,C_=new R,pE=new Xt,L_=[],R_=new Ge;Ve.prototype[ve.types.TRIMESH]=Ve.prototype._intersectTrimesh;var fr=new R,Ma=new R;function P_(n,e,t){t.vsub(n,fr);let i=fr.dot(e);return e.scale(i,Ma),Ma.vadd(n,Ma),t.distanceTo(Ma)}var tn=class extends bc{constructor(e){super();this.axisList=[],this.world=null,this.axisIndex=0;let t=this.axisList;this._addBodyHandler=i=>{t.push(i.body)},this._removeBodyHandler=i=>{let r=t.indexOf(i.body);r!==-1&&t.splice(r,1)},e&&this.setWorld(e)}setWorld(e){this.axisList.length=0;for(let t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0}collisionPairs(e,t,i){let r=this.axisList,s=r.length,o=this.axisIndex,a,c;for(this.dirty&&(this.sortList(),this.dirty=!1),a=0;a!==s;a++){let u=r[a];for(c=a+1;c<s;c++){let d=r[c];if(!!this.needBroadphaseCollision(u,d)){if(!tn.checkBounds(u,d,o))break;this.intersectionTest(u,d,t,i)}}}}sortList(){let e=this.axisList,t=this.axisIndex,i=e.length;for(let r=0;r!==i;r++){let s=e[r];s.aabbNeedsUpdate&&s.computeAABB()}t===0?tn.insertionSortX(e):t===1?tn.insertionSortY(e):t===2&&tn.insertionSortZ(e)}autoDetectAxis(){let e=0,t=0,i=0,r=0,s=0,o=0,a=this.axisList,c=a.length,u=1/c;for(let h=0;h!==c;h++){let p=a[h],m=p.position.x;e+=m,t+=m*m;let v=p.position.y;i+=v,r+=v*v;let _=p.position.z;s+=_,o+=_*_}let d=t-e*e*u,f=r-i*i*u,l=o-s*s*u;d>f?d>l?this.axisIndex=0:this.axisIndex=2:f>l?this.axisIndex=1:this.axisIndex=2}aabbQuery(e,t,i=[]){this.dirty&&(this.sortList(),this.dirty=!1);let r=this.axisIndex,s="x";r===1&&(s="y"),r===2&&(s="z");let o=this.axisList,a=t.lowerBound[s],c=t.upperBound[s];for(let u=0;u<o.length;u++){let d=o[u];d.aabbNeedsUpdate&&d.computeAABB(),d.aabb.overlaps(t)&&i.push(d)}return i}};tn.insertionSortX=n=>{for(let e=1,t=n.length;e<t;e++){let i=n[e],r;for(r=e-1;r>=0&&!(n[r].aabb.lowerBound.x<=i.aabb.lowerBound.x);r--)n[r+1]=n[r];n[r+1]=i}return n};tn.insertionSortY=n=>{for(let e=1,t=n.length;e<t;e++){let i=n[e],r;for(r=e-1;r>=0&&!(n[r].aabb.lowerBound.y<=i.aabb.lowerBound.y);r--)n[r+1]=n[r];n[r+1]=i}return n};tn.insertionSortZ=n=>{for(let e=1,t=n.length;e<t;e++){let i=n[e],r;for(r=e-1;r>=0&&!(n[r].aabb.lowerBound.z<=i.aabb.lowerBound.z);r--)n[r+1]=n[r];n[r+1]=i}return n};tn.checkBounds=(n,e,t)=>{let i,r;t===0?(i=n.position.x,r=e.position.x):t===1?(i=n.position.y,r=e.position.y):t===2&&(i=n.position.z,r=e.position.z);let s=n.boundingRadius,o=e.boundingRadius,a=i+s;return r-o<a};var Sc=class{static defaults(e={},t){for(let i in t)i in e||(e[i]=t[i]);return e}},ao=class{constructor(e,t,i={}){i=Sc.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=ao.idCounter++,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){let e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){let e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}};ao.idCounter=0;var Tc=class{constructor(){this.spatial=new R,this.rotational=new R}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}},Di=class{constructor(e,t,i=-1e6,r=1e6){this.id=Di.id++,this.minForce=i,this.maxForce=r,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Tc,this.jacobianElementB=new Tc,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,i){let r=t,s=e,o=i;this.a=4/(o*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(o*o*s*(1+4*r))}computeB(e,t,i){let r=this.computeGW(),s=this.computeGq(),o=this.computeGiMf();return-s*e-r*t-o*i}computeGq(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.position,o=r.position;return e.spatial.dot(s)+t.spatial.dot(o)}computeGW(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.velocity,o=r.velocity,a=i.angularVelocity,c=r.angularVelocity;return e.multiplyVectors(s,a)+t.multiplyVectors(o,c)}computeGWlambda(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.vlambda,o=r.vlambda,a=i.wlambda,c=r.wlambda;return e.multiplyVectors(s,a)+t.multiplyVectors(o,c)}computeGiMf(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.force,o=i.torque,a=r.force,c=r.torque,u=i.invMassSolve,d=r.invMassSolve;return s.scale(u,_d),a.scale(d,vd),i.invInertiaWorldSolve.vmult(o,yd),r.invInertiaWorldSolve.vmult(c,xd),e.multiplyVectors(_d,yd)+t.multiplyVectors(vd,xd)}computeGiMGt(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.invMassSolve,o=r.invMassSolve,a=i.invInertiaWorldSolve,c=r.invInertiaWorldSolve,u=s+o;return a.vmult(e.rotational,Sa),u+=Sa.dot(e.rotational),c.vmult(t.rotational,Sa),u+=Sa.dot(t.rotational),u}addToWlambda(e){let t=this.jacobianElementA,i=this.jacobianElementB,r=this.bi,s=this.bj,o=I_;r.vlambda.addScaledVector(r.invMassSolve*e,t.spatial,r.vlambda),s.vlambda.addScaledVector(s.invMassSolve*e,i.spatial,s.vlambda),r.invInertiaWorldSolve.vmult(t.rotational,o),r.wlambda.addScaledVector(e,o,r.wlambda),s.invInertiaWorldSolve.vmult(i.rotational,o),s.wlambda.addScaledVector(e,o,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}};Di.id=0;var _d=new R,vd=new R,yd=new R,xd=new R,Sa=new R,I_=new R,lo=class extends Di{constructor(e,t,i=1e6){super(e,t,0,i);this.restitution=0,this.ri=new R,this.rj=new R,this.ni=new R}computeB(e){let t=this.a,i=this.b,r=this.bi,s=this.bj,o=this.ri,a=this.rj,c=O_,u=D_,d=r.velocity,f=r.angularVelocity,l=r.force,h=r.torque,p=s.velocity,m=s.angularVelocity,v=s.force,_=s.torque,g=F_,y=this.jacobianElementA,b=this.jacobianElementB,w=this.ni;o.cross(w,c),a.cross(w,u),w.negate(y.spatial),c.negate(y.rotational),b.spatial.copy(w),b.rotational.copy(u),g.copy(s.position),g.vadd(a,g),g.vsub(r.position,g),g.vsub(o,g);let x=w.dot(g),S=this.restitution+1,P=S*p.dot(w)-S*d.dot(w)+m.dot(u)-f.dot(c),T=this.computeGiMf();return-x*t-P*i-e*T}getImpactVelocityAlongNormal(){let e=B_,t=N_,i=k_,r=z_,s=H_;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(i,e),this.bj.getVelocityAtWorldPoint(r,t),e.vsub(t,s),this.ni.dot(s)}},O_=new R,D_=new R,F_=new R,B_=new R,N_=new R,k_=new R,z_=new R,H_=new R,bd=class extends ao{constructor(e,t=new R,i,r=new R,s=1e6){super(e,i);this.pivotA=t.clone(),this.pivotB=r.clone();let o=this.equationX=new lo(e,i),a=this.equationY=new lo(e,i),c=this.equationZ=new lo(e,i);this.equations.push(o,a,c),o.minForce=a.minForce=c.minForce=-s,o.maxForce=a.maxForce=c.maxForce=s,o.ni.set(1,0,0),a.ni.set(0,1,0),c.ni.set(0,0,1)}update(){let e=this.bodyA,t=this.bodyB,i=this.equationX,r=this.equationY,s=this.equationZ;e.quaternion.vmult(this.pivotA,i.ri),t.quaternion.vmult(this.pivotB,i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj),s.ri.copy(i.ri),s.rj.copy(i.rj)}},Ec=class extends Di{constructor(e,t,i={}){let r=typeof i.maxForce!="undefined"?i.maxForce:1e6;super(e,t,-r,r);this.axisA=i.axisA?i.axisA.clone():new R(1,0,0),this.axisB=i.axisB?i.axisB.clone():new R(0,1,0),this.maxAngle=Math.PI/2}computeB(e){let t=this.a,i=this.b,r=this.axisA,s=this.axisB,o=U_,a=G_,c=this.jacobianElementA,u=this.jacobianElementB;r.cross(s,o),s.cross(r,a),c.rotational.copy(a),u.rotational.copy(o);let d=Math.cos(this.maxAngle)-r.dot(s),f=this.computeGW(),l=this.computeGiMf();return-d*t-f*i-e*l}},U_=new R,G_=new R,wd=class extends Di{constructor(e,t,i=1e6){super(e,t,-i,i);this.axisA=new R,this.axisB=new R,this.targetVelocity=0}computeB(e){let t=this.a,i=this.b,r=this.bi,s=this.bj,o=this.axisA,a=this.axisB,c=this.jacobianElementA,u=this.jacobianElementB;c.rotational.copy(o),a.negate(u.rotational);let d=this.computeGW()-this.targetVelocity,f=this.computeGiMf();return-d*i-e*f}},Ta=class extends bd{constructor(e,t,i={}){let r=typeof i.maxForce!="undefined"?i.maxForce:1e6,s=i.pivotA?i.pivotA.clone():new R,o=i.pivotB?i.pivotB.clone():new R;super(e,s,t,o,r);(this.axisA=i.axisA?i.axisA.clone():new R(1,0,0)).normalize(),(this.axisB=i.axisB?i.axisB.clone():new R(1,0,0)).normalize(),this.collideConnected=!!i.collideConnected;let u=this.rotationalEquation1=new Ec(e,t,i),d=this.rotationalEquation2=new Ec(e,t,i),f=this.motorEquation=new wd(e,t,r);f.enabled=!1,this.equations.push(u,d,f)}enableMotor(){this.motorEquation.enabled=!0}disableMotor(){this.motorEquation.enabled=!1}setMotorSpeed(e){this.motorEquation.targetVelocity=e}setMotorMaxForce(e){this.motorEquation.maxForce=e,this.motorEquation.minForce=-e}update(){let e=this.bodyA,t=this.bodyB,i=this.motorEquation,r=this.rotationalEquation1,s=this.rotationalEquation2,o=V_,a=W_,c=this.axisA,u=this.axisB;super.update(),e.quaternion.vmult(c,o),t.quaternion.vmult(u,a),o.tangents(r.axisA,s.axisA),r.axisB.copy(a),s.axisB.copy(a),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,i.axisA),t.quaternion.vmult(this.axisB,i.axisB))}},V_=new R,W_=new R,Ac=class extends Di{constructor(e,t,i){super(e,t,-i,i);this.ri=new R,this.rj=new R,this.t=new R}computeB(e){let t=this.a,i=this.b,r=this.bi,s=this.bj,o=this.ri,a=this.rj,c=j_,u=q_,d=this.t;o.cross(d,c),a.cross(d,u);let f=this.jacobianElementA,l=this.jacobianElementB;d.negate(f.spatial),c.negate(f.rotational),l.spatial.copy(d),l.rotational.copy(u);let h=this.computeGW(),p=this.computeGiMf();return-h*i-e*p}},j_=new R,q_=new R,Fi=class{constructor(e,t,i){i=Sc.defaults(i,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Fi.idCounter++,this.materials=[e,t],this.friction=i.friction,this.restitution=i.restitution,this.contactEquationStiffness=i.contactEquationStiffness,this.contactEquationRelaxation=i.contactEquationRelaxation,this.frictionEquationStiffness=i.frictionEquationStiffness,this.frictionEquationRelaxation=i.frictionEquationRelaxation}};Fi.idCounter=0;var Bi=class{constructor(e={}){let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=Bi.idCounter++,this.friction=typeof e.friction!="undefined"?e.friction:-1,this.restitution=typeof e.restitution!="undefined"?e.restitution:-1}};Bi.idCounter=0;var co=class{constructor(e,t,i={}){this.restLength=typeof i.restLength=="number"?i.restLength:1,this.stiffness=i.stiffness||100,this.damping=i.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new R,this.localAnchorB=new R,i.localAnchorA&&this.localAnchorA.copy(i.localAnchorA),i.localAnchorB&&this.localAnchorB.copy(i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB)}setWorldAnchorA(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)}setWorldAnchorB(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)}getWorldAnchorA(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)}getWorldAnchorB(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)}applyForce(){let e=this.stiffness,t=this.damping,i=this.restLength,r=this.bodyA,s=this.bodyB,o=X_,a=Y_,c=Z_,u=J_,d=iv,f=K_,l=$_,h=Q_,p=ev,m=tv,v=nv;this.getWorldAnchorA(f),this.getWorldAnchorB(l),f.vsub(r.position,h),l.vsub(s.position,p),l.vsub(f,o);let _=o.length();a.copy(o),a.normalize(),s.velocity.vsub(r.velocity,c),s.angularVelocity.cross(p,d),c.vadd(d,c),r.angularVelocity.cross(h,d),c.vsub(d,c),a.scale(-e*(_-i)-t*c.dot(a),u),r.force.vsub(u,r.force),s.force.vadd(u,s.force),h.cross(u,m),p.cross(u,v),r.torque.vsub(m,r.torque),s.torque.vadd(v,s.torque)}},X_=new R,Y_=new R,Z_=new R,J_=new R,K_=new R,$_=new R,Q_=new R,ev=new R,tv=new R,nv=new R,iv=new R,mE=new Ve,Ea=class extends ve{constructor(e){super({type:ve.types.SPHERE});if(this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t=new R){let i=2*e*this.radius*this.radius/5;return t.x=i,t.y=i,t.z=i,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,i,r){let s=this.radius,o=["x","y","z"];for(let a=0;a<o.length;a++){let c=o[a];i[c]=e[c]-s,r[c]=e[c]+s}}},Aa=class extends dr{constructor(e=1,t=1,i=1,r=8){if(e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");let s=r,o=[],a=[],c=[],u=[],d=[],f=Math.cos,l=Math.sin;o.push(new R(-t*l(0),-i*.5,t*f(0))),u.push(0),o.push(new R(-e*l(0),i*.5,e*f(0))),d.push(1);for(let p=0;p<s;p++){let m=2*Math.PI/s*(p+1),v=2*Math.PI/s*(p+.5);p<s-1?(o.push(new R(-t*l(m),-i*.5,t*f(m))),u.push(2*p+2),o.push(new R(-e*l(m),i*.5,e*f(m))),d.push(2*p+3),c.push([2*p,2*p+1,2*p+3,2*p+2])):c.push([2*p,2*p+1,1,0]),(s%2==1||p<s/2)&&a.push(new R(-l(v),0,f(v)))}c.push(u),a.push(new R(0,1,0));let h=[];for(let p=0;p<d.length;p++)h.push(d[d.length-p-1]);c.push(h),super({vertices:o,faces:c,axes:a}),this.type=ve.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=i,this.numSegments=r}},gE=new Xt,_E=new Xt,vE=new Xt,yE=new Ge,xE=new Xt,Md=class{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){e.enabled&&this.equations.push(e)}removeEquation(e){let t=this.equations,i=t.indexOf(e);i!==-1&&t.splice(i,1)}removeAllEquations(){this.equations.length=0}},Sd=class extends Md{constructor(){super();this.iterations=10,this.tolerance=1e-7}solve(e,t){let i=0,r=this.iterations,s=this.tolerance*this.tolerance,o=this.equations,a=o.length,c=t.bodies,u=c.length,d=e,f,l,h,p,m,v;if(a!==0)for(let b=0;b!==u;b++)c[b].updateSolveMassProperties();let _=sv,g=ov,y=rv;_.length=a,g.length=a,y.length=a;for(let b=0;b!==a;b++){let w=o[b];y[b]=0,g[b]=w.computeB(d),_[b]=1/w.computeC()}if(a!==0){for(let x=0;x!==u;x++){let S=c[x],P=S.vlambda,T=S.wlambda;P.set(0,0,0),T.set(0,0,0)}for(i=0;i!==r;i++){p=0;for(let x=0;x!==a;x++){let S=o[x];f=g[x],l=_[x],v=y[x],m=S.computeGWlambda(),h=l*(f-m-S.eps*v),v+h<S.minForce?h=S.minForce-v:v+h>S.maxForce&&(h=S.maxForce-v),y[x]+=h,p+=h>0?h:-h,S.addToWlambda(h)}if(p*p<s)break}for(let x=0;x!==u;x++){let S=c[x],P=S.velocity,T=S.angularVelocity;S.vlambda.vmul(S.linearFactor,S.vlambda),P.vadd(S.vlambda,P),S.wlambda.vmul(S.angularFactor,S.wlambda),T.vadd(S.wlambda,T)}let b=o.length,w=1/d;for(;b--;)o[b].multiplier=y[b]*w}return i}},rv=[],sv=[],ov=[],Td=class{constructor(){this.objects=[],this.type=Object}release(...e){let t=e.length;for(let i=0;i!==t;i++)this.objects.push(e[i]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){let t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}},Ed=class extends Td{constructor(){super();this.type=R}constructObject(){return new R}},tt={sphereSphere:ve.types.SPHERE,spherePlane:ve.types.SPHERE|ve.types.PLANE,boxBox:ve.types.BOX|ve.types.BOX,sphereBox:ve.types.SPHERE|ve.types.BOX,planeBox:ve.types.PLANE|ve.types.BOX,convexConvex:ve.types.CONVEXPOLYHEDRON,sphereConvex:ve.types.SPHERE|ve.types.CONVEXPOLYHEDRON,planeConvex:ve.types.PLANE|ve.types.CONVEXPOLYHEDRON,boxConvex:ve.types.BOX|ve.types.CONVEXPOLYHEDRON,sphereHeightfield:ve.types.SPHERE|ve.types.HEIGHTFIELD,boxHeightfield:ve.types.BOX|ve.types.HEIGHTFIELD,convexHeightfield:ve.types.CONVEXPOLYHEDRON|ve.types.HEIGHTFIELD,sphereParticle:ve.types.PARTICLE|ve.types.SPHERE,planeParticle:ve.types.PLANE|ve.types.PARTICLE,boxParticle:ve.types.BOX|ve.types.PARTICLE,convexParticle:ve.types.PARTICLE|ve.types.CONVEXPOLYHEDRON,cylinderCylinder:ve.types.CYLINDER,sphereCylinder:ve.types.SPHERE|ve.types.CYLINDER,planeCylinder:ve.types.PLANE|ve.types.CYLINDER,boxCylinder:ve.types.BOX|ve.types.CYLINDER,convexCylinder:ve.types.CONVEXPOLYHEDRON|ve.types.CYLINDER,heightfieldCylinder:ve.types.HEIGHTFIELD|ve.types.CYLINDER,particleCylinder:ve.types.PARTICLE|ve.types.CYLINDER,sphereTrimesh:ve.types.SPHERE|ve.types.TRIMESH,planeTrimesh:ve.types.PLANE|ve.types.TRIMESH},Le=class{constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new Ed,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,i,r,s,o){let a;this.contactPointPool.length?(a=this.contactPointPool.pop(),a.bi=e,a.bj=t):a=new lo(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&r.collisionResponse;let c=this.currentContactMaterial;a.restitution=c.restitution,a.setSpookParams(c.contactEquationStiffness,c.contactEquationRelaxation,this.world.dt);let u=i.material||e.material,d=r.material||t.material;return u&&d&&u.restitution>=0&&d.restitution>=0&&(a.restitution=u.restitution*d.restitution),a.si=s||i,a.sj=o||r,a}createFrictionEquationsFromContact(e,t){let i=e.bi,r=e.bj,s=e.si,o=e.sj,a=this.world,c=this.currentContactMaterial,u=c.friction,d=s.material||i.material,f=o.material||r.material;if(d&&f&&d.friction>=0&&f.friction>=0&&(u=d.friction*f.friction),u>0){let l=u*a.gravity.length(),h=i.invMass+r.invMass;h>0&&(h=1/h);let p=this.frictionEquationPool,m=p.length?p.pop():new Ac(i,r,l*h),v=p.length?p.pop():new Ac(i,r,l*h);return m.bi=v.bi=i,m.bj=v.bj=r,m.minForce=v.minForce=-l*h,m.maxForce=v.maxForce=l*h,m.ri.copy(e.ri),m.rj.copy(e.rj),v.ri.copy(e.ri),v.rj.copy(e.rj),e.ni.tangents(m.t,v.t),m.setSpookParams(c.frictionEquationStiffness,c.frictionEquationRelaxation,a.dt),v.setSpookParams(c.frictionEquationStiffness,c.frictionEquationRelaxation,a.dt),m.enabled=v.enabled=e.enabled,t.push(m,v),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;let i=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];pr.setZero(),jr.setZero(),qr.setZero();let s=t.bi,o=t.bj;for(let c=0;c!==e;c++)t=this.result[this.result.length-1-c],t.bi!==s?(pr.vadd(t.ni,pr),jr.vadd(t.ri,jr),qr.vadd(t.rj,qr)):(pr.vsub(t.ni,pr),jr.vadd(t.rj,jr),qr.vadd(t.ri,qr));let a=1/e;jr.scale(a,i.ri),qr.scale(a,i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj),pr.normalize(),pr.tangents(i.t,r.t)}getContacts(e,t,i,r,s,o,a){this.contactPointPool=s,this.frictionEquationPool=a,this.result=r,this.frictionResult=o;let c=cv,u=uv,d=av,f=lv;for(let l=0,h=e.length;l!==h;l++){let p=e[l],m=t[l],v=null;p.material&&m.material&&(v=i.getContactMaterial(p.material,m.material)||null);let _=p.type&xe.KINEMATIC&&m.type&xe.STATIC||p.type&xe.STATIC&&m.type&xe.KINEMATIC||p.type&xe.KINEMATIC&&m.type&xe.KINEMATIC;for(let g=0;g<p.shapes.length;g++){p.quaternion.mult(p.shapeOrientations[g],c),p.quaternion.vmult(p.shapeOffsets[g],d),d.vadd(p.position,d);let y=p.shapes[g];for(let b=0;b<m.shapes.length;b++){m.quaternion.mult(m.shapeOrientations[b],u),m.quaternion.vmult(m.shapeOffsets[b],f),f.vadd(m.position,f);let w=m.shapes[b];if(!(y.collisionFilterMask&w.collisionFilterGroup&&w.collisionFilterMask&y.collisionFilterGroup)||d.distanceTo(f)>y.boundingSphereRadius+w.boundingSphereRadius)continue;let x=null;y.material&&w.material&&(x=i.getContactMaterial(y.material,w.material)||null),this.currentContactMaterial=x||v||i.defaultContactMaterial;let S=y.type|w.type,P=this[S];if(P){let T=!1;y.type<w.type?T=P.call(this,y,w,d,f,c,u,p,m,y,w,_):T=P.call(this,w,y,f,d,u,c,m,p,y,w,_),T&&_&&(i.shapeOverlapKeeper.set(y.id,w.id),i.bodyOverlapKeeper.set(p.id,m.id))}}}}}sphereSphere(e,t,i,r,s,o,a,c,u,d,f){if(f)return i.distanceSquared(r)<(e.radius+t.radius)**2;let l=this.createContactEquation(a,c,e,t,u,d);r.vsub(i,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.scale(e.radius,l.ri),l.rj.scale(-t.radius,l.rj),l.ri.vadd(i,l.ri),l.ri.vsub(a.position,l.ri),l.rj.vadd(r,l.rj),l.rj.vsub(c.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}spherePlane(e,t,i,r,s,o,a,c,u,d,f){let l=this.createContactEquation(a,c,e,t,u,d);if(l.ni.set(0,0,1),o.vmult(l.ni,l.ni),l.ni.negate(l.ni),l.ni.normalize(),l.ni.scale(e.radius,l.ri),i.vsub(r,Ca),l.ni.scale(l.ni.dot(Ca),Ad),Ca.vsub(Ad,l.rj),-Ca.dot(l.ni)<=e.radius){if(f)return!0;let h=l.ri,p=l.rj;h.vadd(i,h),h.vsub(a.position,h),p.vadd(r,p),p.vsub(c.position,p),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}}boxBox(e,t,i,r,s,o,a,c,u,d,f){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,r,s,o,a,c,e,t,f)}sphereBox(e,t,i,r,s,o,a,c,u,d,f){let l=this.v3pool,h=Ov;i.vsub(r,La),t.getSideNormals(h,o);let p=e.radius,m=!1,v=Fv,_=Bv,g=Nv,y=null,b=0,w=0,x=0,S=null;for(let F=0,Z=h.length;F!==Z&&m===!1;F++){let ee=Rv;ee.copy(h[F]);let oe=ee.length();ee.normalize();let ge=La.dot(ee);if(ge<oe+p&&ge>0){let de=Pv,ne=Iv;de.copy(h[(F+1)%3]),ne.copy(h[(F+2)%3]);let Te=de.length(),Ae=ne.length();de.normalize(),ne.normalize();let re=La.dot(de),C=La.dot(ne);if(re<Te&&re>-Te&&C<Ae&&C>-Ae){let M=Math.abs(ge-oe-p);if((S===null||M<S)&&(S=M,w=re,x=C,y=oe,v.copy(ee),_.copy(de),g.copy(ne),b++,f))return!0}}}if(b){m=!0;let F=this.createContactEquation(a,c,e,t,u,d);v.scale(-p,F.ri),F.ni.copy(v),F.ni.negate(F.ni),v.scale(y,v),_.scale(w,_),v.vadd(_,v),g.scale(x,g),v.vadd(g,F.rj),F.ri.vadd(i,F.ri),F.ri.vsub(a.position,F.ri),F.rj.vadd(r,F.rj),F.rj.vsub(c.position,F.rj),this.result.push(F),this.createFrictionEquationsFromContact(F,this.frictionResult)}let P=l.get(),T=Dv;for(let F=0;F!==2&&!m;F++)for(let Z=0;Z!==2&&!m;Z++)for(let ee=0;ee!==2&&!m;ee++)if(P.set(0,0,0),F?P.vadd(h[0],P):P.vsub(h[0],P),Z?P.vadd(h[1],P):P.vsub(h[1],P),ee?P.vadd(h[2],P):P.vsub(h[2],P),r.vadd(P,T),T.vsub(i,T),T.lengthSquared()<p*p){if(f)return!0;m=!0;let oe=this.createContactEquation(a,c,e,t,u,d);oe.ri.copy(T),oe.ri.normalize(),oe.ni.copy(oe.ri),oe.ri.scale(p,oe.ri),oe.rj.copy(P),oe.ri.vadd(i,oe.ri),oe.ri.vsub(a.position,oe.ri),oe.rj.vadd(r,oe.rj),oe.rj.vsub(c.position,oe.rj),this.result.push(oe),this.createFrictionEquationsFromContact(oe,this.frictionResult)}l.release(P),P=null;let I=l.get(),U=l.get(),W=l.get(),D=l.get(),L=l.get(),O=h.length;for(let F=0;F!==O&&!m;F++)for(let Z=0;Z!==O&&!m;Z++)if(F%3!=Z%3){h[Z].cross(h[F],I),I.normalize(),h[F].vadd(h[Z],U),W.copy(i),W.vsub(U,W),W.vsub(r,W);let ee=W.dot(I);I.scale(ee,D);let oe=0;for(;oe===F%3||oe===Z%3;)oe++;L.copy(i),L.vsub(D,L),L.vsub(U,L),L.vsub(r,L);let ge=Math.abs(ee),de=L.length();if(ge<h[oe].length()&&de<p){if(f)return!0;m=!0;let ne=this.createContactEquation(a,c,e,t,u,d);U.vadd(D,ne.rj),ne.rj.copy(ne.rj),L.negate(ne.ni),ne.ni.normalize(),ne.ri.copy(ne.rj),ne.ri.vadd(r,ne.ri),ne.ri.vsub(i,ne.ri),ne.ri.normalize(),ne.ri.scale(p,ne.ri),ne.ri.vadd(i,ne.ri),ne.ri.vsub(a.position,ne.ri),ne.rj.vadd(r,ne.rj),ne.rj.vsub(c.position,ne.rj),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult)}}l.release(I,U,W,D,L)}planeBox(e,t,i,r,s,o,a,c,u,d,f){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,i,r,s,o,a,c,e,t,f)}convexConvex(e,t,i,r,s,o,a,c,u,d,f,l,h){let p=$v;if(!(i.distanceTo(r)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,s,r,o,p,l,h)){let m=[],v=Qv;e.clipAgainstHull(i,s,t,r,o,p,-100,100,m);let _=0;for(let g=0;g!==m.length;g++){if(f)return!0;let y=this.createContactEquation(a,c,e,t,u,d),b=y.ri,w=y.rj;p.negate(y.ni),m[g].normal.negate(v),v.scale(m[g].depth,v),m[g].point.vadd(v,b),w.copy(m[g].point),b.vsub(i,b),w.vsub(r,w),b.vadd(i,b),b.vsub(a.position,b),w.vadd(r,w),w.vsub(c.position,w),this.result.push(y),_++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(y,this.frictionResult)}this.enableFrictionReduction&&_&&this.createFrictionFromAverage(_)}}sphereConvex(e,t,i,r,s,o,a,c,u,d,f){let l=this.v3pool;i.vsub(r,kv);let h=t.faceNormals,p=t.faces,m=t.vertices,v=e.radius,_=!1;for(let g=0;g!==m.length;g++){let y=m[g],b=Gv;o.vmult(y,b),r.vadd(b,b);let w=Uv;if(b.vsub(i,w),w.lengthSquared()<v*v){if(f)return!0;_=!0;let x=this.createContactEquation(a,c,e,t,u,d);x.ri.copy(w),x.ri.normalize(),x.ni.copy(x.ri),x.ri.scale(v,x.ri),b.vsub(r,x.rj),x.ri.vadd(i,x.ri),x.ri.vsub(a.position,x.ri),x.rj.vadd(r,x.rj),x.rj.vsub(c.position,x.rj),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult);return}}for(let g=0,y=p.length;g!==y&&_===!1;g++){let b=h[g],w=p[g],x=Vv;o.vmult(b,x);let S=Wv;o.vmult(m[w[0]],S),S.vadd(r,S);let P=jv;x.scale(-v,P),i.vadd(P,P);let T=qv;P.vsub(S,T);let I=T.dot(x),U=Xv;if(i.vsub(S,U),I<0&&U.dot(x)>0){let W=[];for(let D=0,L=w.length;D!==L;D++){let O=l.get();o.vmult(m[w[D]],O),r.vadd(O,O),W.push(O)}if(Lv(W,x,i)){if(f)return!0;_=!0;let D=this.createContactEquation(a,c,e,t,u,d);x.scale(-v,D.ri),x.negate(D.ni);let L=l.get();x.scale(-I,L);let O=l.get();x.scale(-v,O),i.vsub(r,D.rj),D.rj.vadd(O,D.rj),D.rj.vadd(L,D.rj),D.rj.vadd(r,D.rj),D.rj.vsub(c.position,D.rj),D.ri.vadd(i,D.ri),D.ri.vsub(a.position,D.ri),l.release(L),l.release(O),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult);for(let F=0,Z=W.length;F!==Z;F++)l.release(W[F]);return}else for(let D=0;D!==w.length;D++){let L=l.get(),O=l.get();o.vmult(m[w[(D+1)%w.length]],L),o.vmult(m[w[(D+2)%w.length]],O),r.vadd(L,L),r.vadd(O,O);let F=zv;O.vsub(L,F);let Z=Hv;F.unit(Z);let ee=l.get(),oe=l.get();i.vsub(L,oe);let ge=oe.dot(Z);Z.scale(ge,ee),ee.vadd(L,ee);let de=l.get();if(ee.vsub(i,de),ge>0&&ge*ge<F.lengthSquared()&&de.lengthSquared()<v*v){if(f)return!0;let ne=this.createContactEquation(a,c,e,t,u,d);ee.vsub(r,ne.rj),ee.vsub(i,ne.ni),ne.ni.normalize(),ne.ni.scale(v,ne.ri),ne.rj.vadd(r,ne.rj),ne.rj.vsub(c.position,ne.rj),ne.ri.vadd(i,ne.ri),ne.ri.vsub(a.position,ne.ri),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult);for(let Te=0,Ae=W.length;Te!==Ae;Te++)l.release(W[Te]);l.release(L),l.release(O),l.release(ee),l.release(de),l.release(oe);return}l.release(L),l.release(O),l.release(ee),l.release(de),l.release(oe)}for(let D=0,L=W.length;D!==L;D++)l.release(W[D])}}}planeConvex(e,t,i,r,s,o,a,c,u,d,f){let l=Yv,h=Zv;h.set(0,0,1),s.vmult(h,h);let p=0,m=Jv;for(let v=0;v!==t.vertices.length;v++)if(l.copy(t.vertices[v]),o.vmult(l,l),r.vadd(l,l),l.vsub(i,m),h.dot(m)<=0){if(f)return!0;let g=this.createContactEquation(a,c,e,t,u,d),y=Kv;h.scale(h.dot(m),y),l.vsub(y,y),y.vsub(i,g.ri),g.ni.copy(h),l.vsub(r,g.rj),g.ri.vadd(i,g.ri),g.ri.vsub(a.position,g.ri),g.rj.vadd(r,g.rj),g.rj.vsub(c.position,g.rj),this.result.push(g),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(g,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(e,t,i,r,s,o,a,c,u,d,f){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,r,s,o,a,c,e,t,f)}sphereHeightfield(e,t,i,r,s,o,a,c,u,d,f){let l=t.data,h=e.radius,p=t.elementSize,m=hy,v=uy;Ge.pointToLocalFrame(r,o,i,v);let _=Math.floor((v.x-h)/p)-1,g=Math.ceil((v.x+h)/p)+1,y=Math.floor((v.y-h)/p)-1,b=Math.ceil((v.y+h)/p)+1;if(g<0||b<0||_>l.length||y>l[0].length)return;_<0&&(_=0),g<0&&(g=0),y<0&&(y=0),b<0&&(b=0),_>=l.length&&(_=l.length-1),g>=l.length&&(g=l.length-1),b>=l[0].length&&(b=l[0].length-1),y>=l[0].length&&(y=l[0].length-1);let w=[];t.getRectMinMax(_,y,g,b,w);let x=w[0],S=w[1];if(v.z-h>S||v.z+h<x)return;let P=this.result;for(let T=_;T<g;T++)for(let I=y;I<b;I++){let U=P.length,W=!1;if(t.getConvexTrianglePillar(T,I,!1),Ge.pointToWorldFrame(r,o,t.pillarOffset,m),i.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(W=this.sphereConvex(e,t.pillarConvex,i,m,s,o,a,c,e,t,f)),f&&W||(t.getConvexTrianglePillar(T,I,!0),Ge.pointToWorldFrame(r,o,t.pillarOffset,m),i.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(W=this.sphereConvex(e,t.pillarConvex,i,m,s,o,a,c,e,t,f)),f&&W))return!0;if(P.length-U>2)return}}boxHeightfield(e,t,i,r,s,o,a,c,u,d,f){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,r,s,o,a,c,e,t,f)}convexHeightfield(e,t,i,r,s,o,a,c,u,d,f){let l=t.data,h=t.elementSize,p=e.boundingSphereRadius,m=ly,v=cy,_=ay;Ge.pointToLocalFrame(r,o,i,_);let g=Math.floor((_.x-p)/h)-1,y=Math.ceil((_.x+p)/h)+1,b=Math.floor((_.y-p)/h)-1,w=Math.ceil((_.y+p)/h)+1;if(y<0||w<0||g>l.length||b>l[0].length)return;g<0&&(g=0),y<0&&(y=0),b<0&&(b=0),w<0&&(w=0),g>=l.length&&(g=l.length-1),y>=l.length&&(y=l.length-1),w>=l[0].length&&(w=l[0].length-1),b>=l[0].length&&(b=l[0].length-1);let x=[];t.getRectMinMax(g,b,y,w,x);let S=x[0],P=x[1];if(!(_.z-p>P||_.z+p<S))for(let T=g;T<y;T++)for(let I=b;I<w;I++){let U=!1;if(t.getConvexTrianglePillar(T,I,!1),Ge.pointToWorldFrame(r,o,t.pillarOffset,m),i.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(U=this.convexConvex(e,t.pillarConvex,i,m,s,o,a,c,null,null,f,v,null)),f&&U||(t.getConvexTrianglePillar(T,I,!0),Ge.pointToWorldFrame(r,o,t.pillarOffset,m),i.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(U=this.convexConvex(e,t.pillarConvex,i,m,s,o,a,c,null,null,f,v,null)),f&&U))return!0}}sphereParticle(e,t,i,r,s,o,a,c,u,d,f){let l=iy;if(l.set(0,0,1),r.vsub(i,l),l.lengthSquared()<=e.radius*e.radius){if(f)return!0;let p=this.createContactEquation(c,a,t,e,u,d);l.normalize(),p.rj.copy(l),p.rj.scale(e.radius,p.rj),p.ni.copy(l),p.ni.negate(p.ni),p.ri.set(0,0,0),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}planeParticle(e,t,i,r,s,o,a,c,u,d,f){let l=ey;l.set(0,0,1),a.quaternion.vmult(l,l);let h=ty;if(r.vsub(a.position,h),l.dot(h)<=0){if(f)return!0;let m=this.createContactEquation(c,a,t,e,u,d);m.ni.copy(l),m.ni.negate(m.ni),m.ri.set(0,0,0);let v=ny;l.scale(l.dot(r),v),r.vsub(v,v),m.rj.copy(v),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}boxParticle(e,t,i,r,s,o,a,c,u,d,f){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,r,s,o,a,c,e,t,f)}convexParticle(e,t,i,r,s,o,a,c,u,d,f){let l=-1,h=sy,p=oy,m=null,v=ry;if(v.copy(r),v.vsub(i,v),s.conjugate(Cd),Cd.vmult(v,v),e.pointIsInside(v)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,s),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(s);for(let _=0,g=e.faces.length;_!==g;_++){let y=[e.worldVertices[e.faces[_][0]]],b=e.worldFaceNormals[_];r.vsub(y[0],Ld);let w=-b.dot(Ld);if(m===null||Math.abs(w)<Math.abs(m)){if(f)return!0;m=w,l=_,h.copy(b)}}if(l!==-1){let _=this.createContactEquation(c,a,t,e,u,d);h.scale(m,p),p.vadd(r,p),p.vsub(i,p),_.rj.copy(p),h.negate(_.ni),_.ri.set(0,0,0);let g=_.ri,y=_.rj;g.vadd(r,g),g.vsub(c.position,g),y.vadd(i,y),y.vsub(a.position,y),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,i,r,s,o,a,c,u,d,f){return this.convexHeightfield(t,e,r,i,o,s,c,a,u,d,f)}particleCylinder(e,t,i,r,s,o,a,c,u,d,f){return this.convexParticle(t,e,r,i,o,s,c,a,u,d,f)}sphereTrimesh(e,t,i,r,s,o,a,c,u,d,f){let l=vv,h=yv,p=xv,m=bv,v=wv,_=Mv,g=Av,y=_v,b=mv,w=Cv;Ge.pointToLocalFrame(r,o,i,v);let x=e.radius;g.lowerBound.set(v.x-x,v.y-x,v.z-x),g.upperBound.set(v.x+x,v.y+x,v.z+x),t.getTrianglesInAABB(g,w);let S=gv,P=e.radius*e.radius;for(let D=0;D<w.length;D++)for(let L=0;L<3;L++)if(t.getVertex(t.indices[w[D]*3+L],S),S.vsub(v,b),b.lengthSquared()<=P){if(y.copy(S),Ge.pointToWorldFrame(r,o,y,S),S.vsub(i,b),f)return!0;let O=this.createContactEquation(a,c,e,t,u,d);O.ni.copy(b),O.ni.normalize(),O.ri.copy(O.ni),O.ri.scale(e.radius,O.ri),O.ri.vadd(i,O.ri),O.ri.vsub(a.position,O.ri),O.rj.copy(S),O.rj.vsub(c.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}for(let D=0;D<w.length;D++)for(let L=0;L<3;L++){t.getVertex(t.indices[w[D]*3+L],l),t.getVertex(t.indices[w[D]*3+(L+1)%3],h),h.vsub(l,p),v.vsub(h,_);let O=_.dot(p);v.vsub(l,_);let F=_.dot(p);if(F>0&&O<0&&(v.vsub(l,_),m.copy(p),m.normalize(),F=_.dot(m),m.scale(F,_),_.vadd(l,_),_.distanceTo(v)<e.radius)){if(f)return!0;let ee=this.createContactEquation(a,c,e,t,u,d);_.vsub(v,ee.ni),ee.ni.normalize(),ee.ni.scale(e.radius,ee.ri),ee.ri.vadd(i,ee.ri),ee.ri.vsub(a.position,ee.ri),Ge.pointToWorldFrame(r,o,_,_),_.vsub(c.position,ee.rj),Ge.vectorToWorldFrame(o,ee.ni,ee.ni),Ge.vectorToWorldFrame(o,ee.ri,ee.ri),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}let T=Sv,I=Tv,U=Ev,W=pv;for(let D=0,L=w.length;D!==L;D++){t.getTriangleVertices(w[D],T,I,U),t.getNormal(w[D],W),v.vsub(T,_);let O=_.dot(W);if(W.scale(O,_),v.vsub(_,_),O=_.distanceTo(v),Ve.pointInTriangle(_,T,I,U)&&O<e.radius){if(f)return!0;let F=this.createContactEquation(a,c,e,t,u,d);_.vsub(v,F.ni),F.ni.normalize(),F.ni.scale(e.radius,F.ri),F.ri.vadd(i,F.ri),F.ri.vsub(a.position,F.ri),Ge.pointToWorldFrame(r,o,_,_),_.vsub(c.position,F.rj),Ge.vectorToWorldFrame(o,F.ni,F.ni),Ge.vectorToWorldFrame(o,F.ri,F.ri),this.result.push(F),this.createFrictionEquationsFromContact(F,this.frictionResult)}}w.length=0}planeTrimesh(e,t,i,r,s,o,a,c,u,d,f){let l=new R,h=hv;h.set(0,0,1),s.vmult(h,h);for(let p=0;p<t.vertices.length/3;p++){t.getVertex(p,l);let m=new R;m.copy(l),Ge.pointToWorldFrame(r,o,m,l);let v=dv;if(l.vsub(i,v),h.dot(v)<=0){if(f)return!0;let g=this.createContactEquation(a,c,e,t,u,d);g.ni.copy(h);let y=fv;h.scale(v.dot(h),y),l.vsub(y,y),g.ri.copy(y),g.ri.vsub(a.position,g.ri),g.rj.copy(l),g.rj.vsub(c.position,g.rj),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}}}},pr=new R,jr=new R,qr=new R,av=new R,lv=new R,cv=new ct,uv=new ct;Le.prototype[tt.boxBox]=Le.prototype.boxBox;Le.prototype[tt.boxConvex]=Le.prototype.boxConvex;Le.prototype[tt.boxParticle]=Le.prototype.boxParticle;Le.prototype[tt.sphereSphere]=Le.prototype.sphereSphere;var hv=new R,dv=new R,fv=new R;Le.prototype[tt.planeTrimesh]=Le.prototype.planeTrimesh;var pv=new R,mv=new R,gv=new R,_v=new R,vv=new R,yv=new R,xv=new R,bv=new R,wv=new R,Mv=new R,Sv=new R,Tv=new R,Ev=new R,Av=new Xt,Cv=[];Le.prototype[tt.sphereTrimesh]=Le.prototype.sphereTrimesh;var Ca=new R,Ad=new R;Le.prototype[tt.spherePlane]=Le.prototype.spherePlane;var dy=new R,fy=new R,py=new R;function Lv(n,e,t){let i=null,r=n.length;for(let s=0;s!==r;s++){let o=n[s],a=dy;n[(s+1)%r].vsub(o,a);let c=fy;a.cross(e,c);let u=py;t.vsub(o,u);let d=c.dot(u);if(i===null||d>0&&i===!0||d<=0&&i===!1){i===null&&(i=d>0);continue}else return!1}return!0}var La=new R,Rv=new R,Pv=new R,Iv=new R,Ov=[new R,new R,new R,new R,new R,new R],Dv=new R,Fv=new R,Bv=new R,Nv=new R;Le.prototype[tt.sphereBox]=Le.prototype.sphereBox;var kv=new R,zv=new R,Hv=new R,Uv=new R,Gv=new R,Vv=new R,Wv=new R,jv=new R,qv=new R,Xv=new R;Le.prototype[tt.sphereConvex]=Le.prototype.sphereConvex;Le.prototype[tt.planeBox]=Le.prototype.planeBox;var Yv=new R,Zv=new R,Jv=new R,Kv=new R;Le.prototype[tt.planeConvex]=Le.prototype.planeConvex;var $v=new R,Qv=new R;Le.prototype[tt.convexConvex]=Le.prototype.convexConvex;var ey=new R,ty=new R,ny=new R;Le.prototype[tt.planeParticle]=Le.prototype.planeParticle;var iy=new R;Le.prototype[tt.sphereParticle]=Le.prototype.sphereParticle;Le.prototype[tt.cylinderCylinder]=Le.prototype.convexConvex;Le.prototype[tt.sphereCylinder]=Le.prototype.sphereConvex;Le.prototype[tt.planeCylinder]=Le.prototype.planeConvex;Le.prototype[tt.boxCylinder]=Le.prototype.boxConvex;Le.prototype[tt.convexCylinder]=Le.prototype.convexConvex;Le.prototype[tt.heightfieldCylinder]=Le.prototype.heightfieldCylinder;Le.prototype[tt.particleCylinder]=Le.prototype.particleCylinder;var Cd=new ct,ry=new R,sy=new R,Ld=new R,oy=new R;Le.prototype[tt.convexParticle]=Le.prototype.convexParticle;Le.prototype[tt.boxHeightfield]=Le.prototype.boxHeightfield;var ay=new R,ly=new R,cy=[0];Le.prototype[tt.convexHeightfield]=Le.prototype.convexHeightfield;var uy=new R,hy=new R;Le.prototype[tt.sphereHeightfield]=Le.prototype.sphereHeightfield;var Cc=class{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){let i=t;t=e,e=i}return e<<16|t}set(e,t){let i=this.getKey(e,t),r=this.current,s=0;for(;i>r[s];)s++;if(i!==r[s]){for(let o=r.length-1;o>=s;o--)r[o+1]=r[o];r[s]=i}}tick(){let e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){let i=this.current,r=this.previous,s=i.length,o=r.length,a=0;for(let c=0;c<s;c++){let u=!1,d=i[c];for(;d>r[a];)a++;u=d===r[a],u||Rd(e,d)}a=0;for(let c=0;c<o;c++){let u=!1,d=r[c];for(;d>i[a];)a++;u=i[a]===d,u||Rd(t,d)}}};function Rd(n,e){n.push((e&4294901760)>>16,e&65535)}var Pd=class{constructor(){this.data={keys:[]}}get(e,t){if(e>t){let i=t;t=e,e=i}return this.data[e+"-"+t]}set(e,t,i){if(e>t){let s=t;t=e,e=s}let r=e+"-"+t;this.get(e,t)||this.data.keys.push(r),this.data[r]=i}reset(){let e=this.data,t=e.keys;for(;t.length>0;){let i=t.pop();delete e[i]}}},uo=class extends _c{constructor(e={}){super();this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new R,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new fd,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new Sd,this.constraints=[],this.narrowphase=new Le(this),this.collisionMatrix=new gc,this.collisionMatrixPrevious=new gc,this.bodyOverlapKeeper=new Cc,this.shapeOverlapKeeper=new Cc,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new Pd,this.defaultMaterial=new Bi("default"),this.defaultContactMaterial=new Fi(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}numObjects(){return this.bodies.length}collisionMatrixTick(){let e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){let t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,i){i instanceof ba?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)}raycastAll(e,t,i={},r){return i.mode=Ve.ALL,i.from=e,i.to=t,i.callback=r,Lc.intersectWorld(this,i)}raycastAny(e,t,i={},r){return i.mode=Ve.ANY,i.from=e,i.to=t,i.result=r,Lc.intersectWorld(this,i)}raycastClosest(e,t,i={},r){return i.mode=Ve.CLOSEST,i.from=e,i.to=t,i.result=r,Lc.intersectWorld(this,i)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof xe&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;let t=this.bodies.length-1,i=this.bodies,r=i.indexOf(e);if(r!==-1){i.splice(r,1);for(let s=0;s!==i.length;s++)i[s].index=s;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){let t=this.bodies;for(let i=0,r=t.length;i<r;i++){let s=t[i].shapes;for(let o=0,a=s.length;o<a;o++){let c=s[o];if(c.id===e)return c}}}addMaterial(e){this.materials.push(e)}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}step(e,t,i=10){if(t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;let r=St.now(),s=0;for(;this.accumulator>=e&&s<i&&(this.internalStep(e),this.accumulator-=e,s++,!(St.now()-r>e*1e3)););this.accumulator=this.accumulator%e;let o=this.accumulator/e;for(let a=0;a!==this.bodies.length;a++){let c=this.bodies[a];c.previousPosition.lerp(c.position,o,c.interpolatedPosition),c.previousQuaternion.slerp(c.quaternion,o,c.interpolatedQuaternion),c.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;let t=this.contacts,i=yy,r=xy,s=this.numObjects(),o=this.bodies,a=this.solver,c=this.gravity,u=this.doProfiling,d=this.profile,f=xe.DYNAMIC,l=-Infinity,h=this.constraints,p=vy,m=c.length(),v=c.x,_=c.y,g=c.z,y=0;for(u&&(l=St.now()),y=0;y!==s;y++){let L=o[y];if(L.type===f){let O=L.force,F=L.mass;O.x+=F*v,O.y+=F*_,O.z+=F*g}}for(let L=0,O=this.subsystems.length;L!==O;L++)this.subsystems[L].update();u&&(l=St.now()),i.length=0,r.length=0,this.broadphase.collisionPairs(this,i,r),u&&(d.broadphase=St.now()-l);let b=h.length;for(y=0;y!==b;y++){let L=h[y];if(!L.collideConnected)for(let O=i.length-1;O>=0;O-=1)(L.bodyA===i[O]&&L.bodyB===r[O]||L.bodyB===i[O]&&L.bodyA===r[O])&&(i.splice(O,1),r.splice(O,1))}this.collisionMatrixTick(),u&&(l=St.now());let w=_y,x=t.length;for(y=0;y!==x;y++)w.push(t[y]);t.length=0;let S=this.frictionEquations.length;for(y=0;y!==S;y++)p.push(this.frictionEquations[y]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,r,this,t,w,this.frictionEquations,p),u&&(d.narrowphase=St.now()-l),u&&(l=St.now()),y=0;y<this.frictionEquations.length;y++)a.addEquation(this.frictionEquations[y]);let P=t.length;for(let L=0;L!==P;L++){let O=t[L],F=O.bi,Z=O.bj,ee=O.si,oe=O.sj,ge;F.material&&Z.material?ge=this.getContactMaterial(F.material,Z.material)||this.defaultContactMaterial:ge=this.defaultContactMaterial;let de=ge.friction;if(F.material&&Z.material&&(F.material.friction>=0&&Z.material.friction>=0&&(de=F.material.friction*Z.material.friction),F.material.restitution>=0&&Z.material.restitution>=0&&(O.restitution=F.material.restitution*Z.material.restitution)),a.addEquation(O),F.allowSleep&&F.type===xe.DYNAMIC&&F.sleepState===xe.SLEEPING&&Z.sleepState===xe.AWAKE&&Z.type!==xe.STATIC){let ne=Z.velocity.lengthSquared()+Z.angularVelocity.lengthSquared(),Te=Z.sleepSpeedLimit**2;ne>=Te*2&&(F.wakeUpAfterNarrowphase=!0)}if(Z.allowSleep&&Z.type===xe.DYNAMIC&&Z.sleepState===xe.SLEEPING&&F.sleepState===xe.AWAKE&&F.type!==xe.STATIC){let ne=F.velocity.lengthSquared()+F.angularVelocity.lengthSquared(),Te=F.sleepSpeedLimit**2;ne>=Te*2&&(Z.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(F,Z,!0),this.collisionMatrixPrevious.get(F,Z)||(ho.body=Z,ho.contact=O,F.dispatchEvent(ho),ho.body=F,Z.dispatchEvent(ho)),this.bodyOverlapKeeper.set(F.id,Z.id),this.shapeOverlapKeeper.set(ee.id,oe.id)}for(this.emitContactEvents(),u&&(d.makeContactConstraints=St.now()-l,l=St.now()),y=0;y!==s;y++){let L=o[y];L.wakeUpAfterNarrowphase&&(L.wakeUp(),L.wakeUpAfterNarrowphase=!1)}for(b=h.length,y=0;y!==b;y++){let L=h[y];L.update();for(let O=0,F=L.equations.length;O!==F;O++){let Z=L.equations[O];a.addEquation(Z)}}a.solve(e,this),u&&(d.solve=St.now()-l),a.removeAllEquations();let T=Math.pow;for(y=0;y!==s;y++){let L=o[y];if(L.type&f){let O=T(1-L.linearDamping,e),F=L.velocity;F.scale(O,F);let Z=L.angularVelocity;if(Z){let ee=T(1-L.angularDamping,e);Z.scale(ee,Z)}}}for(this.dispatchEvent(gy),y=0;y!==s;y++){let L=o[y];L.preStep&&L.preStep.call(L)}u&&(l=St.now());let U=this.stepnumber%(this.quatNormalizeSkip+1)==0,W=this.quatNormalizeFast;for(y=0;y!==s;y++)o[y].integrate(e,U,W);for(this.clearForces(),this.broadphase.dirty=!0,u&&(d.integrate=St.now()-l),this.time+=e,this.stepnumber+=1,this.dispatchEvent(my),y=0;y!==s;y++){let L=o[y],O=L.postStep;O&&O.call(L)}let D=!0;if(this.allowSleep)for(D=!1,y=0;y!==s;y++){let L=o[y];L.sleepTick(this.time),L.sleepState!==xe.SLEEPING&&(D=!0)}this.hasActiveBodies=D}clearForces(){let e=this.bodies,t=e.length;for(let i=0;i!==t;i++){let r=e[i],s=r.force,o=r.torque;r.force.set(0,0,0),r.torque.set(0,0,0)}}},bE=new Xt,Lc=new Ve,St=globalThis.performance||{};if(!St.now){let n=Date.now();St.timing&&St.timing.navigationStart&&(n=St.timing.navigationStart),St.now=()=>Date.now()-n}var my={type:"postStep"},gy={type:"preStep"},ho={type:xe.COLLIDE_EVENT_NAME,body:null,contact:null},_y=[],vy=[],yy=[],xy=[];uo.prototype.emitContactEvents=(()=>{let n=[],e=[],t={type:"beginContact",bodyA:null,bodyB:null},i={type:"endContact",bodyA:null,bodyB:null},r={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},s={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};return function(){let o=this.hasAnyEventListener("beginContact"),a=this.hasAnyEventListener("endContact");if((o||a)&&this.bodyOverlapKeeper.getDiff(n,e),o){for(let d=0,f=n.length;d<f;d+=2)t.bodyA=this.getBodyById(n[d]),t.bodyB=this.getBodyById(n[d+1]),this.dispatchEvent(t);t.bodyA=t.bodyB=null}if(a){for(let d=0,f=e.length;d<f;d+=2)i.bodyA=this.getBodyById(e[d]),i.bodyB=this.getBodyById(e[d+1]),this.dispatchEvent(i);i.bodyA=i.bodyB=null}n.length=e.length=0;let c=this.hasAnyEventListener("beginShapeContact"),u=this.hasAnyEventListener("endShapeContact");if((c||u)&&this.shapeOverlapKeeper.getDiff(n,e),c){for(let d=0,f=n.length;d<f;d+=2){let l=this.getShapeById(n[d]),h=this.getShapeById(n[d+1]);r.shapeA=l,r.shapeB=h,r.bodyA=l.body,r.bodyB=h.body,this.dispatchEvent(r)}r.bodyA=r.bodyB=r.shapeA=r.shapeB=null}if(u){for(let d=0,f=e.length;d<f;d+=2){let l=this.getShapeById(e[d]),h=this.getShapeById(e[d+1]);s.shapeA=l,s.shapeB=h,s.bodyA=l.body,s.bodyB=h.body,this.dispatchEvent(s)}s.bodyA=s.bodyB=s.shapeA=s.shapeB=null}}})();var Id="125",ui={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},hi={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},by=0,Od=1,wy=2,Dd=1,Ra=2,fo=3,di=0,Tt=1,mr=2,Fd=1,po=0,mo=1,Pa=2,Bd=3,Nd=4,My=5,Xr=100,Sy=101,Ty=102,kd=103,zd=104,Ey=200,Ay=201,Cy=202,Ly=203,Hd=204,Ud=205,Ry=206,Py=207,Iy=208,Oy=209,Dy=210,Fy=0,By=1,Ny=2,Rc=3,ky=4,zy=5,Hy=6,Uy=7,Ia=0,Gy=1,Vy=2,Ni=0,Oa=1,Da=2,Fa=3,go=4,Wy=5,Gd=300,Pc=301,Ic=302,Vd=303,Wd=304,Oc=306,Dc=307,gr=1e3,Wt=1001,_o=1002,_t=1003,Ba=1004,Na=1005,Xe=1006,Fc=1007,_r=1008,Bc=1009,jy=1010,qy=1011,ka=1012,Xy=1013,za=1014,ki=1015,Ha=1016,Yy=1017,Zy=1018,Jy=1019,vo=1020,Ky=1021,fi=1022,Et=1023,$y=1024,Qy=1025,Yr=1026,yo=1027,e0=1028,t0=1029,n0=1030,i0=1031,r0=1032,s0=1033,jd=33776,qd=33777,Xd=33778,Yd=33779,Zd=35840,Jd=35841,Kd=35842,$d=35843,o0=36196,Qd=37492,ef=37496,a0=37808,l0=37809,c0=37810,u0=37811,h0=37812,d0=37813,f0=37814,p0=37815,m0=37816,g0=37817,_0=37818,v0=37819,y0=37820,x0=37821,b0=36492,w0=37840,M0=37841,S0=37842,T0=37843,E0=37844,A0=37845,C0=37846,L0=37847,R0=37848,P0=37849,I0=37850,O0=37851,D0=37852,F0=37853,B0=2200,N0=2201,k0=2202,Zr=2300,vr=2301,Nc=2302,Jr=2400,Kr=2401,Ua=2402,kc=2500,tf=2501,z0=0,nf=1,zc=2,xo=3e3,jn=3001,H0=3007,U0=3002,G0=3003,V0=3004,W0=3005,j0=3006,q0=3200,X0=3201,zi=0,Y0=1,Hc=7680,Z0=519,Ga=35044,bo=35048,rf="300 es";function Pn(){}Object.assign(Pn.prototype,{addEventListener:function(n,e){this._listeners===void 0&&(this._listeners={});let t=this._listeners;t[n]===void 0&&(t[n]=[]),t[n].indexOf(e)===-1&&t[n].push(e)},hasEventListener:function(n,e){if(this._listeners===void 0)return!1;let t=this._listeners;return t[n]!==void 0&&t[n].indexOf(e)!==-1},removeEventListener:function(n,e){if(this._listeners===void 0)return;let i=this._listeners[n];if(i!==void 0){let r=i.indexOf(e);r!==-1&&i.splice(r,1)}},dispatchEvent:function(n){if(this._listeners===void 0)return;let t=this._listeners[n.type];if(t!==void 0){n.target=this;let i=t.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,n)}}});var Rt=[];for(let n=0;n<256;n++)Rt[n]=(n<16?"0":"")+n.toString(16);var Va=1234567,Ie={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){let n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Rt[n&255]+Rt[n>>8&255]+Rt[n>>16&255]+Rt[n>>24&255]+"-"+Rt[e&255]+Rt[e>>8&255]+"-"+Rt[e>>16&15|64]+Rt[e>>24&255]+"-"+Rt[t&63|128]+Rt[t>>8&255]+"-"+Rt[t>>16&255]+Rt[t>>24&255]+Rt[i&255]+Rt[i>>8&255]+Rt[i>>16&255]+Rt[i>>24&255]).toUpperCase()},clamp:function(n,e,t){return Math.max(e,Math.min(t,n))},euclideanModulo:function(n,e){return(n%e+e)%e},mapLinear:function(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)},lerp:function(n,e,t){return(1-t)*n+t*e},damp:function(n,e,t,i){return Ie.lerp(n,e,1-Math.exp(-t*i))},pingpong:function(n,e=1){return e-Math.abs(Ie.euclideanModulo(n,e*2)-e)},smoothstep:function(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))},smootherstep:function(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))},randInt:function(n,e){return n+Math.floor(Math.random()*(e-n+1))},randFloat:function(n,e){return n+Math.random()*(e-n)},randFloatSpread:function(n){return n*(.5-Math.random())},seededRandom:function(n){return n!==void 0&&(Va=n%2147483647),Va=Va*16807%2147483647,(Va-1)/2147483646},degToRad:function(n){return n*Ie.DEG2RAD},radToDeg:function(n){return n*Ie.RAD2DEG},isPowerOfTwo:function(n){return(n&n-1)==0&&n!==0},ceilPowerOfTwo:function(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},floorPowerOfTwo:function(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},setQuaternionFromProperEuler:function(n,e,t,i,r){let s=Math.cos,o=Math.sin,a=s(t/2),c=o(t/2),u=s((e+i)/2),d=o((e+i)/2),f=s((e-i)/2),l=o((e-i)/2),h=s((i-e)/2),p=o((i-e)/2);switch(r){case"XYX":n.set(a*d,c*f,c*l,a*u);break;case"YZY":n.set(c*l,a*d,c*f,a*u);break;case"ZXZ":n.set(c*f,c*l,a*d,a*u);break;case"XZX":n.set(a*d,c*p,c*h,a*u);break;case"YXY":n.set(c*h,a*d,c*p,a*u);break;case"ZYZ":n.set(c*p,c*h,a*d,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}},ae=class{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}},nn=class{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,s,o,a,c,u){let d=this.elements;return d[0]=e,d[1]=r,d[2]=a,d[3]=t,d[4]=s,d[5]=c,d[6]=i,d[7]=o,d[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return new this.constructor().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],c=i[6],u=i[1],d=i[4],f=i[7],l=i[2],h=i[5],p=i[8],m=r[0],v=r[3],_=r[6],g=r[1],y=r[4],b=r[7],w=r[2],x=r[5],S=r[8];return s[0]=o*m+a*g+c*w,s[3]=o*v+a*y+c*x,s[6]=o*_+a*b+c*S,s[1]=u*m+d*g+f*w,s[4]=u*v+d*y+f*x,s[7]=u*_+d*b+f*S,s[2]=l*m+h*g+p*w,s[5]=l*v+h*y+p*x,s[8]=l*_+h*b+p*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],d=e[8];return t*o*d-t*a*u-i*s*d+i*a*c+r*s*u-r*o*c}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],d=e[8],f=d*o-a*u,l=a*c-d*s,h=u*s-o*c,p=t*f+i*l+r*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let m=1/p;return e[0]=f*m,e[1]=(r*u-d*i)*m,e[2]=(a*i-r*o)*m,e[3]=l*m,e[4]=(d*t-r*c)*m,e[5]=(r*s-a*t)*m,e[6]=h*m,e[7]=(i*c-u*t)*m,e[8]=(o*t-i*s)*m,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){let c=Math.cos(s),u=Math.sin(s);return this.set(i*c,i*u,-i*(c*o+u*a)+o+e,-r*u,r*c,-r*(-u*o+c*a)+a+t,0,0,1),this}scale(e,t){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){let t=Math.cos(e),i=Math.sin(e),r=this.elements,s=r[0],o=r[3],a=r[6],c=r[1],u=r[4],d=r[7];return r[0]=t*s+i*c,r[3]=t*o+i*u,r[6]=t*a+i*d,r[1]=-i*s+t*c,r[4]=-i*o+t*u,r[7]=-i*a+t*d,this}translate(e,t){let i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}},$r,Qr={getDataURL:function(n){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement=="undefined")return n.src;let e;if(n instanceof HTMLCanvasElement)e=n;else{$r===void 0&&($r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),$r.width=n.width,$r.height=n.height;let t=$r.getContext("2d");n instanceof ImageData?t.putImageData(n,0,0):t.drawImage(n,0,0,n.width,n.height),e=$r}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},J0=0;function Qe(n=Qe.DEFAULT_IMAGE,e=Qe.DEFAULT_MAPPING,t=Wt,i=Wt,r=Xe,s=_r,o=Et,a=Bc,c=1,u=xo){Object.defineProperty(this,"id",{value:J0++}),this.uuid=Ie.generateUUID(),this.name="",this.image=n,this.mipmaps=[],this.mapping=e,this.wrapS=t,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=a,this.offset=new ae(0,0),this.repeat=new ae(1,1),this.center=new ae(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new nn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}Qe.DEFAULT_IMAGE=void 0;Qe.DEFAULT_MAPPING=Gd;Qe.prototype=Object.assign(Object.create(Pn.prototype),{constructor:Qe,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(n){return this.name=n.name,this.image=n.image,this.mipmaps=n.mipmaps.slice(0),this.mapping=n.mapping,this.wrapS=n.wrapS,this.wrapT=n.wrapT,this.magFilter=n.magFilter,this.minFilter=n.minFilter,this.anisotropy=n.anisotropy,this.format=n.format,this.internalFormat=n.internalFormat,this.type=n.type,this.offset.copy(n.offset),this.repeat.copy(n.repeat),this.center.copy(n.center),this.rotation=n.rotation,this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrix.copy(n.matrix),this.generateMipmaps=n.generateMipmaps,this.premultiplyAlpha=n.premultiplyAlpha,this.flipY=n.flipY,this.unpackAlignment=n.unpackAlignment,this.encoding=n.encoding,this},toJSON:function(n){let e=n===void 0||typeof n=="string";if(!e&&n.textures[this.uuid]!==void 0)return n.textures[this.uuid];let t={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let i=this.image;if(i.uuid===void 0&&(i.uuid=Ie.generateUUID()),!e&&n.images[i.uuid]===void 0){let r;if(Array.isArray(i)){r=[];for(let s=0,o=i.length;s<o;s++)i[s].isDataTexture?r.push(Uc(i[s].image)):r.push(Uc(i[s]))}else r=Uc(i);n.images[i.uuid]={uuid:i.uuid,url:r}}t.image=i.uuid}return e||(n.textures[this.uuid]=t),t},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(n){if(this.mapping!==Gd)return n;if(n.applyMatrix3(this.matrix),n.x<0||n.x>1)switch(this.wrapS){case gr:n.x=n.x-Math.floor(n.x);break;case Wt:n.x=n.x<0?0:1;break;case _o:Math.abs(Math.floor(n.x)%2)===1?n.x=Math.ceil(n.x)-n.x:n.x=n.x-Math.floor(n.x);break}if(n.y<0||n.y>1)switch(this.wrapT){case gr:n.y=n.y-Math.floor(n.y);break;case Wt:n.y=n.y<0?0:1;break;case _o:Math.abs(Math.floor(n.y)%2)===1?n.y=Math.ceil(n.y)-n.y:n.y=n.y-Math.floor(n.y);break}return this.flipY&&(n.y=1-n.y),n}});Object.defineProperty(Qe.prototype,"needsUpdate",{set:function(n){n===!0&&this.version++}});function Uc(n){return typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&n instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?Qr.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Ze=class{constructor(e=0,t=0,i=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s,o=.01,a=.1,c=e.elements,u=c[0],d=c[4],f=c[8],l=c[1],h=c[5],p=c[9],m=c[2],v=c[6],_=c[10];if(Math.abs(d-l)<o&&Math.abs(f-m)<o&&Math.abs(p-v)<o){if(Math.abs(d+l)<a&&Math.abs(f+m)<a&&Math.abs(p+v)<a&&Math.abs(u+h+_-3)<a)return this.set(1,0,0,0),this;t=Math.PI;let y=(u+1)/2,b=(h+1)/2,w=(_+1)/2,x=(d+l)/4,S=(f+m)/4,P=(p+v)/4;return y>b&&y>w?y<o?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(y),r=x/i,s=S/i):b>w?b<o?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(b),i=x/r,s=P/r):w<o?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),i=S/s,r=P/s),this.set(i,r,s,t),this}let g=Math.sqrt((v-p)*(v-p)+(f-m)*(f-m)+(l-d)*(l-d));return Math.abs(g)<.001&&(g=1),this.x=(v-p)/g,this.y=(f-m)/g,this.z=(l-d)/g,this.w=Math.acos((u+h+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},Nt=class extends Pn{constructor(e,t,i){super();Object.defineProperty(this,"isWebGLRenderTarget",{value:!0}),this.width=e,this.height=t,this.scissor=new Ze(0,0,e,t),this.scissorTest=!1,this.viewport=new Ze(0,0,e,t),i=i||{},this.texture=new Qe(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Xe,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}setSize(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}},Wa=class extends Nt{constructor(e,t,i){super(e,t,i);Object.defineProperty(this,"isWebGLMultisampleRenderTarget",{value:!0}),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}},Pt=class{constructor(e=0,t=0,i=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=i,this._w=r}static slerp(e,t,i,r){return i.copy(e).slerp(t,r)}static slerpFlat(e,t,i,r,s,o,a){let c=i[r+0],u=i[r+1],d=i[r+2],f=i[r+3],l=s[o+0],h=s[o+1],p=s[o+2],m=s[o+3];if(f!==m||c!==l||u!==h||d!==p){let v=1-a,_=c*l+u*h+d*p+f*m,g=_>=0?1:-1,y=1-_*_;if(y>Number.EPSILON){let w=Math.sqrt(y),x=Math.atan2(w,_*g);v=Math.sin(v*x)/w,a=Math.sin(a*x)/w}let b=a*g;if(c=c*v+l*b,u=u*v+h*b,d=d*v+p*b,f=f*v+m*b,v===1-a){let w=1/Math.sqrt(c*c+u*u+d*d+f*f);c*=w,u*=w,d*=w,f*=w}}e[t]=c,e[t+1]=u,e[t+2]=d,e[t+3]=f}static multiplyQuaternionsFlat(e,t,i,r,s,o){let a=i[r],c=i[r+1],u=i[r+2],d=i[r+3],f=s[o],l=s[o+1],h=s[o+2],p=s[o+3];return e[t]=a*p+d*f+c*h-u*l,e[t+1]=c*p+d*l+u*f-a*h,e[t+2]=u*p+d*h+a*l-c*f,e[t+3]=d*p-a*f-c*l-u*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,u=a(i/2),d=a(r/2),f=a(s/2),l=c(i/2),h=c(r/2),p=c(s/2);switch(o){case"XYZ":this._x=l*d*f+u*h*p,this._y=u*h*f-l*d*p,this._z=u*d*p+l*h*f,this._w=u*d*f-l*h*p;break;case"YXZ":this._x=l*d*f+u*h*p,this._y=u*h*f-l*d*p,this._z=u*d*p-l*h*f,this._w=u*d*f+l*h*p;break;case"ZXY":this._x=l*d*f-u*h*p,this._y=u*h*f+l*d*p,this._z=u*d*p+l*h*f,this._w=u*d*f-l*h*p;break;case"ZYX":this._x=l*d*f-u*h*p,this._y=u*h*f+l*d*p,this._z=u*d*p-l*h*f,this._w=u*d*f+l*h*p;break;case"YZX":this._x=l*d*f+u*h*p,this._y=u*h*f+l*d*p,this._z=u*d*p-l*h*f,this._w=u*d*f-l*h*p;break;case"XZY":this._x=l*d*f-u*h*p,this._y=u*h*f-l*d*p,this._z=u*d*p+l*h*f,this._w=u*d*f+l*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],c=t[9],u=t[2],d=t[6],f=t[10],l=i+a+f;if(l>0){let h=.5/Math.sqrt(l+1);this._w=.25/h,this._x=(d-c)*h,this._y=(s-u)*h,this._z=(o-r)*h}else if(i>a&&i>f){let h=2*Math.sqrt(1+i-a-f);this._w=(d-c)/h,this._x=.25*h,this._y=(r+o)/h,this._z=(s+u)/h}else if(a>f){let h=2*Math.sqrt(1+a-i-f);this._w=(s-u)/h,this._x=(r+o)/h,this._y=.25*h,this._z=(c+d)/h}else{let h=2*Math.sqrt(1+f-i-a);this._w=(o-r)/h,this._x=(s+u)/h,this._y=(c+d)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=1e-6,r=e.dot(t)+1;return r<i?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ie.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,c=t._y,u=t._z,d=t._w;return this._x=i*d+o*a+r*u-s*c,this._y=r*d+o*c+s*a-i*u,this._z=s*d+o*u+i*c-r*a,this._w=o*d-i*a-r*c-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,s=this._z,o=this._w,a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;let c=1-a*a;if(c<=Number.EPSILON){let h=1-t;return this._w=h*o+t*this._w,this._x=h*i+t*this._x,this._y=h*r+t*this._y,this._z=h*s+t*this._z,this.normalize(),this._onChangeCallback(),this}let u=Math.sqrt(c),d=Math.atan2(u,a),f=Math.sin((1-t)*d)/u,l=Math.sin(t*d)/u;return this._w=o*f+this._w*l,this._x=i*f+this._x*l,this._y=r*f+this._y*l,this._z=s*f+this._z*l,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}},k=class{constructor(e=0,t=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(sf.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(sf.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,c=e.w,u=c*t+o*r-a*i,d=c*i+a*t-s*r,f=c*r+s*i-o*t,l=-s*t-o*i-a*r;return this.x=u*c+l*-s+d*-a-f*-o,this.y=d*c+l*-o+f*-s-u*-a,this.z=f*c+l*-a+u*-o-d*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=r*c-s*a,this.y=s*o-i*c,this.z=i*a-r*o,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Gc.copy(this).projectOnVector(e),this.sub(Gc)}reflect(e){return this.sub(Gc.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Ie.clamp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},Gc=new k,sf=new Pt,qn=class{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=e!==void 0?e:new k(Infinity,Infinity,Infinity),this.max=t!==void 0?t:new k(-Infinity,-Infinity,-Infinity)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=Infinity,i=Infinity,r=Infinity,s=-Infinity,o=-Infinity,a=-Infinity;for(let c=0,u=e.length;c<u;c+=3){let d=e[c],f=e[c+1],l=e[c+2];d<t&&(t=d),f<i&&(i=f),l<r&&(r=l),d>s&&(s=d),f>o&&(o=f),l>a&&(a=l)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromBufferAttribute(e){let t=Infinity,i=Infinity,r=Infinity,s=-Infinity,o=-Infinity,a=-Infinity;for(let c=0,u=e.count;c<u;c++){let d=e.getX(c),f=e.getY(c),l=e.getZ(c);d<t&&(t=d),f<i&&(i=f),l<r&&(r=l),d>s&&(s=d),f>o&&(o=f),l>a&&(a=l)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=wo.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new k),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new k),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),Wc.copy(t.boundingBox),Wc.applyMatrix4(e.matrixWorld),this.union(Wc));let i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new k),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,wo),wo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Mo),ja.subVectors(this.max,Mo),es.subVectors(e.a,Mo),ts.subVectors(e.b,Mo),ns.subVectors(e.c,Mo),Hi.subVectors(ts,es),Ui.subVectors(ns,ts),yr.subVectors(es,ns);let t=[0,-Hi.z,Hi.y,0,-Ui.z,Ui.y,0,-yr.z,yr.y,Hi.z,0,-Hi.x,Ui.z,0,-Ui.x,yr.z,0,-yr.x,-Hi.y,Hi.x,0,-Ui.y,Ui.x,0,-yr.y,yr.x,0];return!Vc(t,es,ts,ns,ja)||(t=[1,0,0,0,1,0,0,0,1],!Vc(t,es,ts,ns,ja))?!1:(qa.crossVectors(Hi,Ui),t=[qa.x,qa.y,qa.z],Vc(t,es,ts,ns,ja))}clampPoint(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new k),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return wo.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(wo).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(pi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),pi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),pi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),pi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),pi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),pi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),pi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),pi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(pi),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};function Vc(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){xr.fromArray(n,s);let a=r.x*Math.abs(xr.x)+r.y*Math.abs(xr.y)+r.z*Math.abs(xr.z),c=e.dot(xr),u=t.dot(xr),d=i.dot(xr);if(Math.max(-Math.max(c,u,d),Math.min(c,u,d))>a)return!1}return!0}var pi=[new k,new k,new k,new k,new k,new k,new k,new k],wo=new k,Wc=new qn,es=new k,ts=new k,ns=new k,Hi=new k,Ui=new k,yr=new k,Mo=new k,ja=new k,qa=new k,xr=new k,K0=new qn,Xn=class{constructor(e,t){this.center=e!==void 0?e:new k,this.radius=t!==void 0?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):K0.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new k),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new qn),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}},mi=new k,jc=new k,Xa=new k,Gi=new k,qc=new k,Ya=new k,Xc=new k,is=class{constructor(e,t){this.origin=e!==void 0?e:new k,this.direction=t!==void 0?t:new k(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return new this.constructor().copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new k),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,mi)),this}closestPointToPoint(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new k),t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=mi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(mi.copy(this.direction).multiplyScalar(t).add(this.origin),mi.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){jc.copy(e).add(t).multiplyScalar(.5),Xa.copy(t).sub(e).normalize(),Gi.copy(this.origin).sub(jc);let s=e.distanceTo(t)*.5,o=-this.direction.dot(Xa),a=Gi.dot(this.direction),c=-Gi.dot(Xa),u=Gi.lengthSq(),d=Math.abs(1-o*o),f,l,h,p;if(d>0)if(f=o*c-a,l=o*a-c,p=s*d,f>=0)if(l>=-p)if(l<=p){let m=1/d;f*=m,l*=m,h=f*(f+o*l+2*a)+l*(o*f+l+2*c)+u}else l=s,f=Math.max(0,-(o*l+a)),h=-f*f+l*(l+2*c)+u;else l=-s,f=Math.max(0,-(o*l+a)),h=-f*f+l*(l+2*c)+u;else l<=-p?(f=Math.max(0,-(-o*s+a)),l=f>0?-s:Math.min(Math.max(-s,-c),s),h=-f*f+l*(l+2*c)+u):l<=p?(f=0,l=Math.min(Math.max(-s,-c),s),h=l*(l+2*c)+u):(f=Math.max(0,-(o*s+a)),l=f>0?s:Math.min(Math.max(-s,-c),s),h=-f*f+l*(l+2*c)+u);else l=o>0?-s:s,f=Math.max(0,-(o*l+a)),h=-f*f+l*(l+2*c)+u;return i&&i.copy(this.direction).multiplyScalar(f).add(this.origin),r&&r.copy(Xa).multiplyScalar(l).add(jc),h}intersectSphere(e,t){mi.subVectors(e.center,this.origin);let i=mi.dot(this.direction),r=mi.dot(mi)-i*i,s=e.radius*e.radius;if(r>s)return null;let o=Math.sqrt(s-r),a=i-o,c=i+o;return a<0&&c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,c,u=1/this.direction.x,d=1/this.direction.y,f=1/this.direction.z,l=this.origin;return u>=0?(i=(e.min.x-l.x)*u,r=(e.max.x-l.x)*u):(i=(e.max.x-l.x)*u,r=(e.min.x-l.x)*u),d>=0?(s=(e.min.y-l.y)*d,o=(e.max.y-l.y)*d):(s=(e.max.y-l.y)*d,o=(e.min.y-l.y)*d),i>o||s>r||((s>i||i!==i)&&(i=s),(o<r||r!==r)&&(r=o),f>=0?(a=(e.min.z-l.z)*f,c=(e.max.z-l.z)*f):(a=(e.max.z-l.z)*f,c=(e.min.z-l.z)*f),i>c||a>r)||((a>i||i!==i)&&(i=a),(c<r||r!==r)&&(r=c),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,mi)!==null}intersectTriangle(e,t,i,r,s){qc.subVectors(t,e),Ya.subVectors(i,e),Xc.crossVectors(qc,Ya);let o=this.direction.dot(Xc),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Gi.subVectors(this.origin,e);let c=a*this.direction.dot(Ya.crossVectors(Gi,Ya));if(c<0)return null;let u=a*this.direction.dot(qc.cross(Gi));if(u<0||c+u>o)return null;let d=-a*Gi.dot(Xc);return d<0?null:this.at(d/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},Fe=class{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,s,o,a,c,u,d,f,l,h,p,m,v){let _=this.elements;return _[0]=e,_[4]=t,_[8]=i,_[12]=r,_[1]=s,_[5]=o,_[9]=a,_[13]=c,_[2]=u,_[6]=d,_[10]=f,_[14]=l,_[3]=h,_[7]=p,_[11]=m,_[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Fe().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/rs.setFromMatrixColumn(e,0).length(),s=1/rs.setFromMatrixColumn(e,1).length(),o=1/rs.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),c=Math.cos(r),u=Math.sin(r),d=Math.cos(s),f=Math.sin(s);if(e.order==="XYZ"){let l=o*d,h=o*f,p=a*d,m=a*f;t[0]=c*d,t[4]=-c*f,t[8]=u,t[1]=h+p*u,t[5]=l-m*u,t[9]=-a*c,t[2]=m-l*u,t[6]=p+h*u,t[10]=o*c}else if(e.order==="YXZ"){let l=c*d,h=c*f,p=u*d,m=u*f;t[0]=l+m*a,t[4]=p*a-h,t[8]=o*u,t[1]=o*f,t[5]=o*d,t[9]=-a,t[2]=h*a-p,t[6]=m+l*a,t[10]=o*c}else if(e.order==="ZXY"){let l=c*d,h=c*f,p=u*d,m=u*f;t[0]=l-m*a,t[4]=-o*f,t[8]=p+h*a,t[1]=h+p*a,t[5]=o*d,t[9]=m-l*a,t[2]=-o*u,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){let l=o*d,h=o*f,p=a*d,m=a*f;t[0]=c*d,t[4]=p*u-h,t[8]=l*u+m,t[1]=c*f,t[5]=m*u+l,t[9]=h*u-p,t[2]=-u,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){let l=o*c,h=o*u,p=a*c,m=a*u;t[0]=c*d,t[4]=m-l*f,t[8]=p*f+h,t[1]=f,t[5]=o*d,t[9]=-a*d,t[2]=-u*d,t[6]=h*f+p,t[10]=l-m*f}else if(e.order==="XZY"){let l=o*c,h=o*u,p=a*c,m=a*u;t[0]=c*d,t[4]=-f,t[8]=u*d,t[1]=l*f+m,t[5]=o*d,t[9]=h*f-p,t[2]=p*f-h,t[6]=a*d,t[10]=m*f+l}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($0,e,Q0)}lookAt(e,t,i){let r=this.elements;return rn.subVectors(e,t),rn.lengthSq()===0&&(rn.z=1),rn.normalize(),Vi.crossVectors(i,rn),Vi.lengthSq()===0&&(Math.abs(i.z)===1?rn.x+=1e-4:rn.z+=1e-4,rn.normalize(),Vi.crossVectors(i,rn)),Vi.normalize(),Za.crossVectors(rn,Vi),r[0]=Vi.x,r[4]=Za.x,r[8]=rn.x,r[1]=Vi.y,r[5]=Za.y,r[9]=rn.y,r[2]=Vi.z,r[6]=Za.z,r[10]=rn.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],c=i[8],u=i[12],d=i[1],f=i[5],l=i[9],h=i[13],p=i[2],m=i[6],v=i[10],_=i[14],g=i[3],y=i[7],b=i[11],w=i[15],x=r[0],S=r[4],P=r[8],T=r[12],I=r[1],U=r[5],W=r[9],D=r[13],L=r[2],O=r[6],F=r[10],Z=r[14],ee=r[3],oe=r[7],ge=r[11],de=r[15];return s[0]=o*x+a*I+c*L+u*ee,s[4]=o*S+a*U+c*O+u*oe,s[8]=o*P+a*W+c*F+u*ge,s[12]=o*T+a*D+c*Z+u*de,s[1]=d*x+f*I+l*L+h*ee,s[5]=d*S+f*U+l*O+h*oe,s[9]=d*P+f*W+l*F+h*ge,s[13]=d*T+f*D+l*Z+h*de,s[2]=p*x+m*I+v*L+_*ee,s[6]=p*S+m*U+v*O+_*oe,s[10]=p*P+m*W+v*F+_*ge,s[14]=p*T+m*D+v*Z+_*de,s[3]=g*x+y*I+b*L+w*ee,s[7]=g*S+y*U+b*O+w*oe,s[11]=g*P+y*W+b*F+w*ge,s[15]=g*T+y*D+b*Z+w*de,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],u=e[13],d=e[2],f=e[6],l=e[10],h=e[14],p=e[3],m=e[7],v=e[11],_=e[15];return p*(+s*c*f-r*u*f-s*a*l+i*u*l+r*a*h-i*c*h)+m*(+t*c*h-t*u*l+s*o*l-r*o*h+r*u*d-s*c*d)+v*(+t*u*f-t*a*h-s*o*f+i*o*h+s*a*d-i*u*d)+_*(-r*a*d-t*c*f+t*a*l+r*o*f-i*o*l+i*c*d)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],d=e[8],f=e[9],l=e[10],h=e[11],p=e[12],m=e[13],v=e[14],_=e[15],g=f*v*u-m*l*u+m*c*h-a*v*h-f*c*_+a*l*_,y=p*l*u-d*v*u-p*c*h+o*v*h+d*c*_-o*l*_,b=d*m*u-p*f*u+p*a*h-o*m*h-d*a*_+o*f*_,w=p*f*c-d*m*c-p*a*l+o*m*l+d*a*v-o*f*v,x=t*g+i*y+r*b+s*w;if(x===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let S=1/x;return e[0]=g*S,e[1]=(m*l*s-f*v*s-m*r*h+i*v*h+f*r*_-i*l*_)*S,e[2]=(a*v*s-m*c*s+m*r*u-i*v*u-a*r*_+i*c*_)*S,e[3]=(f*c*s-a*l*s-f*r*u+i*l*u+a*r*h-i*c*h)*S,e[4]=y*S,e[5]=(d*v*s-p*l*s+p*r*h-t*v*h-d*r*_+t*l*_)*S,e[6]=(p*c*s-o*v*s-p*r*u+t*v*u+o*r*_-t*c*_)*S,e[7]=(o*l*s-d*c*s+d*r*u-t*l*u-o*r*h+t*c*h)*S,e[8]=b*S,e[9]=(p*f*s-d*m*s-p*i*h+t*m*h+d*i*_-t*f*_)*S,e[10]=(o*m*s-p*a*s+p*i*u-t*m*u-o*i*_+t*a*_)*S,e[11]=(d*a*s-o*f*s-d*i*u+t*f*u+o*i*h-t*a*h)*S,e[12]=w*S,e[13]=(d*m*r-p*f*r+p*i*l-t*m*l-d*i*v+t*f*v)*S,e[14]=(p*a*r-o*m*r-p*i*c+t*m*c+o*i*v-t*a*v)*S,e[15]=(o*f*r-d*a*r+d*i*c-t*f*c-o*i*l+t*a*l)*S,this}scale(e){let t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,c=e.z,u=s*o,d=s*a;return this.set(u*o+i,u*a-r*c,u*c+r*a,0,u*a+r*c,d*a+i,d*c-r*o,0,u*c-r*a,d*c+r*o,s*c*c+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,u=s+s,d=o+o,f=a+a,l=s*u,h=s*d,p=s*f,m=o*d,v=o*f,_=a*f,g=c*u,y=c*d,b=c*f,w=i.x,x=i.y,S=i.z;return r[0]=(1-(m+_))*w,r[1]=(h+b)*w,r[2]=(p-y)*w,r[3]=0,r[4]=(h-b)*x,r[5]=(1-(l+_))*x,r[6]=(v+g)*x,r[7]=0,r[8]=(p+y)*S,r[9]=(v-g)*S,r[10]=(1-(l+m))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,s=rs.set(r[0],r[1],r[2]).length(),o=rs.set(r[4],r[5],r[6]).length(),a=rs.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],In.copy(this);let u=1/s,d=1/o,f=1/a;return In.elements[0]*=u,In.elements[1]*=u,In.elements[2]*=u,In.elements[4]*=d,In.elements[5]*=d,In.elements[6]*=d,In.elements[8]*=f,In.elements[9]*=f,In.elements[10]*=f,t.setFromRotationMatrix(In),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements,c=2*s/(t-e),u=2*s/(i-r),d=(t+e)/(t-e),f=(i+r)/(i-r),l=-(o+s)/(o-s),h=-2*o*s/(o-s);return a[0]=c,a[4]=0,a[8]=d,a[12]=0,a[1]=0,a[5]=u,a[9]=f,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,s,o){let a=this.elements,c=1/(t-e),u=1/(i-r),d=1/(o-s),f=(t+e)*c,l=(i+r)*u,h=(o+s)*d;return a[0]=2*c,a[4]=0,a[8]=0,a[12]=-f,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-l,a[2]=0,a[6]=0,a[10]=-2*d,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},rs=new k,In=new Fe,$0=new k(0,0,0),Q0=new k(1,1,1),Vi=new k,Za=new k,rn=new k,gi=class{constructor(e=0,t=0,i=0,r=gi.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){let r=Ie.clamp,s=e.elements,o=s[0],a=s[4],c=s[8],u=s[1],d=s[5],f=s[9],l=s[2],h=s[6],p=s[10];switch(t=t||this._order,t){case"XYZ":this._y=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(h,d),this._z=0);break;case"YXZ":this._x=Math.asin(-r(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(c,p),this._z=Math.atan2(u,d)):(this._y=Math.atan2(-l,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2(u,o));break;case"ZYX":this._y=Math.asin(-r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,d));break;case"YZX":this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-l,o)):(this._x=0,this._y=Math.atan2(c,p));break;case"XZY":this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,d),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-f,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i!==!1&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return of.makeRotationFromQuaternion(e),this.setFromRotationMatrix(of,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return af.setFromEuler(this),this.setFromQuaternion(af,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new k(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};gi.DefaultOrder="XYZ";gi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var of=new Fe,af=new Pt,Yc=class{constructor(){this.mask=1|0}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}},ex=0,lf=new k,ss=new Pt,_i=new Fe,Ja=new k,So=new k,tx=new k,nx=new Pt,cf=new k(1,0,0),uf=new k(0,1,0),hf=new k(0,0,1),ix={type:"added"},df={type:"removed"};function Ce(){Object.defineProperty(this,"id",{value:ex++}),this.uuid=Ie.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ce.DefaultUp.clone();let n=new k,e=new gi,t=new Pt,i=new k(1,1,1);function r(){t.setFromEuler(e,!1)}function s(){e.setFromQuaternion(t,void 0,!1)}e._onChange(r),t._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:t},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Fe},normalMatrix:{value:new nn}}),this.matrix=new Fe,this.matrixWorld=new Fe,this.matrixAutoUpdate=Ce.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Yc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Ce.DefaultUp=new k(0,1,0);Ce.DefaultMatrixAutoUpdate=!0;Ce.prototype=Object.assign(Object.create(Pn.prototype),{constructor:Ce,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(n){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(n),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(n){return this.quaternion.premultiply(n),this},setRotationFromAxisAngle:function(n,e){this.quaternion.setFromAxisAngle(n,e)},setRotationFromEuler:function(n){this.quaternion.setFromEuler(n,!0)},setRotationFromMatrix:function(n){this.quaternion.setFromRotationMatrix(n)},setRotationFromQuaternion:function(n){this.quaternion.copy(n)},rotateOnAxis:function(n,e){return ss.setFromAxisAngle(n,e),this.quaternion.multiply(ss),this},rotateOnWorldAxis:function(n,e){return ss.setFromAxisAngle(n,e),this.quaternion.premultiply(ss),this},rotateX:function(n){return this.rotateOnAxis(cf,n)},rotateY:function(n){return this.rotateOnAxis(uf,n)},rotateZ:function(n){return this.rotateOnAxis(hf,n)},translateOnAxis:function(n,e){return lf.copy(n).applyQuaternion(this.quaternion),this.position.add(lf.multiplyScalar(e)),this},translateX:function(n){return this.translateOnAxis(cf,n)},translateY:function(n){return this.translateOnAxis(uf,n)},translateZ:function(n){return this.translateOnAxis(hf,n)},localToWorld:function(n){return n.applyMatrix4(this.matrixWorld)},worldToLocal:function(n){return n.applyMatrix4(_i.copy(this.matrixWorld).invert())},lookAt:function(n,e,t){n.isVector3?Ja.copy(n):Ja.set(n,e,t);let i=this.parent;this.updateWorldMatrix(!0,!1),So.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_i.lookAt(So,Ja,this.up):_i.lookAt(Ja,So,this.up),this.quaternion.setFromRotationMatrix(_i),i&&(_i.extractRotation(i.matrixWorld),ss.setFromRotationMatrix(_i),this.quaternion.premultiply(ss.invert()))},add:function(n){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return n===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this):(n&&n.isObject3D?(n.parent!==null&&n.parent.remove(n),n.parent=this,this.children.push(n),n.dispatchEvent(ix)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n),this)},remove:function(n){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}let e=this.children.indexOf(n);return e!==-1&&(n.parent=null,this.children.splice(e,1),n.dispatchEvent(df)),this},clear:function(){for(let n=0;n<this.children.length;n++){let e=this.children[n];e.parent=null,e.dispatchEvent(df)}return this.children.length=0,this},attach:function(n){return this.updateWorldMatrix(!0,!1),_i.copy(this.matrixWorld).invert(),n.parent!==null&&(n.parent.updateWorldMatrix(!0,!1),_i.multiply(n.parent.matrixWorld)),n.applyMatrix4(_i),n.updateWorldMatrix(!1,!1),this.add(n),this},getObjectById:function(n){return this.getObjectByProperty("id",n)},getObjectByName:function(n){return this.getObjectByProperty("name",n)},getObjectByProperty:function(n,e){if(this[n]===e)return this;for(let t=0,i=this.children.length;t<i;t++){let s=this.children[t].getObjectByProperty(n,e);if(s!==void 0)return s}},getWorldPosition:function(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),n=new k),this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new Pt),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(So,n,tx),n},getWorldScale:function(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new k),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(So,nx,n),n},getWorldDirection:function(n){n===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),n=new k),this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return n.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(n){n(this);let e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].traverse(n)},traverseVisible:function(n){if(this.visible===!1)return;n(this);let e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].traverseVisible(n)},traverseAncestors:function(n){let e=this.parent;e!==null&&(n(e),e.traverseAncestors(n))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0);let e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateMatrixWorld(n)},updateWorldMatrix:function(n,e){let t=this.parent;if(n===!0&&t!==null&&t.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateWorldMatrix(!1,!0)}},toJSON:function(n){let e=n===void 0||typeof n=="string",t={};e&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},t.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON());function r(o,a){return o[a.uuid]===void 0&&(o[a.uuid]=a.toJSON(n)),a.uuid}if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(n.geometries,this.geometry);let o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){let a=o.shapes;if(Array.isArray(a))for(let c=0,u=a.length;c<u;c++){let d=a[c];r(n.shapes,d)}else r(n.shapes,a)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(n.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let o=[];for(let a=0,c=this.material.length;a<c;a++)o.push(r(n.materials,this.material[a]));i.material=o}else i.material=r(n.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(n).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){let a=this.animations[o];i.animations.push(r(n.animations,a))}}if(e){let o=s(n.geometries),a=s(n.materials),c=s(n.textures),u=s(n.images),d=s(n.shapes),f=s(n.skeletons),l=s(n.animations);o.length>0&&(t.geometries=o),a.length>0&&(t.materials=a),c.length>0&&(t.textures=c),u.length>0&&(t.images=u),d.length>0&&(t.shapes=d),f.length>0&&(t.skeletons=f),l.length>0&&(t.animations=l)}return t.object=i,t;function s(o){let a=[];for(let c in o){let u=o[c];delete u.metadata,a.push(u)}return a}},clone:function(n){return new this.constructor().copy(this,n)},copy:function(n,e=!0){if(this.name=n.name,this.up.copy(n.up),this.position.copy(n.position),this.rotation.order=n.rotation.order,this.quaternion.copy(n.quaternion),this.scale.copy(n.scale),this.matrix.copy(n.matrix),this.matrixWorld.copy(n.matrixWorld),this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrixWorldNeedsUpdate=n.matrixWorldNeedsUpdate,this.layers.mask=n.layers.mask,this.visible=n.visible,this.castShadow=n.castShadow,this.receiveShadow=n.receiveShadow,this.frustumCulled=n.frustumCulled,this.renderOrder=n.renderOrder,this.userData=JSON.parse(JSON.stringify(n.userData)),e===!0)for(let t=0;t<n.children.length;t++){let i=n.children[t];this.add(i.clone())}return this}});var Zc=new k,rx=new k,sx=new nn,Yn=class{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=e!==void 0?e:new k(1,0,0),this.constant=t!==void 0?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=Zc.subVectors(i,t).cross(rx.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}clone(){return new this.constructor().copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new k),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new k);let i=e.delta(Zc),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;let s=-(e.start.dot(this.normal)+this.constant)/r;if(!(s<0||s>1))return t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new k),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||sx.getNormalMatrix(e),r=this.coplanarPoint(Zc).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},On=new k,vi=new k,Jc=new k,yi=new k,os=new k,as=new k,ff=new k,Kc=new k,$c=new k,Qc=new k,kt=class{constructor(e,t,i){this.a=e!==void 0?e:new k,this.b=t!==void 0?t:new k,this.c=i!==void 0?i:new k}static getNormal(e,t,i,r){r===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new k),r.subVectors(i,t),On.subVectors(e,t),r.cross(On);let s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){On.subVectors(r,t),vi.subVectors(i,t),Jc.subVectors(e,t);let o=On.dot(On),a=On.dot(vi),c=On.dot(Jc),u=vi.dot(vi),d=vi.dot(Jc),f=o*u-a*a;if(s===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new k),f===0)return s.set(-2,-1,-1);let l=1/f,h=(u*c-a*d)*l,p=(o*d-a*c)*l;return s.set(1-h-p,p,h)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,yi),yi.x>=0&&yi.y>=0&&yi.x+yi.y<=1}static getUV(e,t,i,r,s,o,a,c){return this.getBarycoord(e,t,i,r,yi),c.set(0,0),c.addScaledVector(s,yi.x),c.addScaledVector(o,yi.y),c.addScaledVector(a,yi.z),c}static isFrontFacing(e,t,i,r){return On.subVectors(i,t),vi.subVectors(e,t),On.cross(vi).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return On.subVectors(this.c,this.b),vi.subVectors(this.a,this.b),On.cross(vi).length()*.5}getMidpoint(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new k),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return kt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Yn),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return kt.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return kt.getUV(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return kt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return kt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new k);let i=this.a,r=this.b,s=this.c,o,a;os.subVectors(r,i),as.subVectors(s,i),Kc.subVectors(e,i);let c=os.dot(Kc),u=as.dot(Kc);if(c<=0&&u<=0)return t.copy(i);$c.subVectors(e,r);let d=os.dot($c),f=as.dot($c);if(d>=0&&f<=d)return t.copy(r);let l=c*f-d*u;if(l<=0&&c>=0&&d<=0)return o=c/(c-d),t.copy(i).addScaledVector(os,o);Qc.subVectors(e,s);let h=os.dot(Qc),p=as.dot(Qc);if(p>=0&&h<=p)return t.copy(s);let m=h*u-c*p;if(m<=0&&u>=0&&p<=0)return a=u/(u-p),t.copy(i).addScaledVector(as,a);let v=d*p-h*f;if(v<=0&&f-d>=0&&h-p>=0)return ff.subVectors(s,r),a=(f-d)/(f-d+(h-p)),t.copy(r).addScaledVector(ff,a);let _=1/(v+m+l);return o=m*_,a=l*_,t.copy(i).addScaledVector(os,o).addScaledVector(as,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},pf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Dn={h:0,s:0,l:0},Ka={h:0,s:0,l:0};function eu(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}function tu(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function nu(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}var Me=class{constructor(e,t,i){return Object.defineProperty(this,"isColor",{value:!0}),t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Ie.euclideanModulo(e,1),t=Ie.clamp(t,0,1),i=Ie.clamp(i,0,1),t===0)this.r=this.g=this.b=i;else{let r=i<=.5?i*(1+t):i+t-i*t,s=2*i-r;this.r=eu(s,r,e+1/3),this.g=eu(s,r,e),this.b=eu(s,r,e-1/3)}return this}setStyle(e){function t(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r,s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){let a=parseFloat(r[1])/360,c=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(a,c,u)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=i[1],s=r.length;if(s===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(s===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let t=pf[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){let i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=tu(e.r),this.g=tu(e.g),this.b=tu(e.b),this}copyLinearToSRGB(e){return this.r=nu(e.r),this.g=nu(e.g),this.b=nu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});let t=this.r,i=this.g,r=this.b,s=Math.max(t,i,r),o=Math.min(t,i,r),a,c,u=(o+s)/2;if(o===s)a=0,c=0;else{let d=s-o;switch(c=u<=.5?d/(s+o):d/(2-s-o),s){case t:a=(i-r)/d+(i<r?6:0);break;case i:a=(r-t)/d+2;break;case r:a=(t-i)/d+4;break}a/=6}return e.h=a,e.s=c,e.l=u,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,i){return this.getHSL(Dn),Dn.h+=e,Dn.s+=t,Dn.l+=i,this.setHSL(Dn.h,Dn.s,Dn.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Dn),e.getHSL(Ka);let i=Ie.lerp(Dn.h,Ka.h,t),r=Ie.lerp(Dn.s,Ka.s,t),s=Ie.lerp(Dn.l,Ka.l,t);return this.setHSL(i,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};Me.NAMES=pf;Me.prototype.r=1;Me.prototype.g=1;Me.prototype.b=1;var mf=class{constructor(e,t,i,r,s,o=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new k,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new Me,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=o}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},ox=0;function Re(){Object.defineProperty(this,"id",{value:ox++}),this.uuid=Ie.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=mo,this.side=di,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Hd,this.blendDst=Ud,this.blendEquation=Xr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Rc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Z0,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Hc,this.stencilZFail=Hc,this.stencilZPass=Hc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Re.prototype=Object.assign(Object.create(Pn.prototype),{constructor:Re,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(n){if(n!==void 0)for(let e in n){let t=n[e];if(t===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===Fd;continue}let i=this[e];if(i===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}i&&i.isColor?i.set(t):i&&i.isVector3&&t&&t.isVector3?i.copy(t):this[e]=t}},toJSON:function(n){let e=n===void 0||typeof n=="string";e&&(n={textures:{},images:{}});let t={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.color&&this.color.isColor&&(t.color=this.color.getHex()),this.roughness!==void 0&&(t.roughness=this.roughness),this.metalness!==void 0&&(t.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(t.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(t.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(t.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(t.specular=this.specular.getHex()),this.shininess!==void 0&&(t.shininess=this.shininess),this.clearcoat!==void 0&&(t.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(t.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(t.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(t.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(t.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,t.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(t.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(t.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(t.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(t.lightMap=this.lightMap.toJSON(n).uuid),this.aoMap&&this.aoMap.isTexture&&(t.aoMap=this.aoMap.toJSON(n).uuid,t.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(t.bumpMap=this.bumpMap.toJSON(n).uuid,t.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(t.normalMap=this.normalMap.toJSON(n).uuid,t.normalMapType=this.normalMapType,t.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(t.displacementMap=this.displacementMap.toJSON(n).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(t.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(t.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(t.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(t.specularMap=this.specularMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(t.envMap=this.envMap.toJSON(n).uuid,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,this.combine!==void 0&&(t.combine=this.combine),this.envMapIntensity!==void 0&&(t.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(t.gradientMap=this.gradientMap.toJSON(n).uuid),this.size!==void 0&&(t.size=this.size),this.sizeAttenuation!==void 0&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==mo&&(t.blending=this.blending),this.flatShading===!0&&(t.flatShading=this.flatShading),this.side!==di&&(t.side=this.side),this.vertexColors&&(t.vertexColors=!0),this.opacity<1&&(t.opacity=this.opacity),this.transparent===!0&&(t.transparent=this.transparent),t.depthFunc=this.depthFunc,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.stencilWrite=this.stencilWrite,t.stencilWriteMask=this.stencilWriteMask,t.stencilFunc=this.stencilFunc,t.stencilRef=this.stencilRef,t.stencilFuncMask=this.stencilFuncMask,t.stencilFail=this.stencilFail,t.stencilZFail=this.stencilZFail,t.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(t.rotation=this.rotation),this.polygonOffset===!0&&(t.polygonOffset=!0),this.polygonOffsetFactor!==0&&(t.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(t.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(t.linewidth=this.linewidth),this.dashSize!==void 0&&(t.dashSize=this.dashSize),this.gapSize!==void 0&&(t.gapSize=this.gapSize),this.scale!==void 0&&(t.scale=this.scale),this.dithering===!0&&(t.dithering=!0),this.alphaTest>0&&(t.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(t.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(t.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(t.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(t.morphTargets=!0),this.morphNormals===!0&&(t.morphNormals=!0),this.skinning===!0&&(t.skinning=!0),this.visible===!1&&(t.visible=!1),this.toneMapped===!1&&(t.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(t.userData=this.userData);function i(r){let s=[];for(let o in r){let a=r[o];delete a.metadata,s.push(a)}return s}if(e){let r=i(n.textures),s=i(n.images);r.length>0&&(t.textures=r),s.length>0&&(t.images=s)}return t},clone:function(){return new this.constructor().copy(this)},copy:function(n){this.name=n.name,this.fog=n.fog,this.blending=n.blending,this.side=n.side,this.flatShading=n.flatShading,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;let e=n.clippingPlanes,t=null;if(e!==null){let i=e.length;t=new Array(i);for(let r=0;r!==i;++r)t[r]=e[r].clone()}return this.clippingPlanes=t,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.premultipliedAlpha=n.premultipliedAlpha,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(Re.prototype,"needsUpdate",{set:function(n){n===!0&&this.version++}});function At(n){Re.call(this),this.type="MeshBasicMaterial",this.color=new Me(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ia,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(n)}At.prototype=Object.create(Re.prototype);At.prototype.constructor=At;At.prototype.isMeshBasicMaterial=!0;At.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this};var et=new k,$a=new ae;function Oe(n,e,t){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=n,this.itemSize=e,this.count=n!==void 0?n.length/e:0,this.normalized=t===!0,this.usage=Ga,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Oe.prototype,"needsUpdate",{set:function(n){n===!0&&this.version++}});Object.assign(Oe.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(n){return this.usage=n,this},copy:function(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this},copyAt:function(n,e,t){n*=this.itemSize,t*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[n+i]=e.array[t+i];return this},copyArray:function(n){return this.array.set(n),this},copyColorsArray:function(n){let e=this.array,t=0;for(let i=0,r=n.length;i<r;i++){let s=n[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),s=new Me),e[t++]=s.r,e[t++]=s.g,e[t++]=s.b}return this},copyVector2sArray:function(n){let e=this.array,t=0;for(let i=0,r=n.length;i<r;i++){let s=n[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),s=new ae),e[t++]=s.x,e[t++]=s.y}return this},copyVector3sArray:function(n){let e=this.array,t=0;for(let i=0,r=n.length;i<r;i++){let s=n[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),s=new k),e[t++]=s.x,e[t++]=s.y,e[t++]=s.z}return this},copyVector4sArray:function(n){let e=this.array,t=0;for(let i=0,r=n.length;i<r;i++){let s=n[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),s=new Ze),e[t++]=s.x,e[t++]=s.y,e[t++]=s.z,e[t++]=s.w}return this},applyMatrix3:function(n){if(this.itemSize===2)for(let e=0,t=this.count;e<t;e++)$a.fromBufferAttribute(this,e),$a.applyMatrix3(n),this.setXY(e,$a.x,$a.y);else if(this.itemSize===3)for(let e=0,t=this.count;e<t;e++)et.fromBufferAttribute(this,e),et.applyMatrix3(n),this.setXYZ(e,et.x,et.y,et.z);return this},applyMatrix4:function(n){for(let e=0,t=this.count;e<t;e++)et.x=this.getX(e),et.y=this.getY(e),et.z=this.getZ(e),et.applyMatrix4(n),this.setXYZ(e,et.x,et.y,et.z);return this},applyNormalMatrix:function(n){for(let e=0,t=this.count;e<t;e++)et.x=this.getX(e),et.y=this.getY(e),et.z=this.getZ(e),et.applyNormalMatrix(n),this.setXYZ(e,et.x,et.y,et.z);return this},transformDirection:function(n){for(let e=0,t=this.count;e<t;e++)et.x=this.getX(e),et.y=this.getY(e),et.z=this.getZ(e),et.transformDirection(n),this.setXYZ(e,et.x,et.y,et.z);return this},set:function(n,e=0){return this.array.set(n,e),this},getX:function(n){return this.array[n*this.itemSize]},setX:function(n,e){return this.array[n*this.itemSize]=e,this},getY:function(n){return this.array[n*this.itemSize+1]},setY:function(n,e){return this.array[n*this.itemSize+1]=e,this},getZ:function(n){return this.array[n*this.itemSize+2]},setZ:function(n,e){return this.array[n*this.itemSize+2]=e,this},getW:function(n){return this.array[n*this.itemSize+3]},setW:function(n,e){return this.array[n*this.itemSize+3]=e,this},setXY:function(n,e,t){return n*=this.itemSize,this.array[n+0]=e,this.array[n+1]=t,this},setXYZ:function(n,e,t,i){return n*=this.itemSize,this.array[n+0]=e,this.array[n+1]=t,this.array[n+2]=i,this},setXYZW:function(n,e,t,i,r){return n*=this.itemSize,this.array[n+0]=e,this.array[n+1]=t,this.array[n+2]=i,this.array[n+3]=r,this},onUpload:function(n){return this.onUploadCallback=n,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function iu(n,e,t){Oe.call(this,new Int8Array(n),e,t)}iu.prototype=Object.create(Oe.prototype);iu.prototype.constructor=iu;function ru(n,e,t){Oe.call(this,new Uint8Array(n),e,t)}ru.prototype=Object.create(Oe.prototype);ru.prototype.constructor=ru;function su(n,e,t){Oe.call(this,new Uint8ClampedArray(n),e,t)}su.prototype=Object.create(Oe.prototype);su.prototype.constructor=su;function ou(n,e,t){Oe.call(this,new Int16Array(n),e,t)}ou.prototype=Object.create(Oe.prototype);ou.prototype.constructor=ou;function To(n,e,t){Oe.call(this,new Uint16Array(n),e,t)}To.prototype=Object.create(Oe.prototype);To.prototype.constructor=To;function au(n,e,t){Oe.call(this,new Int32Array(n),e,t)}au.prototype=Object.create(Oe.prototype);au.prototype.constructor=au;function Eo(n,e,t){Oe.call(this,new Uint32Array(n),e,t)}Eo.prototype=Object.create(Oe.prototype);Eo.prototype.constructor=Eo;function Qa(n,e,t){Oe.call(this,new Uint16Array(n),e,t)}Qa.prototype=Object.create(Oe.prototype);Qa.prototype.constructor=Qa;Qa.prototype.isFloat16BufferAttribute=!0;function je(n,e,t){Oe.call(this,new Float32Array(n),e,t)}je.prototype=Object.create(Oe.prototype);je.prototype.constructor=je;function lu(n,e,t){Oe.call(this,new Float64Array(n),e,t)}lu.prototype=Object.create(Oe.prototype);lu.prototype.constructor=lu;function gf(n){if(n.length===0)return-Infinity;let e=n[0];for(let t=1,i=n.length;t<i;++t)n[t]>e&&(e=n[t]);return e}var ax={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray!="undefined"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function el(n,e){return new ax[n](e)}var lx=0,Zn=new Fe,cu=new Ce,ls=new k,sn=new qn,Ao=new qn,Ct=new k;function We(){Object.defineProperty(this,"id",{value:lx++}),this.uuid=Ie.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:Infinity},this.userData={}}We.prototype=Object.assign(Object.create(Pn.prototype),{constructor:We,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(n){return Array.isArray(n)?this.index=new(gf(n)>65535?Eo:To)(n,1):this.index=n,this},getAttribute:function(n){return this.attributes[n]},setAttribute:function(n,e){return this.attributes[n]=e,this},deleteAttribute:function(n){return delete this.attributes[n],this},hasAttribute:function(n){return this.attributes[n]!==void 0},addGroup:function(n,e,t=0){this.groups.push({start:n,count:e,materialIndex:t})},clearGroups:function(){this.groups=[]},setDrawRange:function(n,e){this.drawRange.start=n,this.drawRange.count=e},applyMatrix4:function(n){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(n),e.needsUpdate=!0);let t=this.attributes.normal;if(t!==void 0){let r=new nn().getNormalMatrix(n);t.applyNormalMatrix(r),t.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(n),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(n){return Zn.makeRotationX(n),this.applyMatrix4(Zn),this},rotateY:function(n){return Zn.makeRotationY(n),this.applyMatrix4(Zn),this},rotateZ:function(n){return Zn.makeRotationZ(n),this.applyMatrix4(Zn),this},translate:function(n,e,t){return Zn.makeTranslation(n,e,t),this.applyMatrix4(Zn),this},scale:function(n,e,t){return Zn.makeScale(n,e,t),this.applyMatrix4(Zn),this},lookAt:function(n){return cu.lookAt(n),cu.updateMatrix(),this.applyMatrix4(cu.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ls).negate(),this.translate(ls.x,ls.y,ls.z),this},setFromPoints:function(n){let e=[];for(let t=0,i=n.length;t<i;t++){let r=n[t];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new je(e,3)),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new qn);let n=this.attributes.position,e=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new k(-Infinity,-Infinity,-Infinity),new k(Infinity,Infinity,Infinity));return}if(n!==void 0){if(this.boundingBox.setFromBufferAttribute(n),e)for(let t=0,i=e.length;t<i;t++){let r=e[t];sn.setFromBufferAttribute(r),this.morphTargetsRelative?(Ct.addVectors(this.boundingBox.min,sn.min),this.boundingBox.expandByPoint(Ct),Ct.addVectors(this.boundingBox.max,sn.max),this.boundingBox.expandByPoint(Ct)):(this.boundingBox.expandByPoint(sn.min),this.boundingBox.expandByPoint(sn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Xn);let n=this.attributes.position,e=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new k,Infinity);return}if(n){let t=this.boundingSphere.center;if(sn.setFromBufferAttribute(n),e)for(let r=0,s=e.length;r<s;r++){let o=e[r];Ao.setFromBufferAttribute(o),this.morphTargetsRelative?(Ct.addVectors(sn.min,Ao.min),sn.expandByPoint(Ct),Ct.addVectors(sn.max,Ao.max),sn.expandByPoint(Ct)):(sn.expandByPoint(Ao.min),sn.expandByPoint(Ao.max))}sn.getCenter(t);let i=0;for(let r=0,s=n.count;r<s;r++)Ct.fromBufferAttribute(n,r),i=Math.max(i,t.distanceToSquared(Ct));if(e)for(let r=0,s=e.length;r<s;r++){let o=e[r],a=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Ct.fromBufferAttribute(o,c),a&&(ls.fromBufferAttribute(n,c),Ct.add(ls)),i=Math.max(i,t.distanceToSquared(Ct))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){let n=this.index,e=this.attributes;if(n===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let t=n.array,i=e.position.array,r=e.normal.array,s=e.uv.array,o=i.length/3;e.tangent===void 0&&this.setAttribute("tangent",new Oe(new Float32Array(4*o),4));let a=e.tangent.array,c=[],u=[];for(let T=0;T<o;T++)c[T]=new k,u[T]=new k;let d=new k,f=new k,l=new k,h=new ae,p=new ae,m=new ae,v=new k,_=new k;function g(T,I,U){d.fromArray(i,T*3),f.fromArray(i,I*3),l.fromArray(i,U*3),h.fromArray(s,T*2),p.fromArray(s,I*2),m.fromArray(s,U*2),f.sub(d),l.sub(d),p.sub(h),m.sub(h);let W=1/(p.x*m.y-m.x*p.y);!isFinite(W)||(v.copy(f).multiplyScalar(m.y).addScaledVector(l,-p.y).multiplyScalar(W),_.copy(l).multiplyScalar(p.x).addScaledVector(f,-m.x).multiplyScalar(W),c[T].add(v),c[I].add(v),c[U].add(v),u[T].add(_),u[I].add(_),u[U].add(_))}let y=this.groups;y.length===0&&(y=[{start:0,count:t.length}]);for(let T=0,I=y.length;T<I;++T){let U=y[T],W=U.start,D=U.count;for(let L=W,O=W+D;L<O;L+=3)g(t[L+0],t[L+1],t[L+2])}let b=new k,w=new k,x=new k,S=new k;function P(T){x.fromArray(r,T*3),S.copy(x);let I=c[T];b.copy(I),b.sub(x.multiplyScalar(x.dot(I))).normalize(),w.crossVectors(S,I);let W=w.dot(u[T])<0?-1:1;a[T*4]=b.x,a[T*4+1]=b.y,a[T*4+2]=b.z,a[T*4+3]=W}for(let T=0,I=y.length;T<I;++T){let U=y[T],W=U.start,D=U.count;for(let L=W,O=W+D;L<O;L+=3)P(t[L+0]),P(t[L+1]),P(t[L+2])}},computeVertexNormals:function(){let n=this.index,e=this.getAttribute("position");if(e!==void 0){let t=this.getAttribute("normal");if(t===void 0)t=new Oe(new Float32Array(e.count*3),3),this.setAttribute("normal",t);else for(let f=0,l=t.count;f<l;f++)t.setXYZ(f,0,0,0);let i=new k,r=new k,s=new k,o=new k,a=new k,c=new k,u=new k,d=new k;if(n)for(let f=0,l=n.count;f<l;f+=3){let h=n.getX(f+0),p=n.getX(f+1),m=n.getX(f+2);i.fromBufferAttribute(e,h),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,m),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),o.fromBufferAttribute(t,h),a.fromBufferAttribute(t,p),c.fromBufferAttribute(t,m),o.add(u),a.add(u),c.add(u),t.setXYZ(h,o.x,o.y,o.z),t.setXYZ(p,a.x,a.y,a.z),t.setXYZ(m,c.x,c.y,c.z)}else for(let f=0,l=e.count;f<l;f+=3)i.fromBufferAttribute(e,f+0),r.fromBufferAttribute(e,f+1),s.fromBufferAttribute(e,f+2),u.subVectors(s,r),d.subVectors(i,r),u.cross(d),t.setXYZ(f+0,u.x,u.y,u.z),t.setXYZ(f+1,u.x,u.y,u.z),t.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),t.needsUpdate=!0}},merge:function(n,e){if(!(n&&n.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",n);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let t=this.attributes;for(let i in t){if(n.attributes[i]===void 0)continue;let s=t[i].array,o=n.attributes[i],a=o.array,c=o.itemSize*e,u=Math.min(a.length,s.length-c);for(let d=0,f=c;d<u;d++,f++)s[f]=a[d]}return this},normalizeNormals:function(){let n=this.attributes.normal;for(let e=0,t=n.count;e<t;e++)Ct.fromBufferAttribute(n,e),Ct.normalize(),n.setXYZ(e,Ct.x,Ct.y,Ct.z)},toNonIndexed:function(){function n(o,a){let c=o.array,u=o.itemSize,d=o.normalized,f=new c.constructor(a.length*u),l=0,h=0;for(let p=0,m=a.length;p<m;p++){l=a[p]*u;for(let v=0;v<u;v++)f[h++]=c[l++]}return new Oe(f,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new We,t=this.index.array,i=this.attributes;for(let o in i){let a=i[o],c=n(a,t);e.setAttribute(o,c)}let r=this.morphAttributes;for(let o in r){let a=[],c=r[o];for(let u=0,d=c.length;u<d;u++){let f=c[u],l=n(f,t);a.push(l)}e.morphAttributes[o]=a}e.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let o=0,a=s.length;o<a;o++){let c=s[o];e.addGroup(c.start,c.count,c.materialIndex)}return e},toJSON:function(){let n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),Object.keys(this.userData).length>0&&(n.userData=this.userData),this.parameters!==void 0){let a=this.parameters;for(let c in a)a[c]!==void 0&&(n[c]=a[c]);return n}n.data={attributes:{}};let e=this.index;e!==null&&(n.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let t=this.attributes;for(let a in t){let c=t[a],u=c.toJSON(n.data);c.name!==""&&(u.name=c.name),n.data.attributes[a]=u}let i={},r=!1;for(let a in this.morphAttributes){let c=this.morphAttributes[a],u=[];for(let d=0,f=c.length;d<f;d++){let l=c[d],h=l.toJSON(n.data);l.name!==""&&(h.name=l.name),u.push(h)}u.length>0&&(i[a]=u,r=!0)}r&&(n.data.morphAttributes=i,n.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(n.data.groups=JSON.parse(JSON.stringify(s)));let o=this.boundingSphere;return o!==null&&(n.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),n},clone:function(){return new We().copy(this)},copy:function(n){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=n.name;let t=n.index;t!==null&&this.setIndex(t.clone(e));let i=n.attributes;for(let c in i){let u=i[c];this.setAttribute(c,u.clone(e))}let r=n.morphAttributes;for(let c in r){let u=[],d=r[c];for(let f=0,l=d.length;f<l;f++)u.push(d[f].clone(e));this.morphAttributes[c]=u}this.morphTargetsRelative=n.morphTargetsRelative;let s=n.groups;for(let c=0,u=s.length;c<u;c++){let d=s[c];this.addGroup(d.start,d.count,d.materialIndex)}let o=n.boundingBox;o!==null&&(this.boundingBox=o.clone());let a=n.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=n.drawRange.start,this.drawRange.count=n.drawRange.count,this.userData=n.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _f=new Fe,cs=new is,uu=new Xn,Wi=new k,ji=new k,qi=new k,hu=new k,du=new k,fu=new k,tl=new k,nl=new k,il=new k,rl=new ae,sl=new ae,ol=new ae,pu=new k,al=new k;function ke(n=new We,e=new At){Ce.call(this),this.type="Mesh",this.geometry=n,this.material=e,this.updateMorphTargets()}ke.prototype=Object.assign(Object.create(Ce.prototype),{constructor:ke,isMesh:!0,copy:function(n){return Ce.prototype.copy.call(this,n),n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=n.material,this.geometry=n.geometry,this},updateMorphTargets:function(){let n=this.geometry;if(n.isBufferGeometry){let e=n.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{let e=n.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(n,e){let t=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(t.boundingSphere===null&&t.computeBoundingSphere(),uu.copy(t.boundingSphere),uu.applyMatrix4(r),n.ray.intersectsSphere(uu)===!1)||(_f.copy(r).invert(),cs.copy(n.ray).applyMatrix4(_f),t.boundingBox!==null&&cs.intersectsBox(t.boundingBox)===!1))return;let s;if(t.isBufferGeometry){let o=t.index,a=t.attributes.position,c=t.morphAttributes.position,u=t.morphTargetsRelative,d=t.attributes.uv,f=t.attributes.uv2,l=t.groups,h=t.drawRange;if(o!==null)if(Array.isArray(i))for(let p=0,m=l.length;p<m;p++){let v=l[p],_=i[v.materialIndex],g=Math.max(v.start,h.start),y=Math.min(v.start+v.count,h.start+h.count);for(let b=g,w=y;b<w;b+=3){let x=o.getX(b),S=o.getX(b+1),P=o.getX(b+2);s=ll(this,_,n,cs,a,c,u,d,f,x,S,P),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=v.materialIndex,e.push(s))}}else{let p=Math.max(0,h.start),m=Math.min(o.count,h.start+h.count);for(let v=p,_=m;v<_;v+=3){let g=o.getX(v),y=o.getX(v+1),b=o.getX(v+2);s=ll(this,i,n,cs,a,c,u,d,f,g,y,b),s&&(s.faceIndex=Math.floor(v/3),e.push(s))}}else if(a!==void 0)if(Array.isArray(i))for(let p=0,m=l.length;p<m;p++){let v=l[p],_=i[v.materialIndex],g=Math.max(v.start,h.start),y=Math.min(v.start+v.count,h.start+h.count);for(let b=g,w=y;b<w;b+=3){let x=b,S=b+1,P=b+2;s=ll(this,_,n,cs,a,c,u,d,f,x,S,P),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=v.materialIndex,e.push(s))}}else{let p=Math.max(0,h.start),m=Math.min(a.count,h.start+h.count);for(let v=p,_=m;v<_;v+=3){let g=v,y=v+1,b=v+2;s=ll(this,i,n,cs,a,c,u,d,f,g,y,b),s&&(s.faceIndex=Math.floor(v/3),e.push(s))}}}else t.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});function cx(n,e,t,i,r,s,o,a){let c;if(e.side===Tt?c=i.intersectTriangle(o,s,r,!0,a):c=i.intersectTriangle(r,s,o,e.side!==mr,a),c===null)return null;al.copy(a),al.applyMatrix4(n.matrixWorld);let u=t.ray.origin.distanceTo(al);return u<t.near||u>t.far?null:{distance:u,point:al.clone(),object:n}}function ll(n,e,t,i,r,s,o,a,c,u,d,f){Wi.fromBufferAttribute(r,u),ji.fromBufferAttribute(r,d),qi.fromBufferAttribute(r,f);let l=n.morphTargetInfluences;if(e.morphTargets&&s&&l){tl.set(0,0,0),nl.set(0,0,0),il.set(0,0,0);for(let p=0,m=s.length;p<m;p++){let v=l[p],_=s[p];v!==0&&(hu.fromBufferAttribute(_,u),du.fromBufferAttribute(_,d),fu.fromBufferAttribute(_,f),o?(tl.addScaledVector(hu,v),nl.addScaledVector(du,v),il.addScaledVector(fu,v)):(tl.addScaledVector(hu.sub(Wi),v),nl.addScaledVector(du.sub(ji),v),il.addScaledVector(fu.sub(qi),v)))}Wi.add(tl),ji.add(nl),qi.add(il)}n.isSkinnedMesh&&(n.boneTransform(u,Wi),n.boneTransform(d,ji),n.boneTransform(f,qi));let h=cx(n,e,t,i,Wi,ji,qi,pu);if(h){a&&(rl.fromBufferAttribute(a,u),sl.fromBufferAttribute(a,d),ol.fromBufferAttribute(a,f),h.uv=kt.getUV(pu,Wi,ji,qi,rl,sl,ol,new ae)),c&&(rl.fromBufferAttribute(c,u),sl.fromBufferAttribute(c,d),ol.fromBufferAttribute(c,f),h.uv2=kt.getUV(pu,Wi,ji,qi,rl,sl,ol,new ae));let p=new mf(u,d,f);kt.getNormal(Wi,ji,qi,p.normal),h.face=p}return h}var br=class extends We{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};let a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);let c=[],u=[],d=[],f=[],l=0,h=0;p("z","y","x",-1,-1,i,t,e,o,s,0),p("z","y","x",1,-1,i,t,-e,o,s,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,s,4),p("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(c),this.setAttribute("position",new je(u,3)),this.setAttribute("normal",new je(d,3)),this.setAttribute("uv",new je(f,2));function p(m,v,_,g,y,b,w,x,S,P,T){let I=b/S,U=w/P,W=b/2,D=w/2,L=x/2,O=S+1,F=P+1,Z=0,ee=0,oe=new k;for(let ge=0;ge<F;ge++){let de=ge*U-D;for(let ne=0;ne<O;ne++){let Te=ne*I-W;oe[m]=Te*g,oe[v]=de*y,oe[_]=L,u.push(oe.x,oe.y,oe.z),oe[m]=0,oe[v]=0,oe[_]=x>0?1:-1,d.push(oe.x,oe.y,oe.z),f.push(ne/S),f.push(1-ge/P),Z+=1}}for(let ge=0;ge<P;ge++)for(let de=0;de<S;de++){let ne=l+de+O*ge,Te=l+de+O*(ge+1),Ae=l+(de+1)+O*(ge+1),re=l+(de+1)+O*ge;c.push(ne,Te,re),c.push(Te,Ae,re),ee+=6}a.addGroup(h,ee,T),h+=ee,l+=Z}}};function us(n){let e={};for(let t in n){e[t]={};for(let i in n[t]){let r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function zt(n){let e={};for(let t=0;t<n.length;t++){let i=us(n[t]);for(let r in i)e[r]=i[r]}return e}var hs={clone:us,merge:zt},ux=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,hx=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function nt(n){Re.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=ux,this.fragmentShader=hx,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,n!==void 0&&(n.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(n))}nt.prototype=Object.create(Re.prototype);nt.prototype.constructor=nt;nt.prototype.isShaderMaterial=!0;nt.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.fragmentShader=n.fragmentShader,this.vertexShader=n.vertexShader,this.uniforms=us(n.uniforms),this.defines=Object.assign({},n.defines),this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.lights=n.lights,this.clipping=n.clipping,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this.extensions=Object.assign({},n.extensions),this.glslVersion=n.glslVersion,this};nt.prototype.toJSON=function(n){let e=Re.prototype.toJSON.call(this,n);e.glslVersion=this.glslVersion,e.uniforms={};for(let i in this.uniforms){let s=this.uniforms[i].value;s&&s.isTexture?e.uniforms[i]={type:"t",value:s.toJSON(n).uuid}:s&&s.isColor?e.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[i]={type:"m4",value:s.toArray()}:e.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let t={};for(let i in this.extensions)this.extensions[i]===!0&&(t[i]=!0);return Object.keys(t).length>0&&(e.extensions=t),e};function Xi(){Ce.call(this),this.type="Camera",this.matrixWorldInverse=new Fe,this.projectionMatrix=new Fe,this.projectionMatrixInverse=new Fe}Xi.prototype=Object.assign(Object.create(Ce.prototype),{constructor:Xi,isCamera:!0,copy:function(n,e){return Ce.prototype.copy.call(this,n,e),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this},getWorldDirection:function(n){n===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),n=new k),this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return n.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(n){Ce.prototype.updateMatrixWorld.call(this,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(n,e){Ce.prototype.updateWorldMatrix.call(this,n,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}});function ut(n=50,e=1,t=.1,i=2e3){Xi.call(this),this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=t,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ut.prototype=Object.assign(Object.create(Xi.prototype),{constructor:ut,isPerspectiveCamera:!0,copy:function(n,e){return Xi.prototype.copy.call(this,n,e),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this},setFocalLength:function(n){let e=.5*this.getFilmHeight()/n;this.fov=Ie.RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){let n=Math.tan(Ie.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/n},getEffectiveFOV:function(){return Ie.RAD2DEG*2*Math.atan(Math.tan(Ie.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(n,e,t,i,r,s){this.aspect=n/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=t,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let n=this.near,e=n*Math.tan(Ie.DEG2RAD*.5*this.fov)/this.zoom,t=2*e,i=this.aspect*t,r=-.5*i,s=this.view;if(this.view!==null&&this.view.enabled){let a=s.fullWidth,c=s.fullHeight;r+=s.offsetX*i/a,e-=s.offsetY*t/c,i*=s.width/a,t*=s.height/c}let o=this.filmOffset;o!==0&&(r+=n*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-t,n,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(n){let e=Ce.prototype.toJSON.call(this,n);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});var ds=90,fs=1;function ps(n,e,t){if(Ce.call(this),this.type="CubeCamera",t.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=t;let i=new ut(ds,fs,n,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new k(1,0,0)),this.add(i);let r=new ut(ds,fs,n,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new k(-1,0,0)),this.add(r);let s=new ut(ds,fs,n,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new k(0,1,0)),this.add(s);let o=new ut(ds,fs,n,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new k(0,-1,0)),this.add(o);let a=new ut(ds,fs,n,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new k(0,0,1)),this.add(a);let c=new ut(ds,fs,n,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new k(0,0,-1)),this.add(c),this.update=function(u,d){this.parent===null&&this.updateMatrixWorld();let f=u.xr.enabled,l=u.getRenderTarget();u.xr.enabled=!1;let h=t.texture.generateMipmaps;t.texture.generateMipmaps=!1,u.setRenderTarget(t,0),u.render(d,i),u.setRenderTarget(t,1),u.render(d,r),u.setRenderTarget(t,2),u.render(d,s),u.setRenderTarget(t,3),u.render(d,o),u.setRenderTarget(t,4),u.render(d,a),t.texture.generateMipmaps=h,u.setRenderTarget(t,5),u.render(d,c),u.setRenderTarget(l),u.xr.enabled=f}}ps.prototype=Object.create(Ce.prototype);ps.prototype.constructor=ps;function Yi(n,e,t,i,r,s,o,a,c,u){n=n!==void 0?n:[],e=e!==void 0?e:Pc,o=o!==void 0?o:fi,Qe.call(this,n,e,t,i,r,s,o,a,c,u),this.flipY=!1,this._needsFlipEnvMap=!0}Yi.prototype=Object.create(Qe.prototype);Yi.prototype.constructor=Yi;Yi.prototype.isCubeTexture=!0;Object.defineProperty(Yi.prototype,"images",{get:function(){return this.image},set:function(n){this.image=n}});var vf=class extends Nt{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),Object.defineProperty(this,"isWebGLCubeRenderTarget",{value:!0}),t=t||{},this.texture=new Yi(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Et,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new br(5,5,5),s=new nt({name:"CubemapFromEquirect",uniforms:us(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Tt,blending:po});s.uniforms.tEquirect.value=t;let o=new ke(r,s),a=t.minFilter;return t.minFilter===_r&&(t.minFilter=Xe),new ps(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){let s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}};function ms(n,e,t,i,r,s,o,a,c,u,d,f){Qe.call(this,null,s,o,a,c,u,i,r,d,f),this.image={data:n||null,width:e||1,height:t||1},this.magFilter=c!==void 0?c:_t,this.minFilter=u!==void 0?u:_t,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}ms.prototype=Object.create(Qe.prototype);ms.prototype.constructor=ms;ms.prototype.isDataTexture=!0;var gs=new Xn,cl=new k,Co=class{constructor(e,t,i,r,s,o){this.planes=[e!==void 0?e:new Yn,t!==void 0?t:new Yn,i!==void 0?i:new Yn,r!==void 0?r:new Yn,s!==void 0?s:new Yn,o!==void 0?o:new Yn]}set(e,t,i,r,s,o){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}clone(){return new this.constructor().copy(this)}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],s=i[1],o=i[2],a=i[3],c=i[4],u=i[5],d=i[6],f=i[7],l=i[8],h=i[9],p=i[10],m=i[11],v=i[12],_=i[13],g=i[14],y=i[15];return t[0].setComponents(a-r,f-c,m-l,y-v).normalize(),t[1].setComponents(a+r,f+c,m+l,y+v).normalize(),t[2].setComponents(a+s,f+u,m+h,y+_).normalize(),t[3].setComponents(a-s,f-u,m-h,y-_).normalize(),t[4].setComponents(a-o,f-d,m-p,y-g).normalize(),t[5].setComponents(a+o,f+d,m+p,y+g).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),gs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(gs)}intersectsSprite(e){return gs.center.set(0,0,0),gs.radius=.7071067811865476,gs.applyMatrix4(e.matrixWorld),this.intersectsSphere(gs)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(cl.x=r.normal.x>0?e.max.x:e.min.x,cl.y=r.normal.y>0?e.max.y:e.min.y,cl.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(cl)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}};function yf(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function dx(n,e){let t=e.isWebGL2,i=new WeakMap;function r(u,d){let f=u.array,l=u.usage,h=n.createBuffer();n.bindBuffer(d,h),n.bufferData(d,f,l),u.onUploadCallback();let p=5126;return f instanceof Float32Array?p=5126:f instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):f instanceof Uint16Array?u.isFloat16BufferAttribute?t?p=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):p=5123:f instanceof Int16Array?p=5122:f instanceof Uint32Array?p=5125:f instanceof Int32Array?p=5124:f instanceof Int8Array?p=5120:f instanceof Uint8Array&&(p=5121),{buffer:h,type:p,bytesPerElement:f.BYTES_PER_ELEMENT,version:u.version}}function s(u,d,f){let l=d.array,h=d.updateRange;n.bindBuffer(f,u),h.count===-1?n.bufferSubData(f,0,l):(t?n.bufferSubData(f,h.offset*l.BYTES_PER_ELEMENT,l,h.offset,h.count):n.bufferSubData(f,h.offset*l.BYTES_PER_ELEMENT,l.subarray(h.offset,h.offset+h.count)),h.count=-1)}function o(u){return u.isInterleavedBufferAttribute&&(u=u.data),i.get(u)}function a(u){u.isInterleavedBufferAttribute&&(u=u.data);let d=i.get(u);d&&(n.deleteBuffer(d.buffer),i.delete(u))}function c(u,d){if(u.isGLBufferAttribute){let l=i.get(u);(!l||l.version<u.version)&&i.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);let f=i.get(u);f===void 0?i.set(u,r(u,d)):f.version<u.version&&(s(f.buffer,u,d),f.version=u.version)}return{get:o,remove:a,update:c}}var _n=class extends We{constructor(e=1,t=1,i=1,r=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let s=e/2,o=t/2,a=Math.floor(i),c=Math.floor(r),u=a+1,d=c+1,f=e/a,l=t/c,h=[],p=[],m=[],v=[];for(let _=0;_<d;_++){let g=_*l-o;for(let y=0;y<u;y++){let b=y*f-s;p.push(b,-g,0),m.push(0,0,1),v.push(y/a),v.push(1-_/c)}}for(let _=0;_<c;_++)for(let g=0;g<a;g++){let y=g+u*_,b=g+u*(_+1),w=g+1+u*(_+1),x=g+1+u*_;h.push(y,b,x),h.push(b,w,x)}this.setIndex(h),this.setAttribute("position",new je(p,3)),this.setAttribute("normal",new je(m,3)),this.setAttribute("uv",new je(v,2))}},fx=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,px=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mx=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,gx=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,_x=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,vx="vec3 transformed = vec3( position );",yx=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,xx=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bx=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,wx=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Mx=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Sx=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Tx=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Ex=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,Ax=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,Cx=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Lx=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Rx=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Px=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ix=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Ox=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Dx=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Fx=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Bx=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Nx="gl_FragColor = linearToOutputTexel( gl_FragColor );",kx=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,zx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Hx=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Ux=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Gx=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Vx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Wx=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,jx=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,qx=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Xx=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Yx=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Zx=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,Jx=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Kx=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,$x=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,Qx=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,eb=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,tb=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,nb=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,ib=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,rb=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,sb=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ob=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ab=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lb=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,cb=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,ub=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,hb=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,db=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,fb=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,pb=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,mb=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,gb=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_b=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vb=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,yb=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,xb=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,bb=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,wb=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Mb=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,Sb=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,Tb=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Eb=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,Ab=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Cb=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Lb=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Rb=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Pb=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ib=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Ob=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Db=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Fb=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Bb=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Nb=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,kb=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,zb=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Hb=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,Ub=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Gb=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Vb=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Wb=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,jb=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,qb=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Xb=`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,Yb=`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,Zb=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Jb=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Kb=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,$b=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Qb=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,ew=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,tw=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,nw=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,iw=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,rw=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,sw=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ow=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,aw=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,lw=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,cw=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,uw=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,hw=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,dw=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,fw=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,pw=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mw=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,gw=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_w=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vw=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yw=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,xw=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bw=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ww=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mw=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Sw=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Tw=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ew=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,Aw=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Cw=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Lw=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Rw=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Pw=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Iw=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ow=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ze={alphamap_fragment:fx,alphamap_pars_fragment:px,alphatest_fragment:mx,aomap_fragment:gx,aomap_pars_fragment:_x,begin_vertex:vx,beginnormal_vertex:yx,bsdfs:xx,bumpmap_pars_fragment:bx,clipping_planes_fragment:wx,clipping_planes_pars_fragment:Mx,clipping_planes_pars_vertex:Sx,clipping_planes_vertex:Tx,color_fragment:Ex,color_pars_fragment:Ax,color_pars_vertex:Cx,color_vertex:Lx,common:Rx,cube_uv_reflection_fragment:Px,defaultnormal_vertex:Ix,displacementmap_pars_vertex:Ox,displacementmap_vertex:Dx,emissivemap_fragment:Fx,emissivemap_pars_fragment:Bx,encodings_fragment:Nx,encodings_pars_fragment:kx,envmap_fragment:zx,envmap_common_pars_fragment:Hx,envmap_pars_fragment:Ux,envmap_pars_vertex:Gx,envmap_physical_pars_fragment:Qx,envmap_vertex:Vx,fog_vertex:Wx,fog_pars_vertex:jx,fog_fragment:qx,fog_pars_fragment:Xx,gradientmap_pars_fragment:Yx,lightmap_fragment:Zx,lightmap_pars_fragment:Jx,lights_lambert_vertex:Kx,lights_pars_begin:$x,lights_toon_fragment:eb,lights_toon_pars_fragment:tb,lights_phong_fragment:nb,lights_phong_pars_fragment:ib,lights_physical_fragment:rb,lights_physical_pars_fragment:sb,lights_fragment_begin:ob,lights_fragment_maps:ab,lights_fragment_end:lb,logdepthbuf_fragment:cb,logdepthbuf_pars_fragment:ub,logdepthbuf_pars_vertex:hb,logdepthbuf_vertex:db,map_fragment:fb,map_pars_fragment:pb,map_particle_fragment:mb,map_particle_pars_fragment:gb,metalnessmap_fragment:_b,metalnessmap_pars_fragment:vb,morphnormal_vertex:yb,morphtarget_pars_vertex:xb,morphtarget_vertex:bb,normal_fragment_begin:wb,normal_fragment_maps:Mb,normalmap_pars_fragment:Sb,clearcoat_normal_fragment_begin:Tb,clearcoat_normal_fragment_maps:Eb,clearcoat_pars_fragment:Ab,packing:Cb,premultiplied_alpha_fragment:Lb,project_vertex:Rb,dithering_fragment:Pb,dithering_pars_fragment:Ib,roughnessmap_fragment:Ob,roughnessmap_pars_fragment:Db,shadowmap_pars_fragment:Fb,shadowmap_pars_vertex:Bb,shadowmap_vertex:Nb,shadowmask_pars_fragment:kb,skinbase_vertex:zb,skinning_pars_vertex:Hb,skinning_vertex:Ub,skinnormal_vertex:Gb,specularmap_fragment:Vb,specularmap_pars_fragment:Wb,tonemapping_fragment:jb,tonemapping_pars_fragment:qb,transmissionmap_fragment:Xb,transmissionmap_pars_fragment:Yb,uv_pars_fragment:Zb,uv_pars_vertex:Jb,uv_vertex:Kb,uv2_pars_fragment:$b,uv2_pars_vertex:Qb,uv2_vertex:ew,worldpos_vertex:tw,background_frag:nw,background_vert:iw,cube_frag:rw,cube_vert:sw,depth_frag:ow,depth_vert:aw,distanceRGBA_frag:lw,distanceRGBA_vert:cw,equirect_frag:uw,equirect_vert:hw,linedashed_frag:dw,linedashed_vert:fw,meshbasic_frag:pw,meshbasic_vert:mw,meshlambert_frag:gw,meshlambert_vert:_w,meshmatcap_frag:vw,meshmatcap_vert:yw,meshtoon_frag:xw,meshtoon_vert:bw,meshphong_frag:ww,meshphong_vert:Mw,meshphysical_frag:Sw,meshphysical_vert:Tw,normal_frag:Ew,normal_vert:Aw,points_frag:Cw,points_vert:Lw,shadow_frag:Rw,shadow_vert:Pw,sprite_frag:Iw,sprite_vert:Ow},ye={common:{diffuse:{value:new Me(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new nn},uv2Transform:{value:new nn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ae(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Me(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Me(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new nn}},sprite:{diffuse:{value:new Me(15658734)},opacity:{value:1},center:{value:new ae(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new nn}}},Jn={basic:{uniforms:zt([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.fog]),vertexShader:ze.meshbasic_vert,fragmentShader:ze.meshbasic_frag},lambert:{uniforms:zt([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.fog,ye.lights,{emissive:{value:new Me(0)}}]),vertexShader:ze.meshlambert_vert,fragmentShader:ze.meshlambert_frag},phong:{uniforms:zt([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.fog,ye.lights,{emissive:{value:new Me(0)},specular:{value:new Me(1118481)},shininess:{value:30}}]),vertexShader:ze.meshphong_vert,fragmentShader:ze.meshphong_frag},standard:{uniforms:zt([ye.common,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.roughnessmap,ye.metalnessmap,ye.fog,ye.lights,{emissive:{value:new Me(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ze.meshphysical_vert,fragmentShader:ze.meshphysical_frag},toon:{uniforms:zt([ye.common,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.gradientmap,ye.fog,ye.lights,{emissive:{value:new Me(0)}}]),vertexShader:ze.meshtoon_vert,fragmentShader:ze.meshtoon_frag},matcap:{uniforms:zt([ye.common,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.fog,{matcap:{value:null}}]),vertexShader:ze.meshmatcap_vert,fragmentShader:ze.meshmatcap_frag},points:{uniforms:zt([ye.points,ye.fog]),vertexShader:ze.points_vert,fragmentShader:ze.points_frag},dashed:{uniforms:zt([ye.common,ye.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ze.linedashed_vert,fragmentShader:ze.linedashed_frag},depth:{uniforms:zt([ye.common,ye.displacementmap]),vertexShader:ze.depth_vert,fragmentShader:ze.depth_frag},normal:{uniforms:zt([ye.common,ye.bumpmap,ye.normalmap,ye.displacementmap,{opacity:{value:1}}]),vertexShader:ze.normal_vert,fragmentShader:ze.normal_frag},sprite:{uniforms:zt([ye.sprite,ye.fog]),vertexShader:ze.sprite_vert,fragmentShader:ze.sprite_frag},background:{uniforms:{uvTransform:{value:new nn},t2D:{value:null}},vertexShader:ze.background_vert,fragmentShader:ze.background_frag},cube:{uniforms:zt([ye.envmap,{opacity:{value:1}}]),vertexShader:ze.cube_vert,fragmentShader:ze.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ze.equirect_vert,fragmentShader:ze.equirect_frag},distanceRGBA:{uniforms:zt([ye.common,ye.displacementmap,{referencePosition:{value:new k},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ze.distanceRGBA_vert,fragmentShader:ze.distanceRGBA_frag},shadow:{uniforms:zt([ye.lights,ye.fog,{color:{value:new Me(0)},opacity:{value:1}}]),vertexShader:ze.shadow_vert,fragmentShader:ze.shadow_frag}};Jn.physical={uniforms:zt([Jn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ae(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Me(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ze.meshphysical_vert,fragmentShader:ze.meshphysical_frag};function Dw(n,e,t,i,r){let s=new Me(0),o=0,a,c,u=null,d=0,f=null;function l(p,m,v,_){let g=m.isScene===!0?m.background:null;g&&g.isTexture&&(g=e.get(g));let y=n.xr,b=y.getSession&&y.getSession();b&&b.environmentBlendMode==="additive"&&(g=null),g===null?h(s,o):g&&g.isColor&&(h(g,1),_=!0),(n.autoClear||_)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),g&&(g.isCubeTexture||g.isWebGLCubeRenderTarget||g.mapping===Oc)?(c===void 0&&(c=new ke(new br(1,1,1),new nt({name:"BackgroundCubeMaterial",uniforms:us(Jn.cube.uniforms),vertexShader:Jn.cube.vertexShader,fragmentShader:Jn.cube.fragmentShader,side:Tt,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(w,x,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),g.isWebGLCubeRenderTarget&&(g=g.texture),c.material.uniforms.envMap.value=g,c.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,(u!==g||d!==g.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,u=g,d=g.version,f=n.toneMapping),p.unshift(c,c.geometry,c.material,0,0,null)):g&&g.isTexture&&(a===void 0&&(a=new ke(new _n(2,2),new nt({name:"BackgroundMaterial",uniforms:us(Jn.background.uniforms),vertexShader:Jn.background.vertexShader,fragmentShader:Jn.background.fragmentShader,side:di,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=g,g.matrixAutoUpdate===!0&&g.updateMatrix(),a.material.uniforms.uvTransform.value.copy(g.matrix),(u!==g||d!==g.version||f!==n.toneMapping)&&(a.material.needsUpdate=!0,u=g,d=g.version,f=n.toneMapping),p.unshift(a,a.geometry,a.material,0,0,null))}function h(p,m){t.buffers.color.setClear(p.r,p.g,p.b,m,r)}return{getClearColor:function(){return s},setClearColor:function(p,m=1){s.set(p),o=m,h(s,o)},getClearAlpha:function(){return o},setClearAlpha:function(p){o=p,h(s,o)},render:l}}function Fw(n,e,t,i){let r=n.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||s!==null,a={},c=m(null),u=c;function d(D,L,O,F,Z){let ee=!1;if(o){let oe=p(F,O,L);u!==oe&&(u=oe,l(u.object)),ee=v(F,Z),ee&&_(F,Z)}else{let oe=L.wireframe===!0;(u.geometry!==F.id||u.program!==O.id||u.wireframe!==oe)&&(u.geometry=F.id,u.program=O.id,u.wireframe=oe,ee=!0)}D.isInstancedMesh===!0&&(ee=!0),Z!==null&&t.update(Z,34963),ee&&(S(D,L,O,F),Z!==null&&n.bindBuffer(34963,t.get(Z).buffer))}function f(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}function l(D){return i.isWebGL2?n.bindVertexArray(D):s.bindVertexArrayOES(D)}function h(D){return i.isWebGL2?n.deleteVertexArray(D):s.deleteVertexArrayOES(D)}function p(D,L,O){let F=O.wireframe===!0,Z=a[D.id];Z===void 0&&(Z={},a[D.id]=Z);let ee=Z[L.id];ee===void 0&&(ee={},Z[L.id]=ee);let oe=ee[F];return oe===void 0&&(oe=m(f()),ee[F]=oe),oe}function m(D){let L=[],O=[],F=[];for(let Z=0;Z<r;Z++)L[Z]=0,O[Z]=0,F[Z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:O,attributeDivisors:F,object:D,attributes:{},index:null}}function v(D,L){let O=u.attributes,F=D.attributes,Z=0;for(let ee in F){let oe=O[ee],ge=F[ee];if(oe===void 0||oe.attribute!==ge||oe.data!==ge.data)return!0;Z++}return u.attributesNum!==Z||u.index!==L}function _(D,L){let O={},F=D.attributes,Z=0;for(let ee in F){let oe=F[ee],ge={};ge.attribute=oe,oe.data&&(ge.data=oe.data),O[ee]=ge,Z++}u.attributes=O,u.attributesNum=Z,u.index=L}function g(){let D=u.newAttributes;for(let L=0,O=D.length;L<O;L++)D[L]=0}function y(D){b(D,0)}function b(D,L){let O=u.newAttributes,F=u.enabledAttributes,Z=u.attributeDivisors;O[D]=1,F[D]===0&&(n.enableVertexAttribArray(D),F[D]=1),Z[D]!==L&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,L),Z[D]=L)}function w(){let D=u.newAttributes,L=u.enabledAttributes;for(let O=0,F=L.length;O<F;O++)L[O]!==D[O]&&(n.disableVertexAttribArray(O),L[O]=0)}function x(D,L,O,F,Z,ee){i.isWebGL2===!0&&(O===5124||O===5125)?n.vertexAttribIPointer(D,L,O,Z,ee):n.vertexAttribPointer(D,L,O,F,Z,ee)}function S(D,L,O,F){if(i.isWebGL2===!1&&(D.isInstancedMesh||F.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;g();let Z=F.attributes,ee=O.getAttributes(),oe=L.defaultAttributeValues;for(let ge in ee){let de=ee[ge];if(de>=0){let ne=Z[ge];if(ne!==void 0){let Te=ne.normalized,Ae=ne.itemSize,re=t.get(ne);if(re===void 0)continue;let C=re.buffer,M=re.type,V=re.bytesPerElement;if(ne.isInterleavedBufferAttribute){let B=ne.data,G=B.stride,X=ne.offset;B&&B.isInstancedInterleavedBuffer?(b(de,B.meshPerAttribute),F._maxInstanceCount===void 0&&(F._maxInstanceCount=B.meshPerAttribute*B.count)):y(de),n.bindBuffer(34962,C),x(de,Ae,M,Te,G*V,X*V)}else ne.isInstancedBufferAttribute?(b(de,ne.meshPerAttribute),F._maxInstanceCount===void 0&&(F._maxInstanceCount=ne.meshPerAttribute*ne.count)):y(de),n.bindBuffer(34962,C),x(de,Ae,M,Te,0,0)}else if(ge==="instanceMatrix"){let Te=t.get(D.instanceMatrix);if(Te===void 0)continue;let Ae=Te.buffer,re=Te.type;b(de+0,1),b(de+1,1),b(de+2,1),b(de+3,1),n.bindBuffer(34962,Ae),n.vertexAttribPointer(de+0,4,re,!1,64,0),n.vertexAttribPointer(de+1,4,re,!1,64,16),n.vertexAttribPointer(de+2,4,re,!1,64,32),n.vertexAttribPointer(de+3,4,re,!1,64,48)}else if(ge==="instanceColor"){let Te=t.get(D.instanceColor);if(Te===void 0)continue;let Ae=Te.buffer,re=Te.type;b(de,1),n.bindBuffer(34962,Ae),n.vertexAttribPointer(de,3,re,!1,12,0)}else if(oe!==void 0){let Te=oe[ge];if(Te!==void 0)switch(Te.length){case 2:n.vertexAttrib2fv(de,Te);break;case 3:n.vertexAttrib3fv(de,Te);break;case 4:n.vertexAttrib4fv(de,Te);break;default:n.vertexAttrib1fv(de,Te)}}}}w()}function P(){U();for(let D in a){let L=a[D];for(let O in L){let F=L[O];for(let Z in F)h(F[Z].object),delete F[Z];delete L[O]}delete a[D]}}function T(D){if(a[D.id]===void 0)return;let L=a[D.id];for(let O in L){let F=L[O];for(let Z in F)h(F[Z].object),delete F[Z];delete L[O]}delete a[D.id]}function I(D){for(let L in a){let O=a[L];if(O[D.id]===void 0)continue;let F=O[D.id];for(let Z in F)h(F[Z].object),delete F[Z];delete O[D.id]}}function U(){W(),u!==c&&(u=c,l(u.object))}function W(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:d,reset:U,resetDefaultState:W,dispose:P,releaseStatesOfGeometry:T,releaseStatesOfProgram:I,initAttributes:g,enableAttribute:y,disableUnusedAttributes:w}}function Bw(n,e,t,i){let r=i.isWebGL2,s;function o(u){s=u}function a(u,d){n.drawArrays(s,u,d),t.update(d,s,1)}function c(u,d,f){if(f===0)return;let l,h;if(r)l=n,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",l===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[h](s,u,d,f),t.update(d,s,f)}this.setMode=o,this.render=a,this.renderInstances=c}function Nw(n,e,t){let i;function r(){if(i!==void 0)return i;let x=e.get("EXT_texture_filter_anisotropic");return x!==null?i=n.getParameter(x.MAX_TEXTURE_MAX_ANISOTROPY_EXT):i=0,i}function s(x){if(x==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";x="mediump"}return x==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let o=typeof WebGL2RenderingContext!="undefined"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&n instanceof WebGL2ComputeRenderingContext,a=t.precision!==void 0?t.precision:"highp",c=s(a);c!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",c,"instead."),a=c);let u=t.logarithmicDepthBuffer===!0,d=n.getParameter(34930),f=n.getParameter(35660),l=n.getParameter(3379),h=n.getParameter(34076),p=n.getParameter(34921),m=n.getParameter(36347),v=n.getParameter(36348),_=n.getParameter(36349),g=f>0,y=o||!!e.get("OES_texture_float"),b=g&&y,w=o?n.getParameter(36183):0;return{isWebGL2:o,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:f,maxTextureSize:l,maxCubemapSize:h,maxAttributes:p,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:_,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:b,maxSamples:w}}function kw(n){let e=this,t=null,i=0,r=!1,s=!1,o=new Yn,a=new nn,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(f,l,h){let p=f.length!==0||l||i!==0||r;return r=l,t=d(f,h,0),i=f.length,p},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1,u()},this.setState=function(f,l,h){let p=f.clippingPlanes,m=f.clipIntersection,v=f.clipShadows,_=n.get(f);if(!r||p===null||p.length===0||s&&!v)s?d(null):u();else{let g=s?0:i,y=g*4,b=_.clippingState||null;c.value=b,b=d(p,l,y,h);for(let w=0;w!==y;++w)b[w]=t[w];_.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=g}};function u(){c.value!==t&&(c.value=t,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function d(f,l,h,p){let m=f!==null?f.length:0,v=null;if(m!==0){if(v=c.value,p!==!0||v===null){let _=h+m*4,g=l.matrixWorldInverse;a.getNormalMatrix(g),(v===null||v.length<_)&&(v=new Float32Array(_));for(let y=0,b=h;y!==m;++y,b+=4)o.copy(f[y]).applyMatrix4(g,a),o.normal.toArray(v,b),v[b+3]=o.constant}c.value=v,c.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,v}}function zw(n){let e=new WeakMap;function t(o,a){return a===Vd?o.mapping=Pc:a===Wd&&(o.mapping=Ic),o}function i(o){if(o&&o.isTexture){let a=o.mapping;if(a===Vd||a===Wd)if(e.has(o)){let c=e.get(o).texture;return t(c,o.mapping)}else{let c=o.image;if(c&&c.height>0){let u=n.getRenderList(),d=n.getRenderTarget(),f=new vf(c.height/2);return f.fromEquirectangularTexture(n,o),e.set(o,f),n.setRenderTarget(d),n.setRenderList(u),o.addEventListener("dispose",r),t(f.texture,o.mapping)}else return null}}return o}function r(o){let a=o.target;a.removeEventListener("dispose",r);let c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}function Hw(n){let e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(i){let r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function Uw(n,e,t,i){let r={},s=new WeakMap;function o(f){let l=f.target;l.index!==null&&e.remove(l.index);for(let p in l.attributes)e.remove(l.attributes[p]);l.removeEventListener("dispose",o),delete r[l.id];let h=s.get(l);h&&(e.remove(h),s.delete(l)),i.releaseStatesOfGeometry(l),l.isInstancedBufferGeometry===!0&&delete l._maxInstanceCount,t.memory.geometries--}function a(f,l){return r[l.id]===!0||(l.addEventListener("dispose",o),r[l.id]=!0,t.memory.geometries++),l}function c(f){let l=f.attributes;for(let p in l)e.update(l[p],34962);let h=f.morphAttributes;for(let p in h){let m=h[p];for(let v=0,_=m.length;v<_;v++)e.update(m[v],34962)}}function u(f){let l=[],h=f.index,p=f.attributes.position,m=0;if(h!==null){let g=h.array;m=h.version;for(let y=0,b=g.length;y<b;y+=3){let w=g[y+0],x=g[y+1],S=g[y+2];l.push(w,x,x,S,S,w)}}else{let g=p.array;m=p.version;for(let y=0,b=g.length/3-1;y<b;y+=3){let w=y+0,x=y+1,S=y+2;l.push(w,x,x,S,S,w)}}let v=new(gf(l)>65535?Eo:To)(l,1);v.version=m;let _=s.get(f);_&&e.remove(_),s.set(f,v)}function d(f){let l=s.get(f);if(l){let h=f.index;h!==null&&l.version<h.version&&u(f)}else u(f);return s.get(f)}return{get:a,update:c,getWireframeAttribute:d}}function Gw(n,e,t,i){let r=i.isWebGL2,s;function o(l){s=l}let a,c;function u(l){a=l.type,c=l.bytesPerElement}function d(l,h){n.drawElements(s,h,a,l*c),t.update(h,s,1)}function f(l,h,p){if(p===0)return;let m,v;if(r)m=n,v="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[v](s,h,a,l*c,p),t.update(h,s,p)}this.setMode=o,this.setIndex=u,this.render=d,this.renderInstances=f}function Vw(n){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(s/3);break;case 1:t.lines+=a*(s/2);break;case 3:t.lines+=a*(s-1);break;case 2:t.lines+=a*s;break;case 0:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function Ww(n,e){return n[0]-e[0]}function jw(n,e){return Math.abs(e[1])-Math.abs(n[1])}function qw(n){let e={},t=new Float32Array(8),i=[];for(let s=0;s<8;s++)i[s]=[s,0];function r(s,o,a,c){let u=s.morphTargetInfluences,d=u===void 0?0:u.length,f=e[o.id];if(f===void 0){f=[];for(let v=0;v<d;v++)f[v]=[v,0];e[o.id]=f}for(let v=0;v<d;v++){let _=f[v];_[0]=v,_[1]=u[v]}f.sort(jw);for(let v=0;v<8;v++)v<d&&f[v][1]?(i[v][0]=f[v][0],i[v][1]=f[v][1]):(i[v][0]=Number.MAX_SAFE_INTEGER,i[v][1]=0);i.sort(Ww);let l=a.morphTargets&&o.morphAttributes.position,h=a.morphNormals&&o.morphAttributes.normal,p=0;for(let v=0;v<8;v++){let _=i[v],g=_[0],y=_[1];g!==Number.MAX_SAFE_INTEGER&&y?(l&&o.getAttribute("morphTarget"+v)!==l[g]&&o.setAttribute("morphTarget"+v,l[g]),h&&o.getAttribute("morphNormal"+v)!==h[g]&&o.setAttribute("morphNormal"+v,h[g]),t[v]=y,p+=y):(l&&o.hasAttribute("morphTarget"+v)===!0&&o.deleteAttribute("morphTarget"+v),h&&o.hasAttribute("morphNormal"+v)===!0&&o.deleteAttribute("morphNormal"+v),t[v]=0)}let m=o.morphTargetsRelative?1:1-p;c.getUniforms().setValue(n,"morphTargetBaseInfluence",m),c.getUniforms().setValue(n,"morphTargetInfluences",t)}return{update:r}}function Xw(n,e,t,i){let r=new WeakMap;function s(c){let u=i.render.frame,d=c.geometry,f=e.get(c,d);return r.get(f)!==u&&(e.update(f),r.set(f,u)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),t.update(c.instanceMatrix,34962),c.instanceColor!==null&&t.update(c.instanceColor,34962)),f}function o(){r=new WeakMap}function a(c){let u=c.target;u.removeEventListener("dispose",a),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:o}}function Lo(n=null,e=1,t=1,i=1){Qe.call(this,null),this.image={data:n,width:e,height:t,depth:i},this.magFilter=_t,this.minFilter=_t,this.wrapR=Wt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Lo.prototype=Object.create(Qe.prototype);Lo.prototype.constructor=Lo;Lo.prototype.isDataTexture2DArray=!0;function Ro(n=null,e=1,t=1,i=1){Qe.call(this,null),this.image={data:n,width:e,height:t,depth:i},this.magFilter=_t,this.minFilter=_t,this.wrapR=Wt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Ro.prototype=Object.create(Qe.prototype);Ro.prototype.constructor=Ro;Ro.prototype.isDataTexture3D=!0;var xf=new Qe,Yw=new Lo,Zw=new Ro,bf=new Yi,wf=[],Mf=[],Sf=new Float32Array(16),Tf=new Float32Array(9),Ef=new Float32Array(4);function _s(n,e,t){let i=n[0];if(i<=0||i>0)return n;let r=e*t,s=wf[r];if(s===void 0&&(s=new Float32Array(r),wf[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function vn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function on(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Af(n,e){let t=Mf[e];t===void 0&&(t=new Int32Array(e),Mf[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function Jw(n,e){let t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Kw(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(vn(t,e))return;n.uniform2fv(this.addr,e),on(t,e)}}function $w(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(vn(t,e))return;n.uniform3fv(this.addr,e),on(t,e)}}function Qw(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(vn(t,e))return;n.uniform4fv(this.addr,e),on(t,e)}}function eM(n,e){let t=this.cache,i=e.elements;if(i===void 0){if(vn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),on(t,e)}else{if(vn(t,i))return;Ef.set(i),n.uniformMatrix2fv(this.addr,!1,Ef),on(t,i)}}function tM(n,e){let t=this.cache,i=e.elements;if(i===void 0){if(vn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),on(t,e)}else{if(vn(t,i))return;Tf.set(i),n.uniformMatrix3fv(this.addr,!1,Tf),on(t,i)}}function nM(n,e){let t=this.cache,i=e.elements;if(i===void 0){if(vn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),on(t,e)}else{if(vn(t,i))return;Sf.set(i),n.uniformMatrix4fv(this.addr,!1,Sf),on(t,i)}}function iM(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.safeSetTexture2D(e||xf,r)}function rM(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||Yw,r)}function sM(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||Zw,r)}function oM(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.safeSetTextureCube(e||bf,r)}function aM(n,e){let t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function lM(n,e){let t=this.cache;vn(t,e)||(n.uniform2iv(this.addr,e),on(t,e))}function cM(n,e){let t=this.cache;vn(t,e)||(n.uniform3iv(this.addr,e),on(t,e))}function uM(n,e){let t=this.cache;vn(t,e)||(n.uniform4iv(this.addr,e),on(t,e))}function hM(n,e){let t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function dM(n){switch(n){case 5126:return Jw;case 35664:return Kw;case 35665:return $w;case 35666:return Qw;case 35674:return eM;case 35675:return tM;case 35676:return nM;case 5124:case 35670:return aM;case 35667:case 35671:return lM;case 35668:case 35672:return cM;case 35669:case 35673:return uM;case 5125:return hM;case 35678:case 36198:case 36298:case 36306:case 35682:return iM;case 35679:case 36299:case 36307:return sM;case 35680:case 36300:case 36308:case 36293:return oM;case 36289:case 36303:case 36311:case 36292:return rM}}function fM(n,e){n.uniform1fv(this.addr,e)}function pM(n,e){n.uniform1iv(this.addr,e)}function mM(n,e){n.uniform2iv(this.addr,e)}function gM(n,e){n.uniform3iv(this.addr,e)}function _M(n,e){n.uniform4iv(this.addr,e)}function vM(n,e){let t=_s(e,this.size,2);n.uniform2fv(this.addr,t)}function yM(n,e){let t=_s(e,this.size,3);n.uniform3fv(this.addr,t)}function xM(n,e){let t=_s(e,this.size,4);n.uniform4fv(this.addr,t)}function bM(n,e){let t=_s(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function wM(n,e){let t=_s(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function MM(n,e){let t=_s(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function SM(n,e,t){let i=e.length,r=Af(t,i);n.uniform1iv(this.addr,r);for(let s=0;s!==i;++s)t.safeSetTexture2D(e[s]||xf,r[s])}function TM(n,e,t){let i=e.length,r=Af(t,i);n.uniform1iv(this.addr,r);for(let s=0;s!==i;++s)t.safeSetTextureCube(e[s]||bf,r[s])}function EM(n){switch(n){case 5126:return fM;case 35664:return vM;case 35665:return yM;case 35666:return xM;case 35674:return bM;case 35675:return wM;case 35676:return MM;case 5124:case 35670:return pM;case 35667:case 35671:return mM;case 35668:case 35672:return gM;case 35669:case 35673:return _M;case 35678:case 36198:case 36298:case 36306:case 35682:return SM;case 35680:case 36300:case 36308:case 36293:return TM}}function AM(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=dM(e.type)}function Cf(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=EM(e.type)}Cf.prototype.updateCache=function(n){let e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),on(e,n)};function Lf(n){this.id=n,this.seq=[],this.map={}}Lf.prototype.setValue=function(n,e,t){let i=this.seq;for(let r=0,s=i.length;r!==s;++r){let o=i[r];o.setValue(n,e[o.id],t)}};var mu=/(\w+)(\])?(\[|\.)?/g;function Rf(n,e){n.seq.push(e),n.map[e.id]=e}function CM(n,e,t){let i=n.name,r=i.length;for(mu.lastIndex=0;;){let s=mu.exec(i),o=mu.lastIndex,a=s[1],c=s[2]==="]",u=s[3];if(c&&(a=a|0),u===void 0||u==="["&&o+2===r){Rf(t,u===void 0?new AM(a,n,e):new Cf(a,n,e));break}else{let f=t.map[a];f===void 0&&(f=new Lf(a),Rf(t,f)),t=f}}}function Zi(n,e){this.seq=[],this.map={};let t=n.getProgramParameter(e,35718);for(let i=0;i<t;++i){let r=n.getActiveUniform(e,i),s=n.getUniformLocation(e,r.name);CM(r,s,this)}}Zi.prototype.setValue=function(n,e,t,i){let r=this.map[e];r!==void 0&&r.setValue(n,t,i)};Zi.prototype.setOptional=function(n,e,t){let i=e[t];i!==void 0&&this.setValue(n,t,i)};Zi.upload=function(n,e,t,i){for(let r=0,s=e.length;r!==s;++r){let o=e[r],a=t[o.id];a.needsUpdate!==!1&&o.setValue(n,a.value,i)}};Zi.seqWithValue=function(n,e){let t=[];for(let i=0,r=n.length;i!==r;++i){let s=n[i];s.id in e&&t.push(s)}return t};function Pf(n,e,t){let i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}var LM=0;function RM(n){let e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function If(n){switch(n){case xo:return["Linear","( value )"];case jn:return["sRGB","( value )"];case U0:return["RGBE","( value )"];case V0:return["RGBM","( value, 7.0 )"];case W0:return["RGBM","( value, 16.0 )"];case j0:return["RGBD","( value, 256.0 )"];case H0:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case G0:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function Of(n,e,t){let i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";let s=n.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+r+RM(s)}function Po(n,e){let t=If(e);return"vec4 "+n+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function PM(n,e){let t=If(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function IM(n,e){let t;switch(e){case Oa:t="Linear";break;case Da:t="Reinhard";break;case Fa:t="OptimizedCineon";break;case go:t="ACESFilmic";break;case Wy:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function OM(n){return[n.extensionDerivatives||n.envMapCubeUV||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Io).join(`
`)}function DM(n){let e=[];for(let t in n){let i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function FM(n,e){let t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){let o=n.getActiveAttrib(e,r).name;t[o]=n.getAttribLocation(e,o)}return t}function Io(n){return n!==""}function Df(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ff(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var BM=/^[ \t]*#include +<([\w\d./]+)>/gm;function gu(n){return n.replace(BM,NM)}function NM(n,e){let t=ze[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return gu(t)}var kM=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,zM=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Nf(n){return n.replace(zM,Bf).replace(kM,HM)}function HM(n,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Bf(n,e,t,i)}function Bf(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function kf(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function UM(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Dd?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===Ra?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===fo&&(e="SHADOWMAP_TYPE_VSM"),e}function GM(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Pc:case Ic:e="ENVMAP_TYPE_CUBE";break;case Oc:case Dc:e="ENVMAP_TYPE_CUBE_UV";break}return e}function VM(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Ic:case Dc:e="ENVMAP_MODE_REFRACTION";break}return e}function WM(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Ia:e="ENVMAP_BLENDING_MULTIPLY";break;case Gy:e="ENVMAP_BLENDING_MIX";break;case Vy:e="ENVMAP_BLENDING_ADD";break}return e}function jM(n,e,t,i){let r=n.getContext(),s=t.defines,o=t.vertexShader,a=t.fragmentShader,c=UM(t),u=GM(t),d=VM(t),f=WM(t),l=n.gammaFactor>0?n.gammaFactor:1,h=t.isWebGL2?"":OM(t),p=DM(s),m=r.createProgram(),v,_,g=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[p].filter(Io).join(`
`),v.length>0&&(v+=`
`),_=[h,p].filter(Io).join(`
`),_.length>0&&(_+=`
`)):(v=[kf(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+l,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Io).join(`
`),_=[h,kf(t),"#define SHADER_NAME "+t.shaderName,p,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+l,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ni?"#define TONE_MAPPING":"",t.toneMapping!==Ni?ze.tonemapping_pars_fragment:"",t.toneMapping!==Ni?IM("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",ze.encodings_pars_fragment,t.map?Po("mapTexelToLinear",t.mapEncoding):"",t.matcap?Po("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Po("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Po("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?Po("lightMapTexelToLinear",t.lightMapEncoding):"",PM("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Io).join(`
`)),o=gu(o),o=Df(o,t),o=Ff(o,t),a=gu(a),a=Df(a,t),a=Ff(a,t),o=Nf(o),a=Nf(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(g=`#version 300 es
`,v=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,_=["#define varying in",t.glslVersion===rf?"":"out highp vec4 pc_fragColor;",t.glslVersion===rf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);let y=g+v+o,b=g+_+a,w=Pf(r,35633,y),x=Pf(r,35632,b);if(r.attachShader(m,w),r.attachShader(m,x),t.index0AttributeName!==void 0?r.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),n.debug.checkShaderErrors){let T=r.getProgramInfoLog(m).trim(),I=r.getShaderInfoLog(w).trim(),U=r.getShaderInfoLog(x).trim(),W=!0,D=!0;if(r.getProgramParameter(m,35714)===!1){W=!1;let L=Of(r,w,"vertex"),O=Of(r,x,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(m,35715),"gl.getProgramInfoLog",T,L,O)}else T!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",T):(I===""||U==="")&&(D=!1);D&&(this.diagnostics={runnable:W,programLog:T,vertexShader:{log:I,prefix:v},fragmentShader:{log:U,prefix:_}})}r.deleteShader(w),r.deleteShader(x);let S;this.getUniforms=function(){return S===void 0&&(S=new Zi(r,m)),S};let P;return this.getAttributes=function(){return P===void 0&&(P=FM(r,m)),P},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=LM++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=x,this}function qM(n,e,t,i,r,s){let o=[],a=i.isWebGL2,c=i.logarithmicDepthBuffer,u=i.floatVertexTextures,d=i.maxVertexUniforms,f=i.vertexTextures,l=i.precision,h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(x){let P=x.skeleton.bones;if(u)return 1024;{let I=Math.floor((d-20)/4),U=Math.min(I,P.length);return U<P.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+P.length+" bones. This GPU supports "+U+"."),0):U}}function v(x){let S;return x&&x.isTexture?S=x.encoding:x&&x.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),S=x.texture.encoding):S=xo,S}function _(x,S,P,T,I){let U=T.fog,W=x.isMeshStandardMaterial?T.environment:null,D=e.get(x.envMap||W),L=h[x.type],O=I.isSkinnedMesh?m(I):0;x.precision!==null&&(l=i.getMaxPrecision(x.precision),l!==x.precision&&console.warn("THREE.WebGLProgram.getParameters:",x.precision,"not supported, using",l,"instead."));let F,Z;if(L){let ge=Jn[L];F=ge.vertexShader,Z=ge.fragmentShader}else F=x.vertexShader,Z=x.fragmentShader;let ee=n.getRenderTarget();return{isWebGL2:a,shaderID:L,shaderName:x.type,vertexShader:F,fragmentShader:Z,defines:x.defines,isRawShaderMaterial:x.isRawShaderMaterial===!0,glslVersion:x.glslVersion,precision:l,instancing:I.isInstancedMesh===!0,instancingColor:I.isInstancedMesh===!0&&I.instanceColor!==null,supportsVertexTextures:f,outputEncoding:ee!==null?v(ee.texture):n.outputEncoding,map:!!x.map,mapEncoding:v(x.map),matcap:!!x.matcap,matcapEncoding:v(x.matcap),envMap:!!D,envMapMode:D&&D.mapping,envMapEncoding:v(D),envMapCubeUV:!!D&&(D.mapping===Oc||D.mapping===Dc),lightMap:!!x.lightMap,lightMapEncoding:v(x.lightMap),aoMap:!!x.aoMap,emissiveMap:!!x.emissiveMap,emissiveMapEncoding:v(x.emissiveMap),bumpMap:!!x.bumpMap,normalMap:!!x.normalMap,objectSpaceNormalMap:x.normalMapType===Y0,tangentSpaceNormalMap:x.normalMapType===zi,clearcoatMap:!!x.clearcoatMap,clearcoatRoughnessMap:!!x.clearcoatRoughnessMap,clearcoatNormalMap:!!x.clearcoatNormalMap,displacementMap:!!x.displacementMap,roughnessMap:!!x.roughnessMap,metalnessMap:!!x.metalnessMap,specularMap:!!x.specularMap,alphaMap:!!x.alphaMap,gradientMap:!!x.gradientMap,sheen:!!x.sheen,transmissionMap:!!x.transmissionMap,combine:x.combine,vertexTangents:x.normalMap&&x.vertexTangents,vertexColors:x.vertexColors,vertexUvs:!!x.map||!!x.bumpMap||!!x.normalMap||!!x.specularMap||!!x.alphaMap||!!x.emissiveMap||!!x.roughnessMap||!!x.metalnessMap||!!x.clearcoatMap||!!x.clearcoatRoughnessMap||!!x.clearcoatNormalMap||!!x.displacementMap||!!x.transmissionMap,uvsVertexOnly:!(!!x.map||!!x.bumpMap||!!x.normalMap||!!x.specularMap||!!x.alphaMap||!!x.emissiveMap||!!x.roughnessMap||!!x.metalnessMap||!!x.clearcoatNormalMap||!!x.transmissionMap)&&!!x.displacementMap,fog:!!U,useFog:x.fog,fogExp2:U&&U.isFogExp2,flatShading:x.flatShading,sizeAttenuation:x.sizeAttenuation,logarithmicDepthBuffer:c,skinning:x.skinning&&O>0,maxBones:O,useVertexTexture:u,morphTargets:x.morphTargets,morphNormals:x.morphNormals,maxMorphTargets:n.maxMorphTargets,maxMorphNormals:n.maxMorphNormals,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:x.dithering,shadowMapEnabled:n.shadowMap.enabled&&P.length>0,shadowMapType:n.shadowMap.type,toneMapping:x.toneMapped?n.toneMapping:Ni,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:x.premultipliedAlpha,alphaTest:x.alphaTest,doubleSided:x.side===mr,flipSided:x.side===Tt,depthPacking:x.depthPacking!==void 0?x.depthPacking:!1,index0AttributeName:x.index0AttributeName,extensionDerivatives:x.extensions&&x.extensions.derivatives,extensionFragDepth:x.extensions&&x.extensions.fragDepth,extensionDrawBuffers:x.extensions&&x.extensions.drawBuffers,extensionShaderTextureLOD:x.extensions&&x.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||t.has("EXT_shader_texture_lod"),customProgramCacheKey:x.customProgramCacheKey()}}function g(x){let S=[];if(x.shaderID?S.push(x.shaderID):(S.push(x.fragmentShader),S.push(x.vertexShader)),x.defines!==void 0)for(let P in x.defines)S.push(P),S.push(x.defines[P]);if(x.isRawShaderMaterial===!1){for(let P=0;P<p.length;P++)S.push(x[p[P]]);S.push(n.outputEncoding),S.push(n.gammaFactor)}return S.push(x.customProgramCacheKey),S.join()}function y(x){let S=h[x.type],P;if(S){let T=Jn[S];P=hs.clone(T.uniforms)}else P=x.uniforms;return P}function b(x,S){let P;for(let T=0,I=o.length;T<I;T++){let U=o[T];if(U.cacheKey===S){P=U,++P.usedTimes;break}}return P===void 0&&(P=new jM(n,S,x,r),o.push(P)),P}function w(x){if(--x.usedTimes==0){let S=o.indexOf(x);o[S]=o[o.length-1],o.pop(),x.destroy()}}return{getParameters:_,getProgramCacheKey:g,getUniforms:y,acquireProgram:b,releaseProgram:w,programs:o}}function XM(){let n=new WeakMap;function e(s){let o=n.get(s);return o===void 0&&(o={},n.set(s,o)),o}function t(s){n.delete(s)}function i(s,o,a){n.get(s)[o]=a}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function YM(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.program!==e.program?n.program.id-e.program.id:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function ZM(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function zf(n){let e=[],t=0,i=[],r=[],s={id:-1};function o(){t=0,i.length=0,r.length=0}function a(l,h,p,m,v,_){let g=e[t],y=n.get(p);return g===void 0?(g={id:l.id,object:l,geometry:h,material:p,program:y.program||s,groupOrder:m,renderOrder:l.renderOrder,z:v,group:_},e[t]=g):(g.id=l.id,g.object=l,g.geometry=h,g.material=p,g.program=y.program||s,g.groupOrder=m,g.renderOrder=l.renderOrder,g.z=v,g.group=_),t++,g}function c(l,h,p,m,v,_){let g=a(l,h,p,m,v,_);(p.transparent===!0?r:i).push(g)}function u(l,h,p,m,v,_){let g=a(l,h,p,m,v,_);(p.transparent===!0?r:i).unshift(g)}function d(l,h){i.length>1&&i.sort(l||YM),r.length>1&&r.sort(h||ZM)}function f(){for(let l=t,h=e.length;l<h;l++){let p=e[l];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.program=null,p.group=null}}return{opaque:i,transparent:r,init:o,push:c,unshift:u,finish:f,sort:d}}function JM(n){let e=new WeakMap;function t(r,s){let o=e.get(r),a;return o===void 0?(a=new zf(n),e.set(r,new WeakMap),e.get(r).set(s,a)):(a=o.get(s),a===void 0&&(a=new zf(n),o.set(s,a))),a}function i(){e=new WeakMap}return{get:t,dispose:i}}function KM(){let n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new k,color:new Me};break;case"SpotLight":t={position:new k,direction:new k,color:new Me,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new k,color:new Me,distance:0,decay:0};break;case"HemisphereLight":t={direction:new k,skyColor:new Me,groundColor:new Me};break;case"RectAreaLight":t={color:new Me,position:new k,halfWidth:new k,halfHeight:new k};break}return n[e.id]=t,t}}}function $M(){let n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ae};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ae};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ae,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}var QM=0;function eS(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function tS(n,e){let t=new KM,i=$M(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let d=0;d<9;d++)r.probe.push(new k);let s=new k,o=new Fe,a=new Fe;function c(d){let f=0,l=0,h=0;for(let S=0;S<9;S++)r.probe[S].set(0,0,0);let p=0,m=0,v=0,_=0,g=0,y=0,b=0,w=0;d.sort(eS);for(let S=0,P=d.length;S<P;S++){let T=d[S],I=T.color,U=T.intensity,W=T.distance,D=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)f+=I.r*U,l+=I.g*U,h+=I.b*U;else if(T.isLightProbe)for(let L=0;L<9;L++)r.probe[L].addScaledVector(T.sh.coefficients[L],U);else if(T.isDirectionalLight){let L=t.get(T);if(L.color.copy(T.color).multiplyScalar(T.intensity),T.castShadow){let O=T.shadow,F=i.get(T);F.shadowBias=O.bias,F.shadowNormalBias=O.normalBias,F.shadowRadius=O.radius,F.shadowMapSize=O.mapSize,r.directionalShadow[p]=F,r.directionalShadowMap[p]=D,r.directionalShadowMatrix[p]=T.shadow.matrix,y++}r.directional[p]=L,p++}else if(T.isSpotLight){let L=t.get(T);if(L.position.setFromMatrixPosition(T.matrixWorld),L.color.copy(I).multiplyScalar(U),L.distance=W,L.coneCos=Math.cos(T.angle),L.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),L.decay=T.decay,T.castShadow){let O=T.shadow,F=i.get(T);F.shadowBias=O.bias,F.shadowNormalBias=O.normalBias,F.shadowRadius=O.radius,F.shadowMapSize=O.mapSize,r.spotShadow[v]=F,r.spotShadowMap[v]=D,r.spotShadowMatrix[v]=T.shadow.matrix,w++}r.spot[v]=L,v++}else if(T.isRectAreaLight){let L=t.get(T);L.color.copy(I).multiplyScalar(U),L.halfWidth.set(T.width*.5,0,0),L.halfHeight.set(0,T.height*.5,0),r.rectArea[_]=L,_++}else if(T.isPointLight){let L=t.get(T);if(L.color.copy(T.color).multiplyScalar(T.intensity),L.distance=T.distance,L.decay=T.decay,T.castShadow){let O=T.shadow,F=i.get(T);F.shadowBias=O.bias,F.shadowNormalBias=O.normalBias,F.shadowRadius=O.radius,F.shadowMapSize=O.mapSize,F.shadowCameraNear=O.camera.near,F.shadowCameraFar=O.camera.far,r.pointShadow[m]=F,r.pointShadowMap[m]=D,r.pointShadowMatrix[m]=T.shadow.matrix,b++}r.point[m]=L,m++}else if(T.isHemisphereLight){let L=t.get(T);L.skyColor.copy(T.color).multiplyScalar(U),L.groundColor.copy(T.groundColor).multiplyScalar(U),r.hemi[g]=L,g++}}_>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=ye.LTC_FLOAT_1,r.rectAreaLTC2=ye.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=ye.LTC_HALF_1,r.rectAreaLTC2=ye.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=f,r.ambient[1]=l,r.ambient[2]=h;let x=r.hash;(x.directionalLength!==p||x.pointLength!==m||x.spotLength!==v||x.rectAreaLength!==_||x.hemiLength!==g||x.numDirectionalShadows!==y||x.numPointShadows!==b||x.numSpotShadows!==w)&&(r.directional.length=p,r.spot.length=v,r.rectArea.length=_,r.point.length=m,r.hemi.length=g,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=b,r.pointShadowMap.length=b,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=b,r.spotShadowMatrix.length=w,x.directionalLength=p,x.pointLength=m,x.spotLength=v,x.rectAreaLength=_,x.hemiLength=g,x.numDirectionalShadows=y,x.numPointShadows=b,x.numSpotShadows=w,r.version=QM++)}function u(d,f){let l=0,h=0,p=0,m=0,v=0,_=f.matrixWorldInverse;for(let g=0,y=d.length;g<y;g++){let b=d[g];if(b.isDirectionalLight){let w=r.directional[l];w.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(_),l++}else if(b.isSpotLight){let w=r.spot[p];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(_),w.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(_),p++}else if(b.isRectAreaLight){let w=r.rectArea[m];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(_),a.identity(),o.copy(b.matrixWorld),o.premultiply(_),a.extractRotation(o),w.halfWidth.set(b.width*.5,0,0),w.halfHeight.set(0,b.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),m++}else if(b.isPointLight){let w=r.point[h];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(_),h++}else if(b.isHemisphereLight){let w=r.hemi[v];w.direction.setFromMatrixPosition(b.matrixWorld),w.direction.transformDirection(_),w.direction.normalize(),v++}}}return{setup:c,setupView:u,state:r}}function Hf(n,e){let t=new tS(n,e),i=[],r=[];function s(){i.length=0,r.length=0}function o(f){i.push(f)}function a(f){r.push(f)}function c(){t.setup(i)}function u(f){t.setupView(i,f)}return{init:s,state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:c,setupLightsView:u,pushLight:o,pushShadow:a}}function nS(n,e){let t=new WeakMap;function i(s,o=0){let a;return t.has(s)===!1?(a=new Hf(n,e),t.set(s,[]),t.get(s).push(a)):o>=t.get(s).length?(a=new Hf(n,e),t.get(s).push(a)):a=t.get(s)[o],a}function r(){t=new WeakMap}return{get:i,dispose:r}}function wr(n){Re.call(this),this.type="MeshDepthMaterial",this.depthPacking=q0,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(n)}wr.prototype=Object.create(Re.prototype);wr.prototype.constructor=wr;wr.prototype.isMeshDepthMaterial=!0;wr.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.depthPacking=n.depthPacking,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this};function Mr(n){Re.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new k,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(n)}Mr.prototype=Object.create(Re.prototype);Mr.prototype.constructor=Mr;Mr.prototype.isMeshDistanceMaterial=!0;Mr.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.referencePosition.copy(n.referencePosition),this.nearDistance=n.nearDistance,this.farDistance=n.farDistance,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this};var iS=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,rS=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function Uf(n,e,t){let i=new Co,r=new ae,s=new ae,o=new Ze,a=[],c=[],u={},d={0:Tt,1:di,2:mr},f=new nt({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new ae},radius:{value:4}},vertexShader:rS,fragmentShader:iS}),l=f.clone();l.defines.HORIZONTAL_PASS=1;let h=new We;h.setAttribute("position",new Oe(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let p=new ke(h,f),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Dd,this.render=function(w,x,S){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||w.length===0)return;let P=n.getRenderTarget(),T=n.getActiveCubeFace(),I=n.getActiveMipmapLevel(),U=n.state;U.setBlending(po),U.buffers.color.setClear(1,1,1,1),U.buffers.depth.setTest(!0),U.setScissorTest(!1);for(let W=0,D=w.length;W<D;W++){let L=w[W],O=L.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",L,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;r.copy(O.mapSize);let F=O.getFrameExtents();if(r.multiply(F),s.copy(O.mapSize),(r.x>t||r.y>t)&&(r.x>t&&(s.x=Math.floor(t/F.x),r.x=s.x*F.x,O.mapSize.x=s.x),r.y>t&&(s.y=Math.floor(t/F.y),r.y=s.y*F.y,O.mapSize.y=s.y)),O.map===null&&!O.isPointLightShadow&&this.type===fo){let ee={minFilter:Xe,magFilter:Xe,format:Et};O.map=new Nt(r.x,r.y,ee),O.map.texture.name=L.name+".shadowMap",O.mapPass=new Nt(r.x,r.y,ee),O.camera.updateProjectionMatrix()}if(O.map===null){let ee={minFilter:_t,magFilter:_t,format:Et};O.map=new Nt(r.x,r.y,ee),O.map.texture.name=L.name+".shadowMap",O.camera.updateProjectionMatrix()}n.setRenderTarget(O.map),n.clear();let Z=O.getViewportCount();for(let ee=0;ee<Z;ee++){let oe=O.getViewport(ee);o.set(s.x*oe.x,s.y*oe.y,s.x*oe.z,s.y*oe.w),U.viewport(o),O.updateMatrices(L,ee),i=O.getFrustum(),b(x,S,O.camera,L,this.type)}!O.isPointLightShadow&&this.type===fo&&v(O,S),O.needsUpdate=!1}m.needsUpdate=!1,n.setRenderTarget(P,T,I)};function v(w,x){let S=e.update(p);f.uniforms.shadow_pass.value=w.map.texture,f.uniforms.resolution.value=w.mapSize,f.uniforms.radius.value=w.radius,n.setRenderTarget(w.mapPass),n.clear(),n.renderBufferDirect(x,null,S,f,p,null),l.uniforms.shadow_pass.value=w.mapPass.texture,l.uniforms.resolution.value=w.mapSize,l.uniforms.radius.value=w.radius,n.setRenderTarget(w.map),n.clear(),n.renderBufferDirect(x,null,S,l,p,null)}function _(w,x,S){let P=w<<0|x<<1|S<<2,T=a[P];return T===void 0&&(T=new wr({depthPacking:X0,morphTargets:w,skinning:x}),a[P]=T),T}function g(w,x,S){let P=w<<0|x<<1|S<<2,T=c[P];return T===void 0&&(T=new Mr({morphTargets:w,skinning:x}),c[P]=T),T}function y(w,x,S,P,T,I,U){let W=null,D=_,L=w.customDepthMaterial;if(P.isPointLight===!0&&(D=g,L=w.customDistanceMaterial),L===void 0){let O=!1;S.morphTargets===!0&&(O=x.morphAttributes&&x.morphAttributes.position&&x.morphAttributes.position.length>0);let F=!1;w.isSkinnedMesh===!0&&(S.skinning===!0?F=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",w));let Z=w.isInstancedMesh===!0;W=D(O,F,Z)}else W=L;if(n.localClippingEnabled&&S.clipShadows===!0&&S.clippingPlanes.length!==0){let O=W.uuid,F=S.uuid,Z=u[O];Z===void 0&&(Z={},u[O]=Z);let ee=Z[F];ee===void 0&&(ee=W.clone(),Z[F]=ee),W=ee}return W.visible=S.visible,W.wireframe=S.wireframe,U===fo?W.side=S.shadowSide!==null?S.shadowSide:S.side:W.side=S.shadowSide!==null?S.shadowSide:d[S.side],W.clipShadows=S.clipShadows,W.clippingPlanes=S.clippingPlanes,W.clipIntersection=S.clipIntersection,W.wireframeLinewidth=S.wireframeLinewidth,W.linewidth=S.linewidth,P.isPointLight===!0&&W.isMeshDistanceMaterial===!0&&(W.referencePosition.setFromMatrixPosition(P.matrixWorld),W.nearDistance=T,W.farDistance=I),W}function b(w,x,S,P,T){if(w.visible===!1)return;if(w.layers.test(x.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&T===fo)&&(!w.frustumCulled||i.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,w.matrixWorld);let W=e.update(w),D=w.material;if(Array.isArray(D)){let L=W.groups;for(let O=0,F=L.length;O<F;O++){let Z=L[O],ee=D[Z.materialIndex];if(ee&&ee.visible){let oe=y(w,W,ee,P,S.near,S.far,T);n.renderBufferDirect(S,null,W,oe,w,Z)}}}else if(D.visible){let L=y(w,W,D,P,S.near,S.far,T);n.renderBufferDirect(S,null,W,L,w,null)}}let U=w.children;for(let W=0,D=U.length;W<D;W++)b(U[W],x,S,P,T)}}function sS(n,e,t){let i=t.isWebGL2;function r(){let q=!1,le=new Ze,fe=null,me=new Ze(0,0,0,0);return{setMask:function(he){fe!==he&&!q&&(n.colorMask(he,he,he,he),fe=he)},setLocked:function(he){q=he},setClear:function(he,j,pe,we,_e){_e===!0&&(he*=we,j*=we,pe*=we),le.set(he,j,pe,we),me.equals(le)===!1&&(n.clearColor(he,j,pe,we),me.copy(le))},reset:function(){q=!1,fe=null,me.set(-1,0,0,0)}}}function s(){let q=!1,le=null,fe=null,me=null;return{setTest:function(he){he?ge(2929):de(2929)},setMask:function(he){le!==he&&!q&&(n.depthMask(he),le=he)},setFunc:function(he){if(fe!==he){if(he)switch(he){case Fy:n.depthFunc(512);break;case By:n.depthFunc(519);break;case Ny:n.depthFunc(513);break;case Rc:n.depthFunc(515);break;case ky:n.depthFunc(514);break;case zy:n.depthFunc(518);break;case Hy:n.depthFunc(516);break;case Uy:n.depthFunc(517);break;default:n.depthFunc(515)}else n.depthFunc(515);fe=he}},setLocked:function(he){q=he},setClear:function(he){me!==he&&(n.clearDepth(he),me=he)},reset:function(){q=!1,le=null,fe=null,me=null}}}function o(){let q=!1,le=null,fe=null,me=null,he=null,j=null,pe=null,we=null,_e=null;return{setTest:function(Se){q||(Se?ge(2960):de(2960))},setMask:function(Se){le!==Se&&!q&&(n.stencilMask(Se),le=Se)},setFunc:function(Se,Pe,ot){(fe!==Se||me!==Pe||he!==ot)&&(n.stencilFunc(Se,Pe,ot),fe=Se,me=Pe,he=ot)},setOp:function(Se,Pe,ot){(j!==Se||pe!==Pe||we!==ot)&&(n.stencilOp(Se,Pe,ot),j=Se,pe=Pe,we=ot)},setLocked:function(Se){q=Se},setClear:function(Se){_e!==Se&&(n.clearStencil(Se),_e=Se)},reset:function(){q=!1,le=null,fe=null,me=null,he=null,j=null,pe=null,we=null,_e=null}}}let a=new r,c=new s,u=new o,d={},f=null,l=null,h=null,p=null,m=null,v=null,_=null,g=null,y=null,b=!1,w=null,x=null,S=null,P=null,T=null,I=n.getParameter(35661),U=!1,W=0,D=n.getParameter(7938);D.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(D)[1]),U=W>=1):D.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),U=W>=2);let L=null,O={},F=new Ze,Z=new Ze;function ee(q,le,fe){let me=new Uint8Array(4),he=n.createTexture();n.bindTexture(q,he),n.texParameteri(q,10241,9728),n.texParameteri(q,10240,9728);for(let j=0;j<fe;j++)n.texImage2D(le+j,0,6408,1,1,0,6408,5121,me);return he}let oe={};oe[3553]=ee(3553,3553,1),oe[34067]=ee(34067,34069,6),a.setClear(0,0,0,1),c.setClear(1),u.setClear(0),ge(2929),c.setFunc(Rc),M(!1),V(Od),ge(2884),re(po);function ge(q){d[q]!==!0&&(n.enable(q),d[q]=!0)}function de(q){d[q]!==!1&&(n.disable(q),d[q]=!1)}function ne(q){return f!==q?(n.useProgram(q),f=q,!0):!1}let Te={[Xr]:32774,[Sy]:32778,[Ty]:32779};if(i)Te[kd]=32775,Te[zd]=32776;else{let q=e.get("EXT_blend_minmax");q!==null&&(Te[kd]=q.MIN_EXT,Te[zd]=q.MAX_EXT)}let Ae={[Ey]:0,[Ay]:1,[Cy]:768,[Hd]:770,[Dy]:776,[Iy]:774,[Ry]:772,[Ly]:769,[Ud]:771,[Oy]:775,[Py]:773};function re(q,le,fe,me,he,j,pe,we){if(q===po){l&&(de(3042),l=!1);return}if(l||(ge(3042),l=!0),q!==My){if(q!==h||we!==b){if((p!==Xr||_!==Xr)&&(n.blendEquation(32774),p=Xr,_=Xr),we)switch(q){case mo:n.blendFuncSeparate(1,771,1,771);break;case Pa:n.blendFunc(1,1);break;case Bd:n.blendFuncSeparate(0,0,769,771);break;case Nd:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case mo:n.blendFuncSeparate(770,771,1,771);break;case Pa:n.blendFunc(770,1);break;case Bd:n.blendFunc(0,769);break;case Nd:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}m=null,v=null,g=null,y=null,h=q,b=we}return}he=he||le,j=j||fe,pe=pe||me,(le!==p||he!==_)&&(n.blendEquationSeparate(Te[le],Te[he]),p=le,_=he),(fe!==m||me!==v||j!==g||pe!==y)&&(n.blendFuncSeparate(Ae[fe],Ae[me],Ae[j],Ae[pe]),m=fe,v=me,g=j,y=pe),h=q,b=null}function C(q,le){q.side===mr?de(2884):ge(2884);let fe=q.side===Tt;le&&(fe=!fe),M(fe),q.blending===mo&&q.transparent===!1?re(po):re(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.premultipliedAlpha),c.setFunc(q.depthFunc),c.setTest(q.depthTest),c.setMask(q.depthWrite),a.setMask(q.colorWrite);let me=q.stencilWrite;u.setTest(me),me&&(u.setMask(q.stencilWriteMask),u.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),u.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),G(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits)}function M(q){w!==q&&(q?n.frontFace(2304):n.frontFace(2305),w=q)}function V(q){q!==by?(ge(2884),q!==x&&(q===Od?n.cullFace(1029):q===wy?n.cullFace(1028):n.cullFace(1032))):de(2884),x=q}function B(q){q!==S&&(U&&n.lineWidth(q),S=q)}function G(q,le,fe){q?(ge(32823),(P!==le||T!==fe)&&(n.polygonOffset(le,fe),P=le,T=fe)):de(32823)}function X(q){q?ge(3089):de(3089)}function z(q){q===void 0&&(q=33984+I-1),L!==q&&(n.activeTexture(q),L=q)}function H(q,le){L===null&&z();let fe=O[L];fe===void 0&&(fe={type:void 0,texture:void 0},O[L]=fe),(fe.type!==q||fe.texture!==le)&&(n.bindTexture(q,le||oe[q]),fe.type=q,fe.texture=le)}function Y(){let q=O[L];q!==void 0&&q.type!==void 0&&(n.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function K(){try{n.compressedTexImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function J(){try{n.texImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function A(){try{n.texImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function E(q){F.equals(q)===!1&&(n.scissor(q.x,q.y,q.z,q.w),F.copy(q))}function ie(q){Z.equals(q)===!1&&(n.viewport(q.x,q.y,q.z,q.w),Z.copy(q))}function $(){d={},L=null,O={},f=null,l=null,h=null,p=null,m=null,v=null,_=null,g=null,y=null,b=!1,w=null,x=null,S=null,P=null,T=null,a.reset(),c.reset(),u.reset()}return{buffers:{color:a,depth:c,stencil:u},enable:ge,disable:de,useProgram:ne,setBlending:re,setMaterial:C,setFlipSided:M,setCullFace:V,setLineWidth:B,setPolygonOffset:G,setScissorTest:X,activeTexture:z,bindTexture:H,unbindTexture:Y,compressedTexImage2D:K,texImage2D:J,texImage3D:A,scissor:E,viewport:ie,reset:$}}function oS(n,e,t,i,r,s,o){let a=r.isWebGL2,c=r.maxTextures,u=r.maxCubemapSize,d=r.maxTextureSize,f=r.maxSamples,l=new WeakMap,h,p=!1;try{p=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(A){}function m(A,E){return p?new OffscreenCanvas(A,E):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(A,E,ie,$){let q=1;if((A.width>$||A.height>$)&&(q=$/Math.max(A.width,A.height)),q<1||E===!0)if(typeof HTMLImageElement!="undefined"&&A instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&A instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&A instanceof ImageBitmap){let le=E?Ie.floorPowerOfTwo:Math.floor,fe=le(q*A.width),me=le(q*A.height);h===void 0&&(h=m(fe,me));let he=ie?m(fe,me):h;return he.width=fe,he.height=me,he.getContext("2d").drawImage(A,0,0,fe,me),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+A.width+"x"+A.height+") to ("+fe+"x"+me+")."),he}else return"data"in A&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+A.width+"x"+A.height+")."),A;return A}function _(A){return Ie.isPowerOfTwo(A.width)&&Ie.isPowerOfTwo(A.height)}function g(A){return a?!1:A.wrapS!==Wt||A.wrapT!==Wt||A.minFilter!==_t&&A.minFilter!==Xe}function y(A,E){return A.generateMipmaps&&E&&A.minFilter!==_t&&A.minFilter!==Xe}function b(A,E,ie,$){n.generateMipmap(A);let q=i.get(E);q.__maxMipLevel=Math.log(Math.max(ie,$))*Math.LOG2E}function w(A,E,ie){if(a===!1)return E;if(A!==null){if(n[A]!==void 0)return n[A];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+A+"'")}let $=E;return E===6403&&(ie===5126&&($=33326),ie===5131&&($=33325),ie===5121&&($=33321)),E===6407&&(ie===5126&&($=34837),ie===5131&&($=34843),ie===5121&&($=32849)),E===6408&&(ie===5126&&($=34836),ie===5131&&($=34842),ie===5121&&($=32856)),($===33325||$===33326||$===34842||$===34836)&&e.get("EXT_color_buffer_float"),$}function x(A){return A===_t||A===Ba||A===Na?9728:9729}function S(A){let E=A.target;E.removeEventListener("dispose",S),T(E),E.isVideoTexture&&l.delete(E),o.memory.textures--}function P(A){let E=A.target;E.removeEventListener("dispose",P),I(E),o.memory.textures--}function T(A){let E=i.get(A);E.__webglInit!==void 0&&(n.deleteTexture(E.__webglTexture),i.remove(A))}function I(A){let E=i.get(A),ie=i.get(A.texture);if(!!A){if(ie.__webglTexture!==void 0&&n.deleteTexture(ie.__webglTexture),A.depthTexture&&A.depthTexture.dispose(),A.isWebGLCubeRenderTarget)for(let $=0;$<6;$++)n.deleteFramebuffer(E.__webglFramebuffer[$]),E.__webglDepthbuffer&&n.deleteRenderbuffer(E.__webglDepthbuffer[$]);else n.deleteFramebuffer(E.__webglFramebuffer),E.__webglDepthbuffer&&n.deleteRenderbuffer(E.__webglDepthbuffer),E.__webglMultisampledFramebuffer&&n.deleteFramebuffer(E.__webglMultisampledFramebuffer),E.__webglColorRenderbuffer&&n.deleteRenderbuffer(E.__webglColorRenderbuffer),E.__webglDepthRenderbuffer&&n.deleteRenderbuffer(E.__webglDepthRenderbuffer);i.remove(A.texture),i.remove(A)}}let U=0;function W(){U=0}function D(){let A=U;return A>=c&&console.warn("THREE.WebGLTextures: Trying to use "+A+" texture units while this GPU supports only "+c),U+=1,A}function L(A,E){let ie=i.get(A);if(A.isVideoTexture&&z(A),A.version>0&&ie.__version!==A.version){let $=A.image;if($===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if($.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ne(ie,A,E);return}}t.activeTexture(33984+E),t.bindTexture(3553,ie.__webglTexture)}function O(A,E){let ie=i.get(A);if(A.version>0&&ie.__version!==A.version){ne(ie,A,E);return}t.activeTexture(33984+E),t.bindTexture(35866,ie.__webglTexture)}function F(A,E){let ie=i.get(A);if(A.version>0&&ie.__version!==A.version){ne(ie,A,E);return}t.activeTexture(33984+E),t.bindTexture(32879,ie.__webglTexture)}function Z(A,E){let ie=i.get(A);if(A.version>0&&ie.__version!==A.version){Te(ie,A,E);return}t.activeTexture(33984+E),t.bindTexture(34067,ie.__webglTexture)}let ee={[gr]:10497,[Wt]:33071,[_o]:33648},oe={[_t]:9728,[Ba]:9984,[Na]:9986,[Xe]:9729,[Fc]:9985,[_r]:9987};function ge(A,E,ie){ie?(n.texParameteri(A,10242,ee[E.wrapS]),n.texParameteri(A,10243,ee[E.wrapT]),(A===32879||A===35866)&&n.texParameteri(A,32882,ee[E.wrapR]),n.texParameteri(A,10240,oe[E.magFilter]),n.texParameteri(A,10241,oe[E.minFilter])):(n.texParameteri(A,10242,33071),n.texParameteri(A,10243,33071),(A===32879||A===35866)&&n.texParameteri(A,32882,33071),(E.wrapS!==Wt||E.wrapT!==Wt)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(A,10240,x(E.magFilter)),n.texParameteri(A,10241,x(E.minFilter)),E.minFilter!==_t&&E.minFilter!==Xe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));let $=e.get("EXT_texture_filter_anisotropic");if($){if(E.type===ki&&e.get("OES_texture_float_linear")===null||E.type===Ha&&(a||e.get("OES_texture_half_float_linear"))===null)return;(E.anisotropy>1||i.get(E).__currentAnisotropy)&&(n.texParameterf(A,$.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(E.anisotropy,r.getMaxAnisotropy())),i.get(E).__currentAnisotropy=E.anisotropy)}}function de(A,E){A.__webglInit===void 0&&(A.__webglInit=!0,E.addEventListener("dispose",S),A.__webglTexture=n.createTexture(),o.memory.textures++)}function ne(A,E,ie){let $=3553;E.isDataTexture2DArray&&($=35866),E.isDataTexture3D&&($=32879),de(A,E),t.activeTexture(33984+ie),t.bindTexture($,A.__webglTexture),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment);let q=g(E)&&_(E.image)===!1,le=v(E.image,q,!1,d),fe=_(le)||a,me=s.convert(E.format),he=s.convert(E.type),j=w(E.internalFormat,me,he);ge($,E,fe);let pe,we=E.mipmaps;if(E.isDepthTexture)j=6402,a?E.type===ki?j=36012:E.type===za?j=33190:E.type===vo?j=35056:j=33189:E.type===ki&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),E.format===Yr&&j===6402&&E.type!==ka&&E.type!==za&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),E.type=ka,he=s.convert(E.type)),E.format===yo&&j===6402&&(j=34041,E.type!==vo&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),E.type=vo,he=s.convert(E.type))),t.texImage2D(3553,0,j,le.width,le.height,0,me,he,null);else if(E.isDataTexture)if(we.length>0&&fe){for(let _e=0,Se=we.length;_e<Se;_e++)pe=we[_e],t.texImage2D(3553,_e,j,pe.width,pe.height,0,me,he,pe.data);E.generateMipmaps=!1,A.__maxMipLevel=we.length-1}else t.texImage2D(3553,0,j,le.width,le.height,0,me,he,le.data),A.__maxMipLevel=0;else if(E.isCompressedTexture){for(let _e=0,Se=we.length;_e<Se;_e++)pe=we[_e],E.format!==Et&&E.format!==fi?me!==null?t.compressedTexImage2D(3553,_e,j,pe.width,pe.height,0,pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,_e,j,pe.width,pe.height,0,me,he,pe.data);A.__maxMipLevel=we.length-1}else if(E.isDataTexture2DArray)t.texImage3D(35866,0,j,le.width,le.height,le.depth,0,me,he,le.data),A.__maxMipLevel=0;else if(E.isDataTexture3D)t.texImage3D(32879,0,j,le.width,le.height,le.depth,0,me,he,le.data),A.__maxMipLevel=0;else if(we.length>0&&fe){for(let _e=0,Se=we.length;_e<Se;_e++)pe=we[_e],t.texImage2D(3553,_e,j,me,he,pe);E.generateMipmaps=!1,A.__maxMipLevel=we.length-1}else t.texImage2D(3553,0,j,me,he,le),A.__maxMipLevel=0;y(E,fe)&&b($,E,le.width,le.height),A.__version=E.version,E.onUpdate&&E.onUpdate(E)}function Te(A,E,ie){if(E.image.length!==6)return;de(A,E),t.activeTexture(33984+ie),t.bindTexture(34067,A.__webglTexture),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment);let $=E&&(E.isCompressedTexture||E.image[0].isCompressedTexture),q=E.image[0]&&E.image[0].isDataTexture,le=[];for(let _e=0;_e<6;_e++)!$&&!q?le[_e]=v(E.image[_e],!1,!0,u):le[_e]=q?E.image[_e].image:E.image[_e];let fe=le[0],me=_(fe)||a,he=s.convert(E.format),j=s.convert(E.type),pe=w(E.internalFormat,he,j);ge(34067,E,me);let we;if($){for(let _e=0;_e<6;_e++){we=le[_e].mipmaps;for(let Se=0;Se<we.length;Se++){let Pe=we[Se];E.format!==Et&&E.format!==fi?he!==null?t.compressedTexImage2D(34069+_e,Se,pe,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+_e,Se,pe,Pe.width,Pe.height,0,he,j,Pe.data)}}A.__maxMipLevel=we.length-1}else{we=E.mipmaps;for(let _e=0;_e<6;_e++)if(q){t.texImage2D(34069+_e,0,pe,le[_e].width,le[_e].height,0,he,j,le[_e].data);for(let Se=0;Se<we.length;Se++){let ot=we[Se].image[_e].image;t.texImage2D(34069+_e,Se+1,pe,ot.width,ot.height,0,he,j,ot.data)}}else{t.texImage2D(34069+_e,0,pe,he,j,le[_e]);for(let Se=0;Se<we.length;Se++){let Pe=we[Se];t.texImage2D(34069+_e,Se+1,pe,he,j,Pe.image[_e])}}A.__maxMipLevel=we.length}y(E,me)&&b(34067,E,fe.width,fe.height),A.__version=E.version,E.onUpdate&&E.onUpdate(E)}function Ae(A,E,ie,$){let q=s.convert(E.texture.format),le=s.convert(E.texture.type),fe=w(E.texture.internalFormat,q,le);t.texImage2D($,0,fe,E.width,E.height,0,q,le,null),n.bindFramebuffer(36160,A),n.framebufferTexture2D(36160,ie,$,i.get(E.texture).__webglTexture,0),n.bindFramebuffer(36160,null)}function re(A,E,ie){if(n.bindRenderbuffer(36161,A),E.depthBuffer&&!E.stencilBuffer){let $=33189;if(ie){let q=E.depthTexture;q&&q.isDepthTexture&&(q.type===ki?$=36012:q.type===za&&($=33190));let le=X(E);n.renderbufferStorageMultisample(36161,le,$,E.width,E.height)}else n.renderbufferStorage(36161,$,E.width,E.height);n.framebufferRenderbuffer(36160,36096,36161,A)}else if(E.depthBuffer&&E.stencilBuffer){if(ie){let $=X(E);n.renderbufferStorageMultisample(36161,$,35056,E.width,E.height)}else n.renderbufferStorage(36161,34041,E.width,E.height);n.framebufferRenderbuffer(36160,33306,36161,A)}else{let $=s.convert(E.texture.format),q=s.convert(E.texture.type),le=w(E.texture.internalFormat,$,q);if(ie){let fe=X(E);n.renderbufferStorageMultisample(36161,fe,le,E.width,E.height)}else n.renderbufferStorage(36161,le,E.width,E.height)}n.bindRenderbuffer(36161,null)}function C(A,E){if(E&&E.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,A),!(E.depthTexture&&E.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(E.depthTexture).__webglTexture||E.depthTexture.image.width!==E.width||E.depthTexture.image.height!==E.height)&&(E.depthTexture.image.width=E.width,E.depthTexture.image.height=E.height,E.depthTexture.needsUpdate=!0),L(E.depthTexture,0);let $=i.get(E.depthTexture).__webglTexture;if(E.depthTexture.format===Yr)n.framebufferTexture2D(36160,36096,3553,$,0);else if(E.depthTexture.format===yo)n.framebufferTexture2D(36160,33306,3553,$,0);else throw new Error("Unknown depthTexture format")}function M(A){let E=i.get(A),ie=A.isWebGLCubeRenderTarget===!0;if(A.depthTexture){if(ie)throw new Error("target.depthTexture not supported in Cube render targets");C(E.__webglFramebuffer,A)}else if(ie){E.__webglDepthbuffer=[];for(let $=0;$<6;$++)n.bindFramebuffer(36160,E.__webglFramebuffer[$]),E.__webglDepthbuffer[$]=n.createRenderbuffer(),re(E.__webglDepthbuffer[$],A,!1)}else n.bindFramebuffer(36160,E.__webglFramebuffer),E.__webglDepthbuffer=n.createRenderbuffer(),re(E.__webglDepthbuffer,A,!1);n.bindFramebuffer(36160,null)}function V(A){let E=i.get(A),ie=i.get(A.texture);A.addEventListener("dispose",P),ie.__webglTexture=n.createTexture(),o.memory.textures++;let $=A.isWebGLCubeRenderTarget===!0,q=A.isWebGLMultisampleRenderTarget===!0,le=_(A)||a;if(a&&A.texture.format===fi&&(A.texture.type===ki||A.texture.type===Ha)&&(A.texture.format=Et,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),$){E.__webglFramebuffer=[];for(let fe=0;fe<6;fe++)E.__webglFramebuffer[fe]=n.createFramebuffer()}else if(E.__webglFramebuffer=n.createFramebuffer(),q)if(a){E.__webglMultisampledFramebuffer=n.createFramebuffer(),E.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,E.__webglColorRenderbuffer);let fe=s.convert(A.texture.format),me=s.convert(A.texture.type),he=w(A.texture.internalFormat,fe,me),j=X(A);n.renderbufferStorageMultisample(36161,j,he,A.width,A.height),n.bindFramebuffer(36160,E.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,E.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),A.depthBuffer&&(E.__webglDepthRenderbuffer=n.createRenderbuffer(),re(E.__webglDepthRenderbuffer,A,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if($){t.bindTexture(34067,ie.__webglTexture),ge(34067,A.texture,le);for(let fe=0;fe<6;fe++)Ae(E.__webglFramebuffer[fe],A,36064,34069+fe);y(A.texture,le)&&b(34067,A.texture,A.width,A.height),t.bindTexture(34067,null)}else t.bindTexture(3553,ie.__webglTexture),ge(3553,A.texture,le),Ae(E.__webglFramebuffer,A,36064,3553),y(A.texture,le)&&b(3553,A.texture,A.width,A.height),t.bindTexture(3553,null);A.depthBuffer&&M(A)}function B(A){let E=A.texture,ie=_(A)||a;if(y(E,ie)){let $=A.isWebGLCubeRenderTarget?34067:3553,q=i.get(E).__webglTexture;t.bindTexture($,q),b($,E,A.width,A.height),t.bindTexture($,null)}}function G(A){if(A.isWebGLMultisampleRenderTarget)if(a){let E=i.get(A);n.bindFramebuffer(36008,E.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,E.__webglFramebuffer);let ie=A.width,$=A.height,q=16384;A.depthBuffer&&(q|=256),A.stencilBuffer&&(q|=1024),n.blitFramebuffer(0,0,ie,$,0,0,ie,$,q,9728),n.bindFramebuffer(36160,E.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function X(A){return a&&A.isWebGLMultisampleRenderTarget?Math.min(f,A.samples):0}function z(A){let E=o.render.frame;l.get(A)!==E&&(l.set(A,E),A.update())}let H=!1,Y=!1;function K(A,E){A&&A.isWebGLRenderTarget&&(H===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),H=!0),A=A.texture),L(A,E)}function J(A,E){A&&A.isWebGLCubeRenderTarget&&(Y===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Y=!0),A=A.texture),Z(A,E)}this.allocateTextureUnit=D,this.resetTextureUnits=W,this.setTexture2D=L,this.setTexture2DArray=O,this.setTexture3D=F,this.setTextureCube=Z,this.setupRenderTarget=V,this.updateRenderTargetMipmap=B,this.updateMultisampleRenderTarget=G,this.safeSetTexture2D=K,this.safeSetTextureCube=J}function aS(n,e,t){let i=t.isWebGL2;function r(s){let o;if(s===Bc)return 5121;if(s===Yy)return 32819;if(s===Zy)return 32820;if(s===Jy)return 33635;if(s===jy)return 5120;if(s===qy)return 5122;if(s===ka)return 5123;if(s===Xy)return 5124;if(s===za)return 5125;if(s===ki)return 5126;if(s===Ha)return i?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===Ky)return 6406;if(s===fi)return 6407;if(s===Et)return 6408;if(s===$y)return 6409;if(s===Qy)return 6410;if(s===Yr)return 6402;if(s===yo)return 34041;if(s===e0)return 6403;if(s===t0)return 36244;if(s===n0)return 33319;if(s===i0)return 33320;if(s===r0)return 36248;if(s===s0)return 36249;if(s===jd||s===qd||s===Xd||s===Yd)if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===jd)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===qd)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Xd)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===Yd)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Zd||s===Jd||s===Kd||s===$d)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===Zd)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===Jd)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Kd)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===$d)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===o0)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if((s===Qd||s===ef)&&(o=e.get("WEBGL_compressed_texture_etc"),o!==null)){if(s===Qd)return o.COMPRESSED_RGB8_ETC2;if(s===ef)return o.COMPRESSED_RGBA8_ETC2_EAC}if(s===a0||s===l0||s===c0||s===u0||s===h0||s===d0||s===f0||s===p0||s===m0||s===g0||s===_0||s===v0||s===y0||s===x0||s===w0||s===M0||s===S0||s===T0||s===E0||s===A0||s===C0||s===L0||s===R0||s===P0||s===I0||s===O0||s===D0||s===F0)return o=e.get("WEBGL_compressed_texture_astc"),o!==null?s:null;if(s===b0)return o=e.get("EXT_texture_compression_bptc"),o!==null?s:null;if(s===vo)return i?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:r}}function _u(n=[]){ut.call(this),this.cameras=n}_u.prototype=Object.assign(Object.create(ut.prototype),{constructor:_u,isArrayCamera:!0});function an(){Ce.call(this),this.type="Group"}an.prototype=Object.assign(Object.create(Ce.prototype),{constructor:an,isGroup:!0});function Oo(){this._targetRay=null,this._grip=null,this._hand=null}Object.assign(Oo.prototype,{constructor:Oo,getHandSpace:function(){return this._hand===null&&(this._hand=new an,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new an,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new an,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(n){return this._targetRay!==null&&this._targetRay.dispatchEvent(n),this._grip!==null&&this._grip.dispatchEvent(n),this._hand!==null&&this._hand.dispatchEvent(n),this},disconnect:function(n){return this.dispatchEvent({type:"disconnected",data:n}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(n,e,t){let i=null,r=null,s=null,o=this._targetRay,a=this._grip,c=this._hand;if(n&&e.session.visibilityState!=="visible-blurred")if(c&&n.hand){s=!0;for(let p of n.hand.values()){let m=e.getJointPose(p,t);if(c.joints[p.jointName]===void 0){let _=new an;_.matrixAutoUpdate=!1,_.visible=!1,c.joints[p.jointName]=_,c.add(_)}let v=c.joints[p.jointName];m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=m.radius),v.visible=m!==null}let u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=u.position.distanceTo(d.position),l=.02,h=.005;c.inputState.pinching&&f>l+h?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:n.handedness,target:this})):!c.inputState.pinching&&f<=l-h&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:n.handedness,target:this}))}else o!==null&&(i=e.getPose(n.targetRaySpace,t),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),a!==null&&n.gripSpace&&(r=e.getPose(n.gripSpace,t),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return o!==null&&(o.visible=i!==null),a!==null&&(a.visible=r!==null),c!==null&&(c.visible=s!==null),this}});function Gf(n,e){let t=this,i=null,r=1,s=null,o="local-floor",a=null,c=[],u=new Map,d=new ut;d.layers.enable(1),d.viewport=new Ze;let f=new ut;f.layers.enable(2),f.viewport=new Ze;let l=[d,f],h=new _u;h.layers.enable(1),h.layers.enable(2);let p=null,m=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(I){let U=c[I];return U===void 0&&(U=new Oo,c[I]=U),U.getTargetRaySpace()},this.getControllerGrip=function(I){let U=c[I];return U===void 0&&(U=new Oo,c[I]=U),U.getGripSpace()},this.getHand=function(I){let U=c[I];return U===void 0&&(U=new Oo,c[I]=U),U.getHandSpace()};function v(I){let U=u.get(I.inputSource);U&&U.dispatchEvent({type:I.type,data:I.inputSource})}function _(){u.forEach(function(I,U){I.disconnect(U)}),u.clear(),p=null,m=null,n.setFramebuffer(null),n.setRenderTarget(n.getRenderTarget()),T.stop(),t.isPresenting=!1,t.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(I){r=I,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(I){o=I,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return i},this.setSession=async function(I){if(i=I,i!==null){i.addEventListener("select",v),i.addEventListener("selectstart",v),i.addEventListener("selectend",v),i.addEventListener("squeeze",v),i.addEventListener("squeezestart",v),i.addEventListener("squeezeend",v),i.addEventListener("end",_),i.addEventListener("inputsourceschange",g);let U=e.getContextAttributes();U.xrCompatible!==!0&&await e.makeXRCompatible();let W={antialias:U.antialias,alpha:U.alpha,depth:U.depth,stencil:U.stencil,framebufferScaleFactor:r},D=new XRWebGLLayer(i,e,W);i.updateRenderState({baseLayer:D}),s=await i.requestReferenceSpace(o),T.setContext(i),T.start(),t.isPresenting=!0,t.dispatchEvent({type:"sessionstart"})}};function g(I){let U=i.inputSources;for(let W=0;W<c.length;W++)u.set(U[W],c[W]);for(let W=0;W<I.removed.length;W++){let D=I.removed[W],L=u.get(D);L&&(L.dispatchEvent({type:"disconnected",data:D}),u.delete(D))}for(let W=0;W<I.added.length;W++){let D=I.added[W],L=u.get(D);L&&L.dispatchEvent({type:"connected",data:D})}}let y=new k,b=new k;function w(I,U,W){y.setFromMatrixPosition(U.matrixWorld),b.setFromMatrixPosition(W.matrixWorld);let D=y.distanceTo(b),L=U.projectionMatrix.elements,O=W.projectionMatrix.elements,F=L[14]/(L[10]-1),Z=L[14]/(L[10]+1),ee=(L[9]+1)/L[5],oe=(L[9]-1)/L[5],ge=(L[8]-1)/L[0],de=(O[8]+1)/O[0],ne=F*ge,Te=F*de,Ae=D/(-ge+de),re=Ae*-ge;U.matrixWorld.decompose(I.position,I.quaternion,I.scale),I.translateX(re),I.translateZ(Ae),I.matrixWorld.compose(I.position,I.quaternion,I.scale),I.matrixWorldInverse.copy(I.matrixWorld).invert();let C=F+Ae,M=Z+Ae,V=ne-re,B=Te+(D-re),G=ee*Z/M*C,X=oe*Z/M*C;I.projectionMatrix.makePerspective(V,B,G,X,C,M)}function x(I,U){U===null?I.matrixWorld.copy(I.matrix):I.matrixWorld.multiplyMatrices(U.matrixWorld,I.matrix),I.matrixWorldInverse.copy(I.matrixWorld).invert()}this.getCamera=function(I){h.near=f.near=d.near=I.near,h.far=f.far=d.far=I.far,(p!==h.near||m!==h.far)&&(i.updateRenderState({depthNear:h.near,depthFar:h.far}),p=h.near,m=h.far);let U=I.parent,W=h.cameras;x(h,U);for(let L=0;L<W.length;L++)x(W[L],U);I.matrixWorld.copy(h.matrixWorld),I.matrix.copy(h.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale);let D=I.children;for(let L=0,O=D.length;L<O;L++)D[L].updateMatrixWorld(!0);return W.length===2?w(h,d,f):h.projectionMatrix.copy(d.projectionMatrix),h};let S=null;function P(I,U){if(a=U.getViewerPose(s),a!==null){let D=a.views,L=i.renderState.baseLayer;n.setFramebuffer(L.framebuffer);let O=!1;D.length!==h.cameras.length&&(h.cameras.length=0,O=!0);for(let F=0;F<D.length;F++){let Z=D[F],ee=L.getViewport(Z),oe=l[F];oe.matrix.fromArray(Z.transform.matrix),oe.projectionMatrix.fromArray(Z.projectionMatrix),oe.viewport.set(ee.x,ee.y,ee.width,ee.height),F===0&&h.matrix.copy(oe.matrix),O===!0&&h.cameras.push(oe)}}let W=i.inputSources;for(let D=0;D<c.length;D++){let L=c[D],O=W[D];L.update(O,U,s)}S&&S(I,U)}let T=new yf;T.setAnimationLoop(P),this.setAnimationLoop=function(I){S=I},this.dispose=function(){}}Object.assign(Gf.prototype,Pn.prototype);function lS(n){function e(_,g){_.fogColor.value.copy(g.color),g.isFog?(_.fogNear.value=g.near,_.fogFar.value=g.far):g.isFogExp2&&(_.fogDensity.value=g.density)}function t(_,g,y,b){g.isMeshBasicMaterial?i(_,g):g.isMeshLambertMaterial?(i(_,g),c(_,g)):g.isMeshToonMaterial?(i(_,g),d(_,g)):g.isMeshPhongMaterial?(i(_,g),u(_,g)):g.isMeshStandardMaterial?(i(_,g),g.isMeshPhysicalMaterial?l(_,g):f(_,g)):g.isMeshMatcapMaterial?(i(_,g),h(_,g)):g.isMeshDepthMaterial?(i(_,g),p(_,g)):g.isMeshDistanceMaterial?(i(_,g),m(_,g)):g.isMeshNormalMaterial?(i(_,g),v(_,g)):g.isLineBasicMaterial?(r(_,g),g.isLineDashedMaterial&&s(_,g)):g.isPointsMaterial?o(_,g,y,b):g.isSpriteMaterial?a(_,g):g.isShadowMaterial?(_.color.value.copy(g.color),_.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function i(_,g){_.opacity.value=g.opacity,g.color&&_.diffuse.value.copy(g.color),g.emissive&&_.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(_.map.value=g.map),g.alphaMap&&(_.alphaMap.value=g.alphaMap),g.specularMap&&(_.specularMap.value=g.specularMap);let y=n.get(g).envMap;if(y){_.envMap.value=y,_.flipEnvMap.value=y.isCubeTexture&&y._needsFlipEnvMap?-1:1,_.reflectivity.value=g.reflectivity,_.refractionRatio.value=g.refractionRatio;let x=n.get(y).__maxMipLevel;x!==void 0&&(_.maxMipLevel.value=x)}g.lightMap&&(_.lightMap.value=g.lightMap,_.lightMapIntensity.value=g.lightMapIntensity),g.aoMap&&(_.aoMap.value=g.aoMap,_.aoMapIntensity.value=g.aoMapIntensity);let b;g.map?b=g.map:g.specularMap?b=g.specularMap:g.displacementMap?b=g.displacementMap:g.normalMap?b=g.normalMap:g.bumpMap?b=g.bumpMap:g.roughnessMap?b=g.roughnessMap:g.metalnessMap?b=g.metalnessMap:g.alphaMap?b=g.alphaMap:g.emissiveMap?b=g.emissiveMap:g.clearcoatMap?b=g.clearcoatMap:g.clearcoatNormalMap?b=g.clearcoatNormalMap:g.clearcoatRoughnessMap&&(b=g.clearcoatRoughnessMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),_.uvTransform.value.copy(b.matrix));let w;g.aoMap?w=g.aoMap:g.lightMap&&(w=g.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),_.uv2Transform.value.copy(w.matrix))}function r(_,g){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity}function s(_,g){_.dashSize.value=g.dashSize,_.totalSize.value=g.dashSize+g.gapSize,_.scale.value=g.scale}function o(_,g,y,b){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.size.value=g.size*y,_.scale.value=b*.5,g.map&&(_.map.value=g.map),g.alphaMap&&(_.alphaMap.value=g.alphaMap);let w;g.map?w=g.map:g.alphaMap&&(w=g.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),_.uvTransform.value.copy(w.matrix))}function a(_,g){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.rotation.value=g.rotation,g.map&&(_.map.value=g.map),g.alphaMap&&(_.alphaMap.value=g.alphaMap);let y;g.map?y=g.map:g.alphaMap&&(y=g.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),_.uvTransform.value.copy(y.matrix))}function c(_,g){g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap)}function u(_,g){_.specular.value.copy(g.specular),_.shininess.value=Math.max(g.shininess,1e-4),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,g.side===Tt&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),g.side===Tt&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}function d(_,g){g.gradientMap&&(_.gradientMap.value=g.gradientMap),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,g.side===Tt&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),g.side===Tt&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}function f(_,g){_.roughness.value=g.roughness,_.metalness.value=g.metalness,g.roughnessMap&&(_.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(_.metalnessMap.value=g.metalnessMap),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,g.side===Tt&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),g.side===Tt&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias),n.get(g).envMap&&(_.envMapIntensity.value=g.envMapIntensity)}function l(_,g){f(_,g),_.reflectivity.value=g.reflectivity,_.clearcoat.value=g.clearcoat,_.clearcoatRoughness.value=g.clearcoatRoughness,g.sheen&&_.sheen.value.copy(g.sheen),g.clearcoatMap&&(_.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(_.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),_.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Tt&&_.clearcoatNormalScale.value.negate()),_.transmission.value=g.transmission,g.transmissionMap&&(_.transmissionMap.value=g.transmissionMap)}function h(_,g){g.matcap&&(_.matcap.value=g.matcap),g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,g.side===Tt&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),g.side===Tt&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}function p(_,g){g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}function m(_,g){g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias),_.referencePosition.value.copy(g.referencePosition),_.nearDistance.value=g.nearDistance,_.farDistance.value=g.farDistance}function v(_,g){g.bumpMap&&(_.bumpMap.value=g.bumpMap,_.bumpScale.value=g.bumpScale,g.side===Tt&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,_.normalScale.value.copy(g.normalScale),g.side===Tt&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function cS(){let n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.style.display="block",n}function Sr(n){n=n||{};let e=n.canvas!==void 0?n.canvas:cS(),t=n.context!==void 0?n.context:null,i=n.alpha!==void 0?n.alpha:!1,r=n.depth!==void 0?n.depth:!0,s=n.stencil!==void 0?n.stencil:!0,o=n.antialias!==void 0?n.antialias:!1,a=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,c=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,u=n.powerPreference!==void 0?n.powerPreference:"default",d=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1,f=null,l=null,h=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=xo,this.physicallyCorrectLights=!1,this.toneMapping=Ni,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;let p=this,m=!1,v=null,_=0,g=0,y=null,b=null,w=-1,x=null,S=new Ze,P=new Ze,T=null,I=e.width,U=e.height,W=1,D=null,L=null,O=new Ze(0,0,I,U),F=new Ze(0,0,I,U),Z=!1,ee=new Co,oe=!1,ge=!1,de=new Fe,ne=new k,Te={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ae(){return y===null?W:1}let re=t;function C(N,se){for(let te=0;te<N.length;te++){let ce=N[te],be=e.getContext(ce,se);if(be!==null)return be}return null}try{let N={alpha:i,depth:r,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if(e.addEventListener("webglcontextlost",Pe,!1),e.addEventListener("webglcontextrestored",ot,!1),re===null){let se=["webgl2","webgl","experimental-webgl"];if(p.isWebGL1Renderer===!0&&se.shift(),re=C(se,N),re===null)throw C(se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}re.getShaderPrecisionFormat===void 0&&(re.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(N){throw console.error("THREE.WebGLRenderer: "+N.message),N}let M,V,B,G,X,z,H,Y,K,J,A,E,ie,$,q,le,fe,me,he,j,pe;function we(){M=new Hw(re),V=new Nw(re,M,n),M.init(V),j=new aS(re,M,V),B=new sS(re,M,V),B.scissor(P.copy(F).multiplyScalar(W).floor()),B.viewport(S.copy(O).multiplyScalar(W).floor()),G=new Vw(re),X=new XM,z=new oS(re,M,B,X,V,j,G),H=new zw(p),Y=new dx(re,V),pe=new Fw(re,M,Y,V),K=new Uw(re,Y,G,pe),J=new Xw(re,K,Y,G),fe=new qw(re),q=new kw(X),A=new qM(p,H,M,V,pe,q),E=new lS(X),ie=new JM(X),$=new nS(M,V),le=new Dw(p,H,B,J,a),me=new Bw(re,M,G,V),he=new Gw(re,M,G,V),G.programs=A.programs,p.capabilities=V,p.extensions=M,p.properties=X,p.renderLists=ie,p.state=B,p.info=G}we();let _e=new Gf(p,re);this.xr=_e;let Se=new Uf(p,J,V.maxTextureSize);this.shadowMap=Se,this.getContext=function(){return re},this.getContextAttributes=function(){return re.getContextAttributes()},this.forceContextLoss=function(){let N=M.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){let N=M.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(N){N!==void 0&&(W=N,this.setSize(I,U,!1))},this.getSize=function(N){return N===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),N=new ae),N.set(I,U)},this.setSize=function(N,se,te){if(_e.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}I=N,U=se,e.width=Math.floor(N*W),e.height=Math.floor(se*W),te!==!1&&(e.style.width=N+"px",e.style.height=se+"px"),this.setViewport(0,0,N,se)},this.getDrawingBufferSize=function(N){return N===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),N=new ae),N.set(I*W,U*W).floor()},this.setDrawingBufferSize=function(N,se,te){I=N,U=se,W=te,e.width=Math.floor(N*te),e.height=Math.floor(se*te),this.setViewport(0,0,N,se)},this.getCurrentViewport=function(N){return N===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),N=new Ze),N.copy(S)},this.getViewport=function(N){return N.copy(O)},this.setViewport=function(N,se,te,ce){N.isVector4?O.set(N.x,N.y,N.z,N.w):O.set(N,se,te,ce),B.viewport(S.copy(O).multiplyScalar(W).floor())},this.getScissor=function(N){return N.copy(F)},this.setScissor=function(N,se,te,ce){N.isVector4?F.set(N.x,N.y,N.z,N.w):F.set(N,se,te,ce),B.scissor(P.copy(F).multiplyScalar(W).floor())},this.getScissorTest=function(){return Z},this.setScissorTest=function(N){B.setScissorTest(Z=N)},this.setOpaqueSort=function(N){D=N},this.setTransparentSort=function(N){L=N},this.getClearColor=function(N){return N===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),N=new Me),N.copy(le.getClearColor())},this.setClearColor=function(){le.setClearColor.apply(le,arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha.apply(le,arguments)},this.clear=function(N,se,te){let ce=0;(N===void 0||N)&&(ce|=16384),(se===void 0||se)&&(ce|=256),(te===void 0||te)&&(ce|=1024),re.clear(ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Pe,!1),e.removeEventListener("webglcontextrestored",ot,!1),ie.dispose(),$.dispose(),X.dispose(),H.dispose(),J.dispose(),pe.dispose(),_e.dispose(),Un.stop()};function Pe(N){N.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ot(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,we()}function en(N){let se=N.target;se.removeEventListener("dispose",en),Vt(se)}function Vt(N){Bt(N),X.remove(N)}function Bt(N){let se=X.get(N).program;se!==void 0&&A.releaseProgram(se)}function Gr(N,se){N.render(function(te){p.renderBufferImmediate(te,se)})}this.renderBufferImmediate=function(N,se){pe.initAttributes();let te=X.get(N);N.hasPositions&&!te.position&&(te.position=re.createBuffer()),N.hasNormals&&!te.normal&&(te.normal=re.createBuffer()),N.hasUvs&&!te.uv&&(te.uv=re.createBuffer()),N.hasColors&&!te.color&&(te.color=re.createBuffer());let ce=se.getAttributes();N.hasPositions&&(re.bindBuffer(34962,te.position),re.bufferData(34962,N.positionArray,35048),pe.enableAttribute(ce.position),re.vertexAttribPointer(ce.position,3,5126,!1,0,0)),N.hasNormals&&(re.bindBuffer(34962,te.normal),re.bufferData(34962,N.normalArray,35048),pe.enableAttribute(ce.normal),re.vertexAttribPointer(ce.normal,3,5126,!1,0,0)),N.hasUvs&&(re.bindBuffer(34962,te.uv),re.bufferData(34962,N.uvArray,35048),pe.enableAttribute(ce.uv),re.vertexAttribPointer(ce.uv,2,5126,!1,0,0)),N.hasColors&&(re.bindBuffer(34962,te.color),re.bufferData(34962,N.colorArray,35048),pe.enableAttribute(ce.color),re.vertexAttribPointer(ce.color,3,5126,!1,0,0)),pe.disableUnusedAttributes(),re.drawArrays(4,0,N.count),N.count=0},this.renderBufferDirect=function(N,se,te,ce,be,He){se===null&&(se=Te);let Be=be.isMesh&&be.matrixWorld.determinant()<0,Ue=Vr(N,se,ce,be);B.setMaterial(ce,Be);let Ne=te.index,gt=te.attributes.position;if(Ne===null){if(gt===void 0||gt.count===0)return}else if(Ne.count===0)return;let ft=1;ce.wireframe===!0&&(Ne=K.getWireframeAttribute(te),ft=2),(ce.morphTargets||ce.morphNormals)&&fe.update(be,te,ce,Ue),pe.setup(be,ce,Ue,te,Ne);let De,Ye=me;Ne!==null&&(De=Y.get(Ne),Ye=he,Ye.setIndex(De));let ci=Ne!==null?Ne.count:gt.count,rt=te.drawRange.start*ft,hr=te.drawRange.count*ft,Mt=He!==null?He.start*ft:0,hc=He!==null?He.count*ft:Infinity,qt=Math.max(rt,Mt),io=Math.min(ci,rt+hr,Mt+hc)-1,Wr=Math.max(0,io-qt+1);if(Wr!==0){if(be.isMesh)ce.wireframe===!0?(B.setLineWidth(ce.wireframeLinewidth*Ae()),Ye.setMode(1)):Ye.setMode(4);else if(be.isLine){let ro=ce.linewidth;ro===void 0&&(ro=1),B.setLineWidth(ro*Ae()),be.isLineSegments?Ye.setMode(1):be.isLineLoop?Ye.setMode(2):Ye.setMode(3)}else be.isPoints?Ye.setMode(0):be.isSprite&&Ye.setMode(4);if(be.isInstancedMesh)Ye.renderInstances(qt,Wr,be.count);else if(te.isInstancedBufferGeometry){let ro=Math.min(te.instanceCount,te._maxInstanceCount);Ye.renderInstances(qt,Wr,ro)}else Ye.render(qt,Wr)}},this.compile=function(N,se){l=$.get(N),l.init(),N.traverseVisible(function(ce){ce.isLight&&ce.layers.test(se.layers)&&(l.pushLight(ce),ce.castShadow&&l.pushShadow(ce))}),l.setupLights();let te=new WeakMap;N.traverse(function(ce){let be=ce.material;if(be)if(Array.isArray(be))for(let He=0;He<be.length;He++){let Be=be[He];te.has(Be)===!1&&(wt(Be,N,ce),te.set(Be))}else te.has(be)===!1&&(wt(be,N,ce),te.set(be))})};let eo=null;function cc(N){_e.isPresenting||eo&&eo(N)}let Un=new yf;Un.setAnimationLoop(cc),typeof window!="undefined"&&Un.setContext(window),this.setAnimationLoop=function(N){eo=N,_e.setAnimationLoop(N),N===null?Un.stop():Un.start()},this.render=function(N,se){let te,ce;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),te=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ce=arguments[3]),se!==void 0&&se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;pe.resetDefaultState(),w=-1,x=null,N.autoUpdate===!0&&N.updateMatrixWorld(),se.parent===null&&se.updateMatrixWorld(),_e.enabled===!0&&_e.isPresenting===!0&&(se=_e.getCamera(se)),N.isScene===!0&&N.onBeforeRender(p,N,se,te||y),l=$.get(N,h.length),l.init(),h.push(l),de.multiplyMatrices(se.projectionMatrix,se.matrixWorldInverse),ee.setFromProjectionMatrix(de),ge=this.localClippingEnabled,oe=q.init(this.clippingPlanes,ge,se),f=ie.get(N,se),f.init(),gn(N,se,0,p.sortObjects),f.finish(),p.sortObjects===!0&&f.sort(D,L),oe===!0&&q.beginShadows();let be=l.state.shadowsArray;Se.render(be,N,se),l.setupLights(),l.setupLightsView(se),oe===!0&&q.endShadows(),this.info.autoReset===!0&&this.info.reset(),te!==void 0&&this.setRenderTarget(te),le.render(f,N,se,ce);let He=f.opaque,Be=f.transparent;He.length>0&&Ii(He,N,se),Be.length>0&&Ii(Be,N,se),N.isScene===!0&&N.onAfterRender(p,N,se),y!==null&&(z.updateRenderTargetMipmap(y),z.updateMultisampleRenderTarget(y)),B.buffers.depth.setTest(!0),B.buffers.depth.setMask(!0),B.buffers.color.setMask(!0),B.setPolygonOffset(!1),h.pop(),h.length>0?l=h[h.length-1]:l=null,f=null};function gn(N,se,te,ce){if(N.visible===!1)return;if(N.layers.test(se.layers)){if(N.isGroup)te=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(se);else if(N.isLight)l.pushLight(N),N.castShadow&&l.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||ee.intersectsSprite(N)){ce&&ne.setFromMatrixPosition(N.matrixWorld).applyMatrix4(de);let Be=J.update(N),Ue=N.material;Ue.visible&&f.push(N,Be,Ue,te,ne.z,null)}}else if(N.isImmediateRenderObject)ce&&ne.setFromMatrixPosition(N.matrixWorld).applyMatrix4(de),f.push(N,null,N.material,te,ne.z,null);else if((N.isMesh||N.isLine||N.isPoints)&&(N.isSkinnedMesh&&N.skeleton.frame!==G.render.frame&&(N.skeleton.update(),N.skeleton.frame=G.render.frame),!N.frustumCulled||ee.intersectsObject(N))){ce&&ne.setFromMatrixPosition(N.matrixWorld).applyMatrix4(de);let Be=J.update(N),Ue=N.material;if(Array.isArray(Ue)){let Ne=Be.groups;for(let gt=0,ft=Ne.length;gt<ft;gt++){let De=Ne[gt],Ye=Ue[De.materialIndex];Ye&&Ye.visible&&f.push(N,Be,Ye,te,ne.z,De)}}else Ue.visible&&f.push(N,Be,Ue,te,ne.z,null)}}let He=N.children;for(let Be=0,Ue=He.length;Be<Ue;Be++)gn(He[Be],se,te,ce)}function Ii(N,se,te){let ce=se.isScene===!0?se.overrideMaterial:null;for(let be=0,He=N.length;be<He;be++){let Be=N[be],Ue=Be.object,Ne=Be.geometry,gt=ce===null?Be.material:ce,ft=Be.group;if(te.isArrayCamera){let De=te.cameras;for(let Ye=0,ci=De.length;Ye<ci;Ye++){let rt=De[Ye];Ue.layers.test(rt.layers)&&(B.viewport(S.copy(rt.viewport)),l.setupLightsView(rt),to(Ue,se,rt,Ne,gt,ft))}}else to(Ue,se,te,Ne,gt,ft)}}function to(N,se,te,ce,be,He){if(N.onBeforeRender(p,se,te,ce,be,He),N.modelViewMatrix.multiplyMatrices(te.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),N.isImmediateRenderObject){let Be=Vr(te,se,be,N);B.setMaterial(be),pe.reset(),Gr(N,Be)}else p.renderBufferDirect(te,se,ce,be,N,He);N.onAfterRender(p,se,te,ce,be,He)}function wt(N,se,te){se.isScene!==!0&&(se=Te);let ce=X.get(N),be=l.state.lights,He=l.state.shadowsArray,Be=be.state.version,Ue=A.getParameters(N,be.state,He,se,te),Ne=A.getProgramCacheKey(Ue),gt=ce.program,ft=!0;if(ce.environment=N.isMeshStandardMaterial?se.environment:null,ce.fog=se.fog,ce.envMap=H.get(N.envMap||ce.environment),gt===void 0)N.addEventListener("dispose",en);else if(gt.cacheKey!==Ne)Bt(N);else if(ce.lightsStateVersion!==Be)ft=!1;else{if(Ue.shaderID!==void 0)return;ft=!1}ft&&(Ue.uniforms=A.getUniforms(N),N.onBeforeCompile(Ue,p),gt=A.acquireProgram(Ue,Ne),ce.program=gt,ce.uniforms=Ue.uniforms,ce.outputEncoding=Ue.outputEncoding);let De=ce.uniforms;(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(ce.numClippingPlanes=q.numPlanes,ce.numIntersection=q.numIntersection,De.clippingPlanes=q.uniform),ce.needsLights=uc(N),ce.lightsStateVersion=Be,ce.needsLights&&(De.ambientLightColor.value=be.state.ambient,De.lightProbe.value=be.state.probe,De.directionalLights.value=be.state.directional,De.directionalLightShadows.value=be.state.directionalShadow,De.spotLights.value=be.state.spot,De.spotLightShadows.value=be.state.spotShadow,De.rectAreaLights.value=be.state.rectArea,De.ltc_1.value=be.state.rectAreaLTC1,De.ltc_2.value=be.state.rectAreaLTC2,De.pointLights.value=be.state.point,De.pointLightShadows.value=be.state.pointShadow,De.hemisphereLights.value=be.state.hemi,De.directionalShadowMap.value=be.state.directionalShadowMap,De.directionalShadowMatrix.value=be.state.directionalShadowMatrix,De.spotShadowMap.value=be.state.spotShadowMap,De.spotShadowMatrix.value=be.state.spotShadowMatrix,De.pointShadowMap.value=be.state.pointShadowMap,De.pointShadowMatrix.value=be.state.pointShadowMatrix);let Ye=ce.program.getUniforms(),ci=Zi.seqWithValue(Ye.seq,De);ce.uniformsList=ci}function Vr(N,se,te,ce){se.isScene!==!0&&(se=Te),z.resetTextureUnits();let be=se.fog,He=te.isMeshStandardMaterial?se.environment:null,Be=y===null?p.outputEncoding:y.texture.encoding,Ue=H.get(te.envMap||He),Ne=X.get(te),gt=l.state.lights;if(oe===!0&&(ge===!0||N!==x)){let Mt=N===x&&te.id===w;q.setState(te,N,Mt)}te.version===Ne.__version?(te.fog&&Ne.fog!==be||Ne.environment!==He||Ne.needsLights&&Ne.lightsStateVersion!==gt.state.version||Ne.numClippingPlanes!==void 0&&(Ne.numClippingPlanes!==q.numPlanes||Ne.numIntersection!==q.numIntersection)||Ne.outputEncoding!==Be||Ne.envMap!==Ue)&&wt(te,se,ce):(wt(te,se,ce),Ne.__version=te.version);let ft=!1,De=!1,Ye=!1,ci=Ne.program,rt=ci.getUniforms(),hr=Ne.uniforms;if(B.useProgram(ci.program)&&(ft=!0,De=!0,Ye=!0),te.id!==w&&(w=te.id,De=!0),ft||x!==N){if(rt.setValue(re,"projectionMatrix",N.projectionMatrix),V.logarithmicDepthBuffer&&rt.setValue(re,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),x!==N&&(x=N,De=!0,Ye=!0),te.isShaderMaterial||te.isMeshPhongMaterial||te.isMeshToonMaterial||te.isMeshStandardMaterial||te.envMap){let Mt=rt.map.cameraPosition;Mt!==void 0&&Mt.setValue(re,ne.setFromMatrixPosition(N.matrixWorld))}(te.isMeshPhongMaterial||te.isMeshToonMaterial||te.isMeshLambertMaterial||te.isMeshBasicMaterial||te.isMeshStandardMaterial||te.isShaderMaterial)&&rt.setValue(re,"isOrthographic",N.isOrthographicCamera===!0),(te.isMeshPhongMaterial||te.isMeshToonMaterial||te.isMeshLambertMaterial||te.isMeshBasicMaterial||te.isMeshStandardMaterial||te.isShaderMaterial||te.isShadowMaterial||te.skinning)&&rt.setValue(re,"viewMatrix",N.matrixWorldInverse)}if(te.skinning){rt.setOptional(re,ce,"bindMatrix"),rt.setOptional(re,ce,"bindMatrixInverse");let Mt=ce.skeleton;if(Mt){let hc=Mt.bones;if(V.floatVertexTextures){if(Mt.boneTexture===null){let qt=Math.sqrt(hc.length*4);qt=Ie.ceilPowerOfTwo(qt),qt=Math.max(qt,4);let io=new Float32Array(qt*qt*4);io.set(Mt.boneMatrices);let Wr=new ms(io,qt,qt,Et,ki);Mt.boneMatrices=io,Mt.boneTexture=Wr,Mt.boneTextureSize=qt}rt.setValue(re,"boneTexture",Mt.boneTexture,z),rt.setValue(re,"boneTextureSize",Mt.boneTextureSize)}else rt.setOptional(re,Mt,"boneMatrices")}}return(De||Ne.receiveShadow!==ce.receiveShadow)&&(Ne.receiveShadow=ce.receiveShadow,rt.setValue(re,"receiveShadow",ce.receiveShadow)),De&&(rt.setValue(re,"toneMappingExposure",p.toneMappingExposure),Ne.needsLights&&no(hr,Ye),be&&te.fog&&E.refreshFogUniforms(hr,be),E.refreshMaterialUniforms(hr,te,W,U),Zi.upload(re,Ne.uniformsList,hr,z)),te.isShaderMaterial&&te.uniformsNeedUpdate===!0&&(Zi.upload(re,Ne.uniformsList,hr,z),te.uniformsNeedUpdate=!1),te.isSpriteMaterial&&rt.setValue(re,"center",ce.center),rt.setValue(re,"modelViewMatrix",ce.modelViewMatrix),rt.setValue(re,"normalMatrix",ce.normalMatrix),rt.setValue(re,"modelMatrix",ce.matrixWorld),ci}function no(N,se){N.ambientLightColor.needsUpdate=se,N.lightProbe.needsUpdate=se,N.directionalLights.needsUpdate=se,N.directionalLightShadows.needsUpdate=se,N.pointLights.needsUpdate=se,N.pointLightShadows.needsUpdate=se,N.spotLights.needsUpdate=se,N.spotLightShadows.needsUpdate=se,N.rectAreaLights.needsUpdate=se,N.hemisphereLights.needsUpdate=se}function uc(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.setFramebuffer=function(N){v!==N&&y===null&&re.bindFramebuffer(36160,N),v=N},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return g},this.getRenderList=function(){return f},this.setRenderList=function(N){f=N},this.getRenderTarget=function(){return y},this.setRenderTarget=function(N,se=0,te=0){y=N,_=se,g=te,N&&X.get(N).__webglFramebuffer===void 0&&z.setupRenderTarget(N);let ce=v,be=!1;if(N){let He=X.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(ce=He[se],be=!0):N.isWebGLMultisampleRenderTarget?ce=X.get(N).__webglMultisampledFramebuffer:ce=He,S.copy(N.viewport),P.copy(N.scissor),T=N.scissorTest}else S.copy(O).multiplyScalar(W).floor(),P.copy(F).multiplyScalar(W).floor(),T=Z;if(b!==ce&&(re.bindFramebuffer(36160,ce),b=ce),B.viewport(S),B.scissor(P),B.setScissorTest(T),be){let He=X.get(N.texture);re.framebufferTexture2D(36160,36064,34069+se,He.__webglTexture,te)}},this.readRenderTargetPixels=function(N,se,te,ce,be,He,Be){if(!(N&&N.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ue=X.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&Be!==void 0&&(Ue=Ue[Be]),Ue){let Ne=!1;Ue!==b&&(re.bindFramebuffer(36160,Ue),Ne=!0);try{let gt=N.texture,ft=gt.format,De=gt.type;if(ft!==Et&&j.convert(ft)!==re.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ye=De===Ha&&(M.has("EXT_color_buffer_half_float")||V.isWebGL2&&M.has("EXT_color_buffer_float"));if(De!==Bc&&j.convert(De)!==re.getParameter(35738)&&!(De===ki&&(V.isWebGL2||M.has("OES_texture_float")||M.has("WEBGL_color_buffer_float")))&&!Ye){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}re.checkFramebufferStatus(36160)===36053?se>=0&&se<=N.width-ce&&te>=0&&te<=N.height-be&&re.readPixels(se,te,ce,be,j.convert(ft),j.convert(De),He):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Ne&&re.bindFramebuffer(36160,b)}}},this.copyFramebufferToTexture=function(N,se,te=0){let ce=Math.pow(2,-te),be=Math.floor(se.image.width*ce),He=Math.floor(se.image.height*ce),Be=j.convert(se.format);z.setTexture2D(se,0),re.copyTexImage2D(3553,te,Be,N.x,N.y,be,He,0),B.unbindTexture()},this.copyTextureToTexture=function(N,se,te,ce=0){let be=se.image.width,He=se.image.height,Be=j.convert(te.format),Ue=j.convert(te.type);z.setTexture2D(te,0),re.pixelStorei(37440,te.flipY),re.pixelStorei(37441,te.premultiplyAlpha),re.pixelStorei(3317,te.unpackAlignment),se.isDataTexture?re.texSubImage2D(3553,ce,N.x,N.y,be,He,Be,Ue,se.image.data):se.isCompressedTexture?re.compressedTexSubImage2D(3553,ce,N.x,N.y,se.mipmaps[0].width,se.mipmaps[0].height,Be,se.mipmaps[0].data):re.texSubImage2D(3553,ce,N.x,N.y,Be,Ue,se.image),ce===0&&te.generateMipmaps&&re.generateMipmap(3553),B.unbindTexture()},this.initTexture=function(N){z.setTexture2D(N,0),B.unbindTexture()},this.resetState=function(){B.reset(),pe.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Vf(n){Sr.call(this,n)}Vf.prototype=Object.assign(Object.create(Sr.prototype),{constructor:Vf,isWebGL1Renderer:!0});var vs=class{constructor(e,t,i){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Me(e),this.near=t!==void 0?t:1,this.far=i!==void 0?i:1e3}clone(){return new vs(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Do=class extends Ce{constructor(){super();Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};function Zt(n,e){this.array=n,this.stride=e,this.count=n!==void 0?n.length/e:0,this.usage=Ga,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ie.generateUUID()}Object.defineProperty(Zt.prototype,"needsUpdate",{set:function(n){n===!0&&this.version++}});Object.assign(Zt.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(n){return this.usage=n,this},copy:function(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this},copyAt:function(n,e,t){n*=this.stride,t*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[n+i]=e.array[t+i];return this},set:function(n,e=0){return this.array.set(n,e),this},clone:function(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ie.generateUUID()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),t=new Zt(e,this.stride);return t.setUsage(this.usage),t},onUpload:function(n){return this.onUploadCallback=n,this},toJSON:function(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ie.generateUUID()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var Tr=new k;function xi(n,e,t,i){this.name="",this.data=n,this.itemSize=e,this.offset=t,this.normalized=i===!0}Object.defineProperties(xi.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(n){this.data.needsUpdate=n}}});Object.assign(xi.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(n){for(let e=0,t=this.data.count;e<t;e++)Tr.x=this.getX(e),Tr.y=this.getY(e),Tr.z=this.getZ(e),Tr.applyMatrix4(n),this.setXYZ(e,Tr.x,Tr.y,Tr.z);return this},setX:function(n,e){return this.data.array[n*this.data.stride+this.offset]=e,this},setY:function(n,e){return this.data.array[n*this.data.stride+this.offset+1]=e,this},setZ:function(n,e){return this.data.array[n*this.data.stride+this.offset+2]=e,this},setW:function(n,e){return this.data.array[n*this.data.stride+this.offset+3]=e,this},getX:function(n){return this.data.array[n*this.data.stride+this.offset]},getY:function(n){return this.data.array[n*this.data.stride+this.offset+1]},getZ:function(n){return this.data.array[n*this.data.stride+this.offset+2]},getW:function(n){return this.data.array[n*this.data.stride+this.offset+3]},setXY:function(n,e,t){return n=n*this.data.stride+this.offset,this.data.array[n+0]=e,this.data.array[n+1]=t,this},setXYZ:function(n,e,t,i){return n=n*this.data.stride+this.offset,this.data.array[n+0]=e,this.data.array[n+1]=t,this.data.array[n+2]=i,this},setXYZW:function(n,e,t,i,r){return n=n*this.data.stride+this.offset,this.data.array[n+0]=e,this.data.array[n+1]=t,this.data.array[n+2]=i,this.data.array[n+3]=r,this},clone:function(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[i+r])}return new Oe(new this.array.constructor(e),this.itemSize,this.normalized)}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.clone(n)),new xi(n.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.toJSON(n)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});function Er(n){Re.call(this),this.type="SpriteMaterial",this.color=new Me(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(n)}Er.prototype=Object.create(Re.prototype);Er.prototype.constructor=Er;Er.prototype.isSpriteMaterial=!0;Er.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.rotation=n.rotation,this.sizeAttenuation=n.sizeAttenuation,this};var ys,Fo=new k,xs=new k,bs=new k,ws=new ae,Bo=new ae,Wf=new Fe,ul=new k,No=new k,hl=new k,jf=new ae,vu=new ae,qf=new ae;function Xf(n){if(Ce.call(this),this.type="Sprite",ys===void 0){ys=new We;let e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Zt(e,5);ys.setIndex([0,1,2,0,2,3]),ys.setAttribute("position",new xi(t,3,0,!1)),ys.setAttribute("uv",new xi(t,2,3,!1))}this.geometry=ys,this.material=n!==void 0?n:new Er,this.center=new ae(.5,.5)}Xf.prototype=Object.assign(Object.create(Ce.prototype),{constructor:Xf,isSprite:!0,raycast:function(n,e){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),xs.setFromMatrixScale(this.matrixWorld),Wf.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),bs.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&xs.multiplyScalar(-bs.z);let t=this.material.rotation,i,r;t!==0&&(r=Math.cos(t),i=Math.sin(t));let s=this.center;dl(ul.set(-.5,-.5,0),bs,s,xs,i,r),dl(No.set(.5,-.5,0),bs,s,xs,i,r),dl(hl.set(.5,.5,0),bs,s,xs,i,r),jf.set(0,0),vu.set(1,0),qf.set(1,1);let o=n.ray.intersectTriangle(ul,No,hl,!1,Fo);if(o===null&&(dl(No.set(-.5,.5,0),bs,s,xs,i,r),vu.set(0,1),o=n.ray.intersectTriangle(ul,hl,No,!1,Fo),o===null))return;let a=n.ray.origin.distanceTo(Fo);a<n.near||a>n.far||e.push({distance:a,point:Fo.clone(),uv:kt.getUV(Fo,ul,No,hl,jf,vu,qf,new ae),face:null,object:this})},copy:function(n){return Ce.prototype.copy.call(this,n),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}});function dl(n,e,t,i,r,s){ws.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(Bo.x=s*ws.x-r*ws.y,Bo.y=r*ws.x+s*ws.y):Bo.copy(ws),n.copy(e),n.x+=Bo.x,n.y+=Bo.y,n.applyMatrix4(Wf)}var fl=new k,Yf=new k;function yu(){Ce.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}yu.prototype=Object.assign(Object.create(Ce.prototype),{constructor:yu,isLOD:!0,copy:function(n){Ce.prototype.copy.call(this,n,!1);let e=n.levels;for(let t=0,i=e.length;t<i;t++){let r=e[t];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=n.autoUpdate,this},addLevel:function(n,e=0){e=Math.abs(e);let t=this.levels,i;for(i=0;i<t.length&&!(e<t[i].distance);i++);return t.splice(i,0,{distance:e,object:n}),this.add(n),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(n){let e=this.levels;if(e.length>0){let t,i;for(t=1,i=e.length;t<i&&!(n<e[t].distance);t++);return e[t-1].object}return null},raycast:function(n,e){if(this.levels.length>0){fl.setFromMatrixPosition(this.matrixWorld);let i=n.ray.origin.distanceTo(fl);this.getObjectForDistance(i).raycast(n,e)}},update:function(n){let e=this.levels;if(e.length>1){fl.setFromMatrixPosition(n.matrixWorld),Yf.setFromMatrixPosition(this.matrixWorld);let t=fl.distanceTo(Yf)/n.zoom;e[0].object.visible=!0;let i,r;for(i=1,r=e.length;i<r&&t>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}},toJSON:function(n){let e=Ce.prototype.toJSON.call(this,n);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];let t=this.levels;for(let i=0,r=t.length;i<r;i++){let s=t[i];e.object.levels.push({object:s.object.uuid,distance:s.distance})}return e}});var Zf=new k,Jf=new Ze,Kf=new Ze,uS=new k,$f=new Fe;function ko(n,e){n&&n.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ke.call(this,n,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Fe,this.bindMatrixInverse=new Fe}ko.prototype=Object.assign(Object.create(ke.prototype),{constructor:ko,isSkinnedMesh:!0,copy:function(n){return ke.prototype.copy.call(this,n),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,this},bind:function(n,e){this.skeleton=n,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){let n=new Ze,e=this.geometry.attributes.skinWeight;for(let t=0,i=e.count;t<i;t++){n.x=e.getX(t),n.y=e.getY(t),n.z=e.getZ(t),n.w=e.getW(t);let r=1/n.manhattanLength();r!==Infinity?n.multiplyScalar(r):n.set(1,0,0,0),e.setXYZW(t,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(n){ke.prototype.updateMatrixWorld.call(this,n),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(n,e){let t=this.skeleton,i=this.geometry;Jf.fromBufferAttribute(i.attributes.skinIndex,n),Kf.fromBufferAttribute(i.attributes.skinWeight,n),Zf.fromBufferAttribute(i.attributes.position,n).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){let s=Kf.getComponent(r);if(s!==0){let o=Jf.getComponent(r);$f.multiplyMatrices(t.bones[o].matrixWorld,t.boneInverses[o]),e.addScaledVector(uS.copy(Zf).applyMatrix4($f),s)}}return e.applyMatrix4(this.bindMatrixInverse)}});function zo(){Ce.call(this),this.type="Bone"}zo.prototype=Object.assign(Object.create(Ce.prototype),{constructor:zo,isBone:!0});var Qf=new Fe,hS=new Fe;function Ho(n=[],e=[]){this.uuid=Ie.generateUUID(),this.bones=n.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Ho.prototype,{init:function(){let n=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(n.length*16),e.length===0)this.calculateInverses();else if(n.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,i=this.bones.length;t<i;t++)this.boneInverses.push(new Fe)}},calculateInverses:function(){this.boneInverses.length=0;for(let n=0,e=this.bones.length;n<e;n++){let t=new Fe;this.bones[n]&&t.copy(this.bones[n].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let n=0,e=this.bones.length;n<e;n++){let t=this.bones[n];t&&t.matrixWorld.copy(this.boneInverses[n]).invert()}for(let n=0,e=this.bones.length;n<e;n++){let t=this.bones[n];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){let n=this.bones,e=this.boneInverses,t=this.boneMatrices,i=this.boneTexture;for(let r=0,s=n.length;r<s;r++){let o=n[r]?n[r].matrixWorld:hS;Qf.multiplyMatrices(o,e[r]),Qf.toArray(t,r*16)}i!==null&&(i.needsUpdate=!0)},clone:function(){return new Ho(this.bones,this.boneInverses)},getBoneByName:function(n){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];if(i.name===n)return i}},dispose:function(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(n,e){this.uuid=n.uuid;for(let t=0,i=n.bones.length;t<i;t++){let r=n.bones[t],s=e[r];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new zo),this.bones.push(s),this.boneInverses.push(new Fe().fromArray(n.boneInverses[t]))}return this.init(),this},toJSON:function(){let n={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;let e=this.bones,t=this.boneInverses;for(let i=0,r=e.length;i<r;i++){let s=e[i];n.bones.push(s.uuid);let o=t[i];n.boneInverses.push(o.toArray())}return n}});var ep=new Fe,tp=new Fe,pl=[],Uo=new ke;function np(n,e,t){ke.call(this,n,e),this.instanceMatrix=new Oe(new Float32Array(t*16),16),this.instanceColor=null,this.count=t,this.frustumCulled=!1}np.prototype=Object.assign(Object.create(ke.prototype),{constructor:np,isInstancedMesh:!0,copy:function(n){return ke.prototype.copy.call(this,n),this.instanceMatrix.copy(n.instanceMatrix),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,this},getColorAt:function(n,e){e.fromArray(this.instanceColor.array,n*3)},getMatrixAt:function(n,e){e.fromArray(this.instanceMatrix.array,n*16)},raycast:function(n,e){let t=this.matrixWorld,i=this.count;if(Uo.geometry=this.geometry,Uo.material=this.material,Uo.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,ep),tp.multiplyMatrices(t,ep),Uo.matrixWorld=tp,Uo.raycast(n,pl);for(let s=0,o=pl.length;s<o;s++){let a=pl[s];a.instanceId=r,a.object=this,e.push(a)}pl.length=0}},setColorAt:function(n,e){this.instanceColor===null&&(this.instanceColor=new Oe(new Float32Array(this.count*3),3)),e.toArray(this.instanceColor.array,n*3)},setMatrixAt:function(n,e){e.toArray(this.instanceMatrix.array,n*16)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});function yn(n){Re.call(this),this.type="LineBasicMaterial",this.color=new Me(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(n)}yn.prototype=Object.create(Re.prototype);yn.prototype.constructor=yn;yn.prototype.isLineBasicMaterial=!0;yn.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.morphTargets=n.morphTargets,this};var ip=new k,rp=new k,sp=new Fe,xu=new is,ml=new Xn;function Ji(n=new We,e=new yn){Ce.call(this),this.type="Line",this.geometry=n,this.material=e,this.updateMorphTargets()}Ji.prototype=Object.assign(Object.create(Ce.prototype),{constructor:Ji,isLine:!0,copy:function(n){return Ce.prototype.copy.call(this,n),this.material=n.material,this.geometry=n.geometry,this},computeLineDistances:function(){let n=this.geometry;if(n.isBufferGeometry)if(n.index===null){let e=n.attributes.position,t=[0];for(let i=1,r=e.count;i<r;i++)ip.fromBufferAttribute(e,i-1),rp.fromBufferAttribute(e,i),t[i]=t[i-1],t[i]+=ip.distanceTo(rp);n.setAttribute("lineDistance",new je(t,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else n.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(n,e){let t=this.geometry,i=this.matrixWorld,r=n.params.Line.threshold;if(t.boundingSphere===null&&t.computeBoundingSphere(),ml.copy(t.boundingSphere),ml.applyMatrix4(i),ml.radius+=r,n.ray.intersectsSphere(ml)===!1)return;sp.copy(i).invert(),xu.copy(n.ray).applyMatrix4(sp);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,a=new k,c=new k,u=new k,d=new k,f=this.isLineSegments?2:1;if(t.isBufferGeometry){let l=t.index,p=t.attributes.position;if(l!==null){let m=l.array;for(let v=0,_=m.length-1;v<_;v+=f){let g=m[v],y=m[v+1];if(a.fromBufferAttribute(p,g),c.fromBufferAttribute(p,y),xu.distanceSqToSegment(a,c,d,u)>o)continue;d.applyMatrix4(this.matrixWorld);let w=n.ray.origin.distanceTo(d);w<n.near||w>n.far||e.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(let m=0,v=p.count-1;m<v;m+=f){if(a.fromBufferAttribute(p,m),c.fromBufferAttribute(p,m+1),xu.distanceSqToSegment(a,c,d,u)>o)continue;d.applyMatrix4(this.matrixWorld);let g=n.ray.origin.distanceTo(d);g<n.near||g>n.far||e.push({distance:g,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else t.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){let n=this.geometry;if(n.isBufferGeometry){let e=n.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{let e=n.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var op=new k,ap=new k;function gl(n,e){Ji.call(this,n,e),this.type="LineSegments"}gl.prototype=Object.assign(Object.create(Ji.prototype),{constructor:gl,isLineSegments:!0,computeLineDistances:function(){let n=this.geometry;if(n.isBufferGeometry)if(n.index===null){let e=n.attributes.position,t=[];for(let i=0,r=e.count;i<r;i+=2)op.fromBufferAttribute(e,i),ap.fromBufferAttribute(e,i+1),t[i]=i===0?0:t[i-1],t[i+1]=t[i]+op.distanceTo(ap);n.setAttribute("lineDistance",new je(t,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else n.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});function _l(n,e){Ji.call(this,n,e),this.type="LineLoop"}_l.prototype=Object.assign(Object.create(Ji.prototype),{constructor:_l,isLineLoop:!0});function bi(n){Re.call(this),this.type="PointsMaterial",this.color=new Me(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(n)}bi.prototype=Object.create(Re.prototype);bi.prototype.constructor=bi;bi.prototype.isPointsMaterial=!0;bi.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.morphTargets=n.morphTargets,this};var lp=new Fe,bu=new is,vl=new Xn,yl=new k;function xl(n=new We,e=new bi){Ce.call(this),this.type="Points",this.geometry=n,this.material=e,this.updateMorphTargets()}xl.prototype=Object.assign(Object.create(Ce.prototype),{constructor:xl,isPoints:!0,copy:function(n){return Ce.prototype.copy.call(this,n),this.material=n.material,this.geometry=n.geometry,this},raycast:function(n,e){let t=this.geometry,i=this.matrixWorld,r=n.params.Points.threshold;if(t.boundingSphere===null&&t.computeBoundingSphere(),vl.copy(t.boundingSphere),vl.applyMatrix4(i),vl.radius+=r,n.ray.intersectsSphere(vl)===!1)return;lp.copy(i).invert(),bu.copy(n.ray).applyMatrix4(lp);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s;if(t.isBufferGeometry){let a=t.index,u=t.attributes.position;if(a!==null){let d=a.array;for(let f=0,l=d.length;f<l;f++){let h=d[f];yl.fromBufferAttribute(u,h),cp(yl,h,o,i,n,e,this)}}else for(let d=0,f=u.count;d<f;d++)yl.fromBufferAttribute(u,d),cp(yl,d,o,i,n,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){let n=this.geometry;if(n.isBufferGeometry){let e=n.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{let e=n.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});function cp(n,e,t,i,r,s,o){let a=bu.distanceSqToPoint(n);if(a<t){let c=new k;bu.closestPointToPoint(n,c),c.applyMatrix4(i);let u=r.ray.origin.distanceTo(c);if(u<r.near||u>r.far)return;s.push({distance:u,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,object:o})}}function up(n,e,t,i,r,s,o,a,c){Qe.call(this,n,e,t,i,r,s,o,a,c),this.format=o!==void 0?o:fi,this.minFilter=s!==void 0?s:Xe,this.magFilter=r!==void 0?r:Xe,this.generateMipmaps=!1;let u=this;function d(){u.needsUpdate=!0,n.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in n&&n.requestVideoFrameCallback(d)}up.prototype=Object.assign(Object.create(Qe.prototype),{constructor:up,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){let n=this.image;"requestVideoFrameCallback"in n===!1&&n.readyState>=n.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function Go(n,e,t,i,r,s,o,a,c,u,d,f){Qe.call(this,null,s,o,a,c,u,i,r,d,f),this.image={width:e,height:t},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}Go.prototype=Object.create(Qe.prototype);Go.prototype.constructor=Go;Go.prototype.isCompressedTexture=!0;function Ms(n,e,t,i,r,s,o,a,c){Qe.call(this,n,e,t,i,r,s,o,a,c),this.needsUpdate=!0}Ms.prototype=Object.create(Qe.prototype);Ms.prototype.constructor=Ms;Ms.prototype.isCanvasTexture=!0;function bl(n,e,t,i,r,s,o,a,c,u){if(u=u!==void 0?u:Yr,u!==Yr&&u!==yo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");t===void 0&&u===Yr&&(t=ka),t===void 0&&u===yo&&(t=vo),Qe.call(this,null,i,r,s,o,a,u,t,c),this.image={width:n,height:e},this.magFilter=o!==void 0?o:_t,this.minFilter=a!==void 0?a:_t,this.flipY=!1,this.generateMipmaps=!1}bl.prototype=Object.create(Qe.prototype);bl.prototype.constructor=bl;bl.prototype.isDepthTexture=!0;var wu=class extends We{constructor(e=1,t=1,i=1,r=8,s=1,o=!1,a=0,c=Math.PI*2){super();this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};let u=this;r=Math.floor(r),s=Math.floor(s);let d=[],f=[],l=[],h=[],p=0,m=[],v=i/2,_=0;g(),o===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(d),this.setAttribute("position",new je(f,3)),this.setAttribute("normal",new je(l,3)),this.setAttribute("uv",new je(h,2));function g(){let b=new k,w=new k,x=0,S=(t-e)/i;for(let P=0;P<=s;P++){let T=[],I=P/s,U=I*(t-e)+e;for(let W=0;W<=r;W++){let D=W/r,L=D*c+a,O=Math.sin(L),F=Math.cos(L);w.x=U*O,w.y=-I*i+v,w.z=U*F,f.push(w.x,w.y,w.z),b.set(O,S,F).normalize(),l.push(b.x,b.y,b.z),h.push(D,1-I),T.push(p++)}m.push(T)}for(let P=0;P<r;P++)for(let T=0;T<s;T++){let I=m[T][P],U=m[T+1][P],W=m[T+1][P+1],D=m[T][P+1];d.push(I,U,D),d.push(U,W,D),x+=6}u.addGroup(_,x,0),_+=x}function y(b){let w=p,x=new ae,S=new k,P=0,T=b===!0?e:t,I=b===!0?1:-1;for(let W=1;W<=r;W++)f.push(0,v*I,0),l.push(0,I,0),h.push(.5,.5),p++;let U=p;for(let W=0;W<=r;W++){let L=W/r*c+a,O=Math.cos(L),F=Math.sin(L);S.x=T*F,S.y=v*I,S.z=T*O,f.push(S.x,S.y,S.z),l.push(0,I,0),x.x=O*.5+.5,x.y=F*.5*I+.5,h.push(x.x,x.y),p++}for(let W=0;W<r;W++){let D=w+W,L=U+W;b===!0?d.push(L,L+1,D):d.push(L+1,L,D),P+=3}u.addGroup(_,P,b===!0?1:2),_+=P}}},TE=new k,EE=new k,AE=new k,CE=new kt,fS={triangulate:function(n,e,t){t=t||2;let i=e&&e.length,r=i?e[0]*t:n.length,s=hp(n,0,r,t,!0),o=[];if(!s||s.next===s.prev)return o;let a,c,u,d,f,l,h;if(i&&(s=dS(n,e,s,t)),n.length>80*t){a=u=n[0],c=d=n[1];for(let p=t;p<r;p+=t)f=n[p],l=n[p+1],f<a&&(a=f),l<c&&(c=l),f>u&&(u=f),l>d&&(d=l);h=Math.max(u-a,d-c),h=h!==0?1/h:0}return Vo(s,o,t,a,c,h),o}};function hp(n,e,t,i,r){let s,o;if(r===pS(n,e,t,i)>0)for(s=e;s<t;s+=i)o=dp(s,n[s],n[s+1],o);else for(s=t-i;s>=e;s-=i)o=dp(s,n[s],n[s+1],o);return o&&wl(o,o.next)&&(Wo(o),o=o.next),o}function Ki(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(wl(t,t.next)||at(t.prev,t,t.next)===0)){if(Wo(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Vo(n,e,t,i,r,s,o){if(!n)return;!o&&s&&yS(n,i,r,s);let a=n,c,u;for(;n.prev!==n.next;){if(c=n.prev,u=n.next,s?gS(n,i,r,s):mS(n)){e.push(c.i/t),e.push(n.i/t),e.push(u.i/t),Wo(n),n=u.next,a=u.next;continue}if(n=u,n===a){o?o===1?(n=_S(Ki(n),e,t),Vo(n,e,t,i,r,s,2)):o===2&&vS(n,e,t,i,r,s):Vo(Ki(n),e,t,i,r,s,1);break}}}function mS(n){let e=n.prev,t=n,i=n.next;if(at(e,t,i)>=0)return!1;let r=n.next.next;for(;r!==n.prev;){if(Ss(e.x,e.y,t.x,t.y,i.x,i.y,r.x,r.y)&&at(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function gS(n,e,t,i){let r=n.prev,s=n,o=n.next;if(at(r,s,o)>=0)return!1;let a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,c=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,u=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,d=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,f=Mu(a,c,e,t,i),l=Mu(u,d,e,t,i),h=n.prevZ,p=n.nextZ;for(;h&&h.z>=f&&p&&p.z<=l;){if(h!==n.prev&&h!==n.next&&Ss(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&at(h.prev,h,h.next)>=0||(h=h.prevZ,p!==n.prev&&p!==n.next&&Ss(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&at(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;h&&h.z>=f;){if(h!==n.prev&&h!==n.next&&Ss(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&at(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=l;){if(p!==n.prev&&p!==n.next&&Ss(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&at(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function _S(n,e,t){let i=n;do{let r=i.prev,s=i.next.next;!wl(r,s)&&fp(r,i,i.next,s)&&jo(r,s)&&jo(s,r)&&(e.push(r.i/t),e.push(i.i/t),e.push(s.i/t),Wo(i),Wo(i.next),i=n=s),i=i.next}while(i!==n);return Ki(i)}function vS(n,e,t,i,r,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&xS(o,a)){let c=pp(o,a);o=Ki(o,o.next),c=Ki(c,c.next),Vo(o,e,t,i,r,s),Vo(c,e,t,i,r,s);return}a=a.next}o=o.next}while(o!==n)}function dS(n,e,t,i){let r=[],s,o,a,c,u;for(s=0,o=e.length;s<o;s++)a=e[s]*i,c=s<o-1?e[s+1]*i:n.length,u=hp(n,a,c,i,!1),u===u.next&&(u.steiner=!0),r.push(MS(u));for(r.sort(bS),s=0;s<r.length;s++)wS(r[s],t),t=Ki(t,t.next);return t}function bS(n,e){return n.x-e.x}function wS(n,e){if(e=SS(n,e),e){let t=pp(e,n);Ki(e,e.next),Ki(t,t.next)}}function SS(n,e){let t=e,i=n.x,r=n.y,s=-Infinity,o;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){let l=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(l<=i&&l>s){if(s=l,l===i){if(r===t.y)return t;if(r===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(i===s)return o;let a=o,c=o.x,u=o.y,d=Infinity,f;t=o;do i>=t.x&&t.x>=c&&i!==t.x&&Ss(r<u?i:s,r,c,u,r<u?s:i,r,t.x,t.y)&&(f=Math.abs(r-t.y)/(i-t.x),jo(t,n)&&(f<d||f===d&&(t.x>o.x||t.x===o.x&&TS(o,t)))&&(o=t,d=f)),t=t.next;while(t!==a);return o}function TS(n,e){return at(n.prev,n,e.prev)<0&&at(e.next,n,n.next)<0}function yS(n,e,t,i){let r=n;do r.z===null&&(r.z=Mu(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,ES(r)}function ES(n){let e,t,i,r,s,o,a,c,u=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,i=t,a=0,e=0;e<u&&(a++,i=i.nextZ,!!i);e++);for(c=u;a>0||c>0&&i;)a!==0&&(c===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,a--):(r=i,i=i.nextZ,c--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;t=i}s.nextZ=null,u*=2}while(o>1);return n}function Mu(n,e,t,i,r){return n=32767*(n-t)*r,e=32767*(e-i)*r,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function MS(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Ss(n,e,t,i,r,s,o,a){return(r-o)*(e-a)-(n-o)*(s-a)>=0&&(n-o)*(i-a)-(t-o)*(e-a)>=0&&(t-o)*(s-a)-(r-o)*(i-a)>=0}function xS(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!AS(n,e)&&(jo(n,e)&&jo(e,n)&&CS(n,e)&&(at(n.prev,n,e.prev)||at(n,e.prev,e))||wl(n,e)&&at(n.prev,n,n.next)>0&&at(e.prev,e,e.next)>0)}function at(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function wl(n,e){return n.x===e.x&&n.y===e.y}function fp(n,e,t,i){let r=Sl(at(n,e,t)),s=Sl(at(n,e,i)),o=Sl(at(t,i,n)),a=Sl(at(t,i,e));return!!(r!==s&&o!==a||r===0&&Ml(n,t,e)||s===0&&Ml(n,i,e)||o===0&&Ml(t,n,i)||a===0&&Ml(t,e,i))}function Ml(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Sl(n){return n>0?1:n<0?-1:0}function AS(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&fp(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function jo(n,e){return at(n.prev,n,n.next)<0?at(n,e,n.next)>=0&&at(n,n.prev,e)>=0:at(n,e,n.prev)<0||at(n,n.next,e)<0}function CS(n,e){let t=n,i=!1,r=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function pp(n,e){let t=new Su(n.i,n.x,n.y),i=new Su(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function dp(n,e,t,i){let r=new Su(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Wo(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Su(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pS(n,e,t,i){let r=0;for(let s=e,o=t-i;s<t;s+=i)r+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return r}var $i={area:function(n){let e=n.length,t=0;for(let i=e-1,r=0;r<e;i=r++)t+=n[i].x*n[r].y-n[r].x*n[i].y;return t*.5},isClockWise:function(n){return $i.area(n)<0},triangulateShape:function(n,e){let t=[],i=[],r=[];mp(n),gp(t,n);let s=n.length;e.forEach(mp);for(let a=0;a<e.length;a++)i.push(s),s+=e[a].length,gp(t,e[a]);let o=fS.triangulate(t,i);for(let a=0;a<o.length;a+=3)r.push(o.slice(a,a+3));return r}};function mp(n){let e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function gp(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}var Tu=class extends We{constructor(e,t){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let i=this,r=[],s=[];for(let a=0,c=e.length;a<c;a++){let u=e[a];o(u)}this.setAttribute("position",new je(r,3)),this.setAttribute("uv",new je(s,2)),this.computeVertexNormals();function o(a){let c=[],u=t.curveSegments!==void 0?t.curveSegments:12,d=t.steps!==void 0?t.steps:1,f=t.depth!==void 0?t.depth:100,l=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:h-2,m=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3,_=t.extrudePath,g=t.UVGenerator!==void 0?t.UVGenerator:LS;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),f=t.amount);let y,b=!1,w,x,S,P;_&&(y=_.getSpacedPoints(d),b=!0,l=!1,w=_.computeFrenetFrames(d,!1),x=new k,S=new k,P=new k),l||(v=0,h=0,p=0,m=0);let T=a.extractPoints(u),I=T.shape,U=T.holes;if(!$i.isClockWise(I)){I=I.reverse();for(let z=0,H=U.length;z<H;z++){let Y=U[z];$i.isClockWise(Y)&&(U[z]=Y.reverse())}}let D=$i.triangulateShape(I,U),L=I;for(let z=0,H=U.length;z<H;z++){let Y=U[z];I=I.concat(Y)}function O(z,H,Y){return H||console.error("THREE.ExtrudeGeometry: vec does not exist"),H.clone().multiplyScalar(Y).add(z)}let F=I.length,Z=D.length;function ee(z,H,Y){let K,J,A,E=z.x-H.x,ie=z.y-H.y,$=Y.x-z.x,q=Y.y-z.y,le=E*E+ie*ie,fe=E*q-ie*$;if(Math.abs(fe)>Number.EPSILON){let me=Math.sqrt(le),he=Math.sqrt($*$+q*q),j=H.x-ie/me,pe=H.y+E/me,we=Y.x-q/he,_e=Y.y+$/he,Se=((we-j)*q-(_e-pe)*$)/(E*q-ie*$);K=j+E*Se-z.x,J=pe+ie*Se-z.y;let Pe=K*K+J*J;if(Pe<=2)return new ae(K,J);A=Math.sqrt(Pe/2)}else{let me=!1;E>Number.EPSILON?$>Number.EPSILON&&(me=!0):E<-Number.EPSILON?$<-Number.EPSILON&&(me=!0):Math.sign(ie)===Math.sign(q)&&(me=!0),me?(K=-ie,J=E,A=Math.sqrt(le)):(K=E,J=ie,A=Math.sqrt(le/2))}return new ae(K/A,J/A)}let oe=[];for(let z=0,H=L.length,Y=H-1,K=z+1;z<H;z++,Y++,K++)Y===H&&(Y=0),K===H&&(K=0),oe[z]=ee(L[z],L[Y],L[K]);let ge=[],de,ne=oe.concat();for(let z=0,H=U.length;z<H;z++){let Y=U[z];de=[];for(let K=0,J=Y.length,A=J-1,E=K+1;K<J;K++,A++,E++)A===J&&(A=0),E===J&&(E=0),de[K]=ee(Y[K],Y[A],Y[E]);ge.push(de),ne=ne.concat(de)}for(let z=0;z<v;z++){let H=z/v,Y=h*Math.cos(H*Math.PI/2),K=p*Math.sin(H*Math.PI/2)+m;for(let J=0,A=L.length;J<A;J++){let E=O(L[J],oe[J],K);M(E.x,E.y,-Y)}for(let J=0,A=U.length;J<A;J++){let E=U[J];de=ge[J];for(let ie=0,$=E.length;ie<$;ie++){let q=O(E[ie],de[ie],K);M(q.x,q.y,-Y)}}}let Te=p+m;for(let z=0;z<F;z++){let H=l?O(I[z],ne[z],Te):I[z];b?(S.copy(w.normals[0]).multiplyScalar(H.x),x.copy(w.binormals[0]).multiplyScalar(H.y),P.copy(y[0]).add(S).add(x),M(P.x,P.y,P.z)):M(H.x,H.y,0)}for(let z=1;z<=d;z++)for(let H=0;H<F;H++){let Y=l?O(I[H],ne[H],Te):I[H];b?(S.copy(w.normals[z]).multiplyScalar(Y.x),x.copy(w.binormals[z]).multiplyScalar(Y.y),P.copy(y[z]).add(S).add(x),M(P.x,P.y,P.z)):M(Y.x,Y.y,f/d*z)}for(let z=v-1;z>=0;z--){let H=z/v,Y=h*Math.cos(H*Math.PI/2),K=p*Math.sin(H*Math.PI/2)+m;for(let J=0,A=L.length;J<A;J++){let E=O(L[J],oe[J],K);M(E.x,E.y,f+Y)}for(let J=0,A=U.length;J<A;J++){let E=U[J];de=ge[J];for(let ie=0,$=E.length;ie<$;ie++){let q=O(E[ie],de[ie],K);b?M(q.x,q.y+y[d-1].y,y[d-1].x+Y):M(q.x,q.y,f+Y)}}}Ae(),re();function Ae(){let z=r.length/3;if(l){let H=0,Y=F*H;for(let K=0;K<Z;K++){let J=D[K];V(J[2]+Y,J[1]+Y,J[0]+Y)}H=d+v*2,Y=F*H;for(let K=0;K<Z;K++){let J=D[K];V(J[0]+Y,J[1]+Y,J[2]+Y)}}else{for(let H=0;H<Z;H++){let Y=D[H];V(Y[2],Y[1],Y[0])}for(let H=0;H<Z;H++){let Y=D[H];V(Y[0]+F*d,Y[1]+F*d,Y[2]+F*d)}}i.addGroup(z,r.length/3-z,0)}function re(){let z=r.length/3,H=0;C(L,H),H+=L.length;for(let Y=0,K=U.length;Y<K;Y++){let J=U[Y];C(J,H),H+=J.length}i.addGroup(z,r.length/3-z,1)}function C(z,H){let Y=z.length;for(;--Y>=0;){let K=Y,J=Y-1;J<0&&(J=z.length-1);for(let A=0,E=d+v*2;A<E;A++){let ie=F*A,$=F*(A+1),q=H+K+ie,le=H+J+ie,fe=H+J+$,me=H+K+$;B(q,le,fe,me)}}}function M(z,H,Y){c.push(z),c.push(H),c.push(Y)}function V(z,H,Y){G(z),G(H),G(Y);let K=r.length/3,J=g.generateTopUV(i,r,K-3,K-2,K-1);X(J[0]),X(J[1]),X(J[2])}function B(z,H,Y,K){G(z),G(H),G(K),G(H),G(Y),G(K);let J=r.length/3,A=g.generateSideWallUV(i,r,J-6,J-3,J-2,J-1);X(A[0]),X(A[1]),X(A[3]),X(A[1]),X(A[2]),X(A[3])}function G(z){r.push(c[z*3+0]),r.push(c[z*3+1]),r.push(c[z*3+2])}function X(z){s.push(z.x),s.push(z.y)}}}toJSON(){let e=We.prototype.toJSON.call(this),t=this.parameters.shapes,i=this.parameters.options;return RS(t,i,e)}},LS={generateTopUV:function(n,e,t,i,r){let s=e[t*3],o=e[t*3+1],a=e[i*3],c=e[i*3+1],u=e[r*3],d=e[r*3+1];return[new ae(s,o),new ae(a,c),new ae(u,d)]},generateSideWallUV:function(n,e,t,i,r,s){let o=e[t*3],a=e[t*3+1],c=e[t*3+2],u=e[i*3],d=e[i*3+1],f=e[i*3+2],l=e[r*3],h=e[r*3+1],p=e[r*3+2],m=e[s*3],v=e[s*3+1],_=e[s*3+2];return Math.abs(a-d)<.01?[new ae(o,1-c),new ae(u,1-f),new ae(l,1-p),new ae(m,1-_)]:[new ae(a,1-c),new ae(d,1-f),new ae(h,1-p),new ae(v,1-_)]}};function RS(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){let s=n[i];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}function Eu(n,e,t){We.call(this),this.type="ParametricGeometry",this.parameters={func:n,slices:e,stacks:t};let i=[],r=[],s=[],o=[],a=1e-5,c=new k,u=new k,d=new k,f=new k,l=new k;n.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");let h=e+1;for(let p=0;p<=t;p++){let m=p/t;for(let v=0;v<=e;v++){let _=v/e;n(_,m,u),r.push(u.x,u.y,u.z),_-a>=0?(n(_-a,m,d),f.subVectors(u,d)):(n(_+a,m,d),f.subVectors(d,u)),m-a>=0?(n(_,m-a,d),l.subVectors(u,d)):(n(_,m+a,d),l.subVectors(d,u)),c.crossVectors(f,l).normalize(),s.push(c.x,c.y,c.z),o.push(_,m)}}for(let p=0;p<t;p++)for(let m=0;m<e;m++){let v=p*h+m,_=p*h+m+1,g=(p+1)*h+m+1,y=(p+1)*h+m;i.push(v,_,y),i.push(_,g,y)}this.setIndex(i),this.setAttribute("position",new je(r,3)),this.setAttribute("normal",new je(s,3)),this.setAttribute("uv",new je(o,2))}Eu.prototype=Object.create(We.prototype);Eu.prototype.constructor=Eu;var _p=class extends We{constructor(e,t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let i=[],r=[],s=[],o=[],a=0,c=0;if(Array.isArray(e)===!1)u(e);else for(let d=0;d<e.length;d++)u(e[d]),this.addGroup(a,c,d),a+=c,c=0;this.setIndex(i),this.setAttribute("position",new je(r,3)),this.setAttribute("normal",new je(s,3)),this.setAttribute("uv",new je(o,2));function u(d){let f=r.length/3,l=d.extractPoints(t),h=l.shape,p=l.holes;$i.isClockWise(h)===!1&&(h=h.reverse());for(let v=0,_=p.length;v<_;v++){let g=p[v];$i.isClockWise(g)===!0&&(p[v]=g.reverse())}let m=$i.triangulateShape(h,p);for(let v=0,_=p.length;v<_;v++){let g=p[v];h=h.concat(g)}for(let v=0,_=h.length;v<_;v++){let g=h[v];r.push(g.x,g.y,0),s.push(0,0,1),o.push(g.x,g.y)}for(let v=0,_=m.length;v<_;v++){let g=m[v],y=g[0]+f,b=g[1]+f,w=g[2]+f;i.push(y,b,w),c+=3}}}toJSON(){let e=We.prototype.toJSON.call(this),t=this.parameters.shapes;return PS(t,e)}};function PS(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){let r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}var Tl=class extends We{constructor(e=1,t=8,i=6,r=0,s=Math.PI*2,o=0,a=Math.PI){super();this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let c=Math.min(o+a,Math.PI),u=0,d=[],f=new k,l=new k,h=[],p=[],m=[],v=[];for(let _=0;_<=i;_++){let g=[],y=_/i,b=0;_==0&&o==0?b=.5/t:_==i&&c==Math.PI&&(b=-.5/t);for(let w=0;w<=t;w++){let x=w/t;f.x=-e*Math.cos(r+x*s)*Math.sin(o+y*a),f.y=e*Math.cos(o+y*a),f.z=e*Math.sin(r+x*s)*Math.sin(o+y*a),p.push(f.x,f.y,f.z),l.copy(f).normalize(),m.push(l.x,l.y,l.z),v.push(x+b,1-y),g.push(u++)}d.push(g)}for(let _=0;_<i;_++)for(let g=0;g<t;g++){let y=d[_][g+1],b=d[_][g],w=d[_+1][g],x=d[_+1][g+1];(_!==0||o>0)&&h.push(y,b,x),(_!==i-1||c<Math.PI)&&h.push(b,w,x)}this.setIndex(h),this.setAttribute("position",new je(p,3)),this.setAttribute("normal",new je(m,3)),this.setAttribute("uv",new je(v,2))}};function Ts(n){Re.call(this),this.type="ShadowMaterial",this.color=new Me(0),this.transparent=!0,this.setValues(n)}Ts.prototype=Object.create(Re.prototype);Ts.prototype.constructor=Ts;Ts.prototype.isShadowMaterial=!0;Ts.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this};function qo(n){nt.call(this,n),this.type="RawShaderMaterial"}qo.prototype=Object.create(nt.prototype);qo.prototype.constructor=qo;qo.prototype.isRawShaderMaterial=!0;function yt(n){Re.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Me(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zi,this.normalScale=new ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(n)}yt.prototype=Object.create(Re.prototype);yt.prototype.constructor=yt;yt.prototype.isMeshStandardMaterial=!0;yt.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapIntensity=n.envMapIntensity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this.vertexTangents=n.vertexTangents,this};function Kn(n){yt.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ae(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Ie.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(n)}Kn.prototype=Object.create(yt.prototype);Kn.prototype.constructor=Kn;Kn.prototype.isMeshPhysicalMaterial=!0;Kn.prototype.copy=function(n){return yt.prototype.copy.call(this,n),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.reflectivity=n.reflectivity,n.sheen?this.sheen=(this.sheen||new Me).copy(n.sheen):this.sheen=null,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this};function Ar(n){Re.call(this),this.type="MeshPhongMaterial",this.color=new Me(16777215),this.specular=new Me(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zi,this.normalScale=new ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ia,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(n)}Ar.prototype=Object.create(Re.prototype);Ar.prototype.constructor=Ar;Ar.prototype.isMeshPhongMaterial=!0;Ar.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this.specular.copy(n.specular),this.shininess=n.shininess,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this};function Es(n){Re.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Me(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zi,this.normalScale=new ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(n)}Es.prototype=Object.create(Re.prototype);Es.prototype.constructor=Es;Es.prototype.isMeshToonMaterial=!0;Es.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this.map=n.map,this.gradientMap=n.gradientMap,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this};function As(n){Re.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zi,this.normalScale=new ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(n)}As.prototype=Object.create(Re.prototype);As.prototype.constructor=As;As.prototype.isMeshNormalMaterial=!0;As.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this};function Cs(n){Re.call(this),this.type="MeshLambertMaterial",this.color=new Me(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ia,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(n)}Cs.prototype=Object.create(Re.prototype);Cs.prototype.constructor=Cs;Cs.prototype.isMeshLambertMaterial=!0;Cs.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this};function Ls(n){Re.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Me(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zi,this.normalScale=new ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(n)}Ls.prototype=Object.create(Re.prototype);Ls.prototype.constructor=Ls;Ls.prototype.isMeshMatcapMaterial=!0;Ls.prototype.copy=function(n){return Re.prototype.copy.call(this,n),this.defines={MATCAP:""},this.color.copy(n.color),this.matcap=n.matcap,this.map=n.map,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.skinning=n.skinning,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this};function Rs(n){yn.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(n)}Rs.prototype=Object.create(yn.prototype);Rs.prototype.constructor=Rs;Rs.prototype.isLineDashedMaterial=!0;Rs.prototype.copy=function(n){return yn.prototype.copy.call(this,n),this.scale=n.scale,this.dashSize=n.dashSize,this.gapSize=n.gapSize,this};var IS=Object.freeze({__proto__:null,ShadowMaterial:Ts,SpriteMaterial:Er,RawShaderMaterial:qo,ShaderMaterial:nt,PointsMaterial:bi,MeshPhysicalMaterial:Kn,MeshStandardMaterial:yt,MeshPhongMaterial:Ar,MeshToonMaterial:Es,MeshNormalMaterial:As,MeshLambertMaterial:Cs,MeshDepthMaterial:wr,MeshDistanceMaterial:Mr,MeshBasicMaterial:At,MeshMatcapMaterial:Ls,LineDashedMaterial:Rs,LineBasicMaterial:yn,Material:Re}),st={arraySlice:function(n,e,t){return st.isTypedArray(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){function e(r,s){return n[r]-n[s]}let t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i},sortedArray:function(n,e,t){let i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){let a=t[s]*e;for(let c=0;c!==e;++c)r[o++]=n[a+c]}return r},flattenJSON:function(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=n[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),t.push(o)),s=n[r++];while(s!==void 0)},subclip:function(n,e,t,i,r=30){let s=n.clone();s.name=e;let o=[];for(let c=0;c<s.tracks.length;++c){let u=s.tracks[c],d=u.getValueSize(),f=[],l=[];for(let h=0;h<u.times.length;++h){let p=u.times[h]*r;if(!(p<t||p>=i)){f.push(u.times[h]);for(let m=0;m<d;++m)l.push(u.values[h*d+m])}}f.length!==0&&(u.times=st.convertArray(f,u.times.constructor),u.values=st.convertArray(l,u.values.constructor),o.push(u))}s.tracks=o;let a=Infinity;for(let c=0;c<s.tracks.length;++c)a>s.tracks[c].times[0]&&(a=s.tracks[c].times[0]);for(let c=0;c<s.tracks.length;++c)s.tracks[c].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(n,e=0,t=n,i=30){i<=0&&(i=30);let r=t.tracks.length,s=e/i;for(let o=0;o<r;++o){let a=t.tracks[o],c=a.ValueTypeName;if(c==="bool"||c==="string")continue;let u=n.tracks.find(function(_){return _.name===a.name&&_.ValueTypeName===c});if(u===void 0)continue;let d=0,f=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);let l=0,h=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=h/3);let p=a.times.length-1,m;if(s<=a.times[0]){let _=d,g=f-d;m=st.arraySlice(a.values,_,g)}else if(s>=a.times[p]){let _=p*f+d,g=_+f-d;m=st.arraySlice(a.values,_,g)}else{let _=a.createInterpolant(),g=d,y=f-d;_.evaluate(s),m=st.arraySlice(_.resultBuffer,g,y)}c==="quaternion"&&new Pt().fromArray(m).normalize().conjugate().toArray(m);let v=u.times.length;for(let _=0;_<v;++_){let g=_*h+l;if(c==="quaternion")Pt.multiplyQuaternionsFlat(u.values,g,m,0,u.values,g);else{let y=h-l*2;for(let b=0;b<y;++b)u.values[g+b]-=m[b]}}}return n.blendMode=tf,n}};function jt(n,e,t,i){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new e.constructor(t),this.sampleValues=e,this.valueSize=t}Object.assign(jt.prototype,{evaluate:function(n){let e=this.parameterPositions,t=this._cachedIndex,i=e[t],r=e[t-1];e:{t:{let s;n:{i:if(!(n<i)){for(let o=t+2;;){if(i===void 0){if(n<r)break i;return t=e.length,this._cachedIndex=t,this.afterEnd_(t-1,n,r)}if(t===o)break;if(r=i,i=e[++t],n<i)break t}s=e.length;break n}if(!(n>=r)){let o=e[1];n<o&&(t=2,r=o);for(let a=t-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,n,i);if(t===a)break;if(i=r,r=e[--t-1],n>=r)break t}s=t,t=0;break n}break e}for(;t<s;){let o=t+s>>>1;n<e[o]?s=o:t=o+1}if(i=e[t],r=e[t-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,n,i);if(i===void 0)return t=e.length,this._cachedIndex=t,this.afterEnd_(t-1,r,n)}this._cachedIndex=t,this.intervalChanged_(t,r,i)}return this.interpolate_(t,r,n,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(n){let e=this.resultBuffer,t=this.sampleValues,i=this.valueSize,r=n*i;for(let s=0;s!==i;++s)e[s]=t[r+s];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(jt.prototype,{beforeStart_:jt.prototype.copySampleValue_,afterEnd_:jt.prototype.copySampleValue_});function Au(n,e,t,i){jt.call(this,n,e,t,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}Au.prototype=Object.assign(Object.create(jt.prototype),{constructor:Au,DefaultSettings_:{endingStart:Jr,endingEnd:Jr},intervalChanged_:function(n,e,t){let i=this.parameterPositions,r=n-2,s=n+1,o=i[r],a=i[s];if(o===void 0)switch(this.getSettings_().endingStart){case Kr:r=n,o=2*e-t;break;case Ua:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=n,o=t}if(a===void 0)switch(this.getSettings_().endingEnd){case Kr:s=n,a=2*t-e;break;case Ua:s=1,a=t+i[1]-i[0];break;default:s=n-1,a=e}let c=(t-e)*.5,u=this.valueSize;this._weightPrev=c/(e-o),this._weightNext=c/(a-t),this._offsetPrev=r*u,this._offsetNext=s*u},interpolate_:function(n,e,t,i){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=n*o,c=a-o,u=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,l=this._weightNext,h=(t-e)/(i-e),p=h*h,m=p*h,v=-f*m+2*f*p-f*h,_=(1+f)*m+(-1.5-2*f)*p+(-.5+f)*h+1,g=(-1-l)*m+(1.5+l)*p+.5*h,y=l*m-l*p;for(let b=0;b!==o;++b)r[b]=v*s[u+b]+_*s[c+b]+g*s[a+b]+y*s[d+b];return r}});function El(n,e,t,i){jt.call(this,n,e,t,i)}El.prototype=Object.assign(Object.create(jt.prototype),{constructor:El,interpolate_:function(n,e,t,i){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=n*o,c=a-o,u=(t-e)/(i-e),d=1-u;for(let f=0;f!==o;++f)r[f]=s[c+f]*d+s[a+f]*u;return r}});function Cu(n,e,t,i){jt.call(this,n,e,t,i)}Cu.prototype=Object.assign(Object.create(jt.prototype),{constructor:Cu,interpolate_:function(n){return this.copySampleValue_(n-1)}});function Ht(n,e,t,i){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=st.convertArray(e,this.TimeBufferType),this.values=st.convertArray(t,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}Object.assign(Ht,{toJSON:function(n){let e=n.constructor,t;if(e.toJSON!==void 0)t=e.toJSON(n);else{t={name:n.name,times:st.convertArray(n.times,Array),values:st.convertArray(n.values,Array)};let i=n.getInterpolation();i!==n.DefaultInterpolation&&(t.interpolation=i)}return t.type=n.ValueTypeName,t}});Object.assign(Ht.prototype,{constructor:Ht,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:vr,InterpolantFactoryMethodDiscrete:function(n){return new Cu(this.times,this.values,this.getValueSize(),n)},InterpolantFactoryMethodLinear:function(n){return new El(this.times,this.values,this.getValueSize(),n)},InterpolantFactoryMethodSmooth:function(n){return new Au(this.times,this.values,this.getValueSize(),n)},setInterpolation:function(n){let e;switch(n){case Zr:e=this.InterpolantFactoryMethodDiscrete;break;case vr:e=this.InterpolantFactoryMethodLinear;break;case Nc:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(n!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(t);return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Zr;case this.InterpolantFactoryMethodLinear:return vr;case this.InterpolantFactoryMethodSmooth:return Nc}},getValueSize:function(){return this.values.length/this.times.length},shift:function(n){if(n!==0){let e=this.times;for(let t=0,i=e.length;t!==i;++t)e[t]+=n}return this},scale:function(n){if(n!==1){let e=this.times;for(let t=0,i=e.length;t!==i;++t)e[t]*=n}return this},trim:function(n,e){let t=this.times,i=t.length,r=0,s=i-1;for(;r!==i&&t[r]<n;)++r;for(;s!==-1&&t[s]>e;)--s;if(++s,r!==0||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);let o=this.getValueSize();this.times=st.arraySlice(t,r,s),this.values=st.arraySlice(this.values,r*o,s*o)}return this},validate:function(){let n=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);let t=this.times,i=this.values,r=t.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let s=null;for(let o=0;o!==r;o++){let a=t[o];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),n=!1;break}if(s!==null&&s>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,s),n=!1;break}s=a}if(i!==void 0&&st.isTypedArray(i))for(let o=0,a=i.length;o!==a;++o){let c=i[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),n=!1;break}}return n},optimize:function(){let n=st.arraySlice(this.times),e=st.arraySlice(this.values),t=this.getValueSize(),i=this.getInterpolation()===Nc,r=n.length-1,s=1;for(let o=1;o<r;++o){let a=!1,c=n[o],u=n[o+1];if(c!==u&&(o!==1||c!==n[0]))if(i)a=!0;else{let d=o*t,f=d-t,l=d+t;for(let h=0;h!==t;++h){let p=e[d+h];if(p!==e[f+h]||p!==e[l+h]){a=!0;break}}}if(a){if(o!==s){n[s]=n[o];let d=o*t,f=s*t;for(let l=0;l!==t;++l)e[f+l]=e[d+l]}++s}}if(r>0){n[s]=n[r];for(let o=r*t,a=s*t,c=0;c!==t;++c)e[a+c]=e[o+c];++s}return s!==n.length?(this.times=st.arraySlice(n,0,s),this.values=st.arraySlice(e,0,s*t)):(this.times=n,this.values=e),this},clone:function(){let n=st.arraySlice(this.times,0),e=st.arraySlice(this.values,0),t=this.constructor,i=new t(this.name,n,e);return i.createInterpolant=this.createInterpolant,i}});function Lu(n,e,t){Ht.call(this,n,e,t)}Lu.prototype=Object.assign(Object.create(Ht.prototype),{constructor:Lu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Zr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Ru(n,e,t,i){Ht.call(this,n,e,t,i)}Ru.prototype=Object.assign(Object.create(Ht.prototype),{constructor:Ru,ValueTypeName:"color"});function Cr(n,e,t,i){Ht.call(this,n,e,t,i)}Cr.prototype=Object.assign(Object.create(Ht.prototype),{constructor:Cr,ValueTypeName:"number"});function Pu(n,e,t,i){jt.call(this,n,e,t,i)}Pu.prototype=Object.assign(Object.create(jt.prototype),{constructor:Pu,interpolate_:function(n,e,t,i){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(t-e)/(i-e),c=n*o;for(let u=c+o;c!==u;c+=4)Pt.slerpFlat(r,0,s,c-o,s,c,a);return r}});function Ps(n,e,t,i){Ht.call(this,n,e,t,i)}Ps.prototype=Object.assign(Object.create(Ht.prototype),{constructor:Ps,ValueTypeName:"quaternion",DefaultInterpolation:vr,InterpolantFactoryMethodLinear:function(n){return new Pu(this.times,this.values,this.getValueSize(),n)},InterpolantFactoryMethodSmooth:void 0});function Iu(n,e,t,i){Ht.call(this,n,e,t,i)}Iu.prototype=Object.assign(Object.create(Ht.prototype),{constructor:Iu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Zr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Lr(n,e,t,i){Ht.call(this,n,e,t,i)}Lr.prototype=Object.assign(Object.create(Ht.prototype),{constructor:Lr,ValueTypeName:"vector"});function ln(n,e=-1,t,i=kc){this.name=n,this.tracks=t,this.duration=e,this.blendMode=i,this.uuid=Ie.generateUUID(),this.duration<0&&this.resetDuration()}function OS(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cr;case"vector":case"vector2":case"vector3":case"vector4":return Lr;case"color":return Ru;case"quaternion":return Ps;case"bool":case"boolean":return Lu;case"string":return Iu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function DS(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=OS(n.type);if(n.times===void 0){let t=[],i=[];st.flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}Object.assign(ln,{parse:function(n){let e=[],t=n.tracks,i=1/(n.fps||1);for(let s=0,o=t.length;s!==o;++s)e.push(DS(t[s]).scale(i));let r=new ln(n.name,n.duration,e,n.blendMode);return r.uuid=n.uuid,r},toJSON:function(n){let e=[],t=n.tracks,i={name:n.name,duration:n.duration,tracks:e,uuid:n.uuid,blendMode:n.blendMode};for(let r=0,s=t.length;r!==s;++r)e.push(Ht.toJSON(t[r]));return i},CreateFromMorphTargetSequence:function(n,e,t,i){let r=e.length,s=[];for(let o=0;o<r;o++){let a=[],c=[];a.push((o+r-1)%r,o,(o+1)%r),c.push(0,1,0);let u=st.getKeyframeOrder(a);a=st.sortedArray(a,1,u),c=st.sortedArray(c,1,u),!i&&a[0]===0&&(a.push(r),c.push(c[0])),s.push(new Cr(".morphTargetInfluences["+e[o].name+"]",a,c).scale(1/t))}return new ln(n,-1,s)},findByName:function(n,e){let t=n;if(!Array.isArray(n)){let i=n;t=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<t.length;i++)if(t[i].name===e)return t[i];return null},CreateClipsFromMorphTargetSequences:function(n,e,t){let i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,a=n.length;o<a;o++){let c=n[o],u=c.name.match(r);if(u&&u.length>1){let d=u[1],f=i[d];f||(i[d]=f=[]),f.push(c)}}let s=[];for(let o in i)s.push(ln.CreateFromMorphTargetSequence(o,i[o],e,t));return s},parseAnimation:function(n,e){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let t=function(d,f,l,h,p){if(l.length!==0){let m=[],v=[];st.flattenJSON(l,m,v,h),m.length!==0&&p.push(new d(f,m,v))}},i=[],r=n.name||"default",s=n.fps||30,o=n.blendMode,a=n.length||-1,c=n.hierarchy||[];for(let d=0;d<c.length;d++){let f=c[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){let l={},h;for(h=0;h<f.length;h++)if(f[h].morphTargets)for(let p=0;p<f[h].morphTargets.length;p++)l[f[h].morphTargets[p]]=-1;for(let p in l){let m=[],v=[];for(let _=0;_!==f[h].morphTargets.length;++_){let g=f[h];m.push(g.time),v.push(g.morphTarget===p?1:0)}i.push(new Cr(".morphTargetInfluence["+p+"]",m,v))}a=l.length*(s||1)}else{let l=".bones["+e[d].name+"]";t(Lr,l+".position",f,"pos",i),t(Ps,l+".quaternion",f,"rot",i),t(Lr,l+".scale",f,"scl",i)}}return i.length===0?null:new ln(r,a,i,o)}});Object.assign(ln.prototype,{resetDuration:function(){let n=this.tracks,e=0;for(let t=0,i=n.length;t!==i;++t){let r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this},validate:function(){let n=!0;for(let e=0;e<this.tracks.length;e++)n=n&&this.tracks[e].validate();return n},optimize:function(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this},clone:function(){let n=[];for(let e=0;e<this.tracks.length;e++)n.push(this.tracks[e].clone());return new ln(this.name,this.duration,n,this.blendMode)},toJSON:function(){return ln.toJSON(this)}});var Is={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};function Al(n,e,t){let i=this,r=!1,s=0,o=0,a,c=[];this.onStart=void 0,this.onLoad=n,this.onProgress=e,this.onError=t,this.itemStart=function(u){o++,r===!1&&i.onStart!==void 0&&i.onStart(u,s,o),r=!0},this.itemEnd=function(u){s++,i.onProgress!==void 0&&i.onProgress(u,s,o),s===o&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return a?a(u):u},this.setURLModifier=function(u){return a=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){let d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,f=c.length;d<f;d+=2){let l=c[d],h=c[d+1];if(l.global&&(l.lastIndex=0),l.test(u))return h}return null}}var FS=new Al;function qe(n){this.manager=n!==void 0?n:FS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(qe.prototype,{load:function(){},loadAsync:function(n,e){let t=this;return new Promise(function(i,r){t.load(n,i,e,r)})},parse:function(){},setCrossOrigin:function(n){return this.crossOrigin=n,this},setWithCredentials:function(n){return this.withCredentials=n,this},setPath:function(n){return this.path=n,this},setResourcePath:function(n){return this.resourcePath=n,this},setRequestHeader:function(n){return this.requestHeader=n,this}});var Fn={};function xn(n){qe.call(this,n)}xn.prototype=Object.assign(Object.create(qe.prototype),{constructor:xn,load:function(n,e,t,i){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);let r=this,s=Is.get(n);if(s!==void 0)return r.manager.itemStart(n),setTimeout(function(){e&&e(s),r.manager.itemEnd(n)},0),s;if(Fn[n]!==void 0){Fn[n].push({onLoad:e,onProgress:t,onError:i});return}let o=/^data:(.*?)(;base64)?,(.*)$/,a=n.match(o),c;if(a){let u=a[1],d=!!a[2],f=a[3];f=decodeURIComponent(f),d&&(f=atob(f));try{let l,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":let p=new Uint8Array(f.length);for(let v=0;v<f.length;v++)p[v]=f.charCodeAt(v);h==="blob"?l=new Blob([p.buffer],{type:u}):l=p.buffer;break;case"document":l=new DOMParser().parseFromString(f,u);break;case"json":l=JSON.parse(f);break;default:l=f;break}setTimeout(function(){e&&e(l),r.manager.itemEnd(n)},0)}catch(l){setTimeout(function(){i&&i(l),r.manager.itemError(n),r.manager.itemEnd(n)},0)}}else{Fn[n]=[],Fn[n].push({onLoad:e,onProgress:t,onError:i}),c=new XMLHttpRequest,c.open("GET",n,!0),c.addEventListener("load",function(u){let d=this.response,f=Fn[n];if(delete Fn[n],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Is.add(n,d);for(let l=0,h=f.length;l<h;l++){let p=f[l];p.onLoad&&p.onLoad(d)}r.manager.itemEnd(n)}else{for(let l=0,h=f.length;l<h;l++){let p=f[l];p.onError&&p.onError(u)}r.manager.itemError(n),r.manager.itemEnd(n)}},!1),c.addEventListener("progress",function(u){let d=Fn[n];for(let f=0,l=d.length;f<l;f++){let h=d[f];h.onProgress&&h.onProgress(u)}},!1),c.addEventListener("error",function(u){let d=Fn[n];delete Fn[n];for(let f=0,l=d.length;f<l;f++){let h=d[f];h.onError&&h.onError(u)}r.manager.itemError(n),r.manager.itemEnd(n)},!1),c.addEventListener("abort",function(u){let d=Fn[n];delete Fn[n];for(let f=0,l=d.length;f<l;f++){let h=d[f];h.onError&&h.onError(u)}r.manager.itemError(n),r.manager.itemEnd(n)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(let u in this.requestHeader)c.setRequestHeader(u,this.requestHeader[u]);c.send(null)}return r.manager.itemStart(n),c},setResponseType:function(n){return this.responseType=n,this},setMimeType:function(n){return this.mimeType=n,this}});function vp(n){qe.call(this,n)}vp.prototype=Object.assign(Object.create(qe.prototype),{constructor:vp,load:function(n,e,t,i){let r=this,s=new xn(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(n,function(o){try{e(r.parse(JSON.parse(o)))}catch(a){i?i(a):console.error(a),r.manager.itemError(n)}},t,i)},parse:function(n){let e=[];for(let t=0;t<n.length;t++){let i=ln.parse(n[t]);e.push(i)}return e}});function yp(n){qe.call(this,n)}yp.prototype=Object.assign(Object.create(qe.prototype),{constructor:yp,load:function(n,e,t,i){let r=this,s=[],o=new Go,a=new xn(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let c=0;function u(d){a.load(n[d],function(f){let l=r.parse(f,!0);s[d]={width:l.width,height:l.height,format:l.format,mipmaps:l.mipmaps},c+=1,c===6&&(l.mipmapCount===1&&(o.minFilter=Xe),o.image=s,o.format=l.format,o.needsUpdate=!0,e&&e(o))},t,i)}if(Array.isArray(n))for(let d=0,f=n.length;d<f;++d)u(d);else a.load(n,function(d){let f=r.parse(d,!0);if(f.isCubemap){let l=f.mipmaps.length/f.mipmapCount;for(let h=0;h<l;h++){s[h]={mipmaps:[]};for(let p=0;p<f.mipmapCount;p++)s[h].mipmaps.push(f.mipmaps[h*f.mipmapCount+p]),s[h].format=f.format,s[h].width=f.width,s[h].height=f.height}o.image=s}else o.image.width=f.width,o.image.height=f.height,o.mipmaps=f.mipmaps;f.mipmapCount===1&&(o.minFilter=Xe),o.format=f.format,o.needsUpdate=!0,e&&e(o)},t,i);return o}});function Cl(n){qe.call(this,n)}Cl.prototype=Object.assign(Object.create(qe.prototype),{constructor:Cl,load:function(n,e,t,i){this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);let r=this,s=Is.get(n);if(s!==void 0)return r.manager.itemStart(n),setTimeout(function(){e&&e(s),r.manager.itemEnd(n)},0),s;let o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1),Is.add(n,this),e&&e(this),r.manager.itemEnd(n)}function c(u){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1),i&&i(u),r.manager.itemError(n),r.manager.itemEnd(n)}return o.addEventListener("load",a,!1),o.addEventListener("error",c,!1),n.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(n),o.src=n,o}});function Ou(n){qe.call(this,n)}Ou.prototype=Object.assign(Object.create(qe.prototype),{constructor:Ou,load:function(n,e,t,i){let r=new Yi,s=new Cl(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(c){s.load(n[c],function(u){r.images[c]=u,o++,o===6&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let c=0;c<n.length;++c)a(c);return r}});function xp(n){qe.call(this,n)}xp.prototype=Object.assign(Object.create(qe.prototype),{constructor:xp,load:function(n,e,t,i){let r=this,s=new ms,o=new xn(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(n,function(a){let c=r.parse(a);!c||(c.image!==void 0?s.image=c.image:c.data!==void 0&&(s.image.width=c.width,s.image.height=c.height,s.image.data=c.data),s.wrapS=c.wrapS!==void 0?c.wrapS:Wt,s.wrapT=c.wrapT!==void 0?c.wrapT:Wt,s.magFilter=c.magFilter!==void 0?c.magFilter:Xe,s.minFilter=c.minFilter!==void 0?c.minFilter:Xe,s.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.encoding!==void 0&&(s.encoding=c.encoding),c.flipY!==void 0&&(s.flipY=c.flipY),c.format!==void 0&&(s.format=c.format),c.type!==void 0&&(s.type=c.type),c.mipmaps!==void 0&&(s.mipmaps=c.mipmaps,s.minFilter=_r),c.mipmapCount===1&&(s.minFilter=Xe),s.needsUpdate=!0,e&&e(s,c))},t,i),s}});function Xo(n){qe.call(this,n)}Xo.prototype=Object.assign(Object.create(qe.prototype),{constructor:Xo,load:function(n,e,t,i){let r=new Qe,s=new Cl(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(n,function(o){r.image=o;let a=n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0;r.format=a?fi:Et,r.needsUpdate=!0,e!==void 0&&e(r)},t,i),r}});function Ee(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Ee.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(n,e){let t=this.getUtoTmapping(n);return this.getPoint(t,e)},getPoints:function(n=5){let e=[];for(let t=0;t<=n;t++)e.push(this.getPoint(t/n));return e},getSpacedPoints:function(n=5){let e=[];for(let t=0;t<=n;t++)e.push(this.getPointAt(t/n));return e},getLength:function(){let n=this.getLengths();return n[n.length-1]},getLengths:function(n){if(n===void 0&&(n=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===n+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e=[],t,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=n;s++)t=this.getPoint(s/n),r+=t.distanceTo(i),e.push(r),i=t;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(n,e){let t=this.getLengths(),i=0,r=t.length,s;e?s=e:s=n*t[r-1];let o=0,a=r-1,c;for(;o<=a;)if(i=Math.floor(o+(a-o)/2),c=t[i]-s,c<0)o=i+1;else if(c>0)a=i-1;else{a=i;break}if(i=a,t[i]===s)return i/(r-1);let u=t[i],f=t[i+1]-u,l=(s-u)/f;return(i+l)/(r-1)},getTangent:function(n,e){let t=1e-4,i=n-t,r=n+t;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),o=this.getPoint(r),a=e||(s.isVector2?new ae:new k);return a.copy(o).sub(s).normalize(),a},getTangentAt:function(n,e){let t=this.getUtoTmapping(n);return this.getTangent(t,e)},computeFrenetFrames:function(n,e){let t=new k,i=[],r=[],s=[],o=new k,a=new Fe;for(let l=0;l<=n;l++){let h=l/n;i[l]=this.getTangentAt(h,new k),i[l].normalize()}r[0]=new k,s[0]=new k;let c=Number.MAX_VALUE,u=Math.abs(i[0].x),d=Math.abs(i[0].y),f=Math.abs(i[0].z);u<=c&&(c=u,t.set(1,0,0)),d<=c&&(c=d,t.set(0,1,0)),f<=c&&t.set(0,0,1),o.crossVectors(i[0],t).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let l=1;l<=n;l++){if(r[l]=r[l-1].clone(),s[l]=s[l-1].clone(),o.crossVectors(i[l-1],i[l]),o.length()>Number.EPSILON){o.normalize();let h=Math.acos(Ie.clamp(i[l-1].dot(i[l]),-1,1));r[l].applyMatrix4(a.makeRotationAxis(o,h))}s[l].crossVectors(i[l],r[l])}if(e===!0){let l=Math.acos(Ie.clamp(r[0].dot(r[n]),-1,1));l/=n,i[0].dot(o.crossVectors(r[0],r[n]))>0&&(l=-l);for(let h=1;h<=n;h++)r[h].applyMatrix4(a.makeRotationAxis(i[h],l*h)),s[h].crossVectors(i[h],r[h])}return{tangents:i,normals:r,binormals:s}},clone:function(){return new this.constructor().copy(this)},copy:function(n){return this.arcLengthDivisions=n.arcLengthDivisions,this},toJSON:function(){let n={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return n.arcLengthDivisions=this.arcLengthDivisions,n.type=this.type,n},fromJSON:function(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}});function bn(n,e,t,i,r,s,o,a){Ee.call(this),this.type="EllipseCurve",this.aX=n||0,this.aY=e||0,this.xRadius=t||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=o||!1,this.aRotation=a||0}bn.prototype=Object.create(Ee.prototype);bn.prototype.constructor=bn;bn.prototype.isEllipseCurve=!0;bn.prototype.getPoint=function(n,e){let t=e||new ae,i=Math.PI*2,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(s?r=0:r=i),this.aClockwise===!0&&!s&&(r===i?r=-i:r=r-i);let o=this.aStartAngle+n*r,a=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){let u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=a-this.aX,l=c-this.aY;a=f*u-l*d+this.aX,c=f*d+l*u+this.aY}return t.set(a,c)};bn.prototype.copy=function(n){return Ee.prototype.copy.call(this,n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this};bn.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);return n.aX=this.aX,n.aY=this.aY,n.xRadius=this.xRadius,n.yRadius=this.yRadius,n.aStartAngle=this.aStartAngle,n.aEndAngle=this.aEndAngle,n.aClockwise=this.aClockwise,n.aRotation=this.aRotation,n};bn.prototype.fromJSON=function(n){return Ee.prototype.fromJSON.call(this,n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this};function Yo(n,e,t,i,r,s){bn.call(this,n,e,t,t,i,r,s),this.type="ArcCurve"}Yo.prototype=Object.create(bn.prototype);Yo.prototype.constructor=Yo;Yo.prototype.isArcCurve=!0;function Du(){let n=0,e=0,t=0,i=0;function r(s,o,a,c){n=s,e=a,t=-3*s+3*o-2*a-c,i=2*s-2*o+a+c}return{initCatmullRom:function(s,o,a,c,u){r(o,a,u*(a-s),u*(c-o))},initNonuniformCatmullRom:function(s,o,a,c,u,d,f){let l=(o-s)/u-(a-s)/(u+d)+(a-o)/d,h=(a-o)/d-(c-o)/(d+f)+(c-a)/f;l*=d,h*=d,r(o,a,l,h)},calc:function(s){let o=s*s,a=o*s;return n+e*s+t*o+i*a}}}var Ll=new k,Fu=new Du,Bu=new Du,Nu=new Du;function Bn(n=[],e=!1,t="centripetal",i=.5){Ee.call(this),this.type="CatmullRomCurve3",this.points=n,this.closed=e,this.curveType=t,this.tension=i}Bn.prototype=Object.create(Ee.prototype);Bn.prototype.constructor=Bn;Bn.prototype.isCatmullRomCurve3=!0;Bn.prototype.getPoint=function(n,e=new k){let t=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*n,o=Math.floor(s),a=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:a===0&&o===r-1&&(o=r-2,a=1);let c,u;this.closed||o>0?c=i[(o-1)%r]:(Ll.subVectors(i[0],i[1]).add(i[0]),c=Ll);let d=i[o%r],f=i[(o+1)%r];if(this.closed||o+2<r?u=i[(o+2)%r]:(Ll.subVectors(i[r-1],i[r-2]).add(i[r-1]),u=Ll),this.curveType==="centripetal"||this.curveType==="chordal"){let l=this.curveType==="chordal"?.5:.25,h=Math.pow(c.distanceToSquared(d),l),p=Math.pow(d.distanceToSquared(f),l),m=Math.pow(f.distanceToSquared(u),l);p<1e-4&&(p=1),h<1e-4&&(h=p),m<1e-4&&(m=p),Fu.initNonuniformCatmullRom(c.x,d.x,f.x,u.x,h,p,m),Bu.initNonuniformCatmullRom(c.y,d.y,f.y,u.y,h,p,m),Nu.initNonuniformCatmullRom(c.z,d.z,f.z,u.z,h,p,m)}else this.curveType==="catmullrom"&&(Fu.initCatmullRom(c.x,d.x,f.x,u.x,this.tension),Bu.initCatmullRom(c.y,d.y,f.y,u.y,this.tension),Nu.initCatmullRom(c.z,d.z,f.z,u.z,this.tension));return t.set(Fu.calc(a),Bu.calc(a),Nu.calc(a)),t};Bn.prototype.copy=function(n){Ee.prototype.copy.call(this,n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){let i=n.points[e];this.points.push(i.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this};Bn.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);n.points=[];for(let e=0,t=this.points.length;e<t;e++){let i=this.points[e];n.points.push(i.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n};Bn.prototype.fromJSON=function(n){Ee.prototype.fromJSON.call(this,n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){let i=n.points[e];this.points.push(new k().fromArray(i))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this};function bp(n,e,t,i,r){let s=(i-e)*.5,o=(r-t)*.5,a=n*n,c=n*a;return(2*t-2*i+s+o)*c+(-3*t+3*i-2*s-o)*a+s*n+t}function BS(n,e){let t=1-n;return t*t*e}function NS(n,e){return 2*(1-n)*n*e}function kS(n,e){return n*n*e}function Zo(n,e,t,i){return BS(n,e)+NS(n,t)+kS(n,i)}function zS(n,e){let t=1-n;return t*t*t*e}function HS(n,e){let t=1-n;return 3*t*t*n*e}function US(n,e){return 3*(1-n)*n*n*e}function GS(n,e){return n*n*n*e}function Jo(n,e,t,i,r){return zS(n,e)+HS(n,t)+US(n,i)+GS(n,r)}function $n(n=new ae,e=new ae,t=new ae,i=new ae){Ee.call(this),this.type="CubicBezierCurve",this.v0=n,this.v1=e,this.v2=t,this.v3=i}$n.prototype=Object.create(Ee.prototype);$n.prototype.constructor=$n;$n.prototype.isCubicBezierCurve=!0;$n.prototype.getPoint=function(n,e=new ae){let t=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return t.set(Jo(n,i.x,r.x,s.x,o.x),Jo(n,i.y,r.y,s.y,o.y)),t};$n.prototype.copy=function(n){return Ee.prototype.copy.call(this,n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this};$n.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n};$n.prototype.fromJSON=function(n){return Ee.prototype.fromJSON.call(this,n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this};function wi(n=new k,e=new k,t=new k,i=new k){Ee.call(this),this.type="CubicBezierCurve3",this.v0=n,this.v1=e,this.v2=t,this.v3=i}wi.prototype=Object.create(Ee.prototype);wi.prototype.constructor=wi;wi.prototype.isCubicBezierCurve3=!0;wi.prototype.getPoint=function(n,e=new k){let t=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return t.set(Jo(n,i.x,r.x,s.x,o.x),Jo(n,i.y,r.y,s.y,o.y),Jo(n,i.z,r.z,s.z,o.z)),t};wi.prototype.copy=function(n){return Ee.prototype.copy.call(this,n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this};wi.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n};wi.prototype.fromJSON=function(n){return Ee.prototype.fromJSON.call(this,n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this};function cn(n=new ae,e=new ae){Ee.call(this),this.type="LineCurve",this.v1=n,this.v2=e}cn.prototype=Object.create(Ee.prototype);cn.prototype.constructor=cn;cn.prototype.isLineCurve=!0;cn.prototype.getPoint=function(n,e=new ae){let t=e;return n===1?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(n).add(this.v1)),t};cn.prototype.getPointAt=function(n,e){return this.getPoint(n,e)};cn.prototype.getTangent=function(n,e){let t=e||new ae;return t.copy(this.v2).sub(this.v1).normalize(),t};cn.prototype.copy=function(n){return Ee.prototype.copy.call(this,n),this.v1.copy(n.v1),this.v2.copy(n.v2),this};cn.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n};cn.prototype.fromJSON=function(n){return Ee.prototype.fromJSON.call(this,n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this};function Qn(n=new k,e=new k){Ee.call(this),this.type="LineCurve3",this.v1=n,this.v2=e}Qn.prototype=Object.create(Ee.prototype);Qn.prototype.constructor=Qn;Qn.prototype.isLineCurve3=!0;Qn.prototype.getPoint=function(n,e=new k){let t=e;return n===1?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(n).add(this.v1)),t};Qn.prototype.getPointAt=function(n,e){return this.getPoint(n,e)};Qn.prototype.copy=function(n){return Ee.prototype.copy.call(this,n),this.v1.copy(n.v1),this.v2.copy(n.v2),this};Qn.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n};Qn.prototype.fromJSON=function(n){return Ee.prototype.fromJSON.call(this,n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this};function ei(n=new ae,e=new ae,t=new ae){Ee.call(this),this.type="QuadraticBezierCurve",this.v0=n,this.v1=e,this.v2=t}ei.prototype=Object.create(Ee.prototype);ei.prototype.constructor=ei;ei.prototype.isQuadraticBezierCurve=!0;ei.prototype.getPoint=function(n,e=new ae){let t=e,i=this.v0,r=this.v1,s=this.v2;return t.set(Zo(n,i.x,r.x,s.x),Zo(n,i.y,r.y,s.y)),t};ei.prototype.copy=function(n){return Ee.prototype.copy.call(this,n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this};ei.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n};ei.prototype.fromJSON=function(n){return Ee.prototype.fromJSON.call(this,n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this};function Mi(n=new k,e=new k,t=new k){Ee.call(this),this.type="QuadraticBezierCurve3",this.v0=n,this.v1=e,this.v2=t}Mi.prototype=Object.create(Ee.prototype);Mi.prototype.constructor=Mi;Mi.prototype.isQuadraticBezierCurve3=!0;Mi.prototype.getPoint=function(n,e=new k){let t=e,i=this.v0,r=this.v1,s=this.v2;return t.set(Zo(n,i.x,r.x,s.x),Zo(n,i.y,r.y,s.y),Zo(n,i.z,r.z,s.z)),t};Mi.prototype.copy=function(n){return Ee.prototype.copy.call(this,n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this};Mi.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n};Mi.prototype.fromJSON=function(n){return Ee.prototype.fromJSON.call(this,n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this};function ti(n=[]){Ee.call(this),this.type="SplineCurve",this.points=n}ti.prototype=Object.create(Ee.prototype);ti.prototype.constructor=ti;ti.prototype.isSplineCurve=!0;ti.prototype.getPoint=function(n,e=new ae){let t=e,i=this.points,r=(i.length-1)*n,s=Math.floor(r),o=r-s,a=i[s===0?s:s-1],c=i[s],u=i[s>i.length-2?i.length-1:s+1],d=i[s>i.length-3?i.length-1:s+2];return t.set(bp(o,a.x,c.x,u.x,d.x),bp(o,a.y,c.y,u.y,d.y)),t};ti.prototype.copy=function(n){Ee.prototype.copy.call(this,n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){let i=n.points[e];this.points.push(i.clone())}return this};ti.prototype.toJSON=function(){let n=Ee.prototype.toJSON.call(this);n.points=[];for(let e=0,t=this.points.length;e<t;e++){let i=this.points[e];n.points.push(i.toArray())}return n};ti.prototype.fromJSON=function(n){Ee.prototype.fromJSON.call(this,n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){let i=n.points[e];this.points.push(new ae().fromArray(i))}return this};var VS=Object.freeze({__proto__:null,ArcCurve:Yo,CatmullRomCurve3:Bn,CubicBezierCurve:$n,CubicBezierCurve3:wi,EllipseCurve:bn,LineCurve:cn,LineCurve3:Qn,QuadraticBezierCurve:ei,QuadraticBezierCurve3:Mi,SplineCurve:ti});function Rr(){Ee.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}Rr.prototype=Object.assign(Object.create(Ee.prototype),{constructor:Rr,add:function(n){this.curves.push(n)},closePath:function(){let n=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);n.equals(e)||this.curves.push(new cn(e,n))},getPoint:function(n){let e=n*this.getLength(),t=this.getCurveLengths(),i=0;for(;i<t.length;){if(t[i]>=e){let r=t[i]-e,s=this.curves[i],o=s.getLength(),a=o===0?0:1-r/o;return s.getPointAt(a)}i++}return null},getLength:function(){let n=this.getCurveLengths();return n[n.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let n=[],e=0;for(let t=0,i=this.curves.length;t<i;t++)e+=this.curves[t].getLength(),n.push(e);return this.cacheLengths=n,n},getSpacedPoints:function(n=40){let e=[];for(let t=0;t<=n;t++)e.push(this.getPoint(t/n));return this.autoClose&&e.push(e[0]),e},getPoints:function(n=12){let e=[],t;for(let i=0,r=this.curves;i<r.length;i++){let s=r[i],o=s&&s.isEllipseCurve?n*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?n*s.points.length:n,a=s.getPoints(o);for(let c=0;c<a.length;c++){let u=a[c];t&&t.equals(u)||(e.push(u),t=u)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(n){Ee.prototype.copy.call(this,n),this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){let i=n.curves[e];this.curves.push(i.clone())}return this.autoClose=n.autoClose,this},toJSON:function(){let n=Ee.prototype.toJSON.call(this);n.autoClose=this.autoClose,n.curves=[];for(let e=0,t=this.curves.length;e<t;e++){let i=this.curves[e];n.curves.push(i.toJSON())}return n},fromJSON:function(n){Ee.prototype.fromJSON.call(this,n),this.autoClose=n.autoClose,this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){let i=n.curves[e];this.curves.push(new VS[i.type]().fromJSON(i))}return this}});function ni(n){Rr.call(this),this.type="Path",this.currentPoint=new ae,n&&this.setFromPoints(n)}ni.prototype=Object.assign(Object.create(Rr.prototype),{constructor:ni,setFromPoints:function(n){this.moveTo(n[0].x,n[0].y);for(let e=1,t=n.length;e<t;e++)this.lineTo(n[e].x,n[e].y);return this},moveTo:function(n,e){return this.currentPoint.set(n,e),this},lineTo:function(n,e){let t=new cn(this.currentPoint.clone(),new ae(n,e));return this.curves.push(t),this.currentPoint.set(n,e),this},quadraticCurveTo:function(n,e,t,i){let r=new ei(this.currentPoint.clone(),new ae(n,e),new ae(t,i));return this.curves.push(r),this.currentPoint.set(t,i),this},bezierCurveTo:function(n,e,t,i,r,s){let o=new $n(this.currentPoint.clone(),new ae(n,e),new ae(t,i),new ae(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this},splineThru:function(n){let e=[this.currentPoint.clone()].concat(n),t=new ti(e);return this.curves.push(t),this.currentPoint.copy(n[n.length-1]),this},arc:function(n,e,t,i,r,s){let o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(n+o,e+a,t,i,r,s),this},absarc:function(n,e,t,i,r,s){return this.absellipse(n,e,t,t,i,r,s),this},ellipse:function(n,e,t,i,r,s,o,a){let c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(n+c,e+u,t,i,r,s,o,a),this},absellipse:function(n,e,t,i,r,s,o,a){let c=new bn(n,e,t,i,r,s,o,a);if(this.curves.length>0){let d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);let u=c.getPoint(1);return this.currentPoint.copy(u),this},copy:function(n){return Rr.prototype.copy.call(this,n),this.currentPoint.copy(n.currentPoint),this},toJSON:function(){let n=Rr.prototype.toJSON.call(this);return n.currentPoint=this.currentPoint.toArray(),n},fromJSON:function(n){return Rr.prototype.fromJSON.call(this,n),this.currentPoint.fromArray(n.currentPoint),this}});function Os(n){ni.call(this,n),this.uuid=Ie.generateUUID(),this.type="Shape",this.holes=[]}Os.prototype=Object.assign(Object.create(ni.prototype),{constructor:Os,getPointsHoles:function(n){let e=[];for(let t=0,i=this.holes.length;t<i;t++)e[t]=this.holes[t].getPoints(n);return e},extractPoints:function(n){return{shape:this.getPoints(n),holes:this.getPointsHoles(n)}},copy:function(n){ni.prototype.copy.call(this,n),this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){let i=n.holes[e];this.holes.push(i.clone())}return this},toJSON:function(){let n=ni.prototype.toJSON.call(this);n.uuid=this.uuid,n.holes=[];for(let e=0,t=this.holes.length;e<t;e++){let i=this.holes[e];n.holes.push(i.toJSON())}return n},fromJSON:function(n){ni.prototype.fromJSON.call(this,n),this.uuid=n.uuid,this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){let i=n.holes[e];this.holes.push(new ni().fromJSON(i))}return this}});function it(n,e=1){Ce.call(this),this.type="Light",this.color=new Me(n),this.intensity=e}it.prototype=Object.assign(Object.create(Ce.prototype),{constructor:it,isLight:!0,copy:function(n){return Ce.prototype.copy.call(this,n),this.color.copy(n.color),this.intensity=n.intensity,this},toJSON:function(n){let e=Ce.prototype.toJSON.call(this,n);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}});function wp(n,e,t){it.call(this,n,t),this.type="HemisphereLight",this.position.copy(Ce.DefaultUp),this.updateMatrix(),this.groundColor=new Me(e)}wp.prototype=Object.assign(Object.create(it.prototype),{constructor:wp,isHemisphereLight:!0,copy:function(n){return it.prototype.copy.call(this,n),this.groundColor.copy(n.groundColor),this}});function Si(n){this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new ae(512,512),this.map=null,this.mapPass=null,this.matrix=new Fe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Co,this._frameExtents=new ae(1,1),this._viewportCount=1,this._viewports=[new Ze(0,0,1,1)]}Object.assign(Si.prototype,{_projScreenMatrix:new Fe,_lightPositionWorld:new k,_lookTarget:new k,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(n){let e=this.camera,t=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(n.matrixWorld),e.position.copy(s),r.setFromMatrixPosition(n.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.matrixWorldInverse)},getViewport:function(n){return this._viewports[n]},getFrameExtents:function(){return this._frameExtents},copy:function(n){return this.camera=n.camera.clone(),this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){let n={};return this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}});function ku(){Si.call(this,new ut(50,1,.5,500)),this.focus=1}ku.prototype=Object.assign(Object.create(Si.prototype),{constructor:ku,isSpotLightShadow:!0,updateMatrices:function(n){let e=this.camera,t=Ie.RAD2DEG*2*n.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=n.distance||e.far;(t!==e.fov||i!==e.aspect||r!==e.far)&&(e.fov=t,e.aspect=i,e.far=r,e.updateProjectionMatrix()),Si.prototype.updateMatrices.call(this,n)}});function Rl(n,e,t,i,r,s){it.call(this,n,e),this.type="SpotLight",this.position.copy(Ce.DefaultUp),this.updateMatrix(),this.target=new Ce,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(o){this.intensity=o/Math.PI}}),this.distance=t!==void 0?t:0,this.angle=i!==void 0?i:Math.PI/3,this.penumbra=r!==void 0?r:0,this.decay=s!==void 0?s:1,this.shadow=new ku}Rl.prototype=Object.assign(Object.create(it.prototype),{constructor:Rl,isSpotLight:!0,copy:function(n){return it.prototype.copy.call(this,n),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}});function zu(){Si.call(this,new ut(90,1,.5,500)),this._frameExtents=new ae(4,2),this._viewportCount=6,this._viewports=[new Ze(2,1,1,1),new Ze(0,1,1,1),new Ze(3,1,1,1),new Ze(1,1,1,1),new Ze(3,0,1,1),new Ze(1,0,1,1)],this._cubeDirections=[new k(1,0,0),new k(-1,0,0),new k(0,0,1),new k(0,0,-1),new k(0,1,0),new k(0,-1,0)],this._cubeUps=[new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,0,1),new k(0,0,-1)]}zu.prototype=Object.assign(Object.create(Si.prototype),{constructor:zu,isPointLightShadow:!0,updateMatrices:function(n,e=0){let t=this.camera,i=this.matrix,r=this._lightPositionWorld,s=this._lookTarget,o=this._projScreenMatrix;r.setFromMatrixPosition(n.matrixWorld),t.position.copy(r),s.copy(t.position),s.add(this._cubeDirections[e]),t.up.copy(this._cubeUps[e]),t.lookAt(s),t.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}});function Pl(n,e,t,i){it.call(this,n,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(r){this.intensity=r/(4*Math.PI)}}),this.distance=t!==void 0?t:0,this.decay=i!==void 0?i:1,this.shadow=new zu}Pl.prototype=Object.assign(Object.create(it.prototype),{constructor:Pl,isPointLight:!0,copy:function(n){return it.prototype.copy.call(this,n),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}});function Ti(n=-1,e=1,t=1,i=-1,r=.1,s=2e3){Xi.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=e,this.top=t,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}Ti.prototype=Object.assign(Object.create(Xi.prototype),{constructor:Ti,isOrthographicCamera:!0,copy:function(n,e){return Xi.prototype.copy.call(this,n,e),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this},setViewOffset:function(n,e,t,i,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=t,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let n=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),t=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=t-n,s=t+n,o=i+e,a=i-e;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,s=r+c*this.view.width,o-=u*this.view.offsetY,a=o-u*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(n){let e=Ce.prototype.toJSON.call(this,n);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}});function Hu(){Si.call(this,new Ti(-5,5,5,-5,.5,500))}Hu.prototype=Object.assign(Object.create(Si.prototype),{constructor:Hu,isDirectionalLightShadow:!0,updateMatrices:function(n){Si.prototype.updateMatrices.call(this,n)}});function Pr(n,e){it.call(this,n,e),this.type="DirectionalLight",this.position.copy(Ce.DefaultUp),this.updateMatrix(),this.target=new Ce,this.shadow=new Hu}Pr.prototype=Object.assign(Object.create(it.prototype),{constructor:Pr,isDirectionalLight:!0,copy:function(n){return it.prototype.copy.call(this,n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}});function Ko(n,e){it.call(this,n,e),this.type="AmbientLight"}Ko.prototype=Object.assign(Object.create(it.prototype),{constructor:Ko,isAmbientLight:!0});function Mp(n,e,t,i){it.call(this,n,e),this.type="RectAreaLight",this.width=t!==void 0?t:10,this.height=i!==void 0?i:10}Mp.prototype=Object.assign(Object.create(it.prototype),{constructor:Mp,isRectAreaLight:!0,copy:function(n){return it.prototype.copy.call(this,n),this.width=n.width,this.height=n.height,this},toJSON:function(n){let e=it.prototype.toJSON.call(this,n);return e.object.width=this.width,e.object.height=this.height,e}});var Sp=class{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new k)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(i*s)),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){let i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*i*s),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){let i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){let i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}};function ii(n,e){it.call(this,void 0,e),this.type="LightProbe",this.sh=n!==void 0?n:new Sp}ii.prototype=Object.assign(Object.create(it.prototype),{constructor:ii,isLightProbe:!0,copy:function(n){return it.prototype.copy.call(this,n),this.sh.copy(n.sh),this},fromJSON:function(n){return this.intensity=n.intensity,this.sh.fromArray(n.sh),this},toJSON:function(n){let e=it.prototype.toJSON.call(this,n);return e.object.sh=this.sh.toArray(),e}});function Tp(n){qe.call(this,n),this.textures={}}Tp.prototype=Object.assign(Object.create(qe.prototype),{constructor:Tp,load:function(n,e,t,i){let r=this,s=new xn(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(n,function(o){try{e(r.parse(JSON.parse(o)))}catch(a){i?i(a):console.error(a),r.manager.itemError(n)}},t,i)},parse:function(n){let e=this.textures;function t(r){return e[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),e[r]}let i=new IS[n.type];if(n.uuid!==void 0&&(i.uuid=n.uuid),n.name!==void 0&&(i.name=n.name),n.color!==void 0&&i.color!==void 0&&i.color.setHex(n.color),n.roughness!==void 0&&(i.roughness=n.roughness),n.metalness!==void 0&&(i.metalness=n.metalness),n.sheen!==void 0&&(i.sheen=new Me().setHex(n.sheen)),n.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(n.emissive),n.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(n.specular),n.shininess!==void 0&&(i.shininess=n.shininess),n.clearcoat!==void 0&&(i.clearcoat=n.clearcoat),n.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=n.clearcoatRoughness),n.fog!==void 0&&(i.fog=n.fog),n.flatShading!==void 0&&(i.flatShading=n.flatShading),n.blending!==void 0&&(i.blending=n.blending),n.combine!==void 0&&(i.combine=n.combine),n.side!==void 0&&(i.side=n.side),n.opacity!==void 0&&(i.opacity=n.opacity),n.transparent!==void 0&&(i.transparent=n.transparent),n.alphaTest!==void 0&&(i.alphaTest=n.alphaTest),n.depthTest!==void 0&&(i.depthTest=n.depthTest),n.depthWrite!==void 0&&(i.depthWrite=n.depthWrite),n.colorWrite!==void 0&&(i.colorWrite=n.colorWrite),n.stencilWrite!==void 0&&(i.stencilWrite=n.stencilWrite),n.stencilWriteMask!==void 0&&(i.stencilWriteMask=n.stencilWriteMask),n.stencilFunc!==void 0&&(i.stencilFunc=n.stencilFunc),n.stencilRef!==void 0&&(i.stencilRef=n.stencilRef),n.stencilFuncMask!==void 0&&(i.stencilFuncMask=n.stencilFuncMask),n.stencilFail!==void 0&&(i.stencilFail=n.stencilFail),n.stencilZFail!==void 0&&(i.stencilZFail=n.stencilZFail),n.stencilZPass!==void 0&&(i.stencilZPass=n.stencilZPass),n.wireframe!==void 0&&(i.wireframe=n.wireframe),n.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=n.wireframeLinewidth),n.wireframeLinecap!==void 0&&(i.wireframeLinecap=n.wireframeLinecap),n.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=n.wireframeLinejoin),n.rotation!==void 0&&(i.rotation=n.rotation),n.linewidth!==1&&(i.linewidth=n.linewidth),n.dashSize!==void 0&&(i.dashSize=n.dashSize),n.gapSize!==void 0&&(i.gapSize=n.gapSize),n.scale!==void 0&&(i.scale=n.scale),n.polygonOffset!==void 0&&(i.polygonOffset=n.polygonOffset),n.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=n.polygonOffsetFactor),n.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=n.polygonOffsetUnits),n.skinning!==void 0&&(i.skinning=n.skinning),n.morphTargets!==void 0&&(i.morphTargets=n.morphTargets),n.morphNormals!==void 0&&(i.morphNormals=n.morphNormals),n.dithering!==void 0&&(i.dithering=n.dithering),n.vertexTangents!==void 0&&(i.vertexTangents=n.vertexTangents),n.visible!==void 0&&(i.visible=n.visible),n.toneMapped!==void 0&&(i.toneMapped=n.toneMapped),n.userData!==void 0&&(i.userData=n.userData),n.vertexColors!==void 0&&(typeof n.vertexColors=="number"?i.vertexColors=n.vertexColors>0:i.vertexColors=n.vertexColors),n.uniforms!==void 0)for(let r in n.uniforms){let s=n.uniforms[r];switch(i.uniforms[r]={},s.type){case"t":i.uniforms[r].value=t(s.value);break;case"c":i.uniforms[r].value=new Me().setHex(s.value);break;case"v2":i.uniforms[r].value=new ae().fromArray(s.value);break;case"v3":i.uniforms[r].value=new k().fromArray(s.value);break;case"v4":i.uniforms[r].value=new Ze().fromArray(s.value);break;case"m3":i.uniforms[r].value=new nn().fromArray(s.value);break;case"m4":i.uniforms[r].value=new Fe().fromArray(s.value);break;default:i.uniforms[r].value=s.value}}if(n.defines!==void 0&&(i.defines=n.defines),n.vertexShader!==void 0&&(i.vertexShader=n.vertexShader),n.fragmentShader!==void 0&&(i.fragmentShader=n.fragmentShader),n.extensions!==void 0)for(let r in n.extensions)i.extensions[r]=n.extensions[r];if(n.shading!==void 0&&(i.flatShading=n.shading===1),n.size!==void 0&&(i.size=n.size),n.sizeAttenuation!==void 0&&(i.sizeAttenuation=n.sizeAttenuation),n.map!==void 0&&(i.map=t(n.map)),n.matcap!==void 0&&(i.matcap=t(n.matcap)),n.alphaMap!==void 0&&(i.alphaMap=t(n.alphaMap)),n.bumpMap!==void 0&&(i.bumpMap=t(n.bumpMap)),n.bumpScale!==void 0&&(i.bumpScale=n.bumpScale),n.normalMap!==void 0&&(i.normalMap=t(n.normalMap)),n.normalMapType!==void 0&&(i.normalMapType=n.normalMapType),n.normalScale!==void 0){let r=n.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new ae().fromArray(r)}return n.displacementMap!==void 0&&(i.displacementMap=t(n.displacementMap)),n.displacementScale!==void 0&&(i.displacementScale=n.displacementScale),n.displacementBias!==void 0&&(i.displacementBias=n.displacementBias),n.roughnessMap!==void 0&&(i.roughnessMap=t(n.roughnessMap)),n.metalnessMap!==void 0&&(i.metalnessMap=t(n.metalnessMap)),n.emissiveMap!==void 0&&(i.emissiveMap=t(n.emissiveMap)),n.emissiveIntensity!==void 0&&(i.emissiveIntensity=n.emissiveIntensity),n.specularMap!==void 0&&(i.specularMap=t(n.specularMap)),n.envMap!==void 0&&(i.envMap=t(n.envMap)),n.envMapIntensity!==void 0&&(i.envMapIntensity=n.envMapIntensity),n.reflectivity!==void 0&&(i.reflectivity=n.reflectivity),n.refractionRatio!==void 0&&(i.refractionRatio=n.refractionRatio),n.lightMap!==void 0&&(i.lightMap=t(n.lightMap)),n.lightMapIntensity!==void 0&&(i.lightMapIntensity=n.lightMapIntensity),n.aoMap!==void 0&&(i.aoMap=t(n.aoMap)),n.aoMapIntensity!==void 0&&(i.aoMapIntensity=n.aoMapIntensity),n.gradientMap!==void 0&&(i.gradientMap=t(n.gradientMap)),n.clearcoatMap!==void 0&&(i.clearcoatMap=t(n.clearcoatMap)),n.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=t(n.clearcoatRoughnessMap)),n.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=t(n.clearcoatNormalMap)),n.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new ae().fromArray(n.clearcoatNormalScale)),n.transmission!==void 0&&(i.transmission=n.transmission),n.transmissionMap!==void 0&&(i.transmissionMap=t(n.transmissionMap)),i},setTextures:function(n){return this.textures=n,this}});var Ir={decodeText:function(n){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(n);let e="";for(let t=0,i=n.length;t<i;t++)e+=String.fromCharCode(n[t]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(n){let e=n.lastIndexOf("/");return e===-1?"./":n.substr(0,e+1)}};function Il(){We.call(this),this.type="InstancedBufferGeometry",this.instanceCount=Infinity}Il.prototype=Object.assign(Object.create(We.prototype),{constructor:Il,isInstancedBufferGeometry:!0,copy:function(n){return We.prototype.copy.call(this,n),this.instanceCount=n.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){let n=We.prototype.toJSON.call(this);return n.instanceCount=this.instanceCount,n.isInstancedBufferGeometry=!0,n}});function Uu(n,e,t,i){typeof t=="number"&&(i=t,t=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Oe.call(this,n,e,t),this.meshPerAttribute=i||1}Uu.prototype=Object.assign(Object.create(Oe.prototype),{constructor:Uu,isInstancedBufferAttribute:!0,copy:function(n){return Oe.prototype.copy.call(this,n),this.meshPerAttribute=n.meshPerAttribute,this},toJSON:function(){let n=Oe.prototype.toJSON.call(this);return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}});function Ep(n){qe.call(this,n)}Ep.prototype=Object.assign(Object.create(qe.prototype),{constructor:Ep,load:function(n,e,t,i){let r=this,s=new xn(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(n,function(o){try{e(r.parse(JSON.parse(o)))}catch(a){i?i(a):console.error(a),r.manager.itemError(n)}},t,i)},parse:function(n){let e={},t={};function i(l,h){if(e[h]!==void 0)return e[h];let m=l.interleavedBuffers[h],v=r(l,m.buffer),_=el(m.type,v),g=new Zt(_,m.stride);return g.uuid=m.uuid,e[h]=g,g}function r(l,h){if(t[h]!==void 0)return t[h];let m=l.arrayBuffers[h],v=new Uint32Array(m).buffer;return t[h]=v,v}let s=n.isInstancedBufferGeometry?new Il:new We,o=n.data.index;if(o!==void 0){let l=el(o.type,o.array);s.setIndex(new Oe(l,1))}let a=n.data.attributes;for(let l in a){let h=a[l],p;if(h.isInterleavedBufferAttribute){let m=i(n.data,h.data);p=new xi(m,h.itemSize,h.offset,h.normalized)}else{let m=el(h.type,h.array),v=h.isInstancedBufferAttribute?Uu:Oe;p=new v(m,h.itemSize,h.normalized)}h.name!==void 0&&(p.name=h.name),s.setAttribute(l,p)}let c=n.data.morphAttributes;if(c)for(let l in c){let h=c[l],p=[];for(let m=0,v=h.length;m<v;m++){let _=h[m],g;if(_.isInterleavedBufferAttribute){let y=i(n.data,_.data);g=new xi(y,_.itemSize,_.offset,_.normalized)}else{let y=el(_.type,_.array);g=new Oe(y,_.itemSize,_.normalized)}_.name!==void 0&&(g.name=_.name),p.push(g)}s.morphAttributes[l]=p}n.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let d=n.data.groups||n.data.drawcalls||n.data.offsets;if(d!==void 0)for(let l=0,h=d.length;l!==h;++l){let p=d[l];s.addGroup(p.start,p.count,p.materialIndex)}let f=n.data.boundingSphere;if(f!==void 0){let l=new k;f.center!==void 0&&l.fromArray(f.center),s.boundingSphere=new Xn(l,f.radius)}return n.name&&(s.name=n.name),n.userData&&(s.userData=n.userData),s}});function Ol(n){typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),qe.call(this,n),this.options={premultiplyAlpha:"none"}}Ol.prototype=Object.assign(Object.create(qe.prototype),{constructor:Ol,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(n,e,t,i){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);let r=this,s=Is.get(n);if(s!==void 0)return r.manager.itemStart(n),setTimeout(function(){e&&e(s),r.manager.itemEnd(n)},0),s;let o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",fetch(n,o).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,r.options)}).then(function(a){Is.add(n,a),e&&e(a),r.manager.itemEnd(n)}).catch(function(a){i&&i(a),r.manager.itemError(n),r.manager.itemEnd(n)}),r.manager.itemStart(n)}});function Ap(){this.type="ShapePath",this.color=new Me,this.subPaths=[],this.currentPath=null}Object.assign(Ap.prototype,{moveTo:function(n,e){return this.currentPath=new ni,this.subPaths.push(this.currentPath),this.currentPath.moveTo(n,e),this},lineTo:function(n,e){return this.currentPath.lineTo(n,e),this},quadraticCurveTo:function(n,e,t,i){return this.currentPath.quadraticCurveTo(n,e,t,i),this},bezierCurveTo:function(n,e,t,i,r,s){return this.currentPath.bezierCurveTo(n,e,t,i,r,s),this},splineThru:function(n){return this.currentPath.splineThru(n),this},toShapes:function(n,e){function t(_){let g=[];for(let y=0,b=_.length;y<b;y++){let w=_[y],x=new Os;x.curves=w.curves,g.push(x)}return g}function i(_,g){let y=g.length,b=!1;for(let w=y-1,x=0;x<y;w=x++){let S=g[w],P=g[x],T=P.x-S.x,I=P.y-S.y;if(Math.abs(I)>Number.EPSILON){if(I<0&&(S=g[x],T=-T,P=g[w],I=-I),_.y<S.y||_.y>P.y)continue;if(_.y===S.y){if(_.x===S.x)return!0}else{let U=I*(_.x-S.x)-T*(_.y-S.y);if(U===0)return!0;if(U<0)continue;b=!b}}else{if(_.y!==S.y)continue;if(P.x<=_.x&&_.x<=S.x||S.x<=_.x&&_.x<=P.x)return!0}}return b}let r=$i.isClockWise,s=this.subPaths;if(s.length===0)return[];if(e===!0)return t(s);let o,a,c,u=[];if(s.length===1)return a=s[0],c=new Os,c.curves=a.curves,u.push(c),u;let d=!r(s[0].getPoints());d=n?!d:d;let f=[],l=[],h=[],p=0,m;l[p]=void 0,h[p]=[];for(let _=0,g=s.length;_<g;_++)a=s[_],m=a.getPoints(),o=r(m),o=n?!o:o,o?(!d&&l[p]&&p++,l[p]={s:new Os,p:m},l[p].s.curves=a.curves,d&&p++,h[p]=[]):h[p].push({h:a,p:m[0]});if(!l[0])return t(s);if(l.length>1){let _=!1,g=[];for(let y=0,b=l.length;y<b;y++)f[y]=[];for(let y=0,b=l.length;y<b;y++){let w=h[y];for(let x=0;x<w.length;x++){let S=w[x],P=!0;for(let T=0;T<l.length;T++)i(S.p,l[T].p)&&(y!==T&&g.push({froms:y,tos:T,hole:x}),P?(P=!1,f[T].push(S)):_=!0);P&&f[y].push(S)}}g.length>0&&(_||(h=f))}let v;for(let _=0,g=l.length;_<g;_++){c=l[_].s,u.push(c),v=h[_];for(let y=0,b=v.length;y<b;y++)c.holes.push(v[y].h)}return u}});var Cp=class{constructor(e){Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=e}generateShapes(e,t=100){let i=[],r=WS(e,t,this.data);for(let s=0,o=r.length;s<o;s++)Array.prototype.push.apply(i,r[s].toShapes());return i}};function WS(n,e,t){let i=Array.from?Array.from(n):String(n).split(""),r=e/t.resolution,s=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*r,o=[],a=0,c=0;for(let u=0;u<i.length;u++){let d=i[u];if(d===`
`)a=0,c-=s;else{let f=jS(d,r,a,c,t);a+=f.offsetX,o.push(f.path)}}return o}function jS(n,e,t,i,r){let s=r.glyphs[n]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+n+'" does not exists in font family '+r.familyName+".");return}let o=new Ap,a,c,u,d,f,l,h,p;if(s.o){let m=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let v=0,_=m.length;v<_;)switch(m[v++]){case"m":a=m[v++]*e+t,c=m[v++]*e+i,o.moveTo(a,c);break;case"l":a=m[v++]*e+t,c=m[v++]*e+i,o.lineTo(a,c);break;case"q":u=m[v++]*e+t,d=m[v++]*e+i,f=m[v++]*e+t,l=m[v++]*e+i,o.quadraticCurveTo(f,l,u,d);break;case"b":u=m[v++]*e+t,d=m[v++]*e+i,f=m[v++]*e+t,l=m[v++]*e+i,h=m[v++]*e+t,p=m[v++]*e+i,o.bezierCurveTo(f,l,h,p,u,d);break}}return{offsetX:s.ha*e,path:o}}function Lp(n){qe.call(this,n)}Lp.prototype=Object.assign(Object.create(qe.prototype),{constructor:Lp,load:function(n,e,t,i){let r=this,s=new xn(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(n,function(o){let a;try{a=JSON.parse(o)}catch(u){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),a=JSON.parse(o.substring(65,o.length-2))}let c=r.parse(a);e&&e(c)},t,i)},parse:function(n){return new Cp(n)}});var Dl,qS={getContext:function(){return Dl===void 0&&(Dl=new(window.AudioContext||window.webkitAudioContext)),Dl},setContext:function(n){Dl=n}};function Gu(n){qe.call(this,n)}Gu.prototype=Object.assign(Object.create(qe.prototype),{constructor:Gu,load:function(n,e,t,i){let r=this,s=new xn(r.manager);s.setResponseType("arraybuffer"),s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(n,function(o){try{let a=o.slice(0);qS.getContext().decodeAudioData(a,function(u){e(u)})}catch(a){i?i(a):console.error(a),r.manager.itemError(n)}},t,i)}});function Rp(n,e,t){ii.call(this,void 0,t);let i=new Me().set(n),r=new Me().set(e),s=new k(i.r,i.g,i.b),o=new k(r.r,r.g,r.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(c)}Rp.prototype=Object.assign(Object.create(ii.prototype),{constructor:Rp,isHemisphereLightProbe:!0,copy:function(n){return ii.prototype.copy.call(this,n),this},toJSON:function(n){return ii.prototype.toJSON.call(this,n)}});function Pp(n,e){ii.call(this,void 0,e);let t=new Me().set(n);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}Pp.prototype=Object.assign(Object.create(ii.prototype),{constructor:Pp,isAmbientLightProbe:!0,copy:function(n){return ii.prototype.copy.call(this,n),this},toJSON:function(n){return ii.prototype.toJSON.call(this,n)}});var Ip=new Fe,Op=new Fe;function XS(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ut,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ut,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(XS.prototype,{update:function(n){let e=this._cache;if(e.focus!==n.focus||e.fov!==n.fov||e.aspect!==n.aspect*this.aspect||e.near!==n.near||e.far!==n.far||e.zoom!==n.zoom||e.eyeSep!==this.eyeSep){e.focus=n.focus,e.fov=n.fov,e.aspect=n.aspect*this.aspect,e.near=n.near,e.far=n.far,e.zoom=n.zoom,e.eyeSep=this.eyeSep;let i=n.projectionMatrix.clone(),r=e.eyeSep/2,s=r*e.near/e.focus,o=e.near*Math.tan(Ie.DEG2RAD*e.fov*.5)/e.zoom,a,c;Op.elements[12]=-r,Ip.elements[12]=r,a=-o*e.aspect+s,c=o*e.aspect+s,i.elements[0]=2*e.near/(c-a),i.elements[8]=(c+a)/(c-a),this.cameraL.projectionMatrix.copy(i),a=-o*e.aspect-s,c=o*e.aspect-s,i.elements[0]=2*e.near/(c-a),i.elements[8]=(c+a)/(c-a),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(Op),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(Ip)}});var Ds=class{constructor(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Dp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=Dp();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function Dp(){return(typeof performance=="undefined"?Date:performance).now()}var Fp=class extends Ce{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};function Bp(n,e,t){this.binding=n,this.valueSize=t;let i,r,s;switch(e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(t*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(t*5);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(t*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(Bp.prototype,{accumulate:function(n,e){let t=this.buffer,i=this.valueSize,r=n*i+i,s=this.cumulativeWeight;if(s===0){for(let o=0;o!==i;++o)t[r+o]=t[o];s=e}else{s+=e;let o=e/s;this._mixBufferRegion(t,r,0,o,i)}this.cumulativeWeight=s},accumulateAdditive:function(n){let e=this.buffer,t=this.valueSize,i=t*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,n,t),this.cumulativeWeightAdditive+=n},apply:function(n){let e=this.valueSize,t=this.buffer,i=n*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let a=e*this._origIndex;this._mixBufferRegion(t,i,a,1-r,e)}s>0&&this._mixBufferRegionAdditive(t,i,this._addIndex*e,1,e);for(let a=e,c=e+e;a!==c;++a)if(t[a]!==t[a+e]){o.setValue(t,i);break}},saveOriginalState:function(){let n=this.binding,e=this.buffer,t=this.valueSize,i=t*this._origIndex;n.getValue(e,i);for(let r=t,s=i;r!==s;++r)e[r]=e[i+r%t];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){let n=this.valueSize*3;this.binding.setValue(this.buffer,n)},_setAdditiveIdentityNumeric:function(){let n=this._addIndex*this.valueSize,e=n+this.valueSize;for(let t=n;t<e;t++)this.buffer[t]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){let n=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let t=0;t<this.valueSize;t++)this.buffer[e+t]=this.buffer[n+t]},_select:function(n,e,t,i,r){if(i>=.5)for(let s=0;s!==r;++s)n[e+s]=n[t+s]},_slerp:function(n,e,t,i){Pt.slerpFlat(n,e,n,e,n,t,i)},_slerpAdditive:function(n,e,t,i,r){let s=this._workIndex*r;Pt.multiplyQuaternionsFlat(n,s,n,e,n,t),Pt.slerpFlat(n,e,n,e,n,s,i)},_lerp:function(n,e,t,i,r){let s=1-i;for(let o=0;o!==r;++o){let a=e+o;n[a]=n[a]*s+n[t+o]*i}},_lerpAdditive:function(n,e,t,i,r){for(let s=0;s!==r;++s){let o=e+s;n[o]=n[o]+n[t+s]*i}}});var Vu="\\[\\]\\.:\\/",YS=new RegExp("["+Vu+"]","g"),Wu="[^"+Vu+"]",ZS="[^"+Vu.replace("\\.","")+"]",JS=/((?:WC+[\/:])*)/.source.replace("WC",Wu),KS=/(WCOD+)?/.source.replace("WCOD",ZS),$S=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Wu),QS=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Wu),eT=new RegExp("^"+JS+KS+$S+QS+"$"),tT=["material","materials","bones"];function Np(n,e,t){let i=t||It.parseTrackName(e);this._targetGroup=n,this._bindings=n.subscribe_(e,i)}Object.assign(Np.prototype,{getValue:function(n,e){this.bind();let t=this._targetGroup.nCachedObjects_,i=this._bindings[t];i!==void 0&&i.getValue(n,e)},setValue:function(n,e){let t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].setValue(n,e)},bind:function(){let n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].bind()},unbind:function(){let n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].unbind()}});function It(n,e,t){this.path=e,this.parsedPath=t||It.parseTrackName(e),this.node=It.findNode(n,this.parsedPath.nodeName)||n,this.rootNode=n}Object.assign(It,{Composite:Np,create:function(n,e,t){return n&&n.isAnimationObjectGroup?new It.Composite(n,e,t):new It(n,e,t)},sanitizeNodeName:function(n){return n.replace(/\s/g,"_").replace(YS,"")},parseTrackName:function(n){let e=eT.exec(n);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+n);let t={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=t.nodeName&&t.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let r=t.nodeName.substring(i+1);tT.indexOf(r)!==-1&&(t.nodeName=t.nodeName.substring(0,i),t.objectName=r)}if(t.propertyName===null||t.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+n);return t},findNode:function(n,e){if(!e||e===""||e==="."||e===-1||e===n.name||e===n.uuid)return n;if(n.skeleton){let t=n.skeleton.getBoneByName(e);if(t!==void 0)return t}if(n.children){let t=function(r){for(let s=0;s<r.length;s++){let o=r[s];if(o.name===e||o.uuid===e)return o;let a=t(o.children);if(a)return a}return null},i=t(n.children);if(i)return i}return null}});Object.assign(It.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]},function(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let n=this.node,e=this.parsedPath,t=e.objectName,i=e.propertyName,r=e.propertyIndex;if(n||(n=It.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!n){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(t){let c=e.objectIndex;switch(t){case"materials":if(!n.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!n.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}n=n.material.materials;break;case"bones":if(!n.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}n=n.skeleton.bones;for(let u=0;u<n.length;u++)if(n[u].name===c){c=u;break}break;default:if(n[t]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}n=n[t]}if(c!==void 0){if(n[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);return}n=n[c]}}let s=n[i];if(s===void 0){let c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",n);return}let o=this.Versioning.None;this.targetObject=n,n.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:n.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!n.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(n.geometry.isBufferGeometry){if(!n.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}n.morphTargetDictionary[r]!==void 0&&(r=n.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else s.fromArray!==void 0&&s.toArray!==void 0?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});Object.assign(It.prototype,{_getValue_unbound:It.prototype.getValue,_setValue_unbound:It.prototype.setValue});function nT(){this.uuid=Ie.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let n={};this._indicesByUUID=n;for(let t=0,i=arguments.length;t!==i;++t)n[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(nT.prototype,{isAnimationObjectGroup:!0,add:function(){let n=this._objects,e=this._indicesByUUID,t=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length,o,a=n.length,c=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){let f=arguments[u],l=f.uuid,h=e[l];if(h===void 0){h=a++,e[l]=h,n.push(f);for(let p=0,m=s;p!==m;++p)r[p].push(new It(f,t[p],i[p]))}else if(h<c){o=n[h];let p=--c,m=n[p];e[m.uuid]=h,n[h]=m,e[l]=p,n[p]=f;for(let v=0,_=s;v!==_;++v){let g=r[v],y=g[p],b=g[h];g[h]=y,b===void 0&&(b=new It(f,t[v],i[v])),g[p]=b}}else n[h]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){let n=this._objects,e=this._indicesByUUID,t=this._bindings,i=t.length,r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){let a=arguments[s],c=a.uuid,u=e[c];if(u!==void 0&&u>=r){let d=r++,f=n[d];e[f.uuid]=u,n[u]=f,e[c]=d,n[d]=a;for(let l=0,h=i;l!==h;++l){let p=t[l],m=p[d],v=p[u];p[u]=m,p[d]=v}}}this.nCachedObjects_=r},uncache:function(){let n=this._objects,e=this._indicesByUUID,t=this._bindings,i=t.length,r=this.nCachedObjects_,s=n.length;for(let o=0,a=arguments.length;o!==a;++o){let c=arguments[o],u=c.uuid,d=e[u];if(d!==void 0)if(delete e[u],d<r){let f=--r,l=n[f],h=--s,p=n[h];e[l.uuid]=d,n[d]=l,e[p.uuid]=f,n[f]=p,n.pop();for(let m=0,v=i;m!==v;++m){let _=t[m],g=_[f],y=_[h];_[d]=g,_[f]=y,_.pop()}}else{let f=--s,l=n[f];f>0&&(e[l.uuid]=d),n[d]=l,n.pop();for(let h=0,p=i;h!==p;++h){let m=t[h];m[d]=m[f],m.pop()}}}this.nCachedObjects_=r},subscribe_:function(n,e){let t=this._bindingsIndicesByPath,i=t[n],r=this._bindings;if(i!==void 0)return r[i];let s=this._paths,o=this._parsedPaths,a=this._objects,c=a.length,u=this.nCachedObjects_,d=new Array(c);i=r.length,t[n]=i,s.push(n),o.push(e),r.push(d);for(let f=u,l=a.length;f!==l;++f){let h=a[f];d[f]=new It(h,n,e)}return d},unsubscribe_:function(n){let e=this._bindingsIndicesByPath,t=e[n];if(t!==void 0){let i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o],c=n[o];e[c]=t,s[t]=a,s.pop(),r[t]=r[o],r.pop(),i[t]=i[o],i.pop()}}});var kp=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let s=t.tracks,o=s.length,a=new Array(o),c={endingStart:Jr,endingEnd:Jr};for(let u=0;u!==o;++u){let d=s[u].createInterpolant(null);a[u]=d,d.settings=c}this._interpolantSettings=c,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=N0,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=Infinity,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,s=r.time,o=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let c=a.parameterPositions,u=a.sampleValues;return c[0]=s,c[1]=s+i,u[0]=e/o,u[1]=t/o,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let s=this._startTime;if(s!==null){let c=(e-s)*i;if(c<0||i===0)return;this._startTime=null,t=i*c}t*=this._updateTimeScale(e);let o=this._updateTime(t),a=this._updateWeight(e);if(a>0){let c=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case tf:for(let d=0,f=c.length;d!==f;++d)c[d].evaluate(o),u[d].accumulateAdditive(a);break;case kc:default:for(let d=0,f=c.length;d!==f;++d)c[d].evaluate(o),u[d].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;i!==null&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,s=this._loopCount,o=i===k0;if(e===0)return s===-1?r:o&&(s&1)==1?t-r:r;if(i===B0){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);let c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){let u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)==1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=Kr,r.endingEnd=Kr):(e?r.endingStart=this.zeroSlopeAtStart?Kr:Jr:r.endingStart=Ua,t?r.endingEnd=this.zeroSlopeAtEnd?Kr:Jr:r.endingEnd=Ua)}_scheduleFading(e,t,i){let r=this._mixer,s=r.time,o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);let a=o.parameterPositions,c=o.sampleValues;return a[0]=s,c[0]=t,a[1]=s+e,c[1]=i,this}};function zp(n){this._root=n,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}zp.prototype=Object.assign(Object.create(Pn.prototype),{constructor:zp,_bindAction:function(n,e){let t=n._localRoot||this._root,i=n._clip.tracks,r=i.length,s=n._propertyBindings,o=n._interpolants,a=t.uuid,c=this._bindingsByRootAndName,u=c[a];u===void 0&&(u={},c[a]=u);for(let d=0;d!==r;++d){let f=i[d],l=f.name,h=u[l];if(h!==void 0)s[d]=h;else{if(h=s[d],h!==void 0){h._cacheIndex===null&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}let p=e&&e._propertyBindings[d].binding.parsedPath;h=new Bp(It.create(t,l,p),f.ValueTypeName,f.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[d]=h}o[d].resultBuffer=h.buffer}},_activateAction:function(n){if(!this._isActiveAction(n)){if(n._cacheIndex===null){let t=(n._localRoot||this._root).uuid,i=n._clip.uuid,r=this._actionsByClip[i];this._bindAction(n,r&&r.knownActions[0]),this._addInactiveAction(n,i,t)}let e=n._propertyBindings;for(let t=0,i=e.length;t!==i;++t){let r=e[t];r.useCount++==0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(n)}},_deactivateAction:function(n){if(this._isActiveAction(n)){let e=n._propertyBindings;for(let t=0,i=e.length;t!==i;++t){let r=e[t];--r.useCount==0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(n)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let n=this;this.stats={actions:{get total(){return n._actions.length},get inUse(){return n._nActiveActions}},bindings:{get total(){return n._bindings.length},get inUse(){return n._nActiveBindings}},controlInterpolants:{get total(){return n._controlInterpolants.length},get inUse(){return n._nActiveControlInterpolants}}}},_isActiveAction:function(n){let e=n._cacheIndex;return e!==null&&e<this._nActiveActions},_addInactiveAction:function(n,e,t){let i=this._actions,r=this._actionsByClip,s=r[e];if(s===void 0)s={knownActions:[n],actionByRoot:{}},n._byClipCacheIndex=0,r[e]=s;else{let o=s.knownActions;n._byClipCacheIndex=o.length,o.push(n)}n._cacheIndex=i.length,i.push(n),s.actionByRoot[t]=n},_removeInactiveAction:function(n){let e=this._actions,t=e[e.length-1],i=n._cacheIndex;t._cacheIndex=i,e[i]=t,e.pop(),n._cacheIndex=null;let r=n._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,c=a[a.length-1],u=n._byClipCacheIndex;c._byClipCacheIndex=u,a[u]=c,a.pop(),n._byClipCacheIndex=null;let d=o.actionByRoot,f=(n._localRoot||this._root).uuid;delete d[f],a.length===0&&delete s[r],this._removeInactiveBindingsForAction(n)},_removeInactiveBindingsForAction:function(n){let e=n._propertyBindings;for(let t=0,i=e.length;t!==i;++t){let r=e[t];--r.referenceCount==0&&this._removeInactiveBinding(r)}},_lendAction:function(n){let e=this._actions,t=n._cacheIndex,i=this._nActiveActions++,r=e[i];n._cacheIndex=i,e[i]=n,r._cacheIndex=t,e[t]=r},_takeBackAction:function(n){let e=this._actions,t=n._cacheIndex,i=--this._nActiveActions,r=e[i];n._cacheIndex=i,e[i]=n,r._cacheIndex=t,e[t]=r},_addInactiveBinding:function(n,e,t){let i=this._bindingsByRootAndName,r=this._bindings,s=i[e];s===void 0&&(s={},i[e]=s),s[t]=n,n._cacheIndex=r.length,r.push(n)},_removeInactiveBinding:function(n){let e=this._bindings,t=n.binding,i=t.rootNode.uuid,r=t.path,s=this._bindingsByRootAndName,o=s[i],a=e[e.length-1],c=n._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete o[r],Object.keys(o).length===0&&delete s[i]},_lendBinding:function(n){let e=this._bindings,t=n._cacheIndex,i=this._nActiveBindings++,r=e[i];n._cacheIndex=i,e[i]=n,r._cacheIndex=t,e[t]=r},_takeBackBinding:function(n){let e=this._bindings,t=n._cacheIndex,i=--this._nActiveBindings,r=e[i];n._cacheIndex=i,e[i]=n,r._cacheIndex=t,e[t]=r},_lendControlInterpolant:function(){let n=this._controlInterpolants,e=this._nActiveControlInterpolants++,t=n[e];return t===void 0&&(t=new El(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),t.__cacheIndex=e,n[e]=t),t},_takeBackControlInterpolant:function(n){let e=this._controlInterpolants,t=n.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];n.__cacheIndex=i,e[i]=n,r.__cacheIndex=t,e[t]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(n,e,t){let i=e||this._root,r=i.uuid,s=typeof n=="string"?ln.findByName(i,n):n,o=s!==null?s.uuid:n,a=this._actionsByClip[o],c=null;if(t===void 0&&(s!==null?t=s.blendMode:t=kc),a!==void 0){let d=a.actionByRoot[r];if(d!==void 0&&d.blendMode===t)return d;c=a.knownActions[0],s===null&&(s=c._clip)}if(s===null)return null;let u=new kp(this,s,e,t);return this._bindAction(u,c),this._addInactiveAction(u,o,r),u},existingAction:function(n,e){let t=e||this._root,i=t.uuid,r=typeof n=="string"?ln.findByName(t,n):n,s=r?r.uuid:n,o=this._actionsByClip[s];return o!==void 0&&o.actionByRoot[i]||null},stopAllAction:function(){let n=this._actions,e=this._nActiveActions;for(let t=e-1;t>=0;--t)n[t].stop();return this},update:function(n){n*=this.timeScale;let e=this._actions,t=this._nActiveActions,i=this.time+=n,r=Math.sign(n),s=this._accuIndex^=1;for(let c=0;c!==t;++c)e[c]._update(i,n,r,s);let o=this._bindings,a=this._nActiveBindings;for(let c=0;c!==a;++c)o[c].apply(s);return this},setTime:function(n){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(n)},getRoot:function(){return this._root},uncacheClip:function(n){let e=this._actions,t=n.uuid,i=this._actionsByClip,r=i[t];if(r!==void 0){let s=r.knownActions;for(let o=0,a=s.length;o!==a;++o){let c=s[o];this._deactivateAction(c);let u=c._cacheIndex,d=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,e[u]=d,e.pop(),this._removeInactiveBindingsForAction(c)}delete i[t]}},uncacheRoot:function(n){let e=n.uuid,t=this._actionsByClip;for(let s in t){let o=t[s].actionByRoot,a=o[e];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}let i=this._bindingsByRootAndName,r=i[e];if(r!==void 0)for(let s in r){let o=r[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}},uncacheAction:function(n,e){let t=this.existingAction(n,e);t!==null&&(this._deactivateAction(t),this._removeInactiveAction(t))}});var Fl=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Fl(this.value.clone===void 0?this.value:this.value.clone())}};function Hp(n,e,t){Zt.call(this,n,e),this.meshPerAttribute=t||1}Hp.prototype=Object.assign(Object.create(Zt.prototype),{constructor:Hp,isInstancedInterleavedBuffer:!0,copy:function(n){return Zt.prototype.copy.call(this,n),this.meshPerAttribute=n.meshPerAttribute,this},clone:function(n){let e=Zt.prototype.clone.call(this,n);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(n){let e=Zt.prototype.toJSON.call(this,n);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}});function Up(n,e,t,i,r){this.buffer=n,this.type=e,this.itemSize=t,this.elementSize=i,this.count=r,this.version=0}Object.defineProperty(Up.prototype,"needsUpdate",{set:function(n){n===!0&&this.version++}});Object.assign(Up.prototype,{isGLBufferAttribute:!0,setBuffer:function(n){return this.buffer=n,this},setType:function(n,e){return this.type=n,this.elementSize=e,this},setItemSize:function(n){return this.itemSize=n,this},setCount:function(n){return this.count=n,this}});function Gp(n,e,t,i){this.ray=new is(n,e),this.near=t||0,this.far=i||Infinity,this.camera=null,this.layers=new Yc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Vp(n,e){return n.distance-e.distance}function ju(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){let r=n.children;for(let s=0,o=r.length;s<o;s++)ju(r[s],e,t,!0)}}Object.assign(Gp.prototype,{set:function(n,e){this.ray.set(n,e)},setFromCamera:function(n,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(n,e,t){let i=t||[];return ju(n,this,i,e),i.sort(Vp),i},intersectObjects:function(n,e,t){let i=t||[];if(Array.isArray(n)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(let r=0,s=n.length;r<s;r++)ju(n[r],this,i,e);return i.sort(Vp),i}});var Bl=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}clone(){return new this.constructor().copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){let e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ie.clamp(t/this.radius,-1,1))),this}},Wp=new ae,jp=class{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=e!==void 0?e:new ae(Infinity,Infinity),this.max=t!==void 0?t:new ae(-Infinity,-Infinity)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Wp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new ae),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new ae),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new ae),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new ae),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Wp.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};function Nl(n){Ce.call(this),this.material=n,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Nl.prototype=Object.create(Ce.prototype);Nl.prototype.constructor=Nl;Nl.prototype.isImmediateRenderObject=!0;var iT=new At({side:Tt,depthWrite:!1,depthTest:!1}),LE=new ke(new br,iT);Ee.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(Ee.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n};Object.assign(ni.prototype,{fromPoints:function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)}});function qp(n){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Bn.call(this,n),this.type="catmullrom"}qp.prototype=Object.create(Bn.prototype);Object.assign(qp.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});Object.assign(qe.prototype,{extractUrlBase:function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ir.extractUrlBase(n)}});qe.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Object.assign(jp.prototype,{center:function(n){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(n)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(n){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},size:function(n){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(n)}});Object.assign(qn.prototype,{center:function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},isIntersectionSphere:function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)},size:function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)}});Object.assign(Xn.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}});Co.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)};Object.assign(Ie,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(n){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Ie.floorPowerOfTwo(n)},nextPowerOfTwo:function(n){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Ie.ceilPowerOfTwo(n)}});Object.assign(nn.prototype,{flattenToArrayOffset:function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},multiplyVector3:function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()}});Object.assign(Fe.prototype,{extractPosition:function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)},flattenToArrayOffset:function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new k().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},multiplyVector4:function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)},crossVector:function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(n,e,t,i,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,i,t,r,s)},getInverse:function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()}});Yn.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)};Object.assign(Pt.prototype,{multiplyVector3:function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}});Object.assign(is.prototype,{isIntersectionBox:function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},isIntersectionPlane:function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)},isIntersectionSphere:function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)}});Object.assign(kt.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)},midpoint:function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)},normal:function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)},plane:function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)}});Object.assign(kt,{barycoordFromPoint:function(n,e,t,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),kt.getBarycoord(n,e,t,i,r)},normal:function(n,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),kt.getNormal(n,e,t,i)}});Object.assign(Os.prototype,{extractAllPoints:function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)},extrude:function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Tu(this,n)},makeGeometry:function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new _p(this,n)}});Object.assign(ae.prototype,{fromAttribute:function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},distanceToManhattan:function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(k.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)},getScaleFromMatrix:function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)},getColumnFromMatrix:function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)},applyProjection:function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)},fromAttribute:function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},distanceToManhattan:function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Ze.prototype,{fromAttribute:function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Ce.prototype,{getChildByName:function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)}});Object.defineProperties(Ce.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.assign(ke.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties(ke.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),z0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Object.defineProperties(yu.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}});Object.defineProperty(Ho.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});ko.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(Ee.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(n){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=n}});ut.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(n)};Object.defineProperties(it.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}});Object.defineProperties(Oe.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===bo},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(bo)}}});Object.assign(Oe.prototype,{setDynamic:function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?bo:Ga),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(We.prototype,{addIndex:function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)},addAttribute:function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Oe(arguments[1],arguments[2]))):n==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e)},addDrawCall:function(n,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)},applyMatrix:function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)}});Object.defineProperties(We.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.defineProperties(Il.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(n){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=n}}});Object.defineProperties(Gp.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(n){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=n}}});Object.defineProperties(Zt.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===bo},set:function(n){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(n)}}});Object.assign(Zt.prototype,{setDynamic:function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?bo:Ga),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(Tu.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}});Object.assign(Do.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}});Object.defineProperties(Fl.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}});Object.defineProperties(Re.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Me}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===Fd}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}}});Object.defineProperties(Ar.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Kn.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(n){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=n}}});Object.defineProperties(nt.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}});Object.assign(Sr.prototype,{clearTarget:function(n,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,i)},animate:function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}});Object.defineProperties(Sr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=n===!0?jn:xo}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(Uf.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Nt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}});Object.defineProperties(Fp.prototype,{load:{value:function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new Gu().load(n,function(i){e.setBuffer(i)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}});ps.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)};ps.prototype.clear=function(n,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,i)};Qr.crossOrigin=void 0;Qr.loadTexture=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let r=new Xo;r.setCrossOrigin(this.crossOrigin);let s=r.load(n,t,void 0,i);return e&&(s.mapping=e),s};Qr.loadTextureCube=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let r=new Ou;r.setCrossOrigin(this.crossOrigin);let s=r.load(n,t,void 0,i);return e&&(s.mapping=e),s};Qr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Qr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Id}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Id);function Ei(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Xp(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var un={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Fs={duration:.5,overwrite:!1,delay:0},qu,Nn,vt,wn=1e8,Je=1/wn,Xu=Math.PI*2,rT=Xu/4,sT=0,Yp=Math.sqrt,oT=Math.cos,aT=Math.sin,Lt=function(e){return typeof e=="string"},ht=function(e){return typeof e=="function"},Ai=function(e){return typeof e=="number"},Yu=function(e){return typeof e=="undefined"},ri=function(e){return typeof e=="object"},Jt=function(e){return e!==!1},Zp=function(){return typeof window!="undefined"},kl=function(e){return ht(e)||Lt(e)},Jp=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Ut=Array.isArray,Zu=/(?:-?\.?\d|\.)+/gi,Kp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Bs=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Ju=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,$p=/[+-]=-?[.\d]+/,Qp=/[^,'"\[\]\s]+/gi,lT=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,lt,Mn,Ku,$u,hn={},zl={},em,tm=function(e){return(zl=Or(e,hn))&&dn},Qu=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Hl=function(e,t){return!t&&console.warn(e)},nm=function(e,t){return e&&(hn[e]=t)&&zl&&(zl[e]=t)||hn},$o=function(){return 0},cT={suppressEvents:!0,isStart:!0},Qo={suppressEvents:!0},eh={},Qi=[],th={},im,fn={},nh={},rm=30,Ul=[],ih="",rh=function(e){var t=e[0],i,r;if(ri(t)||ht(t)||(e=[e]),!(i=(t._gsap||{}).harness)){for(r=Ul.length;r--&&!Ul[r].targetTest(t););i=Ul[r]}for(r=e.length;r--;)e[r]&&(e[r]._gsap||(e[r]._gsap=new sm(e[r],i)))||e.splice(r,1);return e},Dr=function(e){return e._gsap||rh(Sn(e))[0]._gsap},om=function(e,t,i){return(i=e[t])&&ht(i)?e[t]():Yu(i)&&e.getAttribute&&e.getAttribute(t)||i},Kt=function(e,t){return(e=e.split(",")).forEach(t)||e},pt=function(e){return Math.round(e*1e5)/1e5||0},Ot=function(e){return Math.round(e*1e7)/1e7||0},Ns=function(e,t){var i=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),i==="+"?e+r:i==="-"?e-r:i==="*"?e*r:e/r},uT=function(e,t){for(var i=t.length,r=0;e.indexOf(t[r])<0&&++r<i;);return r<i},Gl=function(){var e=Qi.length,t=Qi.slice(0),i,r;for(th={},Qi.length=0,i=0;i<e;i++)r=t[i],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},am=function(e,t,i,r){Qi.length&&Gl(),e.render(t,i,r||Nn),Qi.length&&Gl()},lm=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Qp).length<2?t:Lt(e)?e.trim():e},cm=function(e){return e},Tn=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},hT=function(e){return function(t,i){for(var r in i)r in t||r==="duration"&&e||r==="ease"||(t[r]=i[r])}},Or=function(e,t){for(var i in t)e[i]=t[i];return e},um=function n(e,t){for(var i in t)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(e[i]=ri(t[i])?n(e[i]||(e[i]={}),t[i]):t[i]);return e},Vl=function(e,t){var i={},r;for(r in e)r in t||(i[r]=e[r]);return i},ea=function(e){var t=e.parent||lt,i=e.keyframes?hT(Ut(e.keyframes)):Tn;if(Jt(e.inherit))for(;t;)i(e,t.vars.defaults),t=t.parent||t._dp;return e},dT=function(e,t){for(var i=e.length,r=i===t.length;r&&i--&&e[i]===t[i];);return i<0},hm=function(e,t,i,r,s){i===void 0&&(i="_first"),r===void 0&&(r="_last");var o=e[r],a;if(s)for(a=t[s];o&&o[s]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[r]=t,t._prev=o,t.parent=t._dp=e,t},Wl=function(e,t,i,r){i===void 0&&(i="_first"),r===void 0&&(r="_last");var s=t._prev,o=t._next;s?s._next=o:e[i]===t&&(e[i]=o),o?o._prev=s:e[r]===t&&(e[r]=s),t._next=t._prev=t.parent=null},Ci=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},Fr=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},fT=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},sh=function(e,t,i,r){return e._startAt&&(Nn?e._startAt.revert(Qo):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},pT=function n(e){return!e||e._ts&&n(e.parent)},dm=function(e){return e._repeat?ks(e._tTime,e=e.duration()+e._rDelay)*e:0},ks=function(e,t){var i=Math.floor(e/=t);return e&&i===e?i-1:i},jl=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},ql=function(e){return e._end=Ot(e._start+(e._tDur/Math.abs(e._ts||e._rts||Je)||0))},Xl=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=Ot(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),ql(e),i._dirty||Fr(i,e)),e},fm=function(e,t){var i;if((t._time||t._initted&&!t._dur)&&(i=jl(e.rawTime(),t),(!t._dur||ta(0,t.totalDuration(),i)-t._tTime>Je)&&t.render(i,!0)),Fr(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-Je}},si=function(e,t,i,r){return t.parent&&Ci(t),t._start=Ot((Ai(i)?i:i||e!==lt?En(e,i,t):e._time)+t._delay),t._end=Ot(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),hm(e,t,"_first","_last",e._sort?"_start":0),oh(t)||(e._recent=t),r||fm(e,t),e._ts<0&&Xl(e,e._tTime),e},pm=function(e,t){return(hn.ScrollTrigger||Qu("scrollTrigger",t))&&hn.ScrollTrigger.create(t,e)},mm=function(e,t,i,r){if(ah(e,t),!e._initted)return 1;if(!i&&e._pt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&im!==pn.frame)return Qi.push(e),e._lazy=[t,r],1},mT=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},oh=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},gT=function(e,t,i,r){var s=e.ratio,o=t<0||!t&&(!e._start&&mT(e)&&!(!e._initted&&oh(e))||(e._ts<0||e._dp._ts<0)&&!oh(e))?0:1,a=e._rDelay,c=0,u,d,f;if(a&&e._repeat&&(c=ta(0,e._tDur,t),d=ks(c,a),e._yoyo&&d&1&&(o=1-o),d!==ks(e._tTime,a)&&(s=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==s||Nn||r||e._zTime===Je||!t&&e._zTime){if(!e._initted&&mm(e,t,r,i))return;for(f=e._zTime,e._zTime=t||(i?Je:0),i||(i=t&&!f),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=c,u=e._pt;u;)u.r(o,u.d),u=u._next;t<0&&sh(e,t,i,!0),e._onUpdate&&!i&&An(e,"onUpdate"),c&&e._repeat&&!i&&e.parent&&An(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Ci(e,1),i||(An(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},_T=function(e,t,i){var r;if(i>t)for(r=e._first;r&&r._start<=i;){if(r.data==="isPause"&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=i;){if(r.data==="isPause"&&r._start<t)return r;r=r._prev}},zs=function(e,t,i,r){var s=e._repeat,o=Ot(t)||0,a=e._tTime/e._tDur;return a&&!r&&(e._time*=o/e._dur),e._dur=o,e._tDur=s?s<0?1e10:Ot(o*(s+1)+e._rDelay*s):o,a>0&&!r?Xl(e,e._tTime=e._tDur*a):e.parent&&ql(e),i||Fr(e.parent,e),e},gm=function(e){return e instanceof $t?Fr(e):zs(e,e._dur)},vT={_start:0,endTime:$o,totalDuration:$o},En=function n(e,t,i){var r=e.labels,s=e._recent||vT,o=e.duration()>=wn?s.endTime(!1):e._dur,a,c,u;return Lt(t)&&(isNaN(t)||t in r)?(c=t.charAt(0),u=t.substr(-1)==="%",a=t.indexOf("="),c==="<"||c===">"?(a>=0&&(t=t.replace(/=/,"")),(c==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(u?(a<0?s:i).totalDuration()/100:1)):a<0?(t in r||(r[t]=o),r[t]):(c=parseFloat(t.charAt(a-1)+t.substr(a+1)),u&&i&&(c=c/100*(Ut(i)?i[0]:i).totalDuration()),a>1?n(e,t.substr(0,a-1),i)+c:o+c)):t==null?o:+t},na=function(e,t,i){var r=Ai(t[1]),s=(r?2:1)+(e<2?0:1),o=t[s],a,c;if(r&&(o.duration=t[1]),o.parent=i,e){for(a=o,c=i;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=Jt(c.vars.inherit)&&c.parent;o.immediateRender=Jt(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[s-1]}return new xt(t[0],o,t[s+1])},er=function(e,t){return e||e===0?t(e):t},ta=function(e,t,i){return i<e?e:i>t?t:i},Gt=function(e,t){return!Lt(e)||!(t=lT.exec(e))?"":t[1]},yT=function(e,t,i){return er(i,function(r){return ta(e,t,r)})},lh=[].slice,_m=function(e,t){return e&&ri(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&ri(e[0]))&&!e.nodeType&&e!==Mn},xT=function(e,t,i){return i===void 0&&(i=[]),e.forEach(function(r){var s;return Lt(r)&&!t||_m(r,1)?(s=i).push.apply(s,Sn(r)):i.push(r)})||i},Sn=function(e,t,i){return vt&&!t&&vt.selector?vt.selector(e):Lt(e)&&!i&&(Ku||!Hs())?lh.call((t||$u).querySelectorAll(e),0):Ut(e)?xT(e,i):_m(e)?lh.call(e,0):e?[e]:[]},ch=function(e){return e=Sn(e)[0]||Hl("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return Sn(t,i.querySelectorAll?i:i===e?Hl("Invalid scope")||$u.createElement("div"):e)}},vm=function(e){return e.sort(function(){return .5-Math.random()})},xm=function(e){if(ht(e))return e;var t=ri(e)?e:{each:e},i=Br(t.ease),r=t.from||0,s=parseFloat(t.base)||0,o={},a=r>0&&r<1,c=isNaN(r)||a,u=t.axis,d=r,f=r;return Lt(r)?d=f={center:.5,edges:.5,end:1}[r]||0:!a&&c&&(d=r[0],f=r[1]),function(l,h,p){var m=(p||t).length,v=o[m],_,g,y,b,w,x,S,P,T;if(!v){if(T=t.grid==="auto"?0:(t.grid||[1,wn])[1],!T){for(S=-wn;S<(S=p[T++].getBoundingClientRect().left)&&T<m;);T--}for(v=o[m]=[],_=c?Math.min(T,m)*d-.5:r%T,g=T===wn?0:c?m*f/T-.5:r/T|0,S=0,P=wn,x=0;x<m;x++)y=x%T-_,b=g-(x/T|0),v[x]=w=u?Math.abs(u==="y"?b:y):Yp(y*y+b*b),w>S&&(S=w),w<P&&(P=w);r==="random"&&vm(v),v.max=S-P,v.min=P,v.v=m=(parseFloat(t.amount)||parseFloat(t.each)*(T>m?m-1:u?u==="y"?m/T:T:Math.max(T,m/T))||0)*(r==="edges"?-1:1),v.b=m<0?s-m:s,v.u=Gt(t.amount||t.each)||0,i=i&&m<0?ym(i):i}return m=(v[l]-v.min)/v.max||0,Ot(v.b+(i?i(m):m)*v.v)+v.u}},uh=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var r=Ot(Math.round(parseFloat(i)/e)*e*t);return(r-r%1)/t+(Ai(i)?0:Gt(i))}},bm=function(e,t){var i=Ut(e),r,s;return!i&&ri(e)&&(r=i=e.radius||wn,e.values?(e=Sn(e.values),(s=!Ai(e[0]))&&(r*=r)):e=uh(e.increment)),er(t,i?ht(e)?function(o){return s=e(o),Math.abs(s-o)<=r?s:o}:function(o){for(var a=parseFloat(s?o.x:o),c=parseFloat(s?o.y:0),u=wn,d=0,f=e.length,l,h;f--;)s?(l=e[f].x-a,h=e[f].y-c,l=l*l+h*h):l=Math.abs(e[f]-a),l<u&&(u=l,d=f);return d=!r||u<=r?e[d]:o,s||d===o||Ai(o)?d:d+Gt(o)}:uh(e))},wm=function(e,t,i,r){return er(Ut(e)?!t:i===!0?!!(i=0):!r,function(){return Ut(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(r=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+i*.99))/i)*i*r)/r})},bT=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(r){return t.reduce(function(s,o){return o(s)},r)}},wT=function(e,t){return function(i){return e(parseFloat(i))+(t||Gt(i))}},MT=function(e,t,i){return Mm(e,t,0,1,i)},Sm=function(e,t,i){return er(i,function(r){return e[~~t(r)]})},ST=function n(e,t,i){var r=t-e;return Ut(e)?Sm(e,n(0,e.length),t):er(i,function(s){return(r+(s-e)%r)%r+e})},TT=function n(e,t,i){var r=t-e,s=r*2;return Ut(e)?Sm(e,n(0,e.length-1),t):er(i,function(o){return o=(s+(o-e)%s)%s||0,e+(o>r?s-o:o)})},ia=function(e){for(var t=0,i="",r,s,o,a;~(r=e.indexOf("random(",t));)o=e.indexOf(")",r),a=e.charAt(r+7)==="[",s=e.substr(r+7,o-r-7).match(a?Qp:Zu),i+=e.substr(t,r-t)+wm(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=o+1;return i+e.substr(t,e.length-t)},Mm=function(e,t,i,r,s){var o=t-e,a=r-i;return er(s,function(c){return i+((c-e)/o*a||0)})},ET=function n(e,t,i,r){var s=isNaN(e+t)?0:function(h){return(1-h)*e+h*t};if(!s){var o=Lt(e),a={},c,u,d,f,l;if(i===!0&&(r=1)&&(i=null),o)e={p:e},t={p:t};else if(Ut(e)&&!Ut(t)){for(d=[],f=e.length,l=f-2,u=1;u<f;u++)d.push(n(e[u-1],e[u]));f--,s=function(p){p*=f;var m=Math.min(l,~~p);return d[m](p-m)},i=t}else r||(e=Or(Ut(e)?[]:{},e));if(!d){for(c in t)hh.call(a,e,c,"get",t[c]);s=function(p){return dh(p,a)||(o?e.p:e)}}}return er(i,s)},Tm=function(e,t,i){var r=e.labels,s=wn,o,a,c;for(o in r)a=r[o]-t,a<0==!!i&&a&&s>(a=Math.abs(a))&&(c=o,s=a);return c},An=function(e,t,i){var r=e.vars,s=r[t],o=vt,a=e._ctx,c,u,d;if(!!s)return c=r[t+"Params"],u=r.callbackScope||e,i&&Qi.length&&Gl(),a&&(vt=a),d=c?s.apply(u,c):s.call(u),vt=o,d},ra=function(e){return Ci(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&An(e,"onInterrupt"),e},Us,LT=function(e){e=!e.name&&e.default||e;var t=e.name,i=ht(e),r=t&&!i&&e.init?function(){this._props=[]}:e,s={init:$o,render:dh,add:hh,kill:CT,modifier:AT,rawVars:0},o={targetTest:0,get:0,getSetter:fh,aliases:{},register:0};if(Hs(),e!==r){if(fn[t])return;Tn(r,Tn(Vl(e,s),o)),Or(r.prototype,Or(s,Vl(e,o))),fn[r.prop=t]=r,e.targetTest&&(Ul.push(r),eh[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}nm(t,r),e.register&&e.register(dn,r,Qt)},Ke=255,sa={aqua:[0,Ke,Ke],lime:[0,Ke,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Ke],navy:[0,0,128],white:[Ke,Ke,Ke],olive:[128,128,0],yellow:[Ke,Ke,0],orange:[Ke,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Ke,0,0],pink:[Ke,192,203],cyan:[0,Ke,Ke],transparent:[Ke,Ke,Ke,0]},ph=function(e,t,i){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(i-t)*e*6:e<.5?i:e*3<2?t+(i-t)*(2/3-e)*6:t)*Ke+.5|0},Em=function(e,t,i){var r=e?Ai(e)?[e>>16,e>>8&Ke,e&Ke]:0:sa.black,s,o,a,c,u,d,f,l,h,p;if(!r){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),sa[e])r=sa[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+s+s+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return r=parseInt(e.substr(1,6),16),[r>>16,r>>8&Ke,r&Ke,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),r=[e>>16,e>>8&Ke,e&Ke]}else if(e.substr(0,3)==="hsl"){if(r=p=e.match(Zu),!t)c=+r[0]%360/360,u=+r[1]/100,d=+r[2]/100,o=d<=.5?d*(u+1):d+u-d*u,s=d*2-o,r.length>3&&(r[3]*=1),r[0]=ph(c+1/3,s,o),r[1]=ph(c,s,o),r[2]=ph(c-1/3,s,o);else if(~e.indexOf("="))return r=e.match(Kp),i&&r.length<4&&(r[3]=1),r}else r=e.match(Zu)||sa.transparent;r=r.map(Number)}return t&&!p&&(s=r[0]/Ke,o=r[1]/Ke,a=r[2]/Ke,f=Math.max(s,o,a),l=Math.min(s,o,a),d=(f+l)/2,f===l?c=u=0:(h=f-l,u=d>.5?h/(2-f-l):h/(f+l),c=f===s?(o-a)/h+(o<a?6:0):f===o?(a-s)/h+2:(s-o)/h+4,c*=60),r[0]=~~(c+.5),r[1]=~~(u*100+.5),r[2]=~~(d*100+.5)),i&&r.length<4&&(r[3]=1),r},Am=function(e){var t=[],i=[],r=-1;return e.split(tr).forEach(function(s){var o=s.match(Bs)||[];t.push.apply(t,o),i.push(r+=o.length+1)}),t.c=i,t},Cm=function(e,t,i){var r="",s=(e+r).match(tr),o=t?"hsla(":"rgba(",a=0,c,u,d,f;if(!s)return e;if(s=s.map(function(l){return(l=Em(l,t,1))&&o+(t?l[0]+","+l[1]+"%,"+l[2]+"%,"+l[3]:l.join(","))+")"}),i&&(d=Am(e),c=i.c,c.join(r)!==d.c.join(r)))for(u=e.replace(tr,"1").split(Bs),f=u.length-1;a<f;a++)r+=u[a]+(~c.indexOf(a)?s.shift()||o+"0,0,0,0)":(d.length?d:s.length?s:i).shift());if(!u)for(u=e.split(tr),f=u.length-1;a<f;a++)r+=u[a]+s[a];return r+u[f]},tr=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in sa)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),RT=/hsl[a]?\(/,Lm=function(e){var t=e.join(" "),i;if(tr.lastIndex=0,tr.test(t))return i=RT.test(t),e[1]=Cm(e[1],i),e[0]=Cm(e[0],i,Am(e[1])),!0},oa,pn=function(){var n=Date.now,e=500,t=33,i=n(),r=i,s=1e3/240,o=s,a=[],c,u,d,f,l,h,p=function m(v){var _=n()-r,g=v===!0,y,b,w,x;if(_>e&&(i+=_-t),r+=_,w=r-i,y=w-o,(y>0||g)&&(x=++f.frame,l=w-f.time*1e3,f.time=w=w/1e3,o+=y+(y>=s?4:s-y),b=1),g||(c=u(m)),b)for(h=0;h<a.length;h++)a[h](w,l,x,v)};return f={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(v){return l/(1e3/(v||60))},wake:function(){em&&(!Ku&&Zp()&&(Mn=Ku=window,$u=Mn.document||{},hn.gsap=dn,(Mn.gsapVersions||(Mn.gsapVersions=[])).push(dn.version),tm(zl||Mn.GreenSockGlobals||!Mn.gsap&&Mn||{}),d=Mn.requestAnimationFrame),c&&f.sleep(),u=d||function(v){return setTimeout(v,o-f.time*1e3+1|0)},oa=1,p(2))},sleep:function(){(d?Mn.cancelAnimationFrame:clearTimeout)(c),oa=0,u=$o},lagSmoothing:function(v,_){e=v||1/Je,t=Math.min(_,e,0)},fps:function(v){s=1e3/(v||240),o=f.time*1e3+s},add:function(v,_,g){var y=_?function(b,w,x,S){v(b,w,x,S),f.remove(y)}:v;return f.remove(v),a[g?"unshift":"push"](y),Hs(),y},remove:function(v,_){~(_=a.indexOf(v))&&a.splice(_,1)&&h>=_&&h--},_listeners:a},f}(),Hs=function(){return!oa&&pn.wake()},Dt={},PT=/^[\d.\-M][\d.\-,\s]/,IT=/["']/g,OT=function(e){for(var t={},i=e.substr(1,e.length-3).split(":"),r=i[0],s=1,o=i.length,a,c,u;s<o;s++)c=i[s],a=s!==o-1?c.lastIndexOf(","):c.length,u=c.substr(0,a),t[r]=isNaN(u)?u.replace(IT,"").trim():+u,r=c.substr(a+1).trim();return t},DT=function(e){var t=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<i?e.indexOf(")",i+1):i)},FT=function(e){var t=(e+"").split("("),i=Dt[t[0]];return i&&t.length>1&&i.config?i.config.apply(null,~e.indexOf("{")?[OT(t[1])]:DT(e).split(",").map(lm)):Dt._CE&&PT.test(e)?Dt._CE("",e):i},ym=function(e){return function(t){return 1-e(1-t)}},Rm=function n(e,t){for(var i=e._first,r;i;)i instanceof $t?n(i,t):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==t&&(i.timeline?n(i.timeline,t):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=t)),i=i._next},Br=function(e,t){return e&&(ht(e)?e:Dt[e]||FT(e))||t},Nr=function(e,t,i,r){i===void 0&&(i=function(c){return 1-t(1-c)}),r===void 0&&(r=function(c){return c<.5?t(c*2)/2:1-t((1-c)*2)/2});var s={easeIn:t,easeOut:i,easeInOut:r},o;return Kt(e,function(a){Dt[a]=hn[a]=s,Dt[o=a.toLowerCase()]=i;for(var c in s)Dt[o+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=Dt[a+"."+c]=s[c]}),s},Pm=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},mh=function n(e,t,i){var r=t>=1?t:1,s=(i||(e?.3:.45))/(t<1?t:1),o=s/Xu*(Math.asin(1/r)||0),a=function(d){return d===1?1:r*Math.pow(2,-10*d)*aT((d-o)*s)+1},c=e==="out"?a:e==="in"?function(u){return 1-a(1-u)}:Pm(a);return s=Xu/s,c.config=function(u,d){return n(e,u,d)},c},gh=function n(e,t){t===void 0&&(t=1.70158);var i=function(o){return o?--o*o*((t+1)*o+t)+1:0},r=e==="out"?i:e==="in"?function(s){return 1-i(1-s)}:Pm(i);return r.config=function(s){return n(e,s)},r};Kt("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;Nr(n+",Power"+(t-1),e?function(i){return Math.pow(i,t)}:function(i){return i},function(i){return 1-Math.pow(1-i,t)},function(i){return i<.5?Math.pow(i*2,t)/2:1-Math.pow((1-i)*2,t)/2})});Dt.Linear.easeNone=Dt.none=Dt.Linear.easeIn;Nr("Elastic",mh("in"),mh("out"),mh());(function(n,e){var t=1/e,i=2*t,r=2.5*t,s=function(a){return a<t?n*a*a:a<i?n*Math.pow(a-1.5/e,2)+.75:a<r?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};Nr("Bounce",function(o){return 1-s(1-o)},s)})(7.5625,2.75);Nr("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});Nr("Circ",function(n){return-(Yp(1-n*n)-1)});Nr("Sine",function(n){return n===1?1:-oT(n*rT)+1});Nr("Back",gh("in"),gh("out"),gh());Dt.SteppedEase=Dt.steps=hn.SteppedEase={config:function(e,t){e===void 0&&(e=1);var i=1/e,r=e+(t?0:1),s=t?1:0,o=1-Je;return function(a){return((r*ta(0,o,a)|0)+s)*i}}};Fs.ease=Dt["quad.out"];Kt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return ih+=n+","+n+"Params,"});var sm=function(e,t){this.id=sT++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:om,this.set=t?t.getSetter:fh},Gs=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===Infinity?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,zs(this,+t.duration,1,1),this.data=t.data,vt&&(this._ctx=vt,vt.data.push(this)),oa||pn.wake()}var e=n.prototype;return e.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},e.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},e.totalDuration=function(i){return arguments.length?(this._dirty=0,zs(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(i,r){if(Hs(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(Xl(this,i),!s._dp||s.parent||fm(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&si(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Je||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),am(this,i,r)),this},e.time=function(i,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+dm(this))%(this._dur+this._rDelay)||(i?this._dur:0),r):this._time},e.totalProgress=function(i,r){return arguments.length?this.totalTime(this.totalDuration()*i,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(i,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+dm(this),r):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(i,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*s,r):this._repeat?ks(this._tTime,s)+1:1},e.timeScale=function(i){if(!arguments.length)return this._rts===-Je?0:this._rts;if(this._rts===i)return this;var r=this.parent&&this._ts?jl(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-Je?0:this._rts,this.totalTime(ta(-this._delay,this._tDur,r),!0),ql(this),fT(this)},e.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Hs(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Je&&(this._tTime-=Je)))),this):this._ps},e.startTime=function(i){if(arguments.length){this._start=i;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&si(r,this,i-this._delay),this}return this._start},e.endTime=function(i){return this._start+(Jt(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(i){var r=this.parent||this._dp;return r?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?jl(r.rawTime(i),this):this._tTime:this._tTime},e.revert=function(i){i===void 0&&(i=Qo);var r=Nn;return Nn=i,this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents),this.data!=="nested"&&Ci(this),Nn=r,this},e.globalTime=function(i){for(var r=this,s=arguments.length?i:r.rawTime();r;)s=r._start+s/(r._ts||1),r=r._dp;return!this.parent&&this.vars.immediateRender?-1:s},e.repeat=function(i){return arguments.length?(this._repeat=i===Infinity?-2:i,gm(this)):this._repeat===-2?Infinity:this._repeat},e.repeatDelay=function(i){if(arguments.length){var r=this._time;return this._rDelay=i,gm(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},e.seek=function(i,r){return this.totalTime(En(this,i),Jt(r))},e.restart=function(i,r){return this.play().totalTime(i?-this._delay:0,Jt(r))},e.play=function(i,r){return i!=null&&this.seek(i,r),this.reversed(!1).paused(!1)},e.reverse=function(i,r){return i!=null&&this.seek(i||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(i,r){return i!=null&&this.seek(i,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-Je:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Je,this},e.isActive=function(){var i=this.parent||this._dp,r=this._start,s;return!!(!i||this._ts&&this._initted&&i.isActive()&&(s=i.rawTime(!0))>=r&&s<this.endTime(!0)-Je)},e.eventCallback=function(i,r,s){var o=this.vars;return arguments.length>1?(r?(o[i]=r,s&&(o[i+"Params"]=s),i==="onUpdate"&&(this._onUpdate=r)):delete o[i],this):o[i]},e.then=function(i){var r=this;return new Promise(function(s){var o=ht(i)?i:cm,a=function(){var u=r.then;r.then=null,ht(o)&&(o=o(r))&&(o.then||o===r)&&(r.then=u),s(o),r.then=u};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?a():r._prom=a})},e.kill=function(){ra(this)},n}();Tn(Gs.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Je,_prom:0,_ps:!1,_rts:1});var $t=function(n){Xp(e,n);function e(i,r){var s;return i===void 0&&(i={}),s=n.call(this,i)||this,s.labels={},s.smoothChildTiming=!!i.smoothChildTiming,s.autoRemoveChildren=!!i.autoRemoveChildren,s._sort=Jt(i.sortChildren),lt&&si(i.parent||lt,Ei(s),r),i.reversed&&s.reverse(),i.paused&&s.paused(!0),i.scrollTrigger&&pm(Ei(s),i.scrollTrigger),s}var t=e.prototype;return t.to=function(r,s,o){return na(0,arguments,this),this},t.from=function(r,s,o){return na(1,arguments,this),this},t.fromTo=function(r,s,o,a){return na(2,arguments,this),this},t.set=function(r,s,o){return s.duration=0,s.parent=this,ea(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new xt(r,s,En(this,o),1),this},t.call=function(r,s,o){return si(this,xt.delayedCall(0,r,s),o)},t.staggerTo=function(r,s,o,a,c,u,d){return o.duration=s,o.stagger=o.stagger||a,o.onComplete=u,o.onCompleteParams=d,o.parent=this,new xt(r,o,En(this,c)),this},t.staggerFrom=function(r,s,o,a,c,u,d){return o.runBackwards=1,ea(o).immediateRender=Jt(o.immediateRender),this.staggerTo(r,s,o,a,c,u,d)},t.staggerFromTo=function(r,s,o,a,c,u,d,f){return a.startAt=o,ea(a).immediateRender=Jt(a.immediateRender),this.staggerTo(r,s,a,c,u,d,f)},t.render=function(r,s,o){var a=this._time,c=this._dirty?this.totalDuration():this._tDur,u=this._dur,d=r<=0?0:Ot(r),f=this._zTime<0!=r<0&&(this._initted||!u),l,h,p,m,v,_,g,y,b,w,x,S;if(this!==lt&&d>c&&r>=0&&(d=c),d!==this._tTime||o||f){if(a!==this._time&&u&&(d+=this._time-a,r+=this._time-a),l=d,b=this._start,y=this._ts,_=!y,f&&(u||(a=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(x=this._yoyo,v=u+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(v*100+r,s,o);if(l=Ot(d%v),d===c?(m=this._repeat,l=u):(m=~~(d/v),m&&m===d/v&&(l=u,m--),l>u&&(l=u)),w=ks(this._tTime,v),!a&&this._tTime&&w!==m&&(w=m),x&&m&1&&(l=u-l,S=1),m!==w&&!this._lock){var P=x&&w&1,T=P===(x&&m&1);if(m<w&&(P=!P),a=P?0:u,this._lock=1,this.render(a||(S?0:Ot(m*v)),s,!u)._lock=0,this._tTime=d,!s&&this.parent&&An(this,"onRepeat"),this.vars.repeatRefresh&&!S&&(this.invalidate()._lock=1),a&&a!==this._time||_!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(u=this._dur,c=this._tDur,T&&(this._lock=2,a=P?u:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!S&&this.invalidate()),this._lock=0,!this._ts&&!_)return this;Rm(this,S)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(g=_T(this,Ot(a),Ot(l)),g&&(d-=l-(l=g._start))),this._tTime=d,this._time=l,this._act=!y,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,a=0),!a&&l&&!s&&(An(this,"onStart"),this._tTime!==d))return this;if(l>=a&&r>=0)for(h=this._first;h;){if(p=h._next,(h._act||l>=h._start)&&h._ts&&g!==h){if(h.parent!==this)return this.render(r,s,o);if(h.render(h._ts>0?(l-h._start)*h._ts:(h._dirty?h.totalDuration():h._tDur)+(l-h._start)*h._ts,s,o),l!==this._time||!this._ts&&!_){g=0,p&&(d+=this._zTime=-Je);break}}h=p}else{o=o||Nn,h=this._last;for(var I=r<0?r:l;h;){if(p=h._prev,(h._act||I<=h._end)&&h._ts&&g!==h){if(h.parent!==this)return this.render(r,s,o);if(h.render(h._ts>0?(I-h._start)*h._ts:(h._dirty?h.totalDuration():h._tDur)+(I-h._start)*h._ts,s,o),l!==this._time||!this._ts&&!_){g=0,p&&(d+=this._zTime=I?-Je:Je);break}}h=p}}if(g&&!s&&(this.pause(),g.render(l>=a?0:-Je)._zTime=l>=a?1:-1,this._ts))return this._start=b,ql(this),this.render(r,s,o);this._onUpdate&&!s&&An(this,"onUpdate",!0),(d===c&&this._tTime>=this.totalDuration()||!d&&a)&&(b===this._start||Math.abs(y)!==Math.abs(this._ts))&&(this._lock||((r||!u)&&(d===c&&this._ts>0||!d&&this._ts<0)&&Ci(this,1),!s&&!(r<0&&!a)&&(d||a||!c)&&(An(this,d===c&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(d<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var o=this;if(Ai(s)||(s=En(this,s,r)),!(r instanceof Gs)){if(Ut(r))return r.forEach(function(a){return o.add(a,s)}),this;if(Lt(r))return this.addLabel(r,s);if(ht(r))r=xt.delayedCall(0,r);else return this}return this!==r?si(this,r,s):this},t.getChildren=function(r,s,o,a){r===void 0&&(r=!0),s===void 0&&(s=!0),o===void 0&&(o=!0),a===void 0&&(a=-wn);for(var c=[],u=this._first;u;)u._start>=a&&(u instanceof xt?s&&c.push(u):(o&&c.push(u),r&&c.push.apply(c,u.getChildren(!0,s,o)))),u=u._next;return c},t.getById=function(r){for(var s=this.getChildren(1,1,1),o=s.length;o--;)if(s[o].vars.id===r)return s[o]},t.remove=function(r){return Lt(r)?this.removeLabel(r):ht(r)?this.killTweensOf(r):(Wl(this,r),r===this._recent&&(this._recent=this._last),Fr(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Ot(pn.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),n.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=En(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,o){var a=xt.delayedCall(0,s||$o,o);return a.data="isPause",this._hasPause=1,si(this,a,En(this,r))},t.removePause=function(r){var s=this._first;for(r=En(this,r);s;)s._start===r&&s.data==="isPause"&&Ci(s),s=s._next},t.killTweensOf=function(r,s,o){for(var a=this.getTweensOf(r,o),c=a.length;c--;)nr!==a[c]&&a[c].kill(r,s);return this},t.getTweensOf=function(r,s){for(var o=[],a=Sn(r),c=this._first,u=Ai(s),d;c;)c instanceof xt?uT(c._targets,a)&&(u?(!nr||c._initted&&c._ts)&&c.globalTime(0)<=s&&c.globalTime(c.totalDuration())>s:!s||c.isActive())&&o.push(c):(d=c.getTweensOf(a,s)).length&&o.push.apply(o,d),c=c._next;return o},t.tweenTo=function(r,s){s=s||{};var o=this,a=En(o,r),c=s,u=c.startAt,d=c.onStart,f=c.onStartParams,l=c.immediateRender,h,p=xt.to(o,Tn({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(u&&"time"in u?u.time:o._time))/o.timeScale())||Je,onStart:function(){if(o.pause(),!h){var v=s.duration||Math.abs((a-(u&&"time"in u?u.time:o._time))/o.timeScale());p._dur!==v&&zs(p,v,0,1).render(p._time,!0,!0),h=1}d&&d.apply(p,f||[])}},s));return l?p.render(0):p},t.tweenFromTo=function(r,s,o){return this.tweenTo(s,Tn({startAt:{time:En(this,r)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),Tm(this,En(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),Tm(this,En(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Je)},t.shiftChildren=function(r,s,o){o===void 0&&(o=0);for(var a=this._first,c=this.labels,u;a;)a._start>=o&&(a._start+=r,a._end+=r),a=a._next;if(s)for(u in c)c[u]>=o&&(c[u]+=r);return Fr(this)},t.invalidate=function(){var r=this._first;for(this._lock=0;r;)r.invalidate(),r=r._next;return n.prototype.invalidate.call(this)},t.clear=function(r){r===void 0&&(r=!0);for(var s=this._first,o;s;)o=s._next,this.remove(s),s=o;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Fr(this)},t.totalDuration=function(r){var s=0,o=this,a=o._last,c=wn,u,d,f;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-r:r));if(o._dirty){for(f=o.parent;a;)u=a._prev,a._dirty&&a.totalDuration(),d=a._start,d>c&&o._sort&&a._ts&&!o._lock?(o._lock=1,si(o,a,d-a._delay,1)._lock=0):c=d,d<0&&a._ts&&(s-=d,(!f&&!o._dp||f&&f.smoothChildTiming)&&(o._start+=d/o._ts,o._time-=d,o._tTime-=d),o.shiftChildren(-d,!1,-Infinity),c=0),a._end>s&&a._ts&&(s=a._end),a=u;zs(o,o===lt&&o._time>s?o._time:s,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(r){if(lt._ts&&(am(lt,jl(r,lt)),im=pn.frame),pn.frame>=rm){rm+=un.autoSleep||120;var s=lt._first;if((!s||!s._ts)&&un.autoSleep&&pn._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||pn.sleep()}}},e}(Gs);Tn($t.prototype,{_lock:0,_hasPause:0,_forcing:0});var BT=function(e,t,i,r,s,o,a){var c=new Qt(this._pt,e,t,0,1,Im,null,s),u=0,d=0,f,l,h,p,m,v,_,g;for(c.b=i,c.e=r,i+="",r+="",(_=~r.indexOf("random("))&&(r=ia(r)),o&&(g=[i,r],o(g,e,t),i=g[0],r=g[1]),l=i.match(Ju)||[];f=Ju.exec(r);)p=f[0],m=r.substring(u,f.index),h?h=(h+1)%5:m.substr(-5)==="rgba("&&(h=1),p!==l[d++]&&(v=parseFloat(l[d-1])||0,c._pt={_next:c._pt,p:m||d===1?m:",",s:v,c:p.charAt(1)==="="?Ns(v,p)-v:parseFloat(p)-v,m:h&&h<4?Math.round:0},u=Ju.lastIndex);return c.c=u<r.length?r.substring(u,r.length):"",c.fp=a,($p.test(r)||_)&&(c.e=0),this._pt=c,c},hh=function(e,t,i,r,s,o,a,c,u,d){ht(r)&&(r=r(s||0,e,o));var f=e[t],l=i!=="get"?i:ht(f)?u?e[t.indexOf("set")||!ht(e["get"+t.substr(3)])?t:"get"+t.substr(3)](u):e[t]():f,h=ht(f)?u?NT:Om:vh,p;if(Lt(r)&&(~r.indexOf("random(")&&(r=ia(r)),r.charAt(1)==="="&&(p=Ns(l,r)+(Gt(l)||0),(p||p===0)&&(r=p))),!d||l!==r||_h)return!isNaN(l*r)&&r!==""?(p=new Qt(this._pt,e,t,+l||0,r-(l||0),typeof f=="boolean"?kT:Dm,0,h),u&&(p.fp=u),a&&p.modifier(a,this,e),this._pt=p):(!f&&!(t in e)&&Qu(t,r),BT.call(this,e,t,l,r,h,c||un.stringFilter,u))},zT=function(e,t,i,r,s){if(ht(e)&&(e=aa(e,s,t,i,r)),!ri(e)||e.style&&e.nodeType||Ut(e)||Jp(e))return Lt(e)?aa(e,s,t,i,r):e;var o={},a;for(a in e)o[a]=aa(e[a],s,t,i,r);return o},Fm=function(e,t,i,r,s,o){var a,c,u,d;if(fn[e]&&(a=new fn[e]).init(s,a.rawVars?t[e]:zT(t[e],r,s,o,i),i,r,o)!==!1&&(i._pt=c=new Qt(i._pt,s,e,0,1,a.render,a,0,a.priority),i!==Us))for(u=i._ptLookup[i._targets.indexOf(s)],d=a._props.length;d--;)u[a._props[d]]=c;return a},nr,_h,ah=function n(e,t){var i=e.vars,r=i.ease,s=i.startAt,o=i.immediateRender,a=i.lazy,c=i.onUpdate,u=i.onUpdateParams,d=i.callbackScope,f=i.runBackwards,l=i.yoyoEase,h=i.keyframes,p=i.autoRevert,m=e._dur,v=e._startAt,_=e._targets,g=e.parent,y=g&&g.data==="nested"?g.parent._targets:_,b=e._overwrite==="auto"&&!qu,w=e.timeline,x,S,P,T,I,U,W,D,L,O,F,Z,ee;if(w&&(!h||!r)&&(r="none"),e._ease=Br(r,Fs.ease),e._yEase=l?ym(Br(l===!0?r:l,Fs.ease)):0,l&&e._yoyo&&!e._repeat&&(l=e._yEase,e._yEase=e._ease,e._ease=l),e._from=!w&&!!i.runBackwards,!w||h&&!i.stagger){if(D=_[0]?Dr(_[0]).harness:0,Z=D&&i[D.prop],x=Vl(i,eh),v&&(v.revert(f&&m?Qo:cT),v._lazy=0),s){if(Ci(e._startAt=xt.set(_,Tn({data:"isStart",overwrite:!1,parent:g,immediateRender:!0,lazy:Jt(a),startAt:null,delay:0,onUpdate:c,onUpdateParams:u,callbackScope:d,stagger:0},s))),t<0&&(Nn||!o&&!p)&&e._startAt.revert(Qo),o&&m&&t<=0){t&&(e._zTime=t);return}}else if(f&&m&&!v){if(t&&(o=!1),P=Tn({overwrite:!1,data:"isFromStart",lazy:o&&Jt(a),immediateRender:o,stagger:0,parent:g},x),Z&&(P[D.prop]=Z),Ci(e._startAt=xt.set(_,P)),t<0&&(Nn?e._startAt.revert(Qo):e._startAt.render(-1,!0)),e._zTime=t,!o)n(e._startAt,Je);else if(!t)return}for(e._pt=e._ptCache=0,a=m&&Jt(a)||a&&!m,S=0;S<_.length;S++){if(I=_[S],W=I._gsap||rh(_)[S]._gsap,e._ptLookup[S]=O={},th[W.id]&&Qi.length&&Gl(),F=y===_?S:y.indexOf(I),D&&(L=new D).init(I,Z||x,e,F,y)!==!1&&(e._pt=T=new Qt(e._pt,I,L.name,0,1,L.render,L,0,L.priority),L._props.forEach(function(oe){O[oe]=T}),L.priority&&(U=1)),!D||Z)for(P in x)fn[P]&&(L=Fm(P,x,e,F,I,y))?L.priority&&(U=1):O[P]=T=hh.call(e,I,P,"get",x[P],F,y,0,i.stringFilter);e._op&&e._op[S]&&e.kill(I,e._op[S]),b&&e._pt&&(nr=e,lt.killTweensOf(I,O,e.globalTime(t)),ee=!e.parent,nr=0),e._pt&&a&&(th[W.id]=1)}U&&Bm(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!ee,h&&t<=0&&w.render(wn,!0,!0)},HT=function(e,t,i,r,s,o,a){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,d,f,l;if(!c)for(c=e._ptCache[t]=[],f=e._ptLookup,l=e._targets.length;l--;){if(u=f[l][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return _h=1,e.vars[t]="+=0",ah(e,a),_h=0,1;c.push(u)}for(l=c.length;l--;)d=c[l],u=d._pt||d,u.s=(r||r===0)&&!s?r:u.s+(r||0)+o*u.c,u.c=i-u.s,d.e&&(d.e=pt(i)+Gt(d.e)),d.b&&(d.b=u.s+Gt(d.b))},UT=function(e,t){var i=e[0]?Dr(e[0]).harness:0,r=i&&i.aliases,s,o,a,c;if(!r)return t;s=Or({},t);for(o in r)if(o in s)for(c=r[o].split(","),a=c.length;a--;)s[c[a]]=s[o];return s},GT=function(e,t,i,r){var s=t.ease||r||"power1.inOut",o,a;if(Ut(t))a=i[e]||(i[e]=[]),t.forEach(function(c,u){return a.push({t:u/(t.length-1)*100,v:c,e:s})});else for(o in t)a=i[o]||(i[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:s})},aa=function(e,t,i,r,s){return ht(e)?e.call(t,i,r,s):Lt(e)&&~e.indexOf("random(")?ia(e):e},Nm=ih+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",km={};Kt(Nm+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return km[n]=1});var xt=function(n){Xp(e,n);function e(i,r,s,o){var a;typeof r=="number"&&(s.duration=r,r=s,s=null),a=n.call(this,o?r:ea(r))||this;var c=a.vars,u=c.duration,d=c.delay,f=c.immediateRender,l=c.stagger,h=c.overwrite,p=c.keyframes,m=c.defaults,v=c.scrollTrigger,_=c.yoyoEase,g=r.parent||lt,y=(Ut(i)||Jp(i)?Ai(i[0]):"length"in r)?[i]:Sn(i),b,w,x,S,P,T,I,U;if(a._targets=y.length?rh(y):Hl("GSAP target "+i+" not found. https://greensock.com",!un.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=h,p||l||kl(u)||kl(d)){if(r=a.vars,b=a.timeline=new $t({data:"nested",defaults:m||{}}),b.kill(),b.parent=b._dp=Ei(a),b._start=0,l||kl(u)||kl(d)){if(S=y.length,I=l&&xm(l),ri(l))for(P in l)~Nm.indexOf(P)&&(U||(U={}),U[P]=l[P]);for(w=0;w<S;w++)x=Vl(r,km),x.stagger=0,_&&(x.yoyoEase=_),U&&Or(x,U),T=y[w],x.duration=+aa(u,Ei(a),w,T,y),x.delay=(+aa(d,Ei(a),w,T,y)||0)-a._delay,!l&&S===1&&x.delay&&(a._delay=d=x.delay,a._start+=d,x.delay=0),b.to(T,x,I?I(w,T,y):0),b._ease=Dt.none;b.duration()?u=d=0:a.timeline=0}else if(p){ea(Tn(b.vars.defaults,{ease:"none"})),b._ease=Br(p.ease||r.ease||"none");var W=0,D,L,O;if(Ut(p))p.forEach(function(F){return b.to(y,F,">")}),b.duration();else{x={};for(P in p)P==="ease"||P==="easeEach"||GT(P,p[P],x,p.easeEach);for(P in x)for(D=x[P].sort(function(F,Z){return F.t-Z.t}),W=0,w=0;w<D.length;w++)L=D[w],O={ease:L.e,duration:(L.t-(w?D[w-1].t:0))/100*u},O[P]=L.v,b.to(y,O,W),W+=O.duration;b.duration()<u&&b.to({},{duration:u-b.duration()})}}u||a.duration(u=b.duration())}else a.timeline=0;return h===!0&&!qu&&(nr=Ei(a),lt.killTweensOf(y),nr=0),si(g,Ei(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),(f||!u&&!p&&a._start===Ot(g._time)&&Jt(f)&&pT(Ei(a))&&g.data!=="nested")&&(a._tTime=-Je,a.render(Math.max(0,-d))),v&&pm(Ei(a),v),a}var t=e.prototype;return t.render=function(r,s,o){var a=this._time,c=this._tDur,u=this._dur,d=r<0,f=r>c-Je&&!d?c:r<Je?0:r,l,h,p,m,v,_,g,y,b;if(!u)gT(this,r,s,o);else if(f!==this._tTime||!r||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==d){if(l=f,y=this.timeline,this._repeat){if(m=u+this._rDelay,this._repeat<-1&&d)return this.totalTime(m*100+r,s,o);if(l=Ot(f%m),f===c?(p=this._repeat,l=u):(p=~~(f/m),p&&p===f/m&&(l=u,p--),l>u&&(l=u)),_=this._yoyo&&p&1,_&&(b=this._yEase,l=u-l),v=ks(this._tTime,m),l===a&&!o&&this._initted)return this._tTime=f,this;p!==v&&(y&&this._yEase&&Rm(y,_),this.vars.repeatRefresh&&!_&&!this._lock&&(this._lock=o=1,this.render(Ot(m*p),!0).invalidate()._lock=0))}if(!this._initted){if(mm(this,d?r:l,o,s))return this._tTime=0,this;if(a!==this._time)return this;if(u!==this._dur)return this.render(r,s,o)}if(this._tTime=f,this._time=l,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=g=(b||this._ease)(l/u),this._from&&(this.ratio=g=1-g),l&&!a&&!s&&(An(this,"onStart"),this._tTime!==f))return this;for(h=this._pt;h;)h.r(g,h.d),h=h._next;y&&y.render(r<0?r:!l&&_?-Je:y._dur*y._ease(l/this._dur),s,o)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(d&&sh(this,r,s,o),An(this,"onUpdate")),this._repeat&&p!==v&&this.vars.onRepeat&&!s&&this.parent&&An(this,"onRepeat"),(f===this._tDur||!f)&&this._tTime===f&&(d&&!this._onUpdate&&sh(this,r,!0,!0),(r||!u)&&(f===this._tDur&&this._ts>0||!f&&this._ts<0)&&Ci(this,1),!s&&!(d&&!a)&&(f||a)&&(An(this,f===c?"onComplete":"onReverseComplete",!0),this._prom&&!(f<c&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),n.prototype.invalidate.call(this)},t.resetTo=function(r,s,o,a){oa||pn.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||ah(this,c),u=this._ease(c/this._dur),HT(this,r,s,o,a,u,c)?this.resetTo(r,s,o,a):(Xl(this,0),this.parent||hm(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!r&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?ra(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,nr&&nr.vars.overwrite!==!0)._first||ra(this),this.parent&&o!==this.timeline.totalDuration()&&zs(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,c=r?Sn(r):a,u=this._ptLookup,d=this._pt,f,l,h,p,m,v,_;if((!s||s==="all")&&dT(a,c))return s==="all"&&(this._pt=0),ra(this);for(f=this._op=this._op||[],s!=="all"&&(Lt(s)&&(m={},Kt(s,function(g){return m[g]=1}),s=m),s=UT(a,s)),_=a.length;_--;)if(~c.indexOf(a[_])){l=u[_],s==="all"?(f[_]=s,p=l,h={}):(h=f[_]=f[_]||{},p=s);for(m in p)v=l&&l[m],v&&((!("kill"in v.d)||v.d.kill(m)===!0)&&Wl(this,v,"_pt"),delete l[m]),h!=="all"&&(h[m]=1)}return this._initted&&!this._pt&&d&&ra(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return na(1,arguments)},e.delayedCall=function(r,s,o,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(r,s,o){return na(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,o){return lt.killTweensOf(r,s,o)},e}(Gs);Tn(xt.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Kt("staggerTo,staggerFrom,staggerFromTo",function(n){xt[n]=function(){var e=new $t,t=lh.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var vh=function(e,t,i){return e[t]=i},Om=function(e,t,i){return e[t](i)},NT=function(e,t,i,r){return e[t](r.fp,i)},VT=function(e,t,i){return e.setAttribute(t,i)},fh=function(e,t){return ht(e[t])?Om:Yu(e[t])&&e.setAttribute?VT:vh},Dm=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},kT=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Im=function(e,t){var i=t._pt,r="";if(!e&&t.b)r=t.b;else if(e===1&&t.e)r=t.e;else{for(;i;)r=i.p+(i.m?i.m(i.s+i.c*e):Math.round((i.s+i.c*e)*1e4)/1e4)+r,i=i._next;r+=t.c}t.set(t.t,t.p,r,t)},dh=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},AT=function(e,t,i,r){for(var s=this._pt,o;s;)o=s._next,s.p===r&&s.modifier(e,t,i),s=o},CT=function(e){for(var t=this._pt,i,r;t;)r=t._next,t.p===e&&!t.op||t.op===e?Wl(this,t,"_pt"):t.dep||(i=1),t=r;return!i},WT=function(e,t,i,r){r.mSet(e,t,r.m.call(r.tween,i,r.mt),r)},Bm=function(e){for(var t=e._pt,i,r,s,o;t;){for(i=t._next,r=s;r&&r.pr>t.pr;)r=r._next;(t._prev=r?r._prev:o)?t._prev._next=t:s=t,(t._next=r)?r._prev=t:o=t,t=i}e._pt=s},Qt=function(){function n(t,i,r,s,o,a,c,u,d){this.t=i,this.s=s,this.c=o,this.p=r,this.r=a||Dm,this.d=c||this,this.set=u||vh,this.pr=d||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(i,r,s){this.mSet=this.mSet||this.set,this.set=WT,this.m=i,this.mt=s,this.tween=r},n}();Kt(ih+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return eh[n]=1});hn.TweenMax=hn.TweenLite=xt;hn.TimelineLite=hn.TimelineMax=$t;lt=new $t({sortChildren:!1,defaults:Fs,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});un.stringFilter=Lm;var Vs=[],Yl={},jT=[],zm=0,yh=function(e){return(Yl[e]||jT).map(function(t){return t()})},xh=function(){var e=Date.now(),t=[];e-zm>2&&(yh("matchMediaInit"),Vs.forEach(function(i){var r=i.queries,s=i.conditions,o,a,c,u;for(a in r)o=Mn.matchMedia(r[a]).matches,o&&(c=1),o!==s[a]&&(s[a]=o,u=1);u&&(i.revert(),c&&t.push(i))}),yh("matchMediaRevert"),t.forEach(function(i){return i.onMatch(i)}),zm=e,yh("matchMedia"))},Hm=function(){function n(t,i){this.selector=i&&ch(i),this.data=[],this._r=[],this.isReverted=!1,t&&this.add(t)}var e=n.prototype;return e.add=function(i,r,s){ht(i)&&(s=r,r=i,i=ht);var o=this,a=function(){var u=vt,d=o.selector,f;return u&&u.data.push(o),s&&(o.selector=ch(s)),vt=o,f=r.apply(o,arguments),ht(f)&&o._r.push(f),vt=u,o.selector=d,o.isReverted=!1,f};return o.last=a,i===ht?a(o):i?o[i]=a:a},e.ignore=function(i){var r=vt;vt=null,i(this),vt=r},e.getTweens=function(){var i=[];return this.data.forEach(function(r){return r instanceof n?i.push.apply(i,r.getTweens()):r instanceof xt&&r._targets[0]!==r.vars.onComplete&&i.push(r)}),i},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(i,r){var s=this;if(i?(this.getTweens().map(function(a){return{g:a.globalTime(0),t:a}}).sort(function(a,c){return c.g-a.g||-1}).forEach(function(a){return a.t.revert(i)}),this.data.forEach(function(a){return!(a instanceof Gs)&&a.revert&&a.revert(i)}),this._r.forEach(function(a){return a(i,s)}),this.isReverted=!0):this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),r){var o=Vs.indexOf(this);!!~o&&Vs.splice(o,1)}},e.revert=function(i){this.kill(i||{})},n}(),qT=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(i,r,s){ri(i)||(i={matches:i});var o=new Hm(0,s||this.scope),a=o.conditions={},c,u,d;this.contexts.push(o),r=o.add("onMatch",r),o.queries=i;for(u in i)u==="all"?d=1:(c=Mn.matchMedia(i[u]),c&&(Vs.indexOf(o)<0&&Vs.push(o),(a[u]=c.matches)&&(d=1),c.addListener?c.addListener(xh):c.addEventListener("change",xh)));return d&&r(o),this},e.revert=function(i){this.kill(i||{})},e.kill=function(i){this.contexts.forEach(function(r){return r.kill(i,!0)})},n}(),Zl={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(r){return LT(r)})},timeline:function(e){return new $t(e)},getTweensOf:function(e,t){return lt.getTweensOf(e,t)},getProperty:function(e,t,i,r){Lt(e)&&(e=Sn(e)[0]);var s=Dr(e||{}).get,o=i?cm:lm;return i==="native"&&(i=""),e&&(t?o((fn[t]&&fn[t].get||s)(e,t,i,r)):function(a,c,u){return o((fn[a]&&fn[a].get||s)(e,a,c,u))})},quickSetter:function(e,t,i){if(e=Sn(e),e.length>1){var r=e.map(function(d){return dn.quickSetter(d,t,i)}),s=r.length;return function(d){for(var f=s;f--;)r[f](d)}}e=e[0]||{};var o=fn[t],a=Dr(e),c=a.harness&&(a.harness.aliases||{})[t]||t,u=o?function(d){var f=new o;Us._pt=0,f.init(e,i?d+i:d,Us,0,[e]),f.render(1,f),Us._pt&&dh(1,Us)}:a.set(e,c);return o?u:function(d){return u(e,c,i?d+i:d,a,1)}},quickTo:function(e,t,i){var r,s=dn.to(e,Or((r={},r[t]="+=0.1",r.paused=!0,r),i||{})),o=function(c,u,d){return s.resetTo(t,c,u,d)};return o.tween=s,o},isTweening:function(e){return lt.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Br(e.ease,Fs.ease)),um(Fs,e||{})},config:function(e){return um(un,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,r=e.plugins,s=e.defaults,o=e.extendTimeline;(r||"").split(",").forEach(function(a){return a&&!fn[a]&&!hn[a]&&Hl(t+" effect requires "+a+" plugin.")}),nh[t]=function(a,c,u){return i(Sn(a),Tn(c||{},s),u)},o&&($t.prototype[t]=function(a,c,u){return this.add(nh[t](a,ri(c)?c:(u=c)&&{},this),u)})},registerEase:function(e,t){Dt[e]=Br(t)},parseEase:function(e,t){return arguments.length?Br(e,t):Dt},getById:function(e){return lt.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var i=new $t(e),r,s;for(i.smoothChildTiming=Jt(e.smoothChildTiming),lt.remove(i),i._dp=0,i._time=i._tTime=lt._time,r=lt._first;r;)s=r._next,(t||!(!r._dur&&r instanceof xt&&r.vars.onComplete===r._targets[0]))&&si(i,r,r._start-r._delay),r=s;return si(lt,i,0),i},context:function(e,t){return e?new Hm(e,t):vt},matchMedia:function(e){return new qT(e)},matchMediaRefresh:function(){return Vs.forEach(function(e){var t=e.conditions,i,r;for(r in t)t[r]&&(t[r]=!1,i=1);i&&e.revert()})||xh()},addEventListener:function(e,t){var i=Yl[e]||(Yl[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=Yl[e],r=i&&i.indexOf(t);r>=0&&i.splice(r,1)},utils:{wrap:ST,wrapYoyo:TT,distribute:xm,random:wm,snap:bm,normalize:MT,getUnit:Gt,clamp:yT,splitColor:Em,toArray:Sn,selector:ch,mapRange:Mm,pipe:bT,unitize:wT,interpolate:ET,shuffle:vm},install:tm,effects:nh,ticker:pn,updateRoot:$t.updateRoot,plugins:fn,globalTimeline:lt,core:{PropTween:Qt,globals:nm,Tween:xt,Timeline:$t,Animation:Gs,getCache:Dr,_removeLinkedListItem:Wl,reverting:function(){return Nn},context:function(e){return e&&vt&&(vt.data.push(e),e._ctx=vt),vt},suppressOverwrites:function(e){return qu=e}}};Kt("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return Zl[n]=xt[n]});pn.add($t.updateRoot);Us=Zl.to({},{duration:0});var XT=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},YT=function(e,t){var i=e._targets,r,s,o;for(r in t)for(s=i.length;s--;)o=e._ptLookup[s][r],o&&(o=o.d)&&(o._pt&&(o=XT(o,r)),o&&o.modifier&&o.modifier(t[r],e,i[s],r))},bh=function(e,t){return{name:e,rawVars:1,init:function(r,s,o){o._onInit=function(a){var c,u;if(Lt(s)&&(c={},Kt(s,function(d){return c[d]=1}),s=c),t){c={};for(u in s)c[u]=t(s[u]);s=c}YT(a,s)}}}},dn=Zl.registerPlugin({name:"attr",init:function(e,t,i,r,s){var o,a,c;this.tween=i;for(o in t)c=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(c||0)+"",t[o],r,s,0,0,o),a.op=o,a.b=c,this._props.push(o)},render:function(e,t){for(var i=t._pt;i;)Nn?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},bh("roundProps",uh),bh("modifiers"),bh("snap",bm))||Zl;xt.version=$t.version=dn.version="3.11.0";em=1;Zp()&&Hs();var Um,ir,Ws,wh,kr,Gm,Mh,ZT=function(){return typeof window!="undefined"},Li={},zr=180/Math.PI,js=Math.PI/180,qs=Math.atan2,Vm=1e8,Sh=/([A-Z])/g,JT=/(left|right|width|margin|padding|x)/i,KT=/[\s,\(]\S/,Ri={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Th=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},$T=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},QT=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},e1=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},Wm=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},jm=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},t1=function(e,t,i){return e.style[t]=i},n1=function(e,t,i){return e.style.setProperty(t,i)},i1=function(e,t,i){return e._gsap[t]=i},r1=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},s1=function(e,t,i,r,s){var o=e._gsap;o.scaleX=o.scaleY=i,o.renderTransform(s,o)},o1=function(e,t,i,r,s){var o=e._gsap;o[t]=i,o.renderTransform(s,o)},dt="transform",oi=dt+"Origin",a1=function(e){var t=this,i=this.target,r=i.style;if(e in Li){if(this.tfm=this.tfm||{},e!=="transform"&&(e=Ri[e]||e,~e.indexOf(",")?e.split(",").forEach(function(s){return t.tfm[s]=Pi(i,s)}):this.tfm[e]=i._gsap.x?i._gsap[e]:Pi(i,e)),i._gsap.svg&&(this.svg=i.getAttribute(e)||""),this.props.indexOf(dt)>=0)return;e=dt}r&&this.props.push(e,r[e])},qm=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},l1=function(){var e=this.props,t=this.target,i=t.style,r=t._gsap,s,o;for(s=0;s<e.length;s+=2)e[s+1]?i[e[s]]=e[s+1]:i.removeProperty(e[s].replace(Sh,"-$1").toLowerCase());if(this.tfm){r.svg&&t.setAttribute("transform",this.svg||"");for(o in this.tfm)r[o]=this.tfm[o];s=Mh(),s&&!s.isStart&&!i[dt]&&(qm(i),r.uncache=1)}},Xm=function(e,t){var i={target:e,props:[],revert:l1,save:a1};return t&&t.split(",").forEach(function(r){return i.save(r)}),i},Ym,Eh=function(e,t){var i=ir.createElementNS?ir.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):ir.createElement(e);return i.style?i:ir.createElement(e)},ai=function n(e,t,i){var r=getComputedStyle(e);return r[t]||r.getPropertyValue(t.replace(Sh,"-$1").toLowerCase())||r.getPropertyValue(t)||!i&&n(e,Xs(t)||t,1)||""},Zm="O,Moz,ms,Ms,Webkit".split(","),Xs=function(e,t,i){var r=t||kr,s=r.style,o=5;if(e in s&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(Zm[o]+e in s););return o<0?null:(o===3?"ms":o>=0?Zm[o]:"")+e},Ah=function(){ZT()&&window.document&&(Um=window,ir=Um.document,Ws=ir.documentElement,kr=Eh("div")||{style:{}},Eh("div"),dt=Xs(dt),oi=dt+"Origin",kr.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Ym=!!Xs("perspective"),Mh=dn.core.reverting,wh=1)},Ch=function n(e){var t=Eh("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,r=this.nextSibling,s=this.style.cssText,o;if(Ws.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch(a){}else this._gsapBBox&&(o=this._gsapBBox());return i&&(r?i.insertBefore(this,r):i.appendChild(this)),Ws.removeChild(t),this.style.cssText=s,o},Jm=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},Km=function(e){var t;try{t=e.getBBox()}catch(i){t=Ch.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===Ch||(t=Ch.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Jm(e,["x","cx","x1"])||0,y:+Jm(e,["y","cy","y1"])||0,width:0,height:0}:t},$m=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Km(e))},la=function(e,t){if(t){var i=e.style;t in Li&&t!==oi&&(t=dt),i.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),i.removeProperty(t.replace(Sh,"-$1").toLowerCase())):i.removeAttribute(t)}},rr=function(e,t,i,r,s,o){var a=new Qt(e._pt,t,i,0,1,o?jm:Wm);return e._pt=a,a.b=r,a.e=s,e._props.push(i),a},Qm={deg:1,rad:1,turn:1},c1={grid:1,flex:1},sr=function n(e,t,i,r){var s=parseFloat(i)||0,o=(i+"").trim().substr((s+"").length)||"px",a=kr.style,c=JT.test(t),u=e.tagName.toLowerCase()==="svg",d=(u?"client":"offset")+(c?"Width":"Height"),f=100,l=r==="px",h=r==="%",p,m,v,_;return r===o||!s||Qm[r]||Qm[o]?s:(o!=="px"&&!l&&(s=n(e,t,i,"px")),_=e.getCTM&&$m(e),(h||o==="%")&&(Li[t]||~t.indexOf("adius"))?(p=_?e.getBBox()[c?"width":"height"]:e[d],pt(h?s/p*f:s/100*p)):(a[c?"width":"height"]=f+(l?o:r),m=~t.indexOf("adius")||r==="em"&&e.appendChild&&!u?e:e.parentNode,_&&(m=(e.ownerSVGElement||{}).parentNode),(!m||m===ir||!m.appendChild)&&(m=ir.body),v=m._gsap,v&&h&&v.width&&c&&v.time===pn.time&&!v.uncache?pt(s/v.width*f):((h||o==="%")&&!c1[ai(m,"display")]&&(a.position=ai(e,"position")),m===e&&(a.position="static"),m.appendChild(kr),p=kr[d],m.removeChild(kr),a.position="absolute",c&&h&&(v=Dr(m),v.time=pn.time,v.width=m[d]),pt(l?p*s/f:p&&s?f/p*s:0))))},Pi=function(e,t,i,r){var s;return wh||Ah(),t in Ri&&t!=="transform"&&(t=Ri[t],~t.indexOf(",")&&(t=t.split(",")[0])),Li[t]&&t!=="transform"?(s=ca(e,r),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:Kl(ai(e,oi))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=Jl[t]&&Jl[t](e,t,i)||ai(e,t)||om(e,t)||(t==="opacity"?1:0))),i&&!~(s+"").trim().indexOf(" ")?sr(e,t,s,i)+i:s},u1=function(e,t,i,r){if(!i||i==="none"){var s=Xs(t,e,1),o=s&&ai(e,s,1);o&&o!==i?(t=s,i=o):t==="borderColor"&&(i=ai(e,"borderTopColor"))}var a=new Qt(this._pt,e.style,t,0,1,Im),c=0,u=0,d,f,l,h,p,m,v,_,g,y,b,w;if(a.b=i,a.e=r,i+="",r+="",r==="auto"&&(e.style[t]=r,r=ai(e,t)||r,e.style[t]=i),d=[i,r],Lm(d),i=d[0],r=d[1],l=i.match(Bs)||[],w=r.match(Bs)||[],w.length){for(;f=Bs.exec(r);)v=f[0],g=r.substring(c,f.index),p?p=(p+1)%5:(g.substr(-5)==="rgba("||g.substr(-5)==="hsla(")&&(p=1),v!==(m=l[u++]||"")&&(h=parseFloat(m)||0,b=m.substr((h+"").length),v.charAt(1)==="="&&(v=Ns(h,v)+b),_=parseFloat(v),y=v.substr((_+"").length),c=Bs.lastIndex-y.length,y||(y=y||un.units[t]||b,c===r.length&&(r+=y,a.e+=y)),b!==y&&(h=sr(e,t,m,y)||0),a._pt={_next:a._pt,p:g||u===1?g:",",s:h,c:_-h,m:p&&p<4||t==="zIndex"?Math.round:0});a.c=c<r.length?r.substring(c,r.length):""}else a.r=t==="display"&&r==="none"?jm:Wm;return $p.test(r)&&(a.e=0),this._pt=a,a},eg={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},h1=function(e){var t=e.split(" "),i=t[0],r=t[1]||"50%";return(i==="top"||i==="bottom"||r==="left"||r==="right")&&(e=i,i=r,r=e),t[0]=eg[i]||i,t[1]=eg[r]||r,t.join(" ")},d1=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i=t.t,r=i.style,s=t.u,o=i._gsap,a,c,u;if(s==="all"||s===!0)r.cssText="",c=1;else for(s=s.split(","),u=s.length;--u>-1;)a=s[u],Li[a]&&(c=1,a=a==="transformOrigin"?oi:dt),la(i,a);c&&(la(i,dt),o&&(o.svg&&i.removeAttribute("transform"),ca(i,1),o.uncache=1,qm(r)))}},Jl={clearProps:function(e,t,i,r,s){if(s.data!=="isFromStart"){var o=e._pt=new Qt(e._pt,t,i,0,0,d1);return o.u=r,o.pr=-10,o.tween=s,e._props.push(i),1}}},ua=[1,0,0,1,0,0],tg={},ng=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},ig=function(e){var t=ai(e,dt);return ng(t)?ua:t.substr(7).match(Kp).map(pt)},Lh=function(e,t){var i=e._gsap||Dr(e),r=e.style,s=ig(e),o,a,c,u;return i.svg&&e.getAttribute("transform")?(c=e.transform.baseVal.consolidate().matrix,s=[c.a,c.b,c.c,c.d,c.e,c.f],s.join(",")==="1,0,0,1,0,0"?ua:s):(s===ua&&!e.offsetParent&&e!==Ws&&!i.svg&&(c=r.display,r.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(u=1,a=e.nextElementSibling,Ws.appendChild(e)),s=ig(e),c?r.display=c:la(e,"display"),u&&(a?o.insertBefore(e,a):o?o.appendChild(e):Ws.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},Rh=function(e,t,i,r,s,o){var a=e._gsap,c=s||Lh(e,!0),u=a.xOrigin||0,d=a.yOrigin||0,f=a.xOffset||0,l=a.yOffset||0,h=c[0],p=c[1],m=c[2],v=c[3],_=c[4],g=c[5],y=t.split(" "),b=parseFloat(y[0])||0,w=parseFloat(y[1])||0,x,S,P,T;i?c!==ua&&(S=h*v-p*m)&&(P=b*(v/S)+w*(-m/S)+(m*g-v*_)/S,T=b*(-p/S)+w*(h/S)-(h*g-p*_)/S,b=P,w=T):(x=Km(e),b=x.x+(~y[0].indexOf("%")?b/100*x.width:b),w=x.y+(~(y[1]||y[0]).indexOf("%")?w/100*x.height:w)),r||r!==!1&&a.smooth?(_=b-u,g=w-d,a.xOffset=f+(_*h+g*m)-_,a.yOffset=l+(_*p+g*v)-g):a.xOffset=a.yOffset=0,a.xOrigin=b,a.yOrigin=w,a.smooth=!!r,a.origin=t,a.originIsAbsolute=!!i,e.style[oi]="0px 0px",o&&(rr(o,a,"xOrigin",u,b),rr(o,a,"yOrigin",d,w),rr(o,a,"xOffset",f,a.xOffset),rr(o,a,"yOffset",l,a.yOffset)),e.setAttribute("data-svg-origin",b+" "+w)},ca=function(e,t){var i=e._gsap||new sm(e);if("x"in i&&!t&&!i.uncache)return i;var r=e.style,s=i.scaleX<0,o="px",a="deg",c=getComputedStyle(e),u=ai(e,oi)||"0",d,f,l,h,p,m,v,_,g,y,b,w,x,S,P,T,I,U,W,D,L,O,F,Z,ee,oe,ge,de,ne,Te,Ae,re;return d=f=l=m=v=_=g=y=b=0,h=p=1,i.svg=!!(e.getCTM&&$m(e)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(r[dt]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+c[dt]),r.scale=r.rotate=r.translate="none"),S=Lh(e,i.svg),i.svg&&(Z=(!i.uncache||u==="0px 0px")&&!t&&e.getAttribute("data-svg-origin"),Rh(e,Z||u,!!Z||i.originIsAbsolute,i.smooth!==!1,S)),w=i.xOrigin||0,x=i.yOrigin||0,S!==ua&&(U=S[0],W=S[1],D=S[2],L=S[3],d=O=S[4],f=F=S[5],S.length===6?(h=Math.sqrt(U*U+W*W),p=Math.sqrt(L*L+D*D),m=U||W?qs(W,U)*zr:0,g=D||L?qs(D,L)*zr+m:0,g&&(p*=Math.abs(Math.cos(g*js))),i.svg&&(d-=w-(w*U+x*D),f-=x-(w*W+x*L))):(re=S[6],Te=S[7],ge=S[8],de=S[9],ne=S[10],Ae=S[11],d=S[12],f=S[13],l=S[14],P=qs(re,ne),v=P*zr,P&&(T=Math.cos(-P),I=Math.sin(-P),Z=O*T+ge*I,ee=F*T+de*I,oe=re*T+ne*I,ge=O*-I+ge*T,de=F*-I+de*T,ne=re*-I+ne*T,Ae=Te*-I+Ae*T,O=Z,F=ee,re=oe),P=qs(-D,ne),_=P*zr,P&&(T=Math.cos(-P),I=Math.sin(-P),Z=U*T-ge*I,ee=W*T-de*I,oe=D*T-ne*I,Ae=L*I+Ae*T,U=Z,W=ee,D=oe),P=qs(W,U),m=P*zr,P&&(T=Math.cos(P),I=Math.sin(P),Z=U*T+W*I,ee=O*T+F*I,W=W*T-U*I,F=F*T-O*I,U=Z,O=ee),v&&Math.abs(v)+Math.abs(m)>359.9&&(v=m=0,_=180-_),h=pt(Math.sqrt(U*U+W*W+D*D)),p=pt(Math.sqrt(F*F+re*re)),P=qs(O,F),g=Math.abs(P)>2e-4?P*zr:0,b=Ae?1/(Ae<0?-Ae:Ae):0),i.svg&&(Z=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!ng(ai(e,dt)),Z&&e.setAttribute("transform",Z))),Math.abs(g)>90&&Math.abs(g)<270&&(s?(h*=-1,g+=m<=0?180:-180,m+=m<=0?180:-180):(p*=-1,g+=g<=0?180:-180)),t=t||i.uncache,i.x=d-((i.xPercent=d&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-d)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+o,i.y=f-((i.yPercent=f&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-f)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+o,i.z=l+o,i.scaleX=pt(h),i.scaleY=pt(p),i.rotation=pt(m)+a,i.rotationX=pt(v)+a,i.rotationY=pt(_)+a,i.skewX=g+a,i.skewY=y+a,i.transformPerspective=b+o,(i.zOrigin=parseFloat(u.split(" ")[2])||0)&&(r[oi]=Kl(u)),i.xOffset=i.yOffset=0,i.force3D=un.force3D,i.renderTransform=i.svg?p1:Ym?rg:f1,i.uncache=0,i},Kl=function(e){return(e=e.split(" "))[0]+" "+e[1]},Ph=function(e,t,i){var r=Gt(t);return pt(parseFloat(t)+parseFloat(sr(e,"x",i+"px",r)))+r},f1=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,rg(e,t)},Hr="0deg",ha="0px",Ur=") ",rg=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,c=i.z,u=i.rotation,d=i.rotationY,f=i.rotationX,l=i.skewX,h=i.skewY,p=i.scaleX,m=i.scaleY,v=i.transformPerspective,_=i.force3D,g=i.target,y=i.zOrigin,b="",w=_==="auto"&&e&&e!==1||_===!0;if(y&&(f!==Hr||d!==Hr)){var x=parseFloat(d)*js,S=Math.sin(x),P=Math.cos(x),T;x=parseFloat(f)*js,T=Math.cos(x),o=Ph(g,o,S*T*-y),a=Ph(g,a,-Math.sin(x)*-y),c=Ph(g,c,P*T*-y+y)}v!==ha&&(b+="perspective("+v+Ur),(r||s)&&(b+="translate("+r+"%, "+s+"%) "),(w||o!==ha||a!==ha||c!==ha)&&(b+=c!==ha||w?"translate3d("+o+", "+a+", "+c+") ":"translate("+o+", "+a+Ur),u!==Hr&&(b+="rotate("+u+Ur),d!==Hr&&(b+="rotateY("+d+Ur),f!==Hr&&(b+="rotateX("+f+Ur),(l!==Hr||h!==Hr)&&(b+="skew("+l+", "+h+Ur),(p!==1||m!==1)&&(b+="scale("+p+", "+m+Ur),g.style[dt]=b||"translate(0, 0)"},p1=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,c=i.rotation,u=i.skewX,d=i.skewY,f=i.scaleX,l=i.scaleY,h=i.target,p=i.xOrigin,m=i.yOrigin,v=i.xOffset,_=i.yOffset,g=i.forceCSS,y=parseFloat(o),b=parseFloat(a),w,x,S,P,T;c=parseFloat(c),u=parseFloat(u),d=parseFloat(d),d&&(d=parseFloat(d),u+=d,c+=d),c||u?(c*=js,u*=js,w=Math.cos(c)*f,x=Math.sin(c)*f,S=Math.sin(c-u)*-l,P=Math.cos(c-u)*l,u&&(d*=js,T=Math.tan(u-d),T=Math.sqrt(1+T*T),S*=T,P*=T,d&&(T=Math.tan(d),T=Math.sqrt(1+T*T),w*=T,x*=T)),w=pt(w),x=pt(x),S=pt(S),P=pt(P)):(w=f,P=l,x=S=0),(y&&!~(o+"").indexOf("px")||b&&!~(a+"").indexOf("px"))&&(y=sr(h,"x",o,"px"),b=sr(h,"y",a,"px")),(p||m||v||_)&&(y=pt(y+p-(p*w+m*S)+v),b=pt(b+m-(p*x+m*P)+_)),(r||s)&&(T=h.getBBox(),y=pt(y+r/100*T.width),b=pt(b+s/100*T.height)),T="matrix("+w+","+x+","+S+","+P+","+y+","+b+")",h.setAttribute("transform",T),g&&(h.style[dt]=T)},m1=function(e,t,i,r,s){var o=360,a=Lt(s),c=parseFloat(s)*(a&&~s.indexOf("rad")?zr:1),u=c-r,d=r+u+"deg",f,l;return a&&(f=s.split("_")[1],f==="short"&&(u%=o,u!==u%(o/2)&&(u+=u<0?o:-o)),f==="cw"&&u<0?u=(u+o*Vm)%o-~~(u/o)*o:f==="ccw"&&u>0&&(u=(u-o*Vm)%o-~~(u/o)*o)),e._pt=l=new Qt(e._pt,t,i,r,u,$T),l.e=d,l.u="deg",e._props.push(i),l},sg=function(e,t){for(var i in t)e[i]=t[i];return e},g1=function(e,t,i){var r=sg({},i._gsap),s="perspective,force3D,transformOrigin,svgOrigin",o=i.style,a,c,u,d,f,l,h,p;r.svg?(u=i.getAttribute("transform"),i.setAttribute("transform",""),o[dt]=t,a=ca(i,1),la(i,dt),i.setAttribute("transform",u)):(u=getComputedStyle(i)[dt],o[dt]=t,a=ca(i,1),o[dt]=u);for(c in Li)u=r[c],d=a[c],u!==d&&s.indexOf(c)<0&&(h=Gt(u),p=Gt(d),f=h!==p?sr(i,c,u,p):parseFloat(u),l=parseFloat(d),e._pt=new Qt(e._pt,a,c,f,l-f,Th),e._pt.u=p||0,e._props.push(c));sg(a,r)};Kt("padding,margin,Width,Radius",function(n,e){var t="Top",i="Right",r="Bottom",s="Left",o=(e<3?[t,i,r,s]:[t+s,t+i,r+i,r+s]).map(function(a){return e<2?n+a:"border"+a+n});Jl[e>1?"border"+n:n]=function(a,c,u,d,f){var l,h;if(arguments.length<4)return l=o.map(function(p){return Pi(a,p,u)}),h=l.join(" "),h.split(l[0]).length===5?l[0]:h;l=(d+"").split(" "),h={},o.forEach(function(p,m){return h[p]=l[m]=l[m]||l[(m-1)/2|0]}),a.init(c,h,f)}});var og={name:"css",register:Ah,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,r,s){var o=this._props,a=e.style,c=i.vars.startAt,u,d,f,l,h,p,m,v,_,g,y,b,w,x,S,P;wh||Ah(),this.styles=this.styles||Xm(e),P=this.styles.props,this.tween=i;for(m in t)if(m!=="autoRound"&&(d=t[m],!(fn[m]&&Fm(m,t,i,r,e,s)))){if(h=typeof d,p=Jl[m],h==="function"&&(d=d.call(i,r,e,s),h=typeof d),h==="string"&&~d.indexOf("random(")&&(d=ia(d)),p)p(this,e,m,d,i)&&(S=1);else if(m.substr(0,2)==="--")u=(getComputedStyle(e).getPropertyValue(m)+"").trim(),d+="",tr.lastIndex=0,tr.test(u)||(v=Gt(u),_=Gt(d)),_?v!==_&&(u=sr(e,m,u,_)+_):v&&(d+=v),this.add(a,"setProperty",u,d,r,s,0,0,m),o.push(m),P.push(m,a[m]);else if(h!=="undefined"){if(c&&m in c?(u=typeof c[m]=="function"?c[m].call(i,r,e,s):c[m],Lt(u)&&~u.indexOf("random(")&&(u=ia(u)),Gt(u+"")||(u+=un.units[m]||Gt(Pi(e,m))||""),(u+"").charAt(1)==="="&&(u=Pi(e,m))):u=Pi(e,m),l=parseFloat(u),g=h==="string"&&d.charAt(1)==="="&&d.substr(0,2),g&&(d=d.substr(2)),f=parseFloat(d),m in Ri&&(m==="autoAlpha"&&(l===1&&Pi(e,"visibility")==="hidden"&&f&&(l=0),P.push("visibility",a.visibility),rr(this,a,"visibility",l?"inherit":"hidden",f?"inherit":"hidden",!f)),m!=="scale"&&m!=="transform"&&(m=Ri[m],~m.indexOf(",")&&(m=m.split(",")[0]))),y=m in Li,y){if(this.styles.save(m),b||(w=e._gsap,w.renderTransform&&!t.parseTransform||ca(e,t.parseTransform),x=t.smoothOrigin!==!1&&w.smooth,b=this._pt=new Qt(this._pt,a,dt,0,1,w.renderTransform,w,0,-1),b.dep=1),m==="scale")this._pt=new Qt(this._pt,w,"scaleY",w.scaleY,(g?Ns(w.scaleY,g+f):f)-w.scaleY||0,Th),this._pt.u=0,o.push("scaleY",m),m+="X";else if(m==="transformOrigin"){P.push(oi,a[oi]),d=h1(d),w.svg?Rh(e,d,0,x,0,this):(_=parseFloat(d.split(" ")[2])||0,_!==w.zOrigin&&rr(this,w,"zOrigin",w.zOrigin,_),rr(this,a,m,Kl(u),Kl(d)));continue}else if(m==="svgOrigin"){Rh(e,d,1,x,0,this);continue}else if(m in tg){m1(this,w,m,l,g?Ns(l,g+d):d);continue}else if(m==="smoothOrigin"){rr(this,w,"smooth",w.smooth,d);continue}else if(m==="force3D"){w[m]=d;continue}else if(m==="transform"){g1(this,d,e);continue}}else m in a||(m=Xs(m)||m);if(y||(f||f===0)&&(l||l===0)&&!KT.test(d)&&m in a)v=(u+"").substr((l+"").length),f||(f=0),_=Gt(d)||(m in un.units?un.units[m]:v),v!==_&&(l=sr(e,m,u,_)),this._pt=new Qt(this._pt,y?w:a,m,l,(g?Ns(l,g+f):f)-l,!y&&(_==="px"||m==="zIndex")&&t.autoRound!==!1?e1:Th),this._pt.u=_||0,v!==_&&_!=="%"&&(this._pt.b=u,this._pt.r=QT);else if(m in a)u1.call(this,e,m,u,g?g+d:d);else if(m in e)this.add(e,m,u||e[m],g?g+d:d,r,s);else{Qu(m,d);continue}y||P.push(m,a[m]),o.push(m)}}S&&Bm(this)},render:function(e,t){if(t.tween._time||!Mh())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:Pi,aliases:Ri,getSetter:function(e,t,i){var r=Ri[t];return r&&r.indexOf(",")<0&&(t=r),t in Li&&t!==oi&&(e._gsap.x||Pi(e,"x"))?i&&Gm===i?t==="scale"?r1:i1:(Gm=i||{})&&(t==="scale"?s1:o1):e.style&&!Yu(e.style[t])?t1:~t.indexOf("-")?n1:fh(e,t)},core:{_removeProperty:la,_getMatrix:Lh}};dn.utils.checkPrefix=Xs;dn.core.getStyleSaver=Xm;(function(n,e,t,i){var r=Kt(n+","+e+","+t,function(s){Li[s]=1});Kt(e,function(s){un.units[s]="deg",tg[s]=1}),Ri[r[13]]=n+","+e,Kt(i,function(s){var o=s.split(":");Ri[o[1]]=r[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Kt("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){un.units[n]="px"});dn.registerPlugin(og);var ag=dn.registerPlugin(og)||dn,OE=ag.core.Tween,mt=ag;var lg=function(){function n(C){qe.call(this,C),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(M){return new o(M)}),this.register(function(M){return new c(M)}),this.register(function(M){return new u(M)}),this.register(function(M){return new a(M)}),this.register(function(M){return new r(M)}),this.register(function(M){return new d(M)})}n.prototype=Object.assign(Object.create(qe.prototype),{constructor:n,load:function(C,M,V,B){var G=this,X;this.resourcePath!==""?X=this.resourcePath:this.path!==""?X=this.path:X=Ir.extractUrlBase(C),this.manager.itemStart(C);var z=function(Y){B?B(Y):console.error(Y),G.manager.itemError(C),G.manager.itemEnd(C)},H=new xn(this.manager);H.setPath(this.path),H.setResponseType("arraybuffer"),H.setRequestHeader(this.requestHeader),H.setWithCredentials(this.withCredentials),H.load(C,function(Y){try{G.parse(Y,X,function(K){M(K),G.manager.itemEnd(C)},z)}catch(K){z(K)}},V,z)},setDRACOLoader:function(C){return this.dracoLoader=C,this},setDDSLoader:function(C){return this.ddsLoader=C,this},setKTX2Loader:function(C){return this.ktx2Loader=C,this},setMeshoptDecoder:function(C){return this.meshoptDecoder=C,this},register:function(C){return this.pluginCallbacks.indexOf(C)===-1&&this.pluginCallbacks.push(C),this},unregister:function(C){return this.pluginCallbacks.indexOf(C)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(C),1),this},parse:function(C,M,V,B){var G,X={},z={};if(typeof C=="string")G=C;else{var H=Ir.decodeText(new Uint8Array(C,0,4));if(H===f){try{X[t.KHR_BINARY_GLTF]=new p(C)}catch($){B&&B($);return}G=X[t.KHR_BINARY_GLTF].content}else G=Ir.decodeText(new Uint8Array(C))}var Y=JSON.parse(G);if(Y.asset===void 0||Y.asset.version[0]<2){B&&B(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}var K=new ne(Y,{path:M||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});K.fileLoader.setRequestHeader(this.requestHeader);for(var J=0;J<this.pluginCallbacks.length;J++){var A=this.pluginCallbacks[J](K);z[A.name]=A,X[A.name]=!0}if(Y.extensionsUsed)for(var J=0;J<Y.extensionsUsed.length;++J){var E=Y.extensionsUsed[J],ie=Y.extensionsRequired||[];switch(E){case t.KHR_MATERIALS_UNLIT:X[E]=new s;break;case t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:X[E]=new g;break;case t.KHR_DRACO_MESH_COMPRESSION:X[E]=new m(Y,this.dracoLoader);break;case t.MSFT_TEXTURE_DDS:X[E]=new i(this.ddsLoader);break;case t.KHR_TEXTURE_TRANSFORM:X[E]=new v;break;case t.KHR_MESH_QUANTIZATION:X[E]=new y;break;default:ie.indexOf(E)>=0&&z[E]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+E+'".')}}K.setExtensions(X),K.setPlugins(z),K.parse(V,B)}});function e(){var C={};return{get:function(M){return C[M]},add:function(M,V){C[M]=V},remove:function(M){delete C[M]},removeAll:function(){C={}}}}var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(C){if(!C)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=t.MSFT_TEXTURE_DDS,this.ddsLoader=C}function r(C){this.parser=C,this.name=t.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}r.prototype._markDefs=function(){for(var C=this.parser,M=this.parser.json.nodes||[],V=0,B=M.length;V<B;V++){var G=M[V];G.extensions&&G.extensions[this.name]&&G.extensions[this.name].light!==void 0&&C._addNodeRef(this.cache,G.extensions[this.name].light)}},r.prototype._loadLight=function(C){var M=this.parser,V="light:"+C,B=M.cache.get(V);if(B)return B;var G=M.json,X=G.extensions&&G.extensions[this.name]||{},z=X.lights||[],H=z[C],Y,K=new Me(16777215);H.color!==void 0&&K.fromArray(H.color);var J=H.range!==void 0?H.range:0;switch(H.type){case"directional":Y=new Pr(K),Y.target.position.set(0,0,-1),Y.add(Y.target);break;case"point":Y=new Pl(K),Y.distance=J;break;case"spot":Y=new Rl(K),Y.distance=J,H.spot=H.spot||{},H.spot.innerConeAngle=H.spot.innerConeAngle!==void 0?H.spot.innerConeAngle:0,H.spot.outerConeAngle=H.spot.outerConeAngle!==void 0?H.spot.outerConeAngle:Math.PI/4,Y.angle=H.spot.outerConeAngle,Y.penumbra=1-H.spot.innerConeAngle/H.spot.outerConeAngle,Y.target.position.set(0,0,-1),Y.add(Y.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+H.type)}return Y.position.set(0,0,0),Y.decay=2,H.intensity!==void 0&&(Y.intensity=H.intensity),Y.name=M.createUniqueName(H.name||"light_"+C),B=Promise.resolve(Y),M.cache.add(V,B),B},r.prototype.createNodeAttachment=function(C){var M=this,V=this.parser,B=V.json,G=B.nodes[C],X=G.extensions&&G.extensions[this.name]||{},z=X.light;return z===void 0?null:this._loadLight(z).then(function(H){return V._getNodeRef(M.cache,z,H)})};function s(){this.name=t.KHR_MATERIALS_UNLIT}s.prototype.getMaterialType=function(){return At},s.prototype.extendParams=function(C,M,V){var B=[];C.color=new Me(1,1,1),C.opacity=1;var G=M.pbrMetallicRoughness;if(G){if(Array.isArray(G.baseColorFactor)){var X=G.baseColorFactor;C.color.fromArray(X),C.opacity=X[3]}G.baseColorTexture!==void 0&&B.push(V.assignTexture(C,"map",G.baseColorTexture))}return Promise.all(B)};function o(C){this.parser=C,this.name=t.KHR_MATERIALS_CLEARCOAT}o.prototype.getMaterialType=function(C){var M=this.parser,V=M.json.materials[C];return!V.extensions||!V.extensions[this.name]?null:Kn},o.prototype.extendMaterialParams=function(C,M){var V=this.parser,B=V.json.materials[C];if(!B.extensions||!B.extensions[this.name])return Promise.resolve();var G=[],X=B.extensions[this.name];if(X.clearcoatFactor!==void 0&&(M.clearcoat=X.clearcoatFactor),X.clearcoatTexture!==void 0&&G.push(V.assignTexture(M,"clearcoatMap",X.clearcoatTexture)),X.clearcoatRoughnessFactor!==void 0&&(M.clearcoatRoughness=X.clearcoatRoughnessFactor),X.clearcoatRoughnessTexture!==void 0&&G.push(V.assignTexture(M,"clearcoatRoughnessMap",X.clearcoatRoughnessTexture)),X.clearcoatNormalTexture!==void 0&&(G.push(V.assignTexture(M,"clearcoatNormalMap",X.clearcoatNormalTexture)),X.clearcoatNormalTexture.scale!==void 0)){var z=X.clearcoatNormalTexture.scale;M.clearcoatNormalScale=new ae(z,-z)}return Promise.all(G)};function a(C){this.parser=C,this.name=t.KHR_MATERIALS_TRANSMISSION}a.prototype.getMaterialType=function(C){var M=this.parser,V=M.json.materials[C];return!V.extensions||!V.extensions[this.name]?null:Kn},a.prototype.extendMaterialParams=function(C,M){var V=this.parser,B=V.json.materials[C];if(!B.extensions||!B.extensions[this.name])return Promise.resolve();var G=[],X=B.extensions[this.name];return X.transmissionFactor!==void 0&&(M.transmission=X.transmissionFactor),X.transmissionTexture!==void 0&&G.push(V.assignTexture(M,"transmissionMap",X.transmissionTexture)),Promise.all(G)};function c(C){this.parser=C,this.name=t.KHR_TEXTURE_BASISU}c.prototype.loadTexture=function(C){var M=this.parser,V=M.json,B=V.textures[C];if(!B.extensions||!B.extensions[this.name])return null;var G=B.extensions[this.name],X=V.images[G.source],z=M.options.ktx2Loader;if(!z){if(V.extensionsRequired&&V.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return M.loadTextureImage(C,X,z)};function u(C){this.parser=C,this.name=t.EXT_TEXTURE_WEBP,this.isSupported=null}u.prototype.loadTexture=function(C){var M=this.name,V=this.parser,B=V.json,G=B.textures[C];if(!G.extensions||!G.extensions[M])return null;var X=G.extensions[M],z=B.images[X.source],H=z.uri?V.options.manager.getHandler(z.uri):V.textureLoader;return this.detectSupport().then(function(Y){if(Y)return V.loadTextureImage(C,z,H);if(B.extensionsRequired&&B.extensionsRequired.indexOf(M)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return V.loadTexture(C)})},u.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(C){var M=new Image;M.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",M.onload=M.onerror=function(){C(M.height===1)}})),this.isSupported};function d(C){this.name=t.EXT_MESHOPT_COMPRESSION,this.parser=C}d.prototype.loadBufferView=function(C){var M=this.parser.json,V=M.bufferViews[C];if(V.extensions&&V.extensions[this.name]){var B=V.extensions[this.name],G=this.parser.getDependency("buffer",B.buffer),X=this.parser.options.meshoptDecoder;if(!X||!X.supported){if(M.extensionsRequired&&M.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([G,X.ready]).then(function(z){var H=B.byteOffset||0,Y=B.byteLength||0,K=B.count,J=B.byteStride,A=new ArrayBuffer(K*J),E=new Uint8Array(z[0],H,Y);return X.decodeGltfBuffer(new Uint8Array(A),K,J,E,B.mode,B.filter),A})}else return null};var f="glTF",l=12,h={JSON:1313821514,BIN:5130562};function p(C){this.name=t.KHR_BINARY_GLTF,this.content=null,this.body=null;var M=new DataView(C,0,l);if(this.header={magic:Ir.decodeText(new Uint8Array(C.slice(0,4))),version:M.getUint32(4,!0),length:M.getUint32(8,!0)},this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var V=this.header.length-l,B=new DataView(C,l),G=0;G<V;){var X=B.getUint32(G,!0);G+=4;var z=B.getUint32(G,!0);if(G+=4,z===h.JSON){var H=new Uint8Array(C,l+G,X);this.content=Ir.decodeText(H)}else if(z===h.BIN){var Y=l+G;this.body=C.slice(Y,Y+X)}G+=X}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(C,M){if(!M)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=t.KHR_DRACO_MESH_COMPRESSION,this.json=C,this.dracoLoader=M,this.dracoLoader.preload()}m.prototype.decodePrimitive=function(C,M){var V=this.json,B=this.dracoLoader,G=C.extensions[this.name].bufferView,X=C.extensions[this.name].attributes,z={},H={},Y={};for(var K in X){var J=I[K]||K.toLowerCase();z[J]=X[K]}for(K in C.attributes){var J=I[K]||K.toLowerCase();if(X[K]!==void 0){var A=V.accessors[C.attributes[K]],E=x[A.componentType];Y[J]=E,H[J]=A.normalized===!0}}return M.getDependency("bufferView",G).then(function(ie){return new Promise(function($){B.decodeDracoFile(ie,function(q){for(var le in q.attributes){var fe=q.attributes[le],me=H[le];me!==void 0&&(fe.normalized=me)}$(q)},z,Y)})})};function v(){this.name=t.KHR_TEXTURE_TRANSFORM}v.prototype.extendTexture=function(C,M){return C=C.clone(),M.offset!==void 0&&C.offset.fromArray(M.offset),M.rotation!==void 0&&(C.rotation=M.rotation),M.scale!==void 0&&C.repeat.fromArray(M.scale),M.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),C.needsUpdate=!0,C};function _(C){yt.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var M=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),V=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),B=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),G=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),X=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),z={specular:{value:new Me().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=z,this.onBeforeCompile=function(H){for(var Y in z)H.uniforms[Y]=z[Y];H.fragmentShader=H.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",M).replace("#include <metalnessmap_pars_fragment>",V).replace("#include <roughnessmap_fragment>",B).replace("#include <metalnessmap_fragment>",G).replace("#include <lights_physical_fragment>",X)},Object.defineProperties(this,{specular:{get:function(){return z.specular.value},set:function(H){z.specular.value=H}},specularMap:{get:function(){return z.specularMap.value},set:function(H){z.specularMap.value=H,H?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return z.glossiness.value},set:function(H){z.glossiness.value=H}},glossinessMap:{get:function(){return z.glossinessMap.value},set:function(H){z.glossinessMap.value=H,H?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(C)}_.prototype=Object.create(yt.prototype),_.prototype.constructor=_,_.prototype.copy=function(C){return yt.prototype.copy.call(this,C),this.specularMap=C.specularMap,this.specular.copy(C.specular),this.glossinessMap=C.glossinessMap,this.glossiness=C.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this};function g(){return{name:t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return _},extendParams:function(C,M,V){var B=M.extensions[this.name];C.color=new Me(1,1,1),C.opacity=1;var G=[];if(Array.isArray(B.diffuseFactor)){var X=B.diffuseFactor;C.color.fromArray(X),C.opacity=X[3]}if(B.diffuseTexture!==void 0&&G.push(V.assignTexture(C,"map",B.diffuseTexture)),C.emissive=new Me(0,0,0),C.glossiness=B.glossinessFactor!==void 0?B.glossinessFactor:1,C.specular=new Me(1,1,1),Array.isArray(B.specularFactor)&&C.specular.fromArray(B.specularFactor),B.specularGlossinessTexture!==void 0){var z=B.specularGlossinessTexture;G.push(V.assignTexture(C,"glossinessMap",z)),G.push(V.assignTexture(C,"specularMap",z))}return Promise.all(G)},createMaterial:function(C){var M=new _(C);return M.fog=!0,M.color=C.color,M.map=C.map===void 0?null:C.map,M.lightMap=null,M.lightMapIntensity=1,M.aoMap=C.aoMap===void 0?null:C.aoMap,M.aoMapIntensity=1,M.emissive=C.emissive,M.emissiveIntensity=1,M.emissiveMap=C.emissiveMap===void 0?null:C.emissiveMap,M.bumpMap=C.bumpMap===void 0?null:C.bumpMap,M.bumpScale=1,M.normalMap=C.normalMap===void 0?null:C.normalMap,M.normalMapType=zi,C.normalScale&&(M.normalScale=C.normalScale),M.displacementMap=null,M.displacementScale=1,M.displacementBias=0,M.specularMap=C.specularMap===void 0?null:C.specularMap,M.specular=C.specular,M.glossinessMap=C.glossinessMap===void 0?null:C.glossinessMap,M.glossiness=C.glossiness,M.alphaMap=null,M.envMap=C.envMap===void 0?null:C.envMap,M.envMapIntensity=1,M.refractionRatio=.98,M}}}function y(){this.name=t.KHR_MESH_QUANTIZATION}function b(C,M,V,B){jt.call(this,C,M,V,B)}b.prototype=Object.create(jt.prototype),b.prototype.constructor=b,b.prototype.copySampleValue_=function(C){for(var M=this.resultBuffer,V=this.sampleValues,B=this.valueSize,G=C*B*3+B,X=0;X!==B;X++)M[X]=V[G+X];return M},b.prototype.beforeStart_=b.prototype.copySampleValue_,b.prototype.afterEnd_=b.prototype.copySampleValue_,b.prototype.interpolate_=function(C,M,V,B){for(var G=this.resultBuffer,X=this.sampleValues,z=this.valueSize,H=z*2,Y=z*3,K=B-M,J=(V-M)/K,A=J*J,E=A*J,ie=C*Y,$=ie-Y,q=-2*E+3*A,le=E-A,fe=1-q,me=le-A+J,he=0;he!==z;he++){var j=X[$+he+z],pe=X[$+he+H]*K,we=X[ie+he+z],_e=X[ie+he]*K;G[he]=fe*j+me*pe+q*we+le*_e}return G};var w={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},x={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},S={9728:_t,9729:Xe,9984:Ba,9985:Fc,9986:Na,9987:_r},P={33071:Wt,33648:_o,10497:gr},T={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},U={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},W={CUBICSPLINE:void 0,LINEAR:vr,STEP:Zr},D={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function L(C,M){return typeof C!="string"||C===""?"":(/^https?:\/\//i.test(M)&&/^\//.test(C)&&(M=M.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(C)||/^data:.*,.*$/i.test(C)||/^blob:.*$/i.test(C)?C:M+C)}function O(C){return C.DefaultMaterial===void 0&&(C.DefaultMaterial=new yt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:di})),C.DefaultMaterial}function F(C,M,V){for(var B in V.extensions)C[B]===void 0&&(M.userData.gltfExtensions=M.userData.gltfExtensions||{},M.userData.gltfExtensions[B]=V.extensions[B])}function Z(C,M){M.extras!==void 0&&(typeof M.extras=="object"?Object.assign(C.userData,M.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+M.extras))}function ee(C,M,V){for(var B=!1,G=!1,X=0,z=M.length;X<z;X++){var H=M[X];if(H.POSITION!==void 0&&(B=!0),H.NORMAL!==void 0&&(G=!0),B&&G)break}if(!B&&!G)return Promise.resolve(C);for(var Y=[],K=[],X=0,z=M.length;X<z;X++){var H=M[X];if(B){var J=H.POSITION!==void 0?V.getDependency("accessor",H.POSITION):C.attributes.position;Y.push(J)}if(G){var J=H.NORMAL!==void 0?V.getDependency("accessor",H.NORMAL):C.attributes.normal;K.push(J)}}return Promise.all([Promise.all(Y),Promise.all(K)]).then(function(A){var E=A[0],ie=A[1];return B&&(C.morphAttributes.position=E),G&&(C.morphAttributes.normal=ie),C.morphTargetsRelative=!0,C})}function oe(C,M){if(C.updateMorphTargets(),M.weights!==void 0)for(var V=0,B=M.weights.length;V<B;V++)C.morphTargetInfluences[V]=M.weights[V];if(M.extras&&Array.isArray(M.extras.targetNames)){var G=M.extras.targetNames;if(C.morphTargetInfluences.length===G.length){C.morphTargetDictionary={};for(var V=0,B=G.length;V<B;V++)C.morphTargetDictionary[G[V]]=V}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ge(C){var M=C.extensions&&C.extensions[t.KHR_DRACO_MESH_COMPRESSION],V;return M?V="draco:"+M.bufferView+":"+M.indices+":"+de(M.attributes):V=C.indices+":"+de(C.attributes)+":"+C.mode,V}function de(C){for(var M="",V=Object.keys(C).sort(),B=0,G=V.length;B<G;B++)M+=V[B]+":"+C[V[B]]+";";return M}function ne(C,M){this.json=C||{},this.extensions={},this.plugins={},this.options=M||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new Ol(this.options.manager):this.textureLoader=new Xo(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new xn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}ne.prototype.setExtensions=function(C){this.extensions=C},ne.prototype.setPlugins=function(C){this.plugins=C},ne.prototype.parse=function(C,M){var V=this,B=this.json,G=this.extensions;this.cache.removeAll(),this._invokeAll(function(X){return X._markDefs&&X._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(X){var z={scene:X[0][B.scene||0],scenes:X[0],animations:X[1],cameras:X[2],asset:B.asset,parser:V,userData:{}};F(G,z,B),Z(z,B),C(z)}).catch(M)},ne.prototype._markDefs=function(){for(var C=this.json.nodes||[],M=this.json.skins||[],V=this.json.meshes||[],B=0,G=M.length;B<G;B++)for(var X=M[B].joints,z=0,H=X.length;z<H;z++)C[X[z]].isBone=!0;for(var Y=0,K=C.length;Y<K;Y++){var J=C[Y];J.mesh!==void 0&&(this._addNodeRef(this.meshCache,J.mesh),J.skin!==void 0&&(V[J.mesh].isSkinnedMesh=!0)),J.camera!==void 0&&this._addNodeRef(this.cameraCache,J.camera)}},ne.prototype._addNodeRef=function(C,M){M!==void 0&&(C.refs[M]===void 0&&(C.refs[M]=C.uses[M]=0),C.refs[M]++)},ne.prototype._getNodeRef=function(C,M,V){if(C.refs[M]<=1)return V;var B=V.clone();return B.name+="_instance_"+C.uses[M]++,B},ne.prototype._invokeOne=function(C){var M=Object.values(this.plugins);M.push(this);for(var V=0;V<M.length;V++){var B=C(M[V]);if(B)return B}},ne.prototype._invokeAll=function(C){var M=Object.values(this.plugins);M.unshift(this);for(var V=[],B=0;B<M.length;B++){var G=C(M[B]);G&&V.push(G)}return V},ne.prototype.getDependency=function(C,M){var V=C+":"+M,B=this.cache.get(V);if(!B){switch(C){case"scene":B=this.loadScene(M);break;case"node":B=this.loadNode(M);break;case"mesh":B=this._invokeOne(function(G){return G.loadMesh&&G.loadMesh(M)});break;case"accessor":B=this.loadAccessor(M);break;case"bufferView":B=this._invokeOne(function(G){return G.loadBufferView&&G.loadBufferView(M)});break;case"buffer":B=this.loadBuffer(M);break;case"material":B=this._invokeOne(function(G){return G.loadMaterial&&G.loadMaterial(M)});break;case"texture":B=this._invokeOne(function(G){return G.loadTexture&&G.loadTexture(M)});break;case"skin":B=this.loadSkin(M);break;case"animation":B=this.loadAnimation(M);break;case"camera":B=this.loadCamera(M);break;default:throw new Error("Unknown type: "+C)}this.cache.add(V,B)}return B},ne.prototype.getDependencies=function(C){var M=this.cache.get(C);if(!M){var V=this,B=this.json[C+(C==="mesh"?"es":"s")]||[];M=Promise.all(B.map(function(G,X){return V.getDependency(C,X)})),this.cache.add(C,M)}return M},ne.prototype.loadBuffer=function(C){var M=this.json.buffers[C],V=this.fileLoader;if(M.type&&M.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+M.type+" buffer type is not supported.");if(M.uri===void 0&&C===0)return Promise.resolve(this.extensions[t.KHR_BINARY_GLTF].body);var B=this.options;return new Promise(function(G,X){V.load(L(M.uri,B.path),G,void 0,function(){X(new Error('THREE.GLTFLoader: Failed to load buffer "'+M.uri+'".'))})})},ne.prototype.loadBufferView=function(C){var M=this.json.bufferViews[C];return this.getDependency("buffer",M.buffer).then(function(V){var B=M.byteLength||0,G=M.byteOffset||0;return V.slice(G,G+B)})},ne.prototype.loadAccessor=function(C){var M=this,V=this.json,B=this.json.accessors[C];if(B.bufferView===void 0&&B.sparse===void 0)return Promise.resolve(null);var G=[];return B.bufferView!==void 0?G.push(this.getDependency("bufferView",B.bufferView)):G.push(null),B.sparse!==void 0&&(G.push(this.getDependency("bufferView",B.sparse.indices.bufferView)),G.push(this.getDependency("bufferView",B.sparse.values.bufferView))),Promise.all(G).then(function(X){var z=X[0],H=T[B.type],Y=x[B.componentType],K=Y.BYTES_PER_ELEMENT,J=K*H,A=B.byteOffset||0,E=B.bufferView!==void 0?V.bufferViews[B.bufferView].byteStride:void 0,ie=B.normalized===!0,$,q;if(E&&E!==J){var le=Math.floor(A/E),fe="InterleavedBuffer:"+B.bufferView+":"+B.componentType+":"+le+":"+B.count,me=M.cache.get(fe);me||($=new Y(z,le*E,B.count*E/K),me=new Zt($,E/K),M.cache.add(fe,me)),q=new xi(me,H,A%E/K,ie)}else z===null?$=new Y(B.count*H):$=new Y(z,A,B.count*H),q=new Oe($,H,ie);if(B.sparse!==void 0){var he=T.SCALAR,j=x[B.sparse.indices.componentType],pe=B.sparse.indices.byteOffset||0,we=B.sparse.values.byteOffset||0,_e=new j(X[1],pe,B.sparse.count*he),Se=new Y(X[2],we,B.sparse.count*H);z!==null&&(q=new Oe(q.array.slice(),q.itemSize,q.normalized));for(var Pe=0,ot=_e.length;Pe<ot;Pe++){var en=_e[Pe];if(q.setX(en,Se[Pe*H]),H>=2&&q.setY(en,Se[Pe*H+1]),H>=3&&q.setZ(en,Se[Pe*H+2]),H>=4&&q.setW(en,Se[Pe*H+3]),H>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return q})},ne.prototype.loadTexture=function(C){var M=this,V=this.json,B=this.options,G=V.textures[C],X=G.extensions||{},z;X[t.MSFT_TEXTURE_DDS]?z=V.images[X[t.MSFT_TEXTURE_DDS].source]:z=V.images[G.source];var H;return z.uri&&(H=B.manager.getHandler(z.uri)),H||(H=X[t.MSFT_TEXTURE_DDS]?M.extensions[t.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(C,z,H)},ne.prototype.loadTextureImage=function(C,M,V){var B=this,G=this.json,X=this.options,z=G.textures[C],H=self.URL||self.webkitURL,Y=M.uri,K=!1,J=!0;return M.mimeType==="image/jpeg"&&(J=!1),M.bufferView!==void 0&&(Y=B.getDependency("bufferView",M.bufferView).then(function(A){if(M.mimeType==="image/png"){var E=new DataView(A,25,1).getUint8(0,!1);J=E===6||E===4||E===3}K=!0;var ie=new Blob([A],{type:M.mimeType});return Y=H.createObjectURL(ie),Y})),Promise.resolve(Y).then(function(A){return new Promise(function(E,ie){var $=E;V.isImageBitmapLoader===!0&&($=function(q){E(new Ms(q))}),V.load(L(A,X.path),$,void 0,ie)})}).then(function(A){K===!0&&H.revokeObjectURL(Y),A.flipY=!1,z.name&&(A.name=z.name),J||(A.format=fi);var E=G.samplers||{},ie=E[z.sampler]||{};return A.magFilter=S[ie.magFilter]||Xe,A.minFilter=S[ie.minFilter]||_r,A.wrapS=P[ie.wrapS]||gr,A.wrapT=P[ie.wrapT]||gr,B.associations.set(A,{type:"textures",index:C}),A})},ne.prototype.assignTexture=function(C,M,V){var B=this;return this.getDependency("texture",V.index).then(function(G){if(V.texCoord!==void 0&&V.texCoord!=0&&!(M==="aoMap"&&V.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+V.texCoord+" for texture "+M+" not yet supported."),B.extensions[t.KHR_TEXTURE_TRANSFORM]){var X=V.extensions!==void 0?V.extensions[t.KHR_TEXTURE_TRANSFORM]:void 0;if(X){var z=B.associations.get(G);G=B.extensions[t.KHR_TEXTURE_TRANSFORM].extendTexture(G,X),B.associations.set(G,z)}}C[M]=G})},ne.prototype.assignFinalMaterial=function(C){var M=C.geometry,V=C.material,B=M.attributes.tangent!==void 0,G=M.attributes.color!==void 0,X=M.attributes.normal===void 0,z=C.isSkinnedMesh===!0,H=Object.keys(M.morphAttributes).length>0,Y=H&&M.morphAttributes.normal!==void 0;if(C.isPoints){var K="PointsMaterial:"+V.uuid,J=this.cache.get(K);J||(J=new bi,Re.prototype.copy.call(J,V),J.color.copy(V.color),J.map=V.map,J.sizeAttenuation=!1,this.cache.add(K,J)),V=J}else if(C.isLine){var K="LineBasicMaterial:"+V.uuid,A=this.cache.get(K);A||(A=new yn,Re.prototype.copy.call(A,V),A.color.copy(V.color),this.cache.add(K,A)),V=A}if(B||G||X||z||H){var K="ClonedMaterial:"+V.uuid+":";V.isGLTFSpecularGlossinessMaterial&&(K+="specular-glossiness:"),z&&(K+="skinning:"),B&&(K+="vertex-tangents:"),G&&(K+="vertex-colors:"),X&&(K+="flat-shading:"),H&&(K+="morph-targets:"),Y&&(K+="morph-normals:");var E=this.cache.get(K);E||(E=V.clone(),z&&(E.skinning=!0),G&&(E.vertexColors=!0),X&&(E.flatShading=!0),H&&(E.morphTargets=!0),Y&&(E.morphNormals=!0),B&&(E.vertexTangents=!0,E.normalScale&&(E.normalScale.y*=-1),E.clearcoatNormalScale&&(E.clearcoatNormalScale.y*=-1)),this.cache.add(K,E),this.associations.set(E,this.associations.get(V))),V=E}V.aoMap&&M.attributes.uv2===void 0&&M.attributes.uv!==void 0&&M.setAttribute("uv2",M.attributes.uv),C.material=V},ne.prototype.getMaterialType=function(){return yt},ne.prototype.loadMaterial=function(C){var M=this,V=this.json,B=this.extensions,G=V.materials[C],X,z={},H=G.extensions||{},Y=[];if(H[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var K=B[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];X=K.getMaterialType(),Y.push(K.extendParams(z,G,M))}else if(H[t.KHR_MATERIALS_UNLIT]){var J=B[t.KHR_MATERIALS_UNLIT];X=J.getMaterialType(),Y.push(J.extendParams(z,G,M))}else{var A=G.pbrMetallicRoughness||{};if(z.color=new Me(1,1,1),z.opacity=1,Array.isArray(A.baseColorFactor)){var E=A.baseColorFactor;z.color.fromArray(E),z.opacity=E[3]}A.baseColorTexture!==void 0&&Y.push(M.assignTexture(z,"map",A.baseColorTexture)),z.metalness=A.metallicFactor!==void 0?A.metallicFactor:1,z.roughness=A.roughnessFactor!==void 0?A.roughnessFactor:1,A.metallicRoughnessTexture!==void 0&&(Y.push(M.assignTexture(z,"metalnessMap",A.metallicRoughnessTexture)),Y.push(M.assignTexture(z,"roughnessMap",A.metallicRoughnessTexture))),X=this._invokeOne(function($){return $.getMaterialType&&$.getMaterialType(C)}),Y.push(Promise.all(this._invokeAll(function($){return $.extendMaterialParams&&$.extendMaterialParams(C,z)})))}G.doubleSided===!0&&(z.side=mr);var ie=G.alphaMode||D.OPAQUE;return ie===D.BLEND?(z.transparent=!0,z.depthWrite=!1):(z.transparent=!1,ie===D.MASK&&(z.alphaTest=G.alphaCutoff!==void 0?G.alphaCutoff:.5)),G.normalTexture!==void 0&&X!==At&&(Y.push(M.assignTexture(z,"normalMap",G.normalTexture)),z.normalScale=new ae(1,-1),G.normalTexture.scale!==void 0&&z.normalScale.set(G.normalTexture.scale,-G.normalTexture.scale)),G.occlusionTexture!==void 0&&X!==At&&(Y.push(M.assignTexture(z,"aoMap",G.occlusionTexture)),G.occlusionTexture.strength!==void 0&&(z.aoMapIntensity=G.occlusionTexture.strength)),G.emissiveFactor!==void 0&&X!==At&&(z.emissive=new Me().fromArray(G.emissiveFactor)),G.emissiveTexture!==void 0&&X!==At&&Y.push(M.assignTexture(z,"emissiveMap",G.emissiveTexture)),Promise.all(Y).then(function(){var $;return X===_?$=B[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(z):$=new X(z),G.name&&($.name=G.name),$.map&&($.map.encoding=jn),$.emissiveMap&&($.emissiveMap.encoding=jn),Z($,G),M.associations.set($,{type:"materials",index:C}),G.extensions&&F(B,$,G),$})},ne.prototype.createUniqueName=function(C){for(var M=It.sanitizeNodeName(C||""),V=M,B=1;this.nodeNamesUsed[V];++B)V=M+"_"+B;return this.nodeNamesUsed[V]=!0,V};function Te(C,M,V){var B=M.attributes,G=new qn;if(B.POSITION!==void 0){var X=V.json.accessors[B.POSITION],z=X.min,H=X.max;if(z!==void 0&&H!==void 0)G.set(new k(z[0],z[1],z[2]),new k(H[0],H[1],H[2]));else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;var Y=M.targets;if(Y!==void 0){for(var K=new k,J=new k,A=0,E=Y.length;A<E;A++){var ie=Y[A];if(ie.POSITION!==void 0){var X=V.json.accessors[ie.POSITION],z=X.min,H=X.max;z!==void 0&&H!==void 0?(J.setX(Math.max(Math.abs(z[0]),Math.abs(H[0]))),J.setY(Math.max(Math.abs(z[1]),Math.abs(H[1]))),J.setZ(Math.max(Math.abs(z[2]),Math.abs(H[2]))),K.max(J)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}G.expandByVector(K)}C.boundingBox=G;var $=new Xn;G.getCenter($.center),$.radius=G.min.distanceTo(G.max)/2,C.boundingSphere=$}function Ae(C,M,V){var B=M.attributes,G=[];function X(K,J){return V.getDependency("accessor",K).then(function(A){C.setAttribute(J,A)})}for(var z in B){var H=I[z]||z.toLowerCase();H in C.attributes||G.push(X(B[z],H))}if(M.indices!==void 0&&!C.index){var Y=V.getDependency("accessor",M.indices).then(function(K){C.setIndex(K)});G.push(Y)}return Z(C,M),Te(C,M,V),Promise.all(G).then(function(){return M.targets!==void 0?ee(C,M.targets,V):C})}function re(C,M){var V=C.getIndex();if(V===null){var B=[],G=C.getAttribute("position");if(G!==void 0){for(var X=0;X<G.count;X++)B.push(X);C.setIndex(B),V=C.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),C}var z=V.count-2,H=[];if(M===zc)for(var X=1;X<=z;X++)H.push(V.getX(0)),H.push(V.getX(X)),H.push(V.getX(X+1));else for(var X=0;X<z;X++)X%2==0?(H.push(V.getX(X)),H.push(V.getX(X+1)),H.push(V.getX(X+2))):(H.push(V.getX(X+2)),H.push(V.getX(X+1)),H.push(V.getX(X)));H.length/3!==z&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var Y=C.clone();return Y.setIndex(H),Y}return ne.prototype.loadGeometries=function(C){var M=this,V=this.extensions,B=this.primitiveCache;function G(E){return V[t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(E,M).then(function(ie){return Ae(ie,E,M)})}for(var X=[],z=0,H=C.length;z<H;z++){var Y=C[z],K=ge(Y),J=B[K];if(J)X.push(J.promise);else{var A;Y.extensions&&Y.extensions[t.KHR_DRACO_MESH_COMPRESSION]?A=G(Y):A=Ae(new We,Y,M),B[K]={primitive:Y,promise:A},X.push(A)}}return Promise.all(X)},ne.prototype.loadMesh=function(C){for(var M=this,V=this.json,B=this.extensions,G=V.meshes[C],X=G.primitives,z=[],H=0,Y=X.length;H<Y;H++){var K=X[H].material===void 0?O(this.cache):this.getDependency("material",X[H].material);z.push(K)}return z.push(M.loadGeometries(X)),Promise.all(z).then(function(J){for(var A=J.slice(0,J.length-1),E=J[J.length-1],ie=[],$=0,q=E.length;$<q;$++){var le=E[$],fe=X[$],me,he=A[$];if(fe.mode===w.TRIANGLES||fe.mode===w.TRIANGLE_STRIP||fe.mode===w.TRIANGLE_FAN||fe.mode===void 0)me=G.isSkinnedMesh===!0?new ko(le,he):new ke(le,he),he.isMeshStandardMaterial===!0&&he.side===mr&&le.getIndex()!==null&&le.hasAttribute("position")===!0&&le.hasAttribute("normal")===!0&&le.hasAttribute("uv")===!0&&le.hasAttribute("tangent")===!1&&(le.computeTangents(),he.vertexTangents=!0),me.isSkinnedMesh===!0&&!me.geometry.attributes.skinWeight.normalized&&me.normalizeSkinWeights(),fe.mode===w.TRIANGLE_STRIP?me.geometry=re(me.geometry,nf):fe.mode===w.TRIANGLE_FAN&&(me.geometry=re(me.geometry,zc));else if(fe.mode===w.LINES)me=new gl(le,he);else if(fe.mode===w.LINE_STRIP)me=new Ji(le,he);else if(fe.mode===w.LINE_LOOP)me=new _l(le,he);else if(fe.mode===w.POINTS)me=new xl(le,he);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+fe.mode);Object.keys(me.geometry.morphAttributes).length>0&&oe(me,G),me.name=M.createUniqueName(G.name||"mesh_"+C),Z(me,G),fe.extensions&&F(B,me,fe),M.assignFinalMaterial(me),ie.push(me)}if(ie.length===1)return ie[0];for(var j=new an,$=0,q=ie.length;$<q;$++)j.add(ie[$]);return j})},ne.prototype.loadCamera=function(C){var M,V=this.json.cameras[C],B=V[V.type];if(!B){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return V.type==="perspective"?M=new ut(Ie.radToDeg(B.yfov),B.aspectRatio||1,B.znear||1,B.zfar||2e6):V.type==="orthographic"&&(M=new Ti(-B.xmag,B.xmag,B.ymag,-B.ymag,B.znear,B.zfar)),V.name&&(M.name=this.createUniqueName(V.name)),Z(M,V),Promise.resolve(M)},ne.prototype.loadSkin=function(C){var M=this.json.skins[C],V={joints:M.joints};return M.inverseBindMatrices===void 0?Promise.resolve(V):this.getDependency("accessor",M.inverseBindMatrices).then(function(B){return V.inverseBindMatrices=B,V})},ne.prototype.loadAnimation=function(C){for(var M=this.json,V=M.animations[C],B=[],G=[],X=[],z=[],H=[],Y=0,K=V.channels.length;Y<K;Y++){var J=V.channels[Y],A=V.samplers[J.sampler],E=J.target,ie=E.node!==void 0?E.node:E.id,$=V.parameters!==void 0?V.parameters[A.input]:A.input,q=V.parameters!==void 0?V.parameters[A.output]:A.output;B.push(this.getDependency("node",ie)),G.push(this.getDependency("accessor",$)),X.push(this.getDependency("accessor",q)),z.push(A),H.push(E)}return Promise.all([Promise.all(B),Promise.all(G),Promise.all(X),Promise.all(z),Promise.all(H)]).then(function(le){for(var fe=le[0],me=le[1],he=le[2],j=le[3],pe=le[4],we=[],_e=0,Se=fe.length;_e<Se;_e++){var Pe=fe[_e],ot=me[_e],en=he[_e],Vt=j[_e],Bt=pe[_e];if(Pe!==void 0){Pe.updateMatrix(),Pe.matrixAutoUpdate=!0;var Gr;switch(U[Bt.path]){case U.weights:Gr=Cr;break;case U.rotation:Gr=Ps;break;case U.position:case U.scale:default:Gr=Lr;break}var eo=Pe.name?Pe.name:Pe.uuid,cc=Vt.interpolation!==void 0?W[Vt.interpolation]:vr,Un=[];U[Bt.path]===U.weights?Pe.traverse(function(N){N.isMesh===!0&&N.morphTargetInfluences&&Un.push(N.name?N.name:N.uuid)}):Un.push(eo);var gn=en.array;if(en.normalized){var Ii;if(gn.constructor===Int8Array)Ii=1/127;else if(gn.constructor===Uint8Array)Ii=1/255;else if(gn.constructor==Int16Array)Ii=1/32767;else if(gn.constructor===Uint16Array)Ii=1/65535;else throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var to=new Float32Array(gn.length),wt=0,Vr=gn.length;wt<Vr;wt++)to[wt]=gn[wt]*Ii;gn=to}for(var wt=0,Vr=Un.length;wt<Vr;wt++){var no=new Gr(Un[wt]+"."+U[Bt.path],ot.array,gn,cc);Vt.interpolation==="CUBICSPLINE"&&(no.createInterpolant=function(ce){return new b(this.times,this.values,this.getValueSize()/3,ce)},no.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),we.push(no)}}}var uc=V.name?V.name:"animation_"+C;return new ln(uc,void 0,we)})},ne.prototype.loadNode=function(C){var M=this.json,V=this.extensions,B=this,G=M.nodes[C],X=G.name?B.createUniqueName(G.name):"";return function(){var z=[];return G.mesh!==void 0&&z.push(B.getDependency("mesh",G.mesh).then(function(H){var Y=B._getNodeRef(B.meshCache,G.mesh,H);return G.weights!==void 0&&Y.traverse(function(K){if(!!K.isMesh)for(var J=0,A=G.weights.length;J<A;J++)K.morphTargetInfluences[J]=G.weights[J]}),Y})),G.camera!==void 0&&z.push(B.getDependency("camera",G.camera).then(function(H){return B._getNodeRef(B.cameraCache,G.camera,H)})),B._invokeAll(function(H){return H.createNodeAttachment&&H.createNodeAttachment(C)}).forEach(function(H){z.push(H)}),Promise.all(z)}().then(function(z){var H;if(G.isBone===!0?H=new zo:z.length>1?H=new an:z.length===1?H=z[0]:H=new Ce,H!==z[0])for(var Y=0,K=z.length;Y<K;Y++)H.add(z[Y]);if(G.name&&(H.userData.name=G.name,H.name=X),Z(H,G),G.extensions&&F(V,H,G),G.matrix!==void 0){var J=new Fe;J.fromArray(G.matrix),H.applyMatrix4(J)}else G.translation!==void 0&&H.position.fromArray(G.translation),G.rotation!==void 0&&H.quaternion.fromArray(G.rotation),G.scale!==void 0&&H.scale.fromArray(G.scale);return B.associations.set(H,{type:"nodes",index:C}),H})},ne.prototype.loadScene=function(){function C(M,V,B,G){var X=B.nodes[M];return G.getDependency("node",M).then(function(z){if(X.skin===void 0)return z;var H;return G.getDependency("skin",X.skin).then(function(Y){H=Y;for(var K=[],J=0,A=H.joints.length;J<A;J++)K.push(G.getDependency("node",H.joints[J]));return Promise.all(K)}).then(function(Y){return z.traverse(function(K){if(!!K.isMesh){for(var J=[],A=[],E=0,ie=Y.length;E<ie;E++){var $=Y[E];if($){J.push($);var q=new Fe;H.inverseBindMatrices!==void 0&&q.fromArray(H.inverseBindMatrices.array,E*16),A.push(q)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',H.joints[E])}K.bind(new Ho(J,A),K.matrixWorld)}}),z})}).then(function(z){V.add(z);var H=[];if(X.children)for(var Y=X.children,K=0,J=Y.length;K<J;K++){var A=Y[K];H.push(C(A,z,B,G))}return Promise.all(H)})}return function(V){var B=this.json,G=this.extensions,X=this.json.scenes[V],z=this,H=new an;X.name&&(H.name=z.createUniqueName(X.name)),Z(H,X),X.extensions&&F(G,H,X);for(var Y=X.nodes||[],K=[],J=0,A=Y.length;J<A;J++)K.push(C(Y[J],H,B,z));return Promise.all(K).then(function(){return H})}}(),n}();var mn=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function $l(n,e,t){return t={path:e,exports:{},require:function(i,r){return _1(i,r==null?t.path:r)}},n(t,t.exports),t.exports}function _1(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var v1=$l(function(n,e){(function(){var t=function(){this.init()};t.prototype={init:function(){var l=this||i;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var h=this||i;if(l=parseFloat(l),h.ctx||f(),typeof l!="undefined"&&l>=0&&l<=1){if(h._volume=l,h._muted)return h;h.usingWebAudio&&h.masterGain.gain.setValueAtTime(l,i.ctx.currentTime);for(var p=0;p<h._howls.length;p++)if(!h._howls[p]._webAudio)for(var m=h._howls[p]._getSoundIds(),v=0;v<m.length;v++){var _=h._howls[p]._soundById(m[v]);_&&_._node&&(_._node.volume=_._volume*l)}return h}return h._volume},mute:function(l){var h=this||i;h.ctx||f(),h._muted=l,h.usingWebAudio&&h.masterGain.gain.setValueAtTime(l?0:h._volume,i.ctx.currentTime);for(var p=0;p<h._howls.length;p++)if(!h._howls[p]._webAudio)for(var m=h._howls[p]._getSoundIds(),v=0;v<m.length;v++){var _=h._howls[p]._soundById(m[v]);_&&_._node&&(_._node.muted=l?!0:_._muted)}return h},stop:function(){for(var l=this||i,h=0;h<l._howls.length;h++)l._howls[h].stop();return l},unload:function(){for(var l=this||i,h=l._howls.length-1;h>=0;h--)l._howls[h].unload();return l.usingWebAudio&&l.ctx&&typeof l.ctx.close!="undefined"&&(l.ctx.close(),l.ctx=null,f()),l},codecs:function(l){return(this||i)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||i;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio!="undefined")try{var h=new Audio;typeof h.oncanplaythrough=="undefined"&&(l._canPlayEvent="canplay")}catch(p){l.noAudio=!0}else l.noAudio=!0;try{var h=new Audio;h.muted&&(l.noAudio=!0)}catch(p){}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||i,h=null;try{h=typeof Audio!="undefined"?new Audio:null}catch(w){return l}if(!h||typeof h.canPlayType!="function")return l;var p=h.canPlayType("audio/mpeg;").replace(/^no$/,""),m=l._navigator?l._navigator.userAgent:"",v=m.match(/OPR\/(\d+)/g),_=v&&parseInt(v[0].split("/")[1],10)<33,g=m.indexOf("Safari")!==-1&&m.indexOf("Chrome")===-1,y=m.match(/Version\/(.*?) /),b=g&&y&&parseInt(y[1],10)<15;return l._codecs={mp3:!!(!_&&(p||h.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(h.canPlayType('audio/wav; codecs="1"')||h.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!h.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(h.canPlayType("audio/x-m4b;")||h.canPlayType("audio/m4b;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!b&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!b&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!h.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(h.canPlayType("audio/x-flac;")||h.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||i;if(!(l._audioUnlocked||!l.ctx)){l._audioUnlocked=!1,l.autoUnlock=!1,!l._mobileUnloaded&&l.ctx.sampleRate!==44100&&(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var h=function(p){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var m=new Audio;m._unlocked=!0,l._releaseHtml5Audio(m)}catch(w){l.noAudio=!0;break}for(var v=0;v<l._howls.length;v++)if(!l._howls[v]._webAudio)for(var _=l._howls[v]._getSoundIds(),g=0;g<_.length;g++){var y=l._howls[v]._soundById(_[g]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}l._autoResume();var b=l.ctx.createBufferSource();b.buffer=l._scratchBuffer,b.connect(l.ctx.destination),typeof b.start=="undefined"?b.noteOn(0):b.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),b.onended=function(){b.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",h,!0),document.removeEventListener("touchend",h,!0),document.removeEventListener("click",h,!0),document.removeEventListener("keydown",h,!0);for(var w=0;w<l._howls.length;w++)l._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",h,!0),document.addEventListener("touchend",h,!0),document.addEventListener("click",h,!0),document.addEventListener("keydown",h,!0),l}},_obtainHtml5Audio:function(){var l=this||i;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var h=new Audio().play();return h&&typeof Promise!="undefined"&&(h instanceof Promise||typeof h.then=="function")&&h.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var h=this||i;return l._unlocked&&h._html5AudioPool.push(l),h},_autoSuspend:function(){var l=this;if(!(!l.autoSuspend||!l.ctx||typeof l.ctx.suspend=="undefined"||!i.usingWebAudio)){for(var h=0;h<l._howls.length;h++)if(l._howls[h]._webAudio){for(var p=0;p<l._howls[h]._sounds.length;p++)if(!l._howls[h]._sounds[p]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(!!l.autoSuspend){l._suspendTimer=null,l.state="suspending";var m=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(m,m)}},3e4),l}},_autoResume:function(){var l=this;if(!(!l.ctx||typeof l.ctx.resume=="undefined"||!i.usingWebAudio))return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var h=0;h<l._howls.length;h++)l._howls[h]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var i=new t,r=function(l){var h=this;if(!l.src||l.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}h.init(l)};r.prototype={init:function(l){var h=this;return i.ctx||f(),h._autoplay=l.autoplay||!1,h._format=typeof l.format!="string"?l.format:[l.format],h._html5=l.html5||!1,h._muted=l.mute||!1,h._loop=l.loop||!1,h._pool=l.pool||5,h._preload=typeof l.preload=="boolean"||l.preload==="metadata"?l.preload:!0,h._rate=l.rate||1,h._sprite=l.sprite||{},h._src=typeof l.src!="string"?l.src:[l.src],h._volume=l.volume!==void 0?l.volume:1,h._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:l.xhr&&l.xhr.withCredentials?l.xhr.withCredentials:!1},h._duration=0,h._state="unloaded",h._sounds=[],h._endTimers={},h._queue=[],h._playLock=!1,h._onend=l.onend?[{fn:l.onend}]:[],h._onfade=l.onfade?[{fn:l.onfade}]:[],h._onload=l.onload?[{fn:l.onload}]:[],h._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],h._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],h._onpause=l.onpause?[{fn:l.onpause}]:[],h._onplay=l.onplay?[{fn:l.onplay}]:[],h._onstop=l.onstop?[{fn:l.onstop}]:[],h._onmute=l.onmute?[{fn:l.onmute}]:[],h._onvolume=l.onvolume?[{fn:l.onvolume}]:[],h._onrate=l.onrate?[{fn:l.onrate}]:[],h._onseek=l.onseek?[{fn:l.onseek}]:[],h._onunlock=l.onunlock?[{fn:l.onunlock}]:[],h._onresume=[],h._webAudio=i.usingWebAudio&&!h._html5,typeof i.ctx!="undefined"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(h),h._autoplay&&h._queue.push({event:"play",action:function(){h.play()}}),h._preload&&h._preload!=="none"&&h.load(),h},load:function(){var l=this,h=null;if(i.noAudio){l._emit("loaderror",null,"No audio support.");return}typeof l._src=="string"&&(l._src=[l._src]);for(var p=0;p<l._src.length;p++){var m,v;if(l._format&&l._format[p])m=l._format[p];else{if(v=l._src[p],typeof v!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}m=/^data:audio\/([^;,]+);/i.exec(v),m||(m=/\.([^.]+)$/.exec(v.split("?",1)[0])),m&&(m=m[1].toLowerCase())}if(m||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),m&&i.codecs(m)){h=l._src[p];break}}if(!h){l._emit("loaderror",null,"No codec support for selected audio sources.");return}return l._src=h,l._state="loading",window.location.protocol==="https:"&&h.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new s(l),l._webAudio&&a(l),l},play:function(l,h){var p=this,m=null;if(typeof l=="number")m=l,l=null;else{if(typeof l=="string"&&p._state==="loaded"&&!p._sprite[l])return null;if(typeof l=="undefined"&&(l="__default",!p._playLock)){for(var v=0,_=0;_<p._sounds.length;_++)p._sounds[_]._paused&&!p._sounds[_]._ended&&(v++,m=p._sounds[_]._id);v===1?l=null:m=null}}var g=m?p._soundById(m):p._inactiveSound();if(!g)return null;if(m&&!l&&(l=g._sprite||"__default"),p._state!=="loaded"){g._sprite=l,g._ended=!1;var y=g._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(m&&!g._paused)return h||p._loadQueue("play"),g._id;p._webAudio&&i._autoResume();var b=Math.max(0,g._seek>0?g._seek:p._sprite[l][0]/1e3),w=Math.max(0,(p._sprite[l][0]+p._sprite[l][1])/1e3-b),x=w*1e3/Math.abs(g._rate),S=p._sprite[l][0]/1e3,P=(p._sprite[l][0]+p._sprite[l][1])/1e3;g._sprite=l,g._ended=!1;var T=function(){g._paused=!1,g._seek=b,g._start=S,g._stop=P,g._loop=!!(g._loop||p._sprite[l][2])};if(b>=P){p._ended(g);return}var I=g._node;if(p._webAudio){var U=function(){p._playLock=!1,T(),p._refreshBuffer(g);var O=g._muted||p._muted?0:g._volume;I.gain.setValueAtTime(O,i.ctx.currentTime),g._playStart=i.ctx.currentTime,typeof I.bufferSource.start=="undefined"?g._loop?I.bufferSource.noteGrainOn(0,b,86400):I.bufferSource.noteGrainOn(0,b,w):g._loop?I.bufferSource.start(0,b,86400):I.bufferSource.start(0,b,w),x!==Infinity&&(p._endTimers[g._id]=setTimeout(p._ended.bind(p,g),x)),h||setTimeout(function(){p._emit("play",g._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?U():(p._playLock=!0,p.once("resume",U),p._clearTimer(g._id))}else{var W=function(){I.currentTime=b,I.muted=g._muted||p._muted||i._muted||I.muted,I.volume=g._volume*i.volume(),I.playbackRate=g._rate;try{var O=I.play();if(O&&typeof Promise!="undefined"&&(O instanceof Promise||typeof O.then=="function")?(p._playLock=!0,T(),O.then(function(){p._playLock=!1,I._unlocked=!0,h?p._loadQueue():p._emit("play",g._id)}).catch(function(){p._playLock=!1,p._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),g._ended=!0,g._paused=!0})):h||(p._playLock=!1,T(),p._emit("play",g._id)),I.playbackRate=g._rate,I.paused){p._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}l!=="__default"||g._loop?p._endTimers[g._id]=setTimeout(p._ended.bind(p,g),x):(p._endTimers[g._id]=function(){p._ended(g),I.removeEventListener("ended",p._endTimers[g._id],!1)},I.addEventListener("ended",p._endTimers[g._id],!1))}catch(F){p._emit("playerror",g._id,F)}};I.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(I.src=p._src,I.load());var D=window&&window.ejecta||!I.readyState&&i._navigator.isCocoonJS;if(I.readyState>=3||D)W();else{p._playLock=!0,p._state="loading";var L=function(){p._state="loaded",W(),I.removeEventListener(i._canPlayEvent,L,!1)};I.addEventListener(i._canPlayEvent,L,!1),p._clearTimer(g._id)}}return g._id},pause:function(l){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"pause",action:function(){h.pause(l)}}),h;for(var p=h._getSoundIds(l),m=0;m<p.length;m++){h._clearTimer(p[m]);var v=h._soundById(p[m]);if(v&&!v._paused&&(v._seek=h.seek(p[m]),v._rateSeek=0,v._paused=!0,h._stopFade(p[m]),v._node))if(h._webAudio){if(!v._node.bufferSource)continue;typeof v._node.bufferSource.stop=="undefined"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),h._cleanBuffer(v._node)}else(!isNaN(v._node.duration)||v._node.duration===Infinity)&&v._node.pause();arguments[1]||h._emit("pause",v?v._id:null)}return h},stop:function(l,h){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(l)}}),p;for(var m=p._getSoundIds(l),v=0;v<m.length;v++){p._clearTimer(m[v]);var _=p._soundById(m[v]);_&&(_._seek=_._start||0,_._rateSeek=0,_._paused=!0,_._ended=!0,p._stopFade(m[v]),_._node&&(p._webAudio?_._node.bufferSource&&(typeof _._node.bufferSource.stop=="undefined"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),p._cleanBuffer(_._node)):(!isNaN(_._node.duration)||_._node.duration===Infinity)&&(_._node.currentTime=_._start||0,_._node.pause(),_._node.duration===Infinity&&p._clearSound(_._node))),h||p._emit("stop",_._id))}return p},mute:function(l,h){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(l,h)}}),p;if(typeof h=="undefined")if(typeof l=="boolean")p._muted=l;else return p._muted;for(var m=p._getSoundIds(h),v=0;v<m.length;v++){var _=p._soundById(m[v]);_&&(_._muted=l,_._interval&&p._stopFade(_._id),p._webAudio&&_._node?_._node.gain.setValueAtTime(l?0:_._volume,i.ctx.currentTime):_._node&&(_._node.muted=i._muted?!0:l),p._emit("mute",_._id))}return p},volume:function(){var l=this,h=arguments,p,m;if(h.length===0)return l._volume;if(h.length===1||h.length===2&&typeof h[1]=="undefined"){var v=l._getSoundIds(),_=v.indexOf(h[0]);_>=0?m=parseInt(h[0],10):p=parseFloat(h[0])}else h.length>=2&&(p=parseFloat(h[0]),m=parseInt(h[1],10));var g;if(typeof p!="undefined"&&p>=0&&p<=1){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"volume",action:function(){l.volume.apply(l,h)}}),l;typeof m=="undefined"&&(l._volume=p),m=l._getSoundIds(m);for(var y=0;y<m.length;y++)g=l._soundById(m[y]),g&&(g._volume=p,h[2]||l._stopFade(m[y]),l._webAudio&&g._node&&!g._muted?g._node.gain.setValueAtTime(p,i.ctx.currentTime):g._node&&!g._muted&&(g._node.volume=p*i.volume()),l._emit("volume",g._id))}else return g=m?l._soundById(m):l._sounds[0],g?g._volume:0;return l},fade:function(l,h,p,m){var v=this;if(v._state!=="loaded"||v._playLock)return v._queue.push({event:"fade",action:function(){v.fade(l,h,p,m)}}),v;l=Math.min(Math.max(0,parseFloat(l)),1),h=Math.min(Math.max(0,parseFloat(h)),1),p=parseFloat(p),v.volume(l,m);for(var _=v._getSoundIds(m),g=0;g<_.length;g++){var y=v._soundById(_[g]);if(y){if(m||v._stopFade(_[g]),v._webAudio&&!y._muted){var b=i.ctx.currentTime,w=b+p/1e3;y._volume=l,y._node.gain.setValueAtTime(l,b),y._node.gain.linearRampToValueAtTime(h,w)}v._startFadeInterval(y,l,h,p,_[g],typeof m=="undefined")}}return v},_startFadeInterval:function(l,h,p,m,v,_){var g=this,y=h,b=p-h,w=Math.abs(b/.01),x=Math.max(4,w>0?m/w:m),S=Date.now();l._fadeTo=p,l._interval=setInterval(function(){var P=(Date.now()-S)/m;S=Date.now(),y+=b*P,y=Math.round(y*100)/100,b<0?y=Math.max(p,y):y=Math.min(p,y),g._webAudio?l._volume=y:g.volume(y,l._id,!0),_&&(g._volume=y),(p<h&&y<=p||p>h&&y>=p)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,g.volume(p,l._id),g._emit("fade",l._id))},x)},_stopFade:function(l){var h=this,p=h._soundById(l);return p&&p._interval&&(h._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,h.volume(p._fadeTo,l),p._fadeTo=null,h._emit("fade",l)),h},loop:function(){var l=this,h=arguments,p,m,v;if(h.length===0)return l._loop;if(h.length===1)if(typeof h[0]=="boolean")p=h[0],l._loop=p;else return v=l._soundById(parseInt(h[0],10)),v?v._loop:!1;else h.length===2&&(p=h[0],m=parseInt(h[1],10));for(var _=l._getSoundIds(m),g=0;g<_.length;g++)v=l._soundById(_[g]),v&&(v._loop=p,l._webAudio&&v._node&&v._node.bufferSource&&(v._node.bufferSource.loop=p,p&&(v._node.bufferSource.loopStart=v._start||0,v._node.bufferSource.loopEnd=v._stop,l.playing(_[g])&&(l.pause(_[g],!0),l.play(_[g],!0)))));return l},rate:function(){var l=this,h=arguments,p,m;if(h.length===0)m=l._sounds[0]._id;else if(h.length===1){var v=l._getSoundIds(),_=v.indexOf(h[0]);_>=0?m=parseInt(h[0],10):p=parseFloat(h[0])}else h.length===2&&(p=parseFloat(h[0]),m=parseInt(h[1],10));var g;if(typeof p=="number"){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"rate",action:function(){l.rate.apply(l,h)}}),l;typeof m=="undefined"&&(l._rate=p),m=l._getSoundIds(m);for(var y=0;y<m.length;y++)if(g=l._soundById(m[y]),g){l.playing(m[y])&&(g._rateSeek=l.seek(m[y]),g._playStart=l._webAudio?i.ctx.currentTime:g._playStart),g._rate=p,l._webAudio&&g._node&&g._node.bufferSource?g._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):g._node&&(g._node.playbackRate=p);var b=l.seek(m[y]),w=(l._sprite[g._sprite][0]+l._sprite[g._sprite][1])/1e3-b,x=w*1e3/Math.abs(g._rate);(l._endTimers[m[y]]||!g._paused)&&(l._clearTimer(m[y]),l._endTimers[m[y]]=setTimeout(l._ended.bind(l,g),x)),l._emit("rate",g._id)}}else return g=l._soundById(m),g?g._rate:l._rate;return l},seek:function(){var l=this,h=arguments,p,m;if(h.length===0)l._sounds.length&&(m=l._sounds[0]._id);else if(h.length===1){var v=l._getSoundIds(),_=v.indexOf(h[0]);_>=0?m=parseInt(h[0],10):l._sounds.length&&(m=l._sounds[0]._id,p=parseFloat(h[0]))}else h.length===2&&(p=parseFloat(h[0]),m=parseInt(h[1],10));if(typeof m=="undefined")return 0;if(typeof p=="number"&&(l._state!=="loaded"||l._playLock))return l._queue.push({event:"seek",action:function(){l.seek.apply(l,h)}}),l;var g=l._soundById(m);if(g)if(typeof p=="number"&&p>=0){var y=l.playing(m);y&&l.pause(m,!0),g._seek=p,g._ended=!1,l._clearTimer(m),!l._webAudio&&g._node&&!isNaN(g._node.duration)&&(g._node.currentTime=p);var b=function(){y&&l.play(m,!0),l._emit("seek",m)};if(y&&!l._webAudio){var w=function(){l._playLock?setTimeout(w,0):b()};setTimeout(w,0)}else b()}else if(l._webAudio){var x=l.playing(m)?i.ctx.currentTime-g._playStart:0,S=g._rateSeek?g._rateSeek-g._seek:0;return g._seek+(S+x*Math.abs(g._rate))}else return g._node.currentTime;return l},playing:function(l){var h=this;if(typeof l=="number"){var p=h._soundById(l);return p?!p._paused:!1}for(var m=0;m<h._sounds.length;m++)if(!h._sounds[m]._paused)return!0;return!1},duration:function(l){var h=this,p=h._duration,m=h._soundById(l);return m&&(p=h._sprite[m._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var l=this,h=l._sounds,p=0;p<h.length;p++)h[p]._paused||l.stop(h[p]._id),l._webAudio||(l._clearSound(h[p]._node),h[p]._node.removeEventListener("error",h[p]._errorFn,!1),h[p]._node.removeEventListener(i._canPlayEvent,h[p]._loadFn,!1),h[p]._node.removeEventListener("ended",h[p]._endFn,!1),i._releaseHtml5Audio(h[p]._node)),delete h[p]._node,l._clearTimer(h[p]._id);var m=i._howls.indexOf(l);m>=0&&i._howls.splice(m,1);var v=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===l._src||l._src.indexOf(i._howls[p]._src)>=0){v=!1;break}return o&&v&&delete o[l._src],i.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,h,p,m){var v=this,_=v["_on"+l];return typeof h=="function"&&_.push(m?{id:p,fn:h,once:m}:{id:p,fn:h}),v},off:function(l,h,p){var m=this,v=m["_on"+l],_=0;if(typeof h=="number"&&(p=h,h=null),h||p)for(_=0;_<v.length;_++){var g=p===v[_].id;if(h===v[_].fn&&g||!h&&g){v.splice(_,1);break}}else if(l)m["_on"+l]=[];else{var y=Object.keys(m);for(_=0;_<y.length;_++)y[_].indexOf("_on")===0&&Array.isArray(m[y[_]])&&(m[y[_]]=[])}return m},once:function(l,h,p){var m=this;return m.on(l,h,p,1),m},_emit:function(l,h,p){for(var m=this,v=m["_on"+l],_=v.length-1;_>=0;_--)(!v[_].id||v[_].id===h||l==="load")&&(setTimeout(function(g){g.call(this,h,p)}.bind(m,v[_].fn),0),v[_].once&&m.off(l,v[_].fn,v[_].id));return m._loadQueue(l),m},_loadQueue:function(l){var h=this;if(h._queue.length>0){var p=h._queue[0];p.event===l&&(h._queue.shift(),h._loadQueue()),l||p.action()}return h},_ended:function(l){var h=this,p=l._sprite;if(!h._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(h._ended.bind(h,l),100),h;var m=!!(l._loop||h._sprite[p][2]);if(h._emit("end",l._id),!h._webAudio&&m&&h.stop(l._id,!0).play(l._id),h._webAudio&&m){h._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=i.ctx.currentTime;var v=(l._stop-l._start)*1e3/Math.abs(l._rate);h._endTimers[l._id]=setTimeout(h._ended.bind(h,l),v)}return h._webAudio&&!m&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,h._clearTimer(l._id),h._cleanBuffer(l._node),i._autoSuspend()),!h._webAudio&&!m&&h.stop(l._id,!0),h},_clearTimer:function(l){var h=this;if(h._endTimers[l]){if(typeof h._endTimers[l]!="function")clearTimeout(h._endTimers[l]);else{var p=h._soundById(l);p&&p._node&&p._node.removeEventListener("ended",h._endTimers[l],!1)}delete h._endTimers[l]}return h},_soundById:function(l){for(var h=this,p=0;p<h._sounds.length;p++)if(l===h._sounds[p]._id)return h._sounds[p];return null},_inactiveSound:function(){var l=this;l._drain();for(var h=0;h<l._sounds.length;h++)if(l._sounds[h]._ended)return l._sounds[h].reset();return new s(l)},_drain:function(){var l=this,h=l._pool,p=0,m=0;if(!(l._sounds.length<h)){for(m=0;m<l._sounds.length;m++)l._sounds[m]._ended&&p++;for(m=l._sounds.length-1;m>=0;m--){if(p<=h)return;l._sounds[m]._ended&&(l._webAudio&&l._sounds[m]._node&&l._sounds[m]._node.disconnect(0),l._sounds.splice(m,1),p--)}}},_getSoundIds:function(l){var h=this;if(typeof l=="undefined"){for(var p=[],m=0;m<h._sounds.length;m++)p.push(h._sounds[m]._id);return p}else return[l]},_refreshBuffer:function(l){var h=this;return l._node.bufferSource=i.ctx.createBufferSource(),l._node.bufferSource.buffer=o[h._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,i.ctx.currentTime),h},_cleanBuffer:function(l){var h=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(!l.bufferSource)return h;if(i._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),p))try{l.bufferSource.buffer=i._scratchBuffer}catch(m){}return l.bufferSource=null,h},_clearSound:function(l){var h=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);h||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(l){this._parent=l,this.init()};s.prototype={init:function(){var l=this,h=l._parent;return l._muted=h._muted,l._loop=h._loop,l._volume=h._volume,l._rate=h._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++i._counter,h._sounds.push(l),l.create(),l},create:function(){var l=this,h=l._parent,p=i._muted||l._muted||l._parent._muted?0:l._volume;return h._webAudio?(l._node=typeof i.ctx.createGain=="undefined"?i.ctx.createGainNode():i.ctx.createGain(),l._node.gain.setValueAtTime(p,i.ctx.currentTime),l._node.paused=!0,l._node.connect(i.masterGain)):i.noAudio||(l._node=i._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(i._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=h._src,l._node.preload=h._preload===!0?"auto":h._preload,l._node.volume=p*i.volume(),l._node.load()),l},reset:function(){var l=this,h=l._parent;return l._muted=h._muted,l._loop=h._loop,l._volume=h._volume,l._rate=h._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++i._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,h=l._parent;h._duration=Math.ceil(l._node.duration*10)/10,Object.keys(h._sprite).length===0&&(h._sprite={__default:[0,h._duration*1e3]}),h._state!=="loaded"&&(h._state="loaded",h._emit("load"),h._loadQueue()),l._node.removeEventListener(i._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,h=l._parent;h._duration===Infinity&&(h._duration=Math.ceil(l._node.duration*10)/10,h._sprite.__default[1]===Infinity&&(h._sprite.__default[1]=h._duration*1e3),h._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var o={},a=function(l){var h=l._src;if(o[h]){l._duration=o[h].duration,d(l);return}if(/^data:[^;]+;base64,/.test(h)){for(var p=atob(h.split(",")[1]),m=new Uint8Array(p.length),v=0;v<p.length;++v)m[v]=p.charCodeAt(v);u(m.buffer,l)}else{var _=new XMLHttpRequest;_.open(l._xhr.method,h,!0),_.withCredentials=l._xhr.withCredentials,_.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(g){_.setRequestHeader(g,l._xhr.headers[g])}),_.onload=function(){var g=(_.status+"")[0];if(g!=="0"&&g!=="2"&&g!=="3"){l._emit("loaderror",null,"Failed loading audio file with status: "+_.status+".");return}u(_.response,l)},_.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete o[h],l.load())},c(_)}},c=function(l){try{l.send()}catch(h){l.onerror()}},u=function(l,h){var p=function(){h._emit("loaderror",null,"Decoding audio data failed.")},m=function(v){v&&h._sounds.length>0?(o[h._src]=v,d(h,v)):p()};typeof Promise!="undefined"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(l).then(m).catch(p):i.ctx.decodeAudioData(l,m,p)},d=function(l,h){h&&!l._duration&&(l._duration=h.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},f=function(){if(!!i.usingWebAudio){try{typeof AudioContext!="undefined"?i.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch(v){i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),h=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=h?parseInt(h[1],10):null;if(l&&p&&p<9){var m=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!m&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain=="undefined"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};e.Howler=i,e.Howl=r,typeof mn!="undefined"?(mn.HowlerGlobal=t,mn.Howler=i,mn.Howl=r,mn.Sound=s):typeof window!="undefined"&&(window.HowlerGlobal=t,window.Howler=i,window.Howl=r,window.Sound=s)})();(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var s=r._howls.length-1;s>=0;s--)r._howls[s].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,s){var o=this;if(!o.ctx||!o.ctx.listener)return o;if(r=typeof r!="number"?o._pos[1]:r,s=typeof s!="number"?o._pos[2]:s,typeof i=="number")o._pos=[i,r,s],typeof o.ctx.listener.positionX!="undefined"?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]);else return o._pos;return o},HowlerGlobal.prototype.orientation=function(i,r,s,o,a,c){var u=this;if(!u.ctx||!u.ctx.listener)return u;var d=u._orientation;if(r=typeof r!="number"?d[1]:r,s=typeof s!="number"?d[2]:s,o=typeof o!="number"?d[3]:o,a=typeof a!="number"?d[4]:a,c=typeof c!="number"?d[5]:c,typeof i=="number")u._orientation=[i,r,s,o,a,c],typeof u.ctx.listener.forwardX!="undefined"?(u.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),u.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),u.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),u.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),u.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),u.ctx.listener.upZ.setTargetAtTime(c,Howler.ctx.currentTime,.1)):u.ctx.listener.setOrientation(i,r,s,o,a,c);else return d;return u},Howl.prototype.init=function(i){return function(r){var s=this;return s._orientation=r.orientation||[1,0,0],s._stereo=r.stereo||null,s._pos=r.pos||null,s._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle!="undefined"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle!="undefined"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain!="undefined"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel!="undefined"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance!="undefined"?r.maxDistance:1e4,panningModel:typeof r.panningModel!="undefined"?r.panningModel:"HRTF",refDistance:typeof r.refDistance!="undefined"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor!="undefined"?r.rolloffFactor:1},s._onstereo=r.onstereo?[{fn:r.onstereo}]:[],s._onpos=r.onpos?[{fn:r.onpos}]:[],s._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(i,r)}}),s;var o=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof r=="undefined")if(typeof i=="number")s._stereo=i,s._pos=[i,0,0];else return s._stereo;for(var a=s._getSoundIds(r),c=0;c<a.length;c++){var u=s._soundById(a[c]);if(u)if(typeof i=="number")u._stereo=i,u._pos=[i,0,0],u._node&&(u._pannerAttr.panningModel="equalpower",(!u._panner||!u._panner.pan)&&t(u,o),o==="spatial"?typeof u._panner.positionX!="undefined"?(u._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):u._panner.setPosition(i,0,0):u._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),s._emit("stereo",u._id);else return u._stereo}return s},Howl.prototype.pos=function(i,r,s,o){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(i,r,s,o)}}),a;if(r=typeof r!="number"?0:r,s=typeof s!="number"?-.5:s,typeof o=="undefined")if(typeof i=="number")a._pos=[i,r,s];else return a._pos;for(var c=a._getSoundIds(o),u=0;u<c.length;u++){var d=a._soundById(c[u]);if(d)if(typeof i=="number")d._pos=[i,r,s],d._node&&((!d._panner||d._panner.pan)&&t(d,"spatial"),typeof d._panner.positionX!="undefined"?(d._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),d._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),d._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setPosition(i,r,s)),a._emit("pos",d._id);else return d._pos}return a},Howl.prototype.orientation=function(i,r,s,o){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(i,r,s,o)}}),a;if(r=typeof r!="number"?a._orientation[1]:r,s=typeof s!="number"?a._orientation[2]:s,typeof o=="undefined")if(typeof i=="number")a._orientation=[i,r,s];else return a._orientation;for(var c=a._getSoundIds(o),u=0;u<c.length;u++){var d=a._soundById(c[u]);if(d)if(typeof i=="number")d._orientation=[i,r,s],d._node&&(d._panner||(d._pos||(d._pos=a._pos||[0,0,-.5]),t(d,"spatial")),typeof d._panner.orientationX!="undefined"?(d._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),d._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),d._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setOrientation(i,r,s)),a._emit("orientation",d._id);else return d._orientation}return a},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,s,o,a;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")s=r[0],typeof o=="undefined"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),i._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle!="undefined"?s.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle!="undefined"?s.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain!="undefined"?s.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel!="undefined"?s.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance!="undefined"?s.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof s.pannerAttr.refDistance!="undefined"?s.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor!="undefined"?s.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel!="undefined"?s.pannerAttr.panningModel:i._panningModel});else return a=i._soundById(parseInt(r[0],10)),a?a._pannerAttr:i._pannerAttr;else r.length===2&&(s=r[0],o=parseInt(r[1],10));for(var c=i._getSoundIds(o),u=0;u<c.length;u++)if(a=i._soundById(c[u]),a){var d=a._pannerAttr;d={coneInnerAngle:typeof s.coneInnerAngle!="undefined"?s.coneInnerAngle:d.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle!="undefined"?s.coneOuterAngle:d.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain!="undefined"?s.coneOuterGain:d.coneOuterGain,distanceModel:typeof s.distanceModel!="undefined"?s.distanceModel:d.distanceModel,maxDistance:typeof s.maxDistance!="undefined"?s.maxDistance:d.maxDistance,refDistance:typeof s.refDistance!="undefined"?s.refDistance:d.refDistance,rolloffFactor:typeof s.rolloffFactor!="undefined"?s.rolloffFactor:d.rolloffFactor,panningModel:typeof s.panningModel!="undefined"?s.panningModel:d.panningModel};var f=a._panner;f||(a._pos||(a._pos=i._pos||[0,0,-.5]),t(a,"spatial"),f=a._panner),f.coneInnerAngle=d.coneInnerAngle,f.coneOuterAngle=d.coneOuterAngle,f.coneOuterGain=d.coneOuterGain,f.distanceModel=d.distanceModel,f.maxDistance=d.maxDistance,f.refDistance=d.refDistance,f.rolloffFactor=d.rolloffFactor,f.panningModel=d.panningModel}return i},Sound.prototype.init=function(i){return function(){var r=this,s=r._parent;r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,i.call(this),r._stereo?s.stereo(r._stereo):r._pos&&s.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,s=r._parent;return r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,r._stereo?s.stereo(r._stereo):r._pos?s.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,s._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var t=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX!="undefined"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX!="undefined"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}})()}),kn=v1.Howl;function cg(n,e){let t=e.geometry.boundingBox.min.x*2,i=e.geometry.boundingBox.getSize(new k).y*1,r=e.geometry.boundingBox.min.z*2,s=new Ln(new R(t/2,i/2,r/2));n.addShape(s,e.position,e.quaternion)}function Ih(n,e){let t=e.geometry.boundingBox.min.x/-1,i=e.geometry.boundingBox.getSize(new k).y*1,r=new Aa(t,t,i,16);n.addShape(r,e.position,e.quaternion)}function ug(n,e,t){return(n-t)/(e-t)}var y1="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,da=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,Ys=!y1||da||window.navigator.hardwareConcurrency>4;var hg="Expected a function",dg=0/0,x1="[object Symbol]",b1=/^\s+|\s+$/g,w1=/^[-+]0x[0-9a-f]+$/i,M1=/^0b[01]+$/i,S1=/^0o[0-7]+$/i,T1=parseInt,E1=typeof mn=="object"&&mn&&mn.Object===Object&&mn,A1=typeof self=="object"&&self&&self.Object===Object&&self,C1=E1||A1||Function("return this")(),L1=Object.prototype,R1=L1.toString,P1=Math.max,I1=Math.min,Oh=function(){return C1.Date.now()};function O1(n,e,t){var i,r,s,o,a,c,u=0,d=!1,f=!1,l=!0;if(typeof n!="function")throw new TypeError(hg);e=fg(e)||0,Ql(t)&&(d=!!t.leading,f="maxWait"in t,s=f?P1(fg(t.maxWait)||0,e):s,l="trailing"in t?!!t.trailing:l);function h(x){var S=i,P=r;return i=r=void 0,u=x,o=n.apply(P,S),o}function p(x){return u=x,a=setTimeout(_,e),d?h(x):o}function m(x){var S=x-c,P=x-u,T=e-S;return f?I1(T,s-P):T}function v(x){var S=x-c,P=x-u;return c===void 0||S>=e||S<0||f&&P>=s}function _(){var x=Oh();if(v(x))return g(x);a=setTimeout(_,m(x))}function g(x){return a=void 0,l&&i?h(x):(i=r=void 0,o)}function y(){a!==void 0&&clearTimeout(a),u=0,i=c=r=a=void 0}function b(){return a===void 0?o:g(Oh())}function w(){var x=Oh(),S=v(x);if(i=arguments,r=this,c=x,S){if(a===void 0)return p(c);if(f)return a=setTimeout(_,e),h(c)}return a===void 0&&(a=setTimeout(_,e)),o}return w.cancel=y,w.flush=b,w}function D1(n,e,t){var i=!0,r=!0;if(typeof n!="function")throw new TypeError(hg);return Ql(t)&&(i="leading"in t?!!t.leading:i,r="trailing"in t?!!t.trailing:r),O1(n,e,{leading:i,maxWait:e,trailing:r})}function Ql(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function F1(n){return!!n&&typeof n=="object"}function B1(n){return typeof n=="symbol"||F1(n)&&R1.call(n)==x1}function fg(n){if(typeof n=="number")return n;if(B1(n))return dg;if(Ql(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Ql(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(b1,"");var t=M1.test(n);return t||S1.test(n)?T1(n.slice(2),t?2:8):w1.test(n)?dg:+n}var N1=D1,ec=N1;var Dh=class{constructor(e,t){this.interactions=e,this.enabled=!0,this.keySound=new kn({src:["key.mp3"]}),this.leverSound=new kn({src:["lever.mp3"]}),this.wheelSound=new kn({src:["wheel.mp3"]}),this.hitSounds=[new kn({src:["hit1.mp3"]}),new kn({src:["hit2.mp3"]}),new kn({src:["hit3.mp3"]}),new kn({src:["hit4.mp3"]})],this.rotationSound1=new kn({src:["speed1.mp3"],loop:!0}),this.rotationSound2=new kn({src:["speed2.mp3"],loop:!0}),this.rotationSound3=new kn({src:["speed3.mp3"],loop:!0}),t&&t.addFolder("Sounds").add(this,"enabled"),this.playHitSoundThrottled=ec(i=>{if(!!this.enabled&&i>1.5){let r=this.hitSounds[Math.floor(Math.random()*this.hitSounds.length)];r.volume=ug(i,Math.max(i,10),0),r.play()}},200,{trailing:!1})}playHitSound(e){!this.enabled||this.interactions.blocked||this.playHitSoundThrottled(e)}playKeySound(){!this.enabled||this.interactions.blocked||this.keySound.play()}playLeverSound(){!this.enabled||this.interactions.blocked||this.leverSound.play()}playWheelSound(){!this.enabled||this.interactions.blocked||this.wheelSound.play()}playRotationSound(e){!this.enabled||this.interactions.blocked||(this.rotationSound1.pause(),this.rotationSound2.pause(),this.rotationSound3.pause(),e>0&&e<4&&this["rotationSound"+e].play())}};function pg(n,e){let t=!Ys,i=new Ko(16772795,t?1.7:1);n.add(i);let r=new Pr(16766294,t?1.8:1);if(r.castShadow=!0,r.shadow.mapSize.set(2048,2048),r.shadow.normalBias=.05,r.shadow.camera.far=80,r.shadow.camera.left=-7,r.shadow.camera.top=7,r.shadow.camera.right=7,r.shadow.camera.bottom=-7,r.shadow.camera.left=-30,r.shadow.camera.right=30,r.shadow.camera.top=30,r.shadow.camera.bottom=-30,r.position.set(20,20,20),n.add(r),e){let s=e.addFolder("Lights");s.add(i,"intensity").min(0).max(5).step(.01).name("Ambient light intensity"),s.add(r,"intensity").min(0).max(10).step(.001).name("Directional light intensity"),s.add(r.position,"x").min(-30).max(30).step(.001).name("Directional light position X"),s.add(r.position,"y").min(-30).max(30).step(.001).name("Directional light position Y"),s.add(r.position,"z").min(-30).max(30).step(.001).name("Directional light position Z")}}var Fh=class{constructor(e,t,i){if(this.cameraZoomFactor=1,this.camera=new ut(25,t.width/t.height,10,250),this.camera.position.x=75,this.camera.position.z=-5,this.cameraPositionZ=this.camera.position.z,this.cameraPositionX=this.camera.position.x,this.currentSpeed=0,this.cameraMovementIntensitySpeed=.5,this.cameraMovementDurationSpeed=1.5,this.cameraMovementDelaySpeed=.05,this.cameraZoomIntensitySpeed=.005,this.cameraMovementIntensitySteering=3,this.cameraRotationIntensitySteering=1,this.cameraMovementDurationSteering=1,this.cameraMovementDelaySteering=.025,this.onResize(t),this.camera.lookAt(new k(0,0,0)),this.cameraPositionZ=this.camera.position.z,this.cameraPositionX=this.camera.position.x,this.cameraPositionY=this.camera.position.y,e.add(this.camera),i){let r=i.addFolder("Camera"),s=r.addFolder("Base");s.add(this.camera,"near").min(.1).max(2e3).step(.01).name("Camera near").onChange(()=>{this.camera.updateProjectionMatrix()}),s.add(this.camera,"far").min(1).max(2e3).step(.01).name("Camera far").onChange(()=>{this.camera.updateProjectionMatrix()}),s.add(this,"cameraZoomFactor").min(.1).max(2).step(.001).name("Camera zoom factor").onChange(()=>{this.camera.zoom=this.cameraZoomFactor,this.camera.updateProjectionMatrix()}),s.add(this.camera.position,"x").min(-200).max(200).step(.01).name("Camera position X"),s.add(this.camera.position,"y").min(-200).max(200).step(.01).name("Camera position Y"),s.add(this.camera.position,"z").min(-200).max(200).step(.01).name("Camera position Z");let o=r.addFolder("Steering");o.add(this,"cameraMovementIntensitySteering").min(0).max(5).step(.001).name("Camera movement intensity"),o.add(this,"cameraRotationIntensitySteering").min(0).max(5).step(.001).name("Camera rotation intensity"),o.add(this,"cameraMovementDurationSteering").min(0).max(5).step(.001).name("Camera movement duration"),o.add(this,"cameraMovementDelaySteering").min(0).max(2).step(.001).name("Camera movement delay");let a=r.addFolder("Speed");a.add(this,"cameraMovementIntensitySpeed").min(0).max(5).step(.001).name("Camera movement intensity"),a.add(this,"cameraMovementDurationSpeed").min(0).max(5).step(.001).name("Camera movement duration"),a.add(this,"cameraMovementDelaySpeed").min(0).max(2).step(.001).name("Camera movement delay"),a.add(this,"cameraZoomIntensitySpeed").min(0).max(.2).step(.001).name("Camera zoom intensity")}}connectToWheel(e){this.wheel=e}moveOnSpeedLeverShift(e,t){this.currentSpeed=t,mt.to(this.camera.position,{x:this.cameraPositionX-Math.pow(t,2.5)*this.cameraMovementIntensitySpeed,y:this.cameraPositionY-Math.pow(t,2.5)*this.cameraMovementIntensitySpeed*.5,duration:this.cameraMovementDurationSpeed*(e>0?.5:1.5),delay:this.cameraMovementDelaySpeed*(4-t)*.5,overwrite:"auto",ease:"power1.inOut"});let i=this;function r(){i.camera.lookAt(new k(0,0,i.wheel.rotation.x*i.cameraRotationIntensitySteering*.3))}mt.ticker.add(r),mt.to(this.camera,{zoom:this.cameraZoomFactor+Math.pow(t,2)*this.cameraZoomIntensitySpeed,duration:this.cameraMovementDurationSpeed,delay:this.cameraMovementDelaySpeed*(4-t)*.5,overwrite:"auto",ease:"power1.inOut",onUpdate:()=>{this.camera.updateProjectionMatrix()},onComplete:()=>{mt.ticker.remove(r)}})}moveOnWheelTurn(e,t,i){let r=this.cameraMovementDurationSteering-Math.abs(e)*.3*(t?1:2);mt.to(this.camera.position,{z:this.cameraPositionZ+e*this.cameraMovementIntensitySteering,duration:r,delay:this.cameraMovementDelaySteering,overwrite:"auto",ease:"power1.inOut"});let s=this;function o(){s.camera.lookAt(new k(0,0,i.x*s.cameraRotationIntensitySteering*.3))}mt.ticker.add(o);let a={from:0},c=-i.x*this.cameraRotationIntensitySteering;mt.to(a,{from:c,duration:r,delay:this.cameraMovementDelaySteering,overwrite:"auto",ease:"power1.inOut",onComplete:()=>{mt.ticker.remove(o)}})}onResize(e){this.camera.aspect=e.width/e.height,this.cameraZoomFactor=Math.pow(this.camera.aspect,.3)/1.1,this.camera.zoom=this.cameraZoomFactor+Math.pow(this.currentSpeed,2)*this.cameraZoomIntensitySpeed,this.camera.position.y=55/this.cameraZoomFactor,this.cameraPositionY=this.camera.position.y,this.camera.updateProjectionMatrix()}enter(){let e=this.cameraPositionY,t=this.cameraPositionZ;this.camera.position.y=this.cameraPositionY+40,this.camera.position.z=this.cameraPositionZ-20,mt.to(this.camera.position,{y:e,z:t,duration:2,delay:this.cameraMovementDelaySteering,overwrite:"auto",ease:"power1.inOut"})}};var Bh=class{constructor(e,t,i,r){if(this.renderer=new Sr({canvas:e,powerPreference:"high-performance",antialias:!0}),this.renderer.shadowMap.enabled=Ys,this.renderer.shadowMap.type=Ra,this.renderer.setSize(t.width,t.height),this.renderer.physicallyCorrectLights=!0,this.renderer.outputEncoding=jn,this.renderer.toneMapping=go,this.renderer.setClearColor(16772795),this.renderer.setPixelRatio(da?Math.min(window.devicePixelRatio,2):1),r){let s=r.addFolder("Renderer");s.add(this.renderer.shadowMap,"enabled").onChange(i).name("Renderer shadowMap enabled"),s.add(this.renderer,"toneMapping",{No:Ni,Linear:Oa,Reinhard:Da,Cineon:Fa,ACESFilmic:go}).name("Renderer tone mapping").onFinishChange(()=>{this.renderer.toneMapping=Number(this.renderer.toneMapping),i()}),s.add(this.renderer,"toneMappingExposure").min(0).max(10).step(.001).name("Renderer tone mapping exposure")}}};var Zs={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	gl_FragColor = opacity * texel;","}"].join(`
`)};function Ft(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(Ft.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});Ft.FullScreenQuad=function(){var n=new Ti(-1,1,1,-1,0,1),e=new _n(2,2),t=function(i){this._mesh=new ke(e,i)};return Object.defineProperty(t.prototype,"material",{get:function(){return this._mesh.material},set:function(i){this._mesh.material=i}}),Object.assign(t.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(i){i.render(this._mesh,n)}}),t}();var tc=function(n,e){Ft.call(this),this.textureID=e!==void 0?e:"tDiffuse",n instanceof nt?(this.uniforms=n.uniforms,this.material=n):n&&(this.uniforms=hs.clone(n.uniforms),this.material=new nt({defines:Object.assign({},n.defines),uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader})),this.fsQuad=new Ft.FullScreenQuad(this.material)};tc.prototype=Object.assign(Object.create(Ft.prototype),{constructor:tc,render:function(n,e,t){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=t.texture),this.fsQuad.material=this.material,this.renderToScreen?(n.setRenderTarget(null),this.fsQuad.render(n)):(n.setRenderTarget(e),this.clear&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),this.fsQuad.render(n))}});var nc=function(n,e){Ft.call(this),this.scene=n,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};nc.prototype=Object.assign(Object.create(Ft.prototype),{constructor:nc,render:function(n,e,t){var i=n.getContext(),r=n.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);var s,o;this.inverse?(s=0,o=1):(s=1,o=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),r.buffers.stencil.setClear(o),r.buffers.stencil.setLocked(!0),n.setRenderTarget(t),this.clear&&n.clear(),n.render(this.scene,this.camera),n.setRenderTarget(e),this.clear&&n.clear(),n.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}});var Nh=function(){Ft.call(this),this.needsSwap=!1};Nh.prototype=Object.create(Ft.prototype);Object.assign(Nh.prototype,{render:function(n){n.state.buffers.stencil.setLocked(!1),n.state.buffers.stencil.setTest(!1)}});var kh=function(n,e){if(this.renderer=n,e===void 0){var t={minFilter:Xe,magFilter:Xe,format:Et},i=n.getSize(new ae);this._pixelRatio=n.getPixelRatio(),this._width=i.width,this._height=i.height,e=new Nt(this._width*this._pixelRatio,this._height*this._pixelRatio,t),e.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Zs===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),tc===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new tc(Zs),this.clock=new Ds};Object.assign(kh.prototype,{swapBuffers:function(){var n=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=n},addPass:function(n){this.passes.push(n),n.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(n,e){this.passes.splice(e,0,n),n.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},removePass:function(n){let e=this.passes.indexOf(n);e!==-1&&this.passes.splice(e,1)},isLastEnabledPass:function(n){for(var e=n+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},render:function(n){n===void 0&&(n=this.clock.getDelta());var e=this.renderer.getRenderTarget(),t=!1,i,r,s=this.passes.length;for(r=0;r<s;r++)if(i=this.passes[r],i.enabled!==!1){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),i.render(this.renderer,this.writeBuffer,this.readBuffer,n,t),i.needsSwap){if(t){var o=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,n),a.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}nc!==void 0&&(i instanceof nc?t=!0:i instanceof Nh&&(t=!1))}this.renderer.setRenderTarget(e)},reset:function(n){if(n===void 0){var e=this.renderer.getSize(new ae);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,n=this.renderTarget1.clone(),n.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=n,this.renderTarget2=n.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(n,e){this._width=n,this._height=e;var t=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(t,i),this.renderTarget2.setSize(t,i);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(t,i)},setPixelRatio:function(n){this._pixelRatio=n,this.setSize(this._width,this._height)}});var mg=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(mg.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});mg.FullScreenQuad=function(){var n=new Ti(-1,1,1,-1,0,1),e=new _n(2,2),t=function(i){this._mesh=new ke(e,i)};return Object.defineProperty(t.prototype,"material",{get:function(){return this._mesh.material},set:function(i){this._mesh.material=i}}),Object.assign(t.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(i){i.render(this._mesh,n)}}),t}();var ic=function(n,e,t,i,r){Ft.call(this),this.scene=n,this.camera=e,this.overrideMaterial=t,this.clearColor=i,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Me};ic.prototype=Object.assign(Object.create(Ft.prototype),{constructor:ic,render:function(n,e,t){var i=n.autoClear;n.autoClear=!1;var r,s;this.overrideMaterial!==void 0&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(n.getClearColor(this._oldClearColor),r=n.getClearAlpha(),n.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&n.clearDepth(),n.setRenderTarget(this.renderToScreen?null:t),this.clear&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),n.render(this.scene,this.camera),this.clearColor&&n.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=s),n.autoClear=i}});var gg={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Me(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	vec3 luma = vec3( 0.299, 0.587, 0.114 );","	float v = dot( texel.xyz, luma );","	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","	gl_FragColor = mix( outputColor, texel, alpha );","}"].join(`
`)},or=function(n,e,t,i){Ft.call(this),this.strength=e!==void 0?e:1,this.radius=t,this.threshold=i,this.resolution=n!==void 0?new ae(n.x,n.y):new ae(256,256),this.clearColor=new Me(0,0,0);var r={minFilter:Xe,magFilter:Xe,format:Et};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var s=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new Nt(s,o,r),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var a=0;a<this.nMips;a++){var c=new Nt(s,o,r);c.texture.name="UnrealBloomPass.h"+a,c.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(c);var u=new Nt(s,o,r);u.texture.name="UnrealBloomPass.v"+a,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),s=Math.round(s/2),o=Math.round(o/2)}gg===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");var d=gg;this.highPassUniforms=hs.clone(d.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new nt({uniforms:this.highPassUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,defines:{}}),this.separableBlurMaterials=[];for(var f=[3,5,7,9,11],s=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),a=0;a<this.nMips;a++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(f[a])),this.separableBlurMaterials[a].uniforms.texSize.value=new ae(s,o),s=Math.round(s/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;var l=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=l,this.bloomTintColors=[new k(1,1,1),new k(1,1,1),new k(1,1,1),new k(1,1,1),new k(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,Zs===void 0&&console.error("THREE.UnrealBloomPass relies on CopyShader");var h=Zs;this.copyUniforms=hs.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new nt({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:Pa,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Me,this.oldClearAlpha=1,this.basic=new At,this.fsQuad=new Ft.FullScreenQuad(null)};or.prototype=Object.assign(Object.create(Ft.prototype),{constructor:or,dispose:function(){for(var n=0;n<this.renderTargetsHorizontal.length;n++)this.renderTargetsHorizontal[n].dispose();for(var n=0;n<this.renderTargetsVertical.length;n++)this.renderTargetsVertical[n].dispose();this.renderTargetBright.dispose()},setSize:function(n,e){var t=Math.round(n/2),i=Math.round(e/2);this.renderTargetBright.setSize(t,i);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(t,i),this.renderTargetsVertical[r].setSize(t,i),this.separableBlurMaterials[r].uniforms.texSize.value=new ae(t,i),t=Math.round(t/2),i=Math.round(i/2)},render:function(n,e,t,i,r){n.getClearColor(this._oldClearColor),this.oldClearAlpha=n.getClearAlpha();var s=n.autoClear;n.autoClear=!1,n.setClearColor(this.clearColor,0),r&&n.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=t.texture,n.setRenderTarget(null),n.clear(),this.fsQuad.render(n)),this.highPassUniforms.tDiffuse.value=t.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,n.setRenderTarget(this.renderTargetBright),n.clear(),this.fsQuad.render(n);for(var o=this.renderTargetBright,a=0;a<this.nMips;a++)this.fsQuad.material=this.separableBlurMaterials[a],this.separableBlurMaterials[a].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[a].uniforms.direction.value=or.BlurDirectionX,n.setRenderTarget(this.renderTargetsHorizontal[a]),n.clear(),this.fsQuad.render(n),this.separableBlurMaterials[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurMaterials[a].uniforms.direction.value=or.BlurDirectionY,n.setRenderTarget(this.renderTargetsVertical[a]),n.clear(),this.fsQuad.render(n),o=this.renderTargetsVertical[a];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,n.setRenderTarget(this.renderTargetsHorizontal[0]),n.clear(),this.fsQuad.render(n),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&n.state.buffers.stencil.setTest(!0),this.renderToScreen?(n.setRenderTarget(null),this.fsQuad.render(n)):(n.setRenderTarget(t),this.fsQuad.render(n)),n.setClearColor(this._oldClearColor,this.oldClearAlpha),n.autoClear=s},getSeperableBlurMaterial:function(n){return new nt({defines:{KERNEL_RADIUS:n,SIGMA:n},uniforms:{colorTexture:{value:null},texSize:{value:new ae(.5,.5)},direction:{value:new ae(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;				uniform vec2 direction;								float gaussianPdf(in float x, in float sigma) {					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;				}				void main() {
					vec2 invSize = 1.0 / texSize;					float fSigma = float(SIGMA);					float weightSum = gaussianPdf(0.0, fSigma);					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {						float x = float(i);						float w = gaussianPdf(x, fSigma);						vec2 uvOffset = direction * invSize * x;						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;						diffuseSum += (sample1 + sample2) * w;						weightSum += 2.0 * w;					}					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})},getCompositeMaterial:function(n){return new nt({defines:{NUM_MIPS:n},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:"varying vec2 vUv;				uniform sampler2D blurTexture1;				uniform sampler2D blurTexture2;				uniform sampler2D blurTexture3;				uniform sampler2D blurTexture4;				uniform sampler2D blurTexture5;				uniform sampler2D dirtTexture;				uniform float bloomStrength;				uniform float bloomRadius;				uniform float bloomFactors[NUM_MIPS];				uniform vec3 bloomTintColors[NUM_MIPS];								float lerpBloomFactor(const in float factor) { 					float mirrorFactor = 1.2 - factor;					return mix(factor, mirrorFactor, bloomRadius);				}								void main() {					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + 													 lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + 													 lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + 													 lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + 													 lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );				}"})}});or.BlurDirectionX=new ae(1,0);or.BlurDirectionY=new ae(0,1);var zh=class{constructor(e,t,i,r,s){let o=i.capabilities.isWebGL2?Wa:Nt,a=new o(r.width,r.height,{minFilter:Xe,magFilter:Xe,format:Et,encoding:jn});this.effectComposer=new kh(i,a),this.effectComposer.setPixelRatio(da?Math.min(window.devicePixelRatio,2):1);let c=new ic(e,t);if(this.effectComposer.addPass(c),this.unrealBloomPass=new or(new ae(r.width,r.height),.4,1.5,.5),this.unrealBloomPass.enabled=Ys,this.effectComposer.addPass(this.unrealBloomPass),s){let u=s.addFolder("Post processing");u.add(this.unrealBloomPass,"enabled").name("Unreal bloom pass enabled"),u.add(this.unrealBloomPass,"strength").min(0).max(2).step(.001).name("Unreal bloom pass strength"),u.add(this.unrealBloomPass,"radius").min(0).max(2).step(.001).name("Unreal bloom pass radius"),u.add(this.unrealBloomPass,"threshold").min(0).max(1).step(.001).name("Unreal bloom pass threshold")}}};function _g(n,e){let t=new vs(16772795,50,350);if(n.fog=t,e){let i=e.addFolder("Fog");i.add(n.fog,"near").min(1).max(2e3).step(.1).name("Fog near"),i.add(n.fog,"far").min(1).max(2e3).step(.1).name("Fog far")}}function vg(n,e,t,i,r,s,o,a,c){let u=new Ds,d=0,f=0,l=()=>{c&&c.begin(),d++;let h=u.getElapsedTime(),p=h-f;if(f=h,o.step(1/200,p,3),d%3==0){t&&t.update();for(let m of a)m.mesh.position.copy(m.body.position),m.mesh.quaternion.copy(m.body.quaternion);i.onTick(p),r.onTick(p),s.onTick(p),n.effectComposer.render()}window.requestAnimationFrame(l),c&&c.end()};l()}var Js=function(n,e){e===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=n,this.domElement=e,this.enabled=!0,this.target=new k,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:ui.ROTATE,MIDDLE:ui.DOLLY,RIGHT:ui.PAN},this.touches={ONE:hi.ROTATE,TWO:hi.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.listenToKeyEvents=function(j){j.addEventListener("keydown",q),this._domElementKeyEvents=j},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(i),t.update(),a=o.NONE},this.update=function(){var j=new k,pe=new Pt().setFromUnitVectors(n.up,new k(0,1,0)),we=pe.clone().invert(),_e=new k,Se=new Pt,Pe=2*Math.PI;return function(){var en=t.object.position;j.copy(en).sub(t.target),j.applyQuaternion(pe),u.setFromVector3(j),t.autoRotate&&a===o.NONE&&T(S()),t.enableDamping?(u.theta+=d.theta*t.dampingFactor,u.phi+=d.phi*t.dampingFactor):(u.theta+=d.theta,u.phi+=d.phi);var Vt=t.minAzimuthAngle,Bt=t.maxAzimuthAngle;return isFinite(Vt)&&isFinite(Bt)&&(Vt<-Math.PI?Vt+=Pe:Vt>Math.PI&&(Vt-=Pe),Bt<-Math.PI?Bt+=Pe:Bt>Math.PI&&(Bt-=Pe),Vt<=Bt?u.theta=Math.max(Vt,Math.min(Bt,u.theta)):u.theta=u.theta>(Vt+Bt)/2?Math.max(Vt,u.theta):Math.min(Bt,u.theta)),u.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=f,u.radius=Math.max(t.minDistance,Math.min(t.maxDistance,u.radius)),t.enableDamping===!0?t.target.addScaledVector(l,t.dampingFactor):t.target.add(l),j.setFromSpherical(u),j.applyQuaternion(we),en.copy(t.target).add(j),t.object.lookAt(t.target),t.enableDamping===!0?(d.theta*=1-t.dampingFactor,d.phi*=1-t.dampingFactor,l.multiplyScalar(1-t.dampingFactor)):(d.set(0,0,0),l.set(0,0,0)),f=1,h||_e.distanceToSquared(t.object.position)>c||8*(1-Se.dot(t.object.quaternion))>c?(t.dispatchEvent(i),_e.copy(t.object.position),Se.copy(t.object.quaternion),h=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",he),t.domElement.removeEventListener("pointerdown",Y),t.domElement.removeEventListener("wheel",$),t.domElement.removeEventListener("touchstart",le),t.domElement.removeEventListener("touchend",me),t.domElement.removeEventListener("touchmove",fe),t.domElement.ownerDocument.removeEventListener("pointermove",K),t.domElement.ownerDocument.removeEventListener("pointerup",J),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",q)};var t=this,i={type:"change"},r={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},a=o.NONE,c=1e-6,u=new Bl,d=new Bl,f=1,l=new k,h=!1,p=new ae,m=new ae,v=new ae,_=new ae,g=new ae,y=new ae,b=new ae,w=new ae,x=new ae;function S(){return 2*Math.PI/60/60*t.autoRotateSpeed}function P(){return Math.pow(.95,t.zoomSpeed)}function T(j){d.theta-=j}function I(j){d.phi-=j}var U=function(){var j=new k;return function(we,_e){j.setFromMatrixColumn(_e,0),j.multiplyScalar(-we),l.add(j)}}(),W=function(){var j=new k;return function(we,_e){t.screenSpacePanning===!0?j.setFromMatrixColumn(_e,1):(j.setFromMatrixColumn(_e,0),j.crossVectors(t.object.up,j)),j.multiplyScalar(we),l.add(j)}}(),D=function(){var j=new k;return function(we,_e){var Se=t.domElement;if(t.object.isPerspectiveCamera){var Pe=t.object.position;j.copy(Pe).sub(t.target);var ot=j.length();ot*=Math.tan(t.object.fov/2*Math.PI/180),U(2*we*ot/Se.clientHeight,t.object.matrix),W(2*_e*ot/Se.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(U(we*(t.object.right-t.object.left)/t.object.zoom/Se.clientWidth,t.object.matrix),W(_e*(t.object.top-t.object.bottom)/t.object.zoom/Se.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function L(j){t.object.isPerspectiveCamera?f/=j:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*j)),t.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function O(j){t.object.isPerspectiveCamera?f*=j:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/j)),t.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function F(j){p.set(j.clientX,j.clientY)}function Z(j){b.set(j.clientX,j.clientY)}function ee(j){_.set(j.clientX,j.clientY)}function oe(j){m.set(j.clientX,j.clientY),v.subVectors(m,p).multiplyScalar(t.rotateSpeed);var pe=t.domElement;T(2*Math.PI*v.x/pe.clientHeight),I(2*Math.PI*v.y/pe.clientHeight),p.copy(m),t.update()}function ge(j){w.set(j.clientX,j.clientY),x.subVectors(w,b),x.y>0?L(P()):x.y<0&&O(P()),b.copy(w),t.update()}function de(j){g.set(j.clientX,j.clientY),y.subVectors(g,_).multiplyScalar(t.panSpeed),D(y.x,y.y),_.copy(g),t.update()}function ne(j){j.deltaY<0?O(P()):j.deltaY>0&&L(P()),t.update()}function Te(j){var pe=!1;switch(j.keyCode){case t.keys.UP:D(0,t.keyPanSpeed),pe=!0;break;case t.keys.BOTTOM:D(0,-t.keyPanSpeed),pe=!0;break;case t.keys.LEFT:D(t.keyPanSpeed,0),pe=!0;break;case t.keys.RIGHT:D(-t.keyPanSpeed,0),pe=!0;break}pe&&(j.preventDefault(),t.update())}function Ae(j){if(j.touches.length==1)p.set(j.touches[0].pageX,j.touches[0].pageY);else{var pe=.5*(j.touches[0].pageX+j.touches[1].pageX),we=.5*(j.touches[0].pageY+j.touches[1].pageY);p.set(pe,we)}}function re(j){if(j.touches.length==1)_.set(j.touches[0].pageX,j.touches[0].pageY);else{var pe=.5*(j.touches[0].pageX+j.touches[1].pageX),we=.5*(j.touches[0].pageY+j.touches[1].pageY);_.set(pe,we)}}function C(j){var pe=j.touches[0].pageX-j.touches[1].pageX,we=j.touches[0].pageY-j.touches[1].pageY,_e=Math.sqrt(pe*pe+we*we);b.set(0,_e)}function M(j){t.enableZoom&&C(j),t.enablePan&&re(j)}function V(j){t.enableZoom&&C(j),t.enableRotate&&Ae(j)}function B(j){if(j.touches.length==1)m.set(j.touches[0].pageX,j.touches[0].pageY);else{var pe=.5*(j.touches[0].pageX+j.touches[1].pageX),we=.5*(j.touches[0].pageY+j.touches[1].pageY);m.set(pe,we)}v.subVectors(m,p).multiplyScalar(t.rotateSpeed);var _e=t.domElement;T(2*Math.PI*v.x/_e.clientHeight),I(2*Math.PI*v.y/_e.clientHeight),p.copy(m)}function G(j){if(j.touches.length==1)g.set(j.touches[0].pageX,j.touches[0].pageY);else{var pe=.5*(j.touches[0].pageX+j.touches[1].pageX),we=.5*(j.touches[0].pageY+j.touches[1].pageY);g.set(pe,we)}y.subVectors(g,_).multiplyScalar(t.panSpeed),D(y.x,y.y),_.copy(g)}function X(j){var pe=j.touches[0].pageX-j.touches[1].pageX,we=j.touches[0].pageY-j.touches[1].pageY,_e=Math.sqrt(pe*pe+we*we);w.set(0,_e),x.set(0,Math.pow(w.y/b.y,t.zoomSpeed)),L(x.y),b.copy(w)}function z(j){t.enableZoom&&X(j),t.enablePan&&G(j)}function H(j){t.enableZoom&&X(j),t.enableRotate&&B(j)}function Y(j){if(t.enabled!==!1)switch(j.pointerType){case"mouse":case"pen":A(j);break}}function K(j){if(t.enabled!==!1)switch(j.pointerType){case"mouse":case"pen":E(j);break}}function J(j){switch(j.pointerType){case"mouse":case"pen":ie();break}}function A(j){j.preventDefault(),t.domElement.focus?t.domElement.focus():window.focus();var pe;switch(j.button){case 0:pe=t.mouseButtons.LEFT;break;case 1:pe=t.mouseButtons.MIDDLE;break;case 2:pe=t.mouseButtons.RIGHT;break;default:pe=-1}switch(pe){case ui.DOLLY:if(t.enableZoom===!1)return;Z(j),a=o.DOLLY;break;case ui.ROTATE:if(j.ctrlKey||j.metaKey||j.shiftKey){if(t.enablePan===!1)return;ee(j),a=o.PAN}else{if(t.enableRotate===!1)return;F(j),a=o.ROTATE}break;case ui.PAN:if(j.ctrlKey||j.metaKey||j.shiftKey){if(t.enableRotate===!1)return;F(j),a=o.ROTATE}else{if(t.enablePan===!1)return;ee(j),a=o.PAN}break;default:a=o.NONE}a!==o.NONE&&(t.domElement.ownerDocument.addEventListener("pointermove",K),t.domElement.ownerDocument.addEventListener("pointerup",J),t.dispatchEvent(r))}function E(j){if(t.enabled!==!1)switch(j.preventDefault(),a){case o.ROTATE:if(t.enableRotate===!1)return;oe(j);break;case o.DOLLY:if(t.enableZoom===!1)return;ge(j);break;case o.PAN:if(t.enablePan===!1)return;de(j);break}}function ie(j){t.domElement.ownerDocument.removeEventListener("pointermove",K),t.domElement.ownerDocument.removeEventListener("pointerup",J),t.enabled!==!1&&(t.dispatchEvent(s),a=o.NONE)}function $(j){t.enabled===!1||t.enableZoom===!1||a!==o.NONE&&a!==o.ROTATE||(j.preventDefault(),j.stopPropagation(),t.dispatchEvent(r),ne(j),t.dispatchEvent(s))}function q(j){t.enabled===!1||t.enablePan===!1||Te(j)}function le(j){if(t.enabled!==!1){switch(j.preventDefault(),j.touches.length){case 1:switch(t.touches.ONE){case hi.ROTATE:if(t.enableRotate===!1)return;Ae(j),a=o.TOUCH_ROTATE;break;case hi.PAN:if(t.enablePan===!1)return;re(j),a=o.TOUCH_PAN;break;default:a=o.NONE}break;case 2:switch(t.touches.TWO){case hi.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;M(j),a=o.TOUCH_DOLLY_PAN;break;case hi.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;V(j),a=o.TOUCH_DOLLY_ROTATE;break;default:a=o.NONE}break;default:a=o.NONE}a!==o.NONE&&t.dispatchEvent(r)}}function fe(j){if(t.enabled!==!1)switch(j.preventDefault(),j.stopPropagation(),a){case o.TOUCH_ROTATE:if(t.enableRotate===!1)return;B(j),t.update();break;case o.TOUCH_PAN:if(t.enablePan===!1)return;G(j),t.update();break;case o.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;z(j),t.update();break;case o.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;H(j),t.update();break;default:a=o.NONE}}function me(j){t.enabled!==!1&&(t.dispatchEvent(s),a=o.NONE)}function he(j){t.enabled!==!1&&j.preventDefault()}t.domElement.addEventListener("contextmenu",he),t.domElement.addEventListener("pointerdown",Y),t.domElement.addEventListener("wheel",$),t.domElement.addEventListener("touchstart",le),t.domElement.addEventListener("touchend",me),t.domElement.addEventListener("touchmove",fe),this.update()};Js.prototype=Object.create(Pn.prototype);Js.prototype.constructor=Js;var Hh=function(n,e){Js.call(this,n,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=ui.PAN,this.mouseButtons.RIGHT=ui.ROTATE,this.touches.ONE=hi.PAN,this.touches.TWO=hi.DOLLY_ROTATE};Hh.prototype=Object.create(Pn.prototype);Hh.prototype.constructor=Hh;function yg(n,e,t){let i=new Js(e,n);return i.target.set(0,1,0),i.enableDamping=!0,i.enabled=!1,t&&t.addFolder("Orbit controls").add(i,"enabled").name("Orbit controls enabled"),i}var Uh=class{constructor(e,t,i,r){ld(this,"on",!0);this.interactions=i,this.keys=r,this.key=e,this.sounds=t,this.speed=null,this.car=null,this.on&&this.key.rotateOnAxis(new k(1,0,0).normalize(),-1),document.addEventListener("keydown",s=>{this.interactions.blocked||s.key==="Enter"&&(s.preventDefault(),s.stopImmediatePropagation())}),document.addEventListener("keyup",s=>{this.interactions.blocked||s.key==="Enter"&&(this.toggle(),s.preventDefault(),s.stopImmediatePropagation())})}toggle(){let e=this;this.on=!this.on;let t=Number(this.on),i=1-t,r={from:t};this.on?this.car.crashed?this.keys.hintSpace():this.keys.stopHinting():this.keys.hintEnter(),mt.ticker.add(s),this.sounds.playKeySound(),this.speed.shift(0);function s(){let o=e.key.rotation.x>=.4?-1:e.key.rotation.x<=-.4?1:e.on?-1:1;e.key.rotateOnAxis(new k(o,0,0).normalize(),.14)}mt.to(r,{duration:.2,from:i,onComplete:()=>{mt.ticker.remove(s)}})}setSpeed(e){this.speed=e}setCar(e){this.car=e}};var Gh=class{constructor(e,t,i,r,s,o){this.interactions=s,this.keys=o,this.turntable=null,this.car=null,this.ignition=null,this.current=0,this.sounds=r,this.lever=e,this.head=i,t.onClickUp=this.shift.bind(this,1),t.onClickDown=this.shift.bind(this,-1),document.addEventListener("keydown",a=>{this.interactions.blocked||(a.key==="ArrowUp"&&(a.preventDefault(),a.stopImmediatePropagation()),a.key==="ArrowDown"&&(a.preventDefault(),a.stopImmediatePropagation()))}),document.addEventListener("keyup",a=>{this.interactions.blocked||(a.key==="ArrowUp"&&(this.shift(1),a.preventDefault(),a.stopImmediatePropagation()),a.key==="ArrowDown"&&(this.shift(-1),a.preventDefault(),a.stopImmediatePropagation()))})}shift(e){let t=this.current+e;if(t<0||t>3)return;this.sounds.playLeverSound(),this.current=t;let i=this;this.on=!this.on;let r=Number(this.on),s=1-r,o={from:r};this.car.crashed||(this.ignition.on?this.current===0?this.keys.hintUp():this.keys.dim():this.keys.hintEnter()),this.sounds.playRotationSound(this.ignition.on?this.current:0),this.head.moveOnSpeedLeverShift(e,this.ignition.on?this.current:0),mt.ticker.add(a);function a(){i.lever.rotateOnAxis(new k(0,0,e>0?-1:1).normalize(),.05*Math.abs(e))}mt.to(o,{duration:.1,from:s,onComplete:()=>{mt.ticker.remove(a),i.lever.rotation.z=-.25*this.current}}),this.turntable&&this.turntable.onChangeSpeed(this.ignition.on?this.current:0),this.car&&this.car.onChangeSpeed(this.ignition.on?this.current:0)}setTurntable(e){this.turntable=e}setCar(e){this.car=e}setIgnition(e){this.ignition=e}};var Vh=class{constructor(e,t,i){let r=new Ln(new R(.2,2,7.4));if(this.triggerBodyIn=new xe,this.triggerBodyIn.addShape(r),this.triggerBodyIn.position.set(2,7,9),this.triggerBodyInAngle=-.1,this.triggerBodyIn.quaternion.setFromAxisAngle(new R(0,1,0),this.triggerBodyInAngle),this.triggerBodyOut=new xe,this.triggerBodyOut.addShape(r),this.triggerBodyOut.position.set(-7.8,7,7.5),this.triggerBodyOutAngle=-.4,this.triggerBodyOut.quaternion.setFromAxisAngle(new R(0,1,0),this.triggerBodyOutAngle),this.triggerBodyIn.addEventListener("collide",s=>{s.body===t.body&&t.onCrash()}),e.addEventListener("endContact",s=>{(s.bodyA===t.body&&s.bodyB===this.triggerBodyOut||s.bodyB===t.body&&s.bodyA===this.triggerBodyOut)&&t.onReset()}),e.addBody(this.triggerBodyIn),e.addBody(this.triggerBodyOut),i){let s=i.addFolder("Triggers");s.add(this.triggerBodyIn.position,"x").min(-20).max(20).step(.1).name("Trigger in position x"),s.add(this.triggerBodyIn.position,"y").min(-20).max(20).step(.1).name("Trigger in position y"),s.add(this.triggerBodyIn.position,"z").min(-20).max(20).step(.1).name("Trigger in position z"),s.add(this,"triggerBodyInAngle").min(-2).max(2).step(.001).onChange(o=>{this.triggerBodyIn.quaternion.setFromAxisAngle(new R(0,1,0),o)}).name("Trigger in angle"),s.add(this.triggerBodyOut.position,"x").min(-20).max(20).step(.1).name("Trigger out position x"),s.add(this.triggerBodyOut.position,"y").min(-20).max(20).step(.1).name("Trigger out position y"),s.add(this.triggerBodyOut.position,"z").min(-20).max(20).step(.1).name("Trigger out position z"),s.add(this,"triggerBodyOutAngle").min(-2).max(2).step(.001).onChange(o=>{this.triggerBodyOut.quaternion.setFromAxisAngle(new R(0,1,0),o)}).name("Trigger out angle")}}};var Wh=class{constructor(e,t,i,r,s,o,a,c){if(this.canvas=e,this.interactions=a,this.magnet=null,this.speed=null,this.sounds=o,this.wheel=t,this.head=i,this.joystick=r,this.intensity=0,this.direction=0,this.prevAngle=0,this.currentAngle=0,this.isPointerActive=!1,this.isIntensityIncreasing=!1,this.changeFactor=1.75,this.changePotency=1.25,this.enabled=!0,c){let u=c.addFolder("Steering");u.add(this,"enabled").name("Steering enabled").onChange(()=>{s.enabled=!this.enabled}),u.add(this,"changeFactor").min(0).max(10).step(1e-4).name("Steering change factor"),u.add(this,"changePotency").min(.5).max(20).step(.01).name("Steering change potency")}document.addEventListener("keydown",u=>{if(!this.interactions.blocked&&!!this.enabled&&!this.isPointerActive&&(u.key==="ArrowLeft"||u.key==="ArrowRight")){switch(u.preventDefault(),u.stopImmediatePropagation(),this.isIntensityIncreasing=!0,u.key){case"ArrowLeft":this.direction=-1;break;case"ArrowRight":this.direction=1;break}u.preventDefault()}}),document.addEventListener("keyup",u=>{if(!this.interactions.blocked&&!!this.enabled&&!this.isPointerActive&&(u.key==="ArrowLeft"||u.key==="ArrowRight")){if(u.preventDefault(),u.stopImmediatePropagation(),u.key==="ArrowLeft"&&this.direction===1||u.key==="ArrowRight"&&this.direction===-1){this.intensity=0;return}this.isIntensityIncreasing=!1,this.direction=0,this.intensity=0}}),this.canvas.style.cursor="grab",window.addEventListener("mousedown",()=>{this.interactions.blocked||!this.enabled||(this.isPointerActive=!0,this.canvas.style.cursor="grabbing")}),window.addEventListener("mouseup",()=>{this.interactions.blocked||!this.enabled||(this.isPointerActive=!1,this.canvas.style.cursor="grab")}),window.addEventListener("mousemove",u=>{this.interactions.blocked||!this.enabled||!this.isPointerActive||this.turnWithPointer(u)})}moveMagnet(e=!1){if(!this.magnet)return;let t=4,r=t+(16-t)*(this.currentAngle+1)/2;this.magnet.springBody.position.z=r,this.speed&&(this.speed.current>0||e)&&setTimeout(()=>{this.magnet.springBody2.position.z=r-this.currentAngle+3},200/this.speed.current)}turnWheel(e){this.wheel.setRotationFromEuler(new gi(e,0,.72,"YZX")),this.currentAngle=e,Math.abs(Math.abs(this.prevAngle)-Math.abs(this.currentAngle))>.3&&(this.sounds.playWheelSound(),this.head.moveOnWheelTurn(this.currentAngle,this.isIntensityIncreasing,this.wheel.rotation),this.prevAngle=this.currentAngle),this.moveMagnet()}turnWithPointer(e){let t=Math.max(-1,Math.min(1,(e.offsetX/window.innerWidth*2-1)*-2));this.turnWheel(t)}turnWithKeys(e){this.isIntensityIncreasing?this.intensity<1?this.intensity+=this.changeFactor*e*Math.pow(2-this.intensity,this.changePotency):this.intensity=1:this.intensity>0&&(this.intensity-=this.changeFactor*e*Math.pow(2-this.intensity,this.changePotency));let t=this.intensity*-this.direction,i=this.currentAngle;t=Math.max(-1,Math.min(1,t+i)),t!==this.currentAngle&&this.turnWheel(t)}setMagnet(e){this.magnet=e}setSpeed(e){this.speed=e,this.moveMagnet(!0)}onTick(e){if(this.joystick.value.x){this.turnWheel(-this.joystick.value.x);return}this.isPointerActive||this.turnWithKeys(e)}};var jh=class{constructor(e,t,i,r,s){this.groupTurntable=new an,this.currentGear=0,this.currentAngle=0,this.maxSpeed=2,this.gearwheel=r,this.gearwheelAngle=0,this.body=i,this.axis=new R(0,1,0);for(let o of t)this.groupTurntable.add(o);e.add(this.groupTurntable),s&&s.addFolder("Turntable").add(this,"maxSpeed").min(0).max(10).step(.001).name("Max speed")}onChangeSpeed(e){this.currentGear=e}onTick(e){this.currentAngle=(this.currentAngle+this.currentGear*this.maxSpeed*e)%(Math.PI*2),this.body.quaternion.setFromAxisAngle(this.axis,this.currentAngle),this.currentGear>0&&(this.gearwheelAngle+=.1,this.gearwheel.rotateOnAxis(new k(0,1,0).normalize(),this.gearwheelAngle))}};var qh=class{constructor(e,t,i,r,s,o,a,c){this.interactions=s,this.hasHadInitialImpact=!1,this.joystick=o,this.keys=a,this.sounds=r,this.turntable=null,this.ignition=null,this.constraint=null,this.world=i,this.currentGear=0,this.currentAngle=null,this.axis=new R(0,1,0),this.crashed=!1,this.shape=e,this.initialPosition=e.position.clone(),this.body=new xe({mass:20,linearDamping:.001,shape:new Ln(new R(e.geometry.boundingBox.min.x,e.geometry.boundingBox.getSize(new k).y/2,e.geometry.boundingBox.min.z)),position:new R(0,0,0),material:t}),this.body.position.copy(e.position),this.positionY=this.body.position.y,this.body.position.y=7,this.body.quaternion.copy(e.quaternion),this.initialPosition=this.body.position.clone(),this.initialQuaternion=this.body.quaternion.clone(),this.body.addEventListener("collide",this.onCollide.bind(this)),this.impactStrengthTolerance=100,this.onCrashThrottled=ec(this.onCrash.bind(this),500,{trailing:!1}),c&&c.addFolder("Car").add(this,"impactStrengthTolerance").min(0).max(100).step(.001),document.addEventListener("keydown",u=>{this.interactions.blocked||u.key===" "&&(u.preventDefault(),u.stopImmediatePropagation())}),document.addEventListener("keyup",u=>{this.interactions.blocked||u.key===" "&&this.crashed&&(this.resetCar.apply(this),u.preventDefault(),u.stopImmediatePropagation())}),this.joystick.onClickReset=this.resetCar.bind(this)}setTurntable(e){this.turntable=e}setIgnition(e){this.ignition=e}resetCar(){this.onReset(),this.body.position.copy(this.initialPosition),this.body.quaternion.copy(this.initialQuaternion)}onReset(){this.crashed&&(this.currentGear===0?this.ignition.on?this.keys.hintUp():this.keys.hintEnter():this.keys.dim(),this.world.removeConstraint(this.constraint),this.constraint=null,this.body.angularDamping=0,this.crashed=!1,this.joystick.onReset())}onCrash(){if(!this.hasHadInitialImpact){this.hasHadInitialImpact=!0;return}if(this.crashed)return;this.crashed=!0,this.joystick.onCrash(),this.keys.hintSpace();let e=this.body.position,t=new R(0,1,0),i=this.body.pointToLocalFrame(e),r=this.turntable.body.pointToLocalFrame(e),s=this.body.vectorToLocalFrame(t),o=this.turntable.body.vectorToLocalFrame(t);this.constraint||(this.constraint=new Ta(this.body,this.turntable.body,{pivotA:i,pivotB:r,axisA:s,axisB:o}),this.world.addConstraint(this.constraint)),this.body.angularDamping=1}onCollide(e){let t=e.contact.getImpactVelocityAlongNormal();this.sounds.playHitSound(t),t>this.impactStrengthTolerance&&this.onCrashThrottled()}onChangeSpeed(e){this.currentGear=e}onTick(e){if(this.body.position.y<5){this.resetCar();return}if(this.crashed){if(this.body.position.y=this.positionY,!this.crashAngle){this.crashAngle=this.body.quaternion.y*Math.PI;return}this.currentAngle=(this.currentAngle+this.currentGear*2*e)%(Math.PI*2),this.body.quaternion.setFromAxisAngle(this.axis,this.currentAngle+this.crashAngle)}}};var Xh=class{constructor(e,t){if(this.cannonDebugger=null,this.world=new uo,this.scene=t,this.world.broadphase=new tn(this.world),this.world.gravity.set(0,-150,0),this.defaultMaterial=new Bi("default"),this.defaultContactMaterial=new Fi(this.defaultMaterial,this.defaultMaterial,{friction:1e8,restitution:.5,frictionEquationRelaxation:2.5,contactEquationStiffness:1e8,frictionEquationStiffness:1e4,contactEquationRelaxation:2}),this.world.addContactMaterial(this.defaultContactMaterial),this.world.defaultContactMaterial=this.defaultContactMaterial,e){let i=e.addFolder("World");i.add(this,"enableCannonDebugger"),i.add(this.defaultContactMaterial,"restitution").min(0).max(10).step(.001),i.add(this.defaultContactMaterial,"contactEquationRelaxation").min(0).max(10).step(.001),i.add(this.defaultContactMaterial,"contactEquationStiffness").min(0).max(1e8).step(10),i.add(this.defaultContactMaterial,"frictionEquationRelaxation").min(0).max(10).step(.001),i.add(this.defaultContactMaterial,"frictionEquationStiffness").min(0).max(1e4).step(10),i.add(this.defaultContactMaterial,"friction").min(0).max(1e8).step(10)}}async enableCannonDebugger(){this.cannonDebugger||(this.cannonDebugger=(await Promise.resolve().then(()=>xg())).default,this.cannonDebugger(this.scene,this.world.bodies))}};var Yh=class{constructor(e,t,i){let r=new Ea(.1);this.springBody=new xe({mass:0}),this.springBody.addShape(r),this.springBody.position.set(e.body.position.x,0,e.body.position.z),this.springBody2=new xe({mass:0}),this.springBody2.addShape(r),this.springBody2.position.set(5,0,e.body.position.z),t.addBody(this.springBody),t.addBody(this.springBody2);let s=e.shape.geometry.boundingBox.min.x/2;if(this.spring=new co(e.body,this.springBody,{localAnchorA:new R(s/1.5,s,0),localAnchorB:new R(0,0,0),restLength:0,stiffness:6e3,damping:1e3}),this.spring2=new co(e.body,this.springBody2,{localAnchorA:new R(s/.25,s,0),localAnchorB:new R(0,0,0),restLength:100,stiffness:60,damping:10}),t.addEventListener("postStep",()=>{e.crashed||(this.spring.applyForce(),this.spring2.applyForce())}),i){let o=i.addFolder("Magnet");o.add(this.spring,"damping").min(0).max(1e5).step(1).name("Spring 1 damping"),o.add(this.spring,"restLength").min(.1).max(10).step(.01).name("Spring 1 restLength"),o.add(this.spring,"stiffness").min(.01).max(1e5).step(1).name("Spring 1 stiffness"),o.add(this.springBody.position,"z").min(4).max(14).step(.001).name("Spring 1 position z"),o.add(this.spring2,"damping").min(0).max(1e5).step(1).name("Spring 2 damping"),o.add(this.spring2,"restLength").min(.1).max(10).step(.01).name("Spring 2 restLength"),o.add(this.spring2,"stiffness").min(.01).max(1e5).step(1).name("Spring 2 stiffness"),o.add(this.springBody2.position,"x").min(4).max(14).step(.001).name("Spring 2 position x")}}};var Zh=class{constructor(e){this.interactions=e,this.onClickUp=null,this.onClickDown=null,this.onClickReset=null,this.maxDistance=42,this.deadzone=1,this.joy=document.createElement("div"),this.joy.id="joy",this.joy.classList.add("joy"),this.stick=document.createElement("div"),this.stick.classList.add("stick"),this.joy.appendChild(this.stick),document.body.appendChild(this.joy),this.btnReset=document.createElement("div"),this.btnReset.id="btn-reset",this.btnReset.classList.add("btn"),this.btnReset.classList.add("btn--reset"),document.body.appendChild(this.btnReset),this.btnReset.addEventListener("mousedown",this.handleBtnResetStart.bind(this)),this.btnReset.addEventListener("touchstart",this.handleBtnResetStart.bind(this)),this.btnReset.addEventListener("mouseup",this.handleBtnResetEnd.bind(this)),this.btnReset.addEventListener("touchend",this.handleBtnResetEnd.bind(this)),this.btnUp=document.createElement("a"),this.btnUp.id="btn-up",this.btnUp.classList.add("btn"),this.btnUp.classList.add("btn--up"),document.body.appendChild(this.btnUp),this.btnUp.addEventListener("mousedown",this.handleBtnUpStart.bind(this)),this.btnUp.addEventListener("touchstart",this.handleBtnUpStart.bind(this)),this.btnUp.addEventListener("mouseup",this.handleBtnUpEnd.bind(this)),this.btnUp.addEventListener("touchend",this.handleBtnUpEnd.bind(this)),this.btnDown=document.createElement("a"),this.btnDown.id="btn-down",this.btnDown.classList.add("btn"),this.btnDown.classList.add("btn--down"),document.body.appendChild(this.btnDown),this.btnDown.addEventListener("mousedown",this.handleBtnDownStart.bind(this)),this.btnDown.addEventListener("touchstart",this.handleBtnDownStart.bind(this)),this.btnDown.addEventListener("mouseup",this.handleBtnDownEnd.bind(this)),this.btnDown.addEventListener("touchend",this.handleBtnDownEnd.bind(this)),this.dragStart=null,this.touchId=null,this.active=!1,this.value={x:0,y:0},this.joy.addEventListener("mousedown",this.handleDown.bind(this)),this.joy.addEventListener("touchstart",this.handleDown.bind(this)),this.stick.addEventListener("mousedown",this.handleDown.bind(this)),this.stick.addEventListener("touchstart",this.handleDown.bind(this)),document.addEventListener("mousemove",this.handleMove.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleMove.bind(this),{passive:!1}),document.addEventListener("mouseup",this.handleUp.bind(this)),document.addEventListener("touchend",this.handleUp.bind(this))}handleDown(e){if(this.interactions.blocked)return;e.stopImmediatePropagation(),this.active=!0,this.joy.classList.add("joy--active"),this.stick.style.transition="0s",e.preventDefault();let t=this.stick.getBoundingClientRect();if(e.changedTouches){let i=t.x-e.changedTouches[0].clientX+t.width/2,r=t.y-e.changedTouches[0].clientY+t.height/2;this.dragStart={x:e.changedTouches[0].clientX+i,y:e.changedTouches[0].clientY+r}}else{let i=t.x-e.clientX+t.width/2,r=t.y-e.clientY+t.height/2;this.dragStart={x:e.clientX+i,y:e.clientY+r}}e.changedTouches&&(this.touchId=e.changedTouches[0].identifier),this.handleMove(e)}handleMove(e){if(this.interactions.blocked||!this.active)return;e.stopImmediatePropagation();let t=null;if(e.changedTouches){for(let p=0;p<e.changedTouches.length;p++)this.touchId==e.changedTouches[p].identifier&&(t=p,e.clientX=e.changedTouches[p].clientX,e.clientY=e.changedTouches[p].clientY);if(t==null)return}let i=e.clientX-this.dragStart.x,r=e.clientY-this.dragStart.y,s=Math.atan2(r,i),o=Math.min(this.maxDistance,Math.hypot(i,r)),a=o*Math.cos(s),c=o*Math.sin(s);this.stick.style.transform=`translate3d(${a}px, ${c}px, 0px)`;let u=0;o>=this.deadzone&&(u=this.maxDistance/(this.maxDistance-this.deadzone)*(o-this.deadzone));let d=u*Math.cos(s),f=u*Math.sin(s),l=parseFloat((d/this.maxDistance).toFixed(4)),h=parseFloat((f/this.maxDistance).toFixed(4));this.value={x:l,y:h}}handleUp(e){this.interactions.blocked||!this.active||(e.stopImmediatePropagation(),!(e.changedTouches&&this.touchId!=e.changedTouches[0].identifier)&&(this.stick.style.transition=".2s",this.stick.style.transform="translate3d(0px, 0px, 0px)",this.value={x:0,y:0},this.touchId=null,this.active=!1,this.joy.classList.remove("joy--active")))}handleBtnUpStart(e){this.interactions.blocked||(e.preventDefault(),this.onClickUp&&this.onClickUp(),this.btnUp.classList.add("btn--active"))}handleBtnUpEnd(e){this.interactions.blocked||(e.preventDefault(),this.btnUp.classList.remove("btn--active"))}handleBtnDownStart(e){this.interactions.blocked||(e.preventDefault(),this.onClickDown&&this.onClickDown(),this.btnDown.classList.add("btn--active"))}handleBtnDownEnd(e){this.interactions.blocked||(e.preventDefault(),this.btnDown.classList.remove("btn--active"))}handleBtnResetStart(e){this.interactions.blocked||(e.preventDefault(),this.onClickReset&&this.onClickReset(),this.btnDown.classList.add("btn--active"))}handleBtnResetEnd(e){this.interactions.blocked||(e.preventDefault(),this.btnDown.classList.remove("btn--active"))}onReset(){this.btnReset.classList.remove("btn--visible")}onCrash(){this.btnReset.classList.add("btn--visible")}enter(){this.joy.style.visibility="visible",this.joy.style.opacity="1",this.btnUp.style.visibility="visible",this.btnUp.style.opacity="1",this.btnDown.style.visibility="visible",this.btnDown.style.opacity="1"}};var Jh=class{constructor(){this.keys=document.getElementById("keys"),this.keyEnter=document.getElementById("key-enter"),this.keySpace=document.getElementById("key-space"),this.keyUp=document.getElementById("key-up"),this.allKeys=[this.keys,this.keyEnter,this.keySpace,this.keyUp]}enter(){this.keys.style.opacity="1"}stopHinting(){for(let e of this.allKeys)e.classList.remove("key--hinting")}hintEnter(){this.stopHinting(),this.undim(),this.keyEnter.classList.add("key--hinting")}hintSpace(){this.stopHinting(),this.undim(),this.keySpace.classList.add("key--hinting")}hintUp(){this.stopHinting(),this.undim(),this.keyUp.classList.add("key--hinting")}dim(){this.stopHinting(),this.keys.style.opacity="0.5"}undim(){this.keys.style.opacity="1"}};(async()=>{let n=location.hash==="#debug",e=document.createElement("canvas");e.classList.add("webgl"),document.body.appendChild(e);let t;if(n){let O=(await Promise.resolve().then(()=>bg())).default;t=new O,t.showPanel(0),document.body.appendChild(t.dom)}let i;if(n){let{GUI:O}=await Promise.resolve().then(()=>Wg());i=new O({width:346}),i.closed=!0}let r={blocked:!0},s=new Do,o=new _n(2,2,1),a=new nt({transparent:!0,uniforms:{uAlpha:{value:1}},vertexShader:`
			void main() {
				gl_Position = vec4(position, 1.0);
			}
    `,fragmentShader:`
			uniform float uAlpha;
			void main() {
				gl_FragColor = vec4(0.12, 0.12, 0.08, uAlpha);
			}
    `}),c=new ke(o,a);s.add(c);let u=new Jh,d=document.body.getBoundingClientRect(),f={width:d.width,height:d.height};function l(){let O=document.body.getBoundingClientRect();f.width=O.width,f.height=O.height,_.onResize(f),b.renderer.setSize(f.width,f.height),w.effectComposer.setSize(f.width,f.height)}window.addEventListener("resize",l);function h(){s.traverse(O=>{O instanceof ke&&O.material instanceof yt&&(O.material.needsUpdate=!0,O.castShadow=!0,O.receiveShadow=!0)})}let p=new Dh(r,i),m=new Xh(i,s),v=m.world;_g(s,i),pg(s,i);let _=new Fh(s,f,i),g=new Zh(r),y=yg(e,_.camera,i),b=new Bh(e,f,h,i),w=new zh(s,_.camera,b.renderer,f,i);function x(){document.getElementById("overlay").classList.add("removed"),_.enter(),mt.to(a.uniforms.uAlpha,{duration:1,value:0,onComplete:()=>{document.body.removeChild(document.getElementById("overlay")),s.remove(c),c=null,r.blocked=!1,g.enter(),u.enter(),u.hintUp()}})}let S=document.getElementById("progress"),P=0,T=0,I=0,U=new Al(()=>{mt.delayedCall(.5,()=>{x()})},(O,F,Z)=>{let ee=F/Z;I=Math.max(I,P,ee),S.style.transform=`translateX(${(-1+I)*100}%)`}),W=new lg(U),D=new xe({mass:0,material:m.defaultMaterial});v.addBody(D);let L=new xe({mass:0,material:m.defaultMaterial});v.addBody(L),W.load("zarulem.glb",async O=>{let F=[],Z,ee,oe,ge,de,ne,Te,Ae;O.scene.traverse(M=>{M instanceof ke&&M.material instanceof yt&&(M.material.side=di,(M.name==="rug"||M.name.indexOf("plate")===0&&M.material.map)&&(M.material.map.generateMipmaps=!1,M.material.map.minFilter=_t)),M.name==="key"&&(Ae=new Uh(M,p,r,u)),M.name==="speed"&&(de=new Gh(M,g,_,p,r,u)),M.name==="steering"&&(ge=new Wh(e,M,_,g,y,p,r,i),_.connectToWheel(M)),M.name==="shapePlate"&&Ih(L,M),["obstacles","bridges","plate"].includes(M.name)&&F.push(M),M.name==="gearwheel"&&(Te=M),M instanceof ke&&M.name.indexOf("shape")===0&&(M.visible=!1),M instanceof ke&&M.name.indexOf("shapeWall")===0&&cg(D,M),M.name.indexOf("shapeCylinder")===0&&Ih(D,M),M.name==="car"&&(ee=M),M.name.indexOf("shapeCar")===0&&(Z=new qh(M,m.defaultMaterial,v,p,r,g,u,i),oe=Z.body,v.addBody(oe),ne=new Yh(Z,v,i))});let re=new jh(s,F,D,Te,i);de.setTurntable(re),de.setCar(Z),de.setIgnition(Ae),Ae.setSpeed(de),Ae.setCar(Z),ge.setMagnet(ne),ge.setSpeed(de),Z.setTurntable(re),Z.setIgnition(Ae);let C=[{mesh:ee,body:oe},{mesh:re.groupTurntable,body:D}];new Vh(v,Z,i),s.add(O.scene),h(),vg(w,b,y,ge,re,Z,v,C,t)},O=>{P=O.loaded/8433840,I=Math.max(I,P,T),S.style.transform=`translateX(${(-1+I)*100}%)`})})();
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
/*!
 * CSSPlugin 3.11.0
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/*!
 * GSAP 3.11.0
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
//# sourceMappingURL=index.js.map
